(function(He,dt){typeof exports=="object"&&typeof module<"u"?dt(exports):typeof define=="function"&&define.amd?define(["exports"],dt):(He=typeof globalThis<"u"?globalThis:He||self,dt(He.BlockSuitePlayground={}))})(this,function(He){"use strict";var gge=Object.defineProperty;var v6=He=>{throw TypeError(He)};var bge=(He,dt,At)=>dt in He?gge(He,dt,{enumerable:!0,configurable:!0,writable:!0,value:At}):He[dt]=At;var J=(He,dt,At)=>bge(He,typeof dt!="symbol"?dt+"":dt,At),VE=(He,dt,At)=>dt.has(He)||v6("Cannot "+At);var ne=(He,dt,At)=>(VE(He,dt,"read from private field"),At?At.call(He):dt.get(He)),Nr=(He,dt,At)=>dt.has(He)?v6("Cannot add the same private member more than once"):dt instanceof WeakSet?dt.add(He):dt.set(He,At),Kt=(He,dt,At,ou)=>(VE(He,dt,"write to private field"),ou?ou.call(He,At):dt.set(He,At),At),Ea=(He,dt,At)=>(VE(He,dt,"access private method"),At);var _n,Nn,lo,Nt,on,ha,yl,fa,_s,_l,Vh,xl,w6,pa,Zm,XE,k6,m6;const dt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function At(t,e,n){const r=n[0];if(e!=null&&t>=e)throw new Error(t+" >= "+e);if(t.slice(-1)===r||e&&e.slice(-1)===r)throw new Error("trailing zero");if(e){let o=0;for(;(t[o]||r)===e[o];)o++;if(o>0)return e.slice(0,o)+At(t.slice(o),e.slice(o),n)}const i=t?n.indexOf(t[0]):0,s=e!=null?n.indexOf(e[0]):n.length;if(s-i>1){const o=Math.round(.5*(i+s));return n[o]}else return e&&e.length>1?e.slice(0,1):n[i]+At(t.slice(1),null,n)}function ou(t){if(t.length!==rv(t[0]))throw new Error("invalid integer part of order key: "+t)}function rv(t){if(t>="a"&&t<="z")return t.charCodeAt(0)-97+2;if(t>="A"&&t<="Z")return 90-t.charCodeAt(0)+2;throw new Error("invalid order key head: "+t)}function au(t){const e=rv(t[0]);if(e>t.length)throw new Error("invalid order key: "+t);return t.slice(0,e)}function iv(t,e){if(t==="A"+e[0].repeat(26))throw new Error("invalid order key: "+t);const n=au(t);if(t.slice(n.length).slice(-1)===e[0])throw new Error("invalid order key: "+t)}function sv(t,e){ou(t);const[n,...r]=t.split("");let i=!0;for(let s=r.length-1;i&&s>=0;s--){const o=e.indexOf(r[s])+1;o===e.length?r[s]=e[0]:(r[s]=e[o],i=!1)}if(i){if(n==="Z")return"a"+e[0];if(n==="z")return null;const s=String.fromCharCode(n.charCodeAt(0)+1);return s>"a"?r.push(e[0]):r.pop(),s+r.join("")}else return n+r.join("")}function S6(t,e){ou(t);const[n,...r]=t.split("");let i=!0;for(let s=r.length-1;i&&s>=0;s--){const o=e.indexOf(r[s])-1;o===-1?r[s]=e.slice(-1):(r[s]=e[o],i=!1)}if(i){if(n==="a")return"Z"+e.slice(-1);if(n==="A")return null;const s=String.fromCharCode(n.charCodeAt(0)-1);return s<"Z"?r.push(e.slice(-1)):r.pop(),s+r.join("")}else return n+r.join("")}function jn(t,e,n=dt){if(t!=null&&iv(t,n),e!=null&&iv(e,n),t!=null&&e!=null&&t>=e)throw new Error(t+" >= "+e);if(t==null){if(e==null)return"a"+n[0];const l=au(e),c=e.slice(l.length);if(l==="A"+n[0].repeat(26))return l+At("",c,n);if(l<e)return l;const u=S6(l,n);if(u==null)throw new Error("cannot decrement any more");return u}if(e==null){const l=au(t),c=t.slice(l.length),u=sv(l,n);return u??l+At(c,null,n)}const r=au(t),i=t.slice(r.length),s=au(e),o=e.slice(s.length);if(r===s)return r+At(i,o,n);const a=sv(r,n);if(a==null)throw new Error("cannot increment any more");return a<e?a:r+At(i,null,n)}function C6(t,e){return t.startsWith(e)||e.startsWith(t)}function A6(t,e){function r(a=32){const l="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c=new Uint8Array(a);crypto.getRandomValues(c);let u="";for(let d=0;d<a;d++)u+=l.charAt(c[d]%l.length);return u}function i(a){return null}const s=i(),o=i();if(s===null&&o===null)return jn(null,null)+"0"+r();if(s===null&&o!==null)return jn(null,o)+"0"+r();if(o===null&&s!==null)return jn(s,null)+"0"+r();if(s!==null&&o!==null&&!(C6(s,o)&&t!==null))return jn(s,o)+"0"+r();throw new Error("Never reach here")}const Qh=Symbol("GfxGroupCompatible"),gr=t=>typeof t!="object"||t===null?!1:Qh in t&&t[Qh]===!0;var re=(t=>(t[t.DefaultRuntimeError=1]="DefaultRuntimeError",t[t.ReactiveProxyError=2]="ReactiveProxyError",t[t.DocCollectionError=3]="DocCollectionError",t[t.ModelCRUDError=4]="ModelCRUDError",t[t.ValueNotExists=5]="ValueNotExists",t[t.ValueNotInstanceOf=6]="ValueNotInstanceOf",t[t.ValueNotEqual=7]="ValueNotEqual",t[t.MigrationError=8]="MigrationError",t[t.SchemaValidateError=9]="SchemaValidateError",t[t.TransformerError=10]="TransformerError",t[t.InlineEditorError=11]="InlineEditorError",t[t.TransformerNotImplementedError=12]="TransformerNotImplementedError",t[t.EdgelessExportError=13]="EdgelessExportError",t[t.CommandError=14]="CommandError",t[t.EventDispatcherError=15]="EventDispatcherError",t[t.SelectionError=16]="SelectionError",t[t.GfxBlockElementError=17]="GfxBlockElementError",t[t.MissingViewModelError=18]="MissingViewModelError",t[t.DatabaseBlockError=19]="DatabaseBlockError",t[t.ParsingError=20]="ParsingError",t[t.UserAbortError=21]="UserAbortError",t[t.ExecutionError=22]="ExecutionError",t[t.DefaultFatalError=1e4]="DefaultFatalError",t[t.NoRootModelError=10001]="NoRootModelError",t[t.NoSurfaceModelError=10002]="NoSurfaceModelError",t[t.NoneSupportedSSRError=10003]="NoneSupportedSSRError",t))(re||{});class V extends Error{constructor(e,n,r){super(n,r),this.name="BlockSuiteError",this.code=e,this.isFatal=e>=1e4}}V.ErrorCode=re;function I6(t){if(!(t instanceof V))throw t;if(t.isFatal)throw new Error("A fatal error for BlockSuite occurs, please contact the team if you find this.",{cause:t});console.error("A runtime error for BlockSuite occurs, you can ignore this error if it won't break the user experience."),console.error(t.stack)}const W=class qE{static clamp(e,n,r){return Math.max(n,r!==void 0?Math.min(e,r):e)}static clampV(e,n,r){return e.map(i=>r!==void 0?qE.clamp(i,n,r):qE.clamp(i,n))}static cross(e,n,r){return(n[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(n[1]-e[1])}static snap(e,n=1){return[Math.round(e[0]/n)*n,Math.round(e[1]/n)*n]}};W.abs=t=>[Math.abs(t[0]),Math.abs(t[1])],W.add=(t,e)=>[t[0]+e[0],t[1]+e[1]],W.addScalar=(t,e)=>[t[0]+e,t[1]+e],W.ang=(t,e)=>Math.atan2(W.cpr(t,e),W.dpr(t,e)),W.ang3=(t,e,n)=>{const r=W.vec(e,t),i=W.vec(e,n);return W.ang(r,i)},W.angle=(t,e)=>Math.atan2(e[1]-t[1],e[0]-t[0]),W.clockwise=(t,e,n)=>W.isLeft(t,e,n)>0,W.cpr=(t,e)=>t[0]*e[1]-e[0]*t[1],W.dist=(t,e)=>Math.hypot(t[1]-e[1],t[0]-e[0]),W.dist2=(t,e)=>W.len2(W.sub(t,e)),W.distanceToBounds=(t,e)=>W.dist(e,W.nearestPointOnBounds(t,e)),W.distanceToLineSegment=(t,e,n,r=!0)=>W.dist(n,W.nearestPointOnLineSegment(t,e,n,r)),W.distanceToLineThroughPoint=(t,e,n)=>W.dist(n,W.nearestPointOnLineThroughPoint(t,e,n)),W.div=(t,e)=>[t[0]/e,t[1]/e],W.divV=(t,e)=>[t[0]/e[0],t[1]/e[1]],W.dpr=(t,e)=>t[0]*e[0]+t[1]*e[1],W.fastDist=(t,e)=>{const n=[e[0]-t[0],e[1]-t[1]],r=[Math.abs(n[0]),Math.abs(n[1])];let i=1/Math.max(r[0],r[1]);return i=i*(1.29289-(r[0]+r[1])*i*.29289),[n[0]*i,n[1]*i]},W.int=(t,e,n,r,i=1)=>{const s=(W.clamp(n,r)-n)/(r-n);return W.add(W.mul(t,1-s),W.mul(e,i))},W.isEqual=(t,e)=>t[0]===e[0]&&t[1]===e[1],W.isLeft=(t,e,n)=>(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]),W.len=t=>Math.hypot(t[0],t[1]),W.len2=t=>t[0]*t[0]+t[1]*t[1],W.lrp=(t,e,n)=>W.add(t,W.mul(W.sub(e,t),n)),W.max=(...t)=>[Math.max(...t.map(e=>e[0])),Math.max(...t.map(e=>e[1]))],W.med=(t,e)=>W.mul(W.add(t,e),.5),W.min=(...t)=>[Math.min(...t.map(e=>e[0])),Math.min(...t.map(e=>e[1]))],W.mul=(t,e)=>[t[0]*e,t[1]*e],W.mulV=(t,e)=>[t[0]*e[0],t[1]*e[1]],W.nearestPointOnBounds=(t,e)=>[W.clamp(e[0],t.minX,t.maxX),W.clamp(e[1],t.minY,t.maxY)],W.nearestPointOnLineSegment=(t,e,n,r=!0)=>{const i=W.uni(W.sub(e,t)),s=W.add(t,W.mul(i,W.pry(W.sub(n,t),i)));if(r){if(s[0]<Math.min(t[0],e[0]))return t[0]<e[0]?t:e;if(s[0]>Math.max(t[0],e[0]))return t[0]>e[0]?t:e;if(s[1]<Math.min(t[1],e[1]))return t[1]<e[1]?t:e;if(s[1]>Math.max(t[1],e[1]))return t[1]>e[1]?t:e}return s},W.nearestPointOnLineThroughPoint=(t,e,n)=>W.add(t,W.mul(e,W.pry(W.sub(n,t),e))),W.neg=t=>[-t[0],-t[1]],W.normalize=t=>W.uni(t),W.nudge=(t,e,n)=>W.isEqual(t,e)?t:W.add(t,W.mul(W.uni(W.sub(e,t)),n)),W.nudgeAtAngle=(t,e,n)=>[Math.cos(e)*n+t[0],Math.sin(e)*n+t[1]],W.per=t=>[t[1],-t[0]],W.pointOffset=(t,e,n)=>{let r=W.uni(W.sub(e,t));return W.isEqual(t,e)&&(r=t),W.add(t,W.mul(r,n))},W.pointsBetween=(t,e,n=6)=>Array.from({length:n}).map((r,i)=>{const s=i/(n-1),o=Math.min(1,.5+Math.abs(.5-s));return[...W.lrp(t,e,s),o]}),W.pry=(t,e)=>W.dpr(t,e)/W.len(e),W.rescale=(t,e)=>{const n=W.len(t);return[e*t[0]/n,e*t[1]/n]},W.rot=(t,e=0)=>[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[0]*Math.sin(e)+t[1]*Math.cos(e)],W.rotWith=(t,e,n=0)=>{if(n===0)return t;const r=Math.sin(n),i=Math.cos(n),s=t[0]-e[0],o=t[1]-e[1],a=s*i-o*r,l=s*r+o*i;return[a+e[0],l+e[1]]},W.slope=(t,e)=>t[0]===e[0]?NaN:(t[1]-e[1])/(t[0]-e[0]),W.sub=(t,e)=>[t[0]-e[0],t[1]-e[1]],W.subScalar=(t,e)=>[t[0]-e,t[1]-e],W.tangent=(t,e)=>W.uni(W.sub(t,e)),W.toFixed=t=>t.map(e=>Math.round(e*100)/100),W.toPoint=t=>({x:t[0],y:t[1]}),W.toPrecision=(t,e=4)=>[+t[0].toPrecision(e),+t[1].toPrecision(e)],W.toVec=t=>[t.x,t.y],W.uni=t=>W.div(t,W.len(t)),W.vec=(t,e)=>[e[0]-t[0],e[1]-t[1]];let R=W;class wt extends Array{constructor(e=[0,0],n=[0,0],r=[0,0],i=[0,0]){super(2),this._in=[0,0],this._out=[0,0],this._tangent=[0,0],this[0]=e[0],this[1]=e[1],this._tangent=n,this._in=r,this._out=i}get absIn(){return R.add(this,this._in)}get absOut(){return R.add(this,this._out)}get in(){return this._in}set in(e){this._in=e}get length(){return super.length}get out(){return this._out}set out(e){this._out=e}get tangent(){return this._tangent}set tangent(e){this._tangent=e}static fromVec(e){const n=new wt;return n[0]=e[0],n[1]=e[1],n}clone(){return new wt(this,this._tangent,this._in,this._out)}setVec(e){return this[0]=e[0],this[1]=e[1],this}toVec(){return[this[0],this[1]]}}const lu=1e-12,M6=112e-18,ov=Math.PI*2,D6=1e-8;function N6(){return Math.floor(Math.random()*2**31)}function Wr(t,e,n,r,i=!1){const s=R.sub(e,t),o=R.sub(r,n),a=R.cpr(s,o);if(Je(a,0,M6))return null;const l=R.sub(t,n);let c=R.cpr(o,l)/a;const u=R.cpr(s,l)/a,d=lu,h=-d,f=1+d;return i||h<c&&c<f&&h<u&&u<f?(i||(c=Il(c,0,1)),R.lrp(t,e,c)):null}function fo(t,e){const n=t.length;if(n<2)throw new Error("Polygon must have at least 2 points");let r=t[0],i=R.dist(t[0],e);for(let s=0;s<n;s++){const o=t[s],a=t[(s+1)%n],l=R.nearestPointOnLineSegment(o,a,e,!0),c=R.dist(l,e);c<i&&(i=c,r=l)}return r}function O6(t,e){const n=fo(t,e);return R.dist(n,e)}function Or(t,e,n){const r=po(n);return t.map(i=>R.rotWith(i,e,r))}function P6(t,e,n){const r=po(n);return R.add(e,R.rot(R.sub(t,e),r))}function po(t){return t*Math.PI/180}function L6(t,e){const[n,r]=e,i=R.sub(t,n),s=R.sub(t,r);return Je(R.cpr(i,s),0,.01)&&R.dpr(i,s)<=0}function Cl(t,e){const n=t.length;for(let r=0;r<n;r++){const i=t[r],s=t[(r+1)%n];if(L6(e,[i,s]))return R.normalize(R.sub(s,i))}return[0,0]}function Ri(t,e,n){const r=[],i=n.length;for(let s=0;s<i;s++){const o=n[s],a=n[(s+1)%i],l=Wr(t,e,o,a);if(l){const c=new wt(l);c.tangent=R.normalize(R.sub(a,o)),r.push(c)}}return r.length?r:null}function av(t,e,n){const r=[],i=n.length;for(let s=0;s<i-1;s++){const o=n[s],a=n[s+1],l=Wr(t,e,o,a);l&&r.push(new wt(l,R.normalize(R.sub(a,o))))}return r.length?r:null}function Jm(t,e){const n=t.length;let r,i=1/0;for(let s=0;s<n-1;s++){const o=t[s],a=t[s+1],l=R.nearestPointOnLineSegment(o,a,e,!0),c=R.dist(l,e);c<i&&(i=c,r=l)}return r}function lv(t,e,n,r,i){let s,o;if(n===0)s=r[0]-t.x,o=r[1]-t.y;else{const{minX:u,minY:d,maxX:h,maxY:f}=t,p=P6(r,[u+(h-u)/2,d+(f-d)/2],-n);s=p[0]-t.x,o=p[1]-t.y}let[a,l]=e,c;if(Zh(a[0],a[1],s,o)<i||Zh(l[0],l[1],s,o)<i)return!0;for(let u=0;u<e.length;u++){const d=[l[0]-a[0],l[1]-a[1]],h=Math.hypot(d[1],d[0]),f=[d[0]/h,d[1]/h],p=[s-a[0],o-a[1]],g=(p[0]*f[0]+p[1]*f[1])/Math.hypot(f[1],f[0]);c=[a[0]+f[0]*g,a[1]+f[1]*g];const b=Zh(c[0],c[1],a[0],a[1]),_=Zh(c[0],c[1],l[0],l[1]);if(c=_<b&&b>h?l:b<_&&_>h?a:c,Math.hypot(o-c[1],s-c[0])<i)return!0;a=l,l=e[u+1]}return!1}const Zh=(t,e,n,r)=>{const i=n-t,s=r-e;return Math.hypot(i,s)};function cv(t){return t*t}function eg(t,e){return cv(t[0]-e[0])+cv(t[1]-e[1])}function R6(t,e,n){const r=eg(e,n);if(r==0)return eg(t,e);let i=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/r;return i=Math.max(0,Math.min(1,i)),eg(t,[e[0]+i*(n[0]-e[0]),e[1]+i*(n[1]-e[1])])}function B6(t,e,n){return Math.sqrt(R6(t,e,n))}function Jh(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function Je(t,e,n=1e-4){return Math.abs(t-e)<n}function Al(t){return t.every(e=>cu(e))}function cu(t){return t>=-lu&&t<=lu}function Il(t,e,n){return Math.max(e,n!==void 0?Math.min(t,n):t)}function ef(t,e,n,r,i=0){const s=Math.cos(i),o=Math.sin(i),a=R.sub(t,e),l=s*a[0]+o*a[1],c=o*a[0]-s*a[1];return l*l/(n*n)+c*c/(r*r)<=1}function ci(t,e){let n=0;return e.forEach((r,i)=>{const s=e[(i+1)%e.length];r[1]<=t[1]?s[1]>t[1]&&R.cross(r,s,t)>0&&(n+=1):s[1]<=t[1]&&R.cross(r,s,t)<0&&(n-=1)}),n!==0}function tg(t,e,n){for(let r=0;r<e.length;++r){const i=r+1===e.length?0:r+1;if(B6(t,e[r],e[i])<=n)return!0}return!1}function uv(t,e=!0){const n=t.length;if(n<4)return"";let r=t[0],i=t[1];const s=t[2];let o=`M${r[0].toFixed(2)},${r[1].toFixed(2)} Q${i[0].toFixed(2)},${i[1].toFixed(2)} ${tf(i[0],s[0]).toFixed(2)},${tf(i[1],s[1]).toFixed(2)} T`;for(let a=2,l=n-1;a<l;a++)r=t[a],i=t[a+1],o+=`${tf(r[0],i[0]).toFixed(2)},${tf(r[1],i[1]).toFixed(2)} `;return e&&(o+="Z"),o}function tf(t,e){return(t+e)/2}function F6(t,e,n,r,i,s=0){t=R.rot(R.sub(t,n),-s),e=R.rot(R.sub(e,n),-s),r*=r,i*=i;const o=[],a=R.sub(e,t),l=r*a[1]*a[1]+i*a[0]*a[0],c=2*(r*t[1]*a[1]+i*t[0]*a[0]),u=r*t[1]*t[1]+i*t[0]*t[0]-r*i,d=c*c-4*l*u;if(d>=0){const h=Math.sqrt(d),f=(-c+h)/(2*l),p=(-c-h)/(2*l);0<=f&&f<=1&&o.push(R.add(R.rot(R.add(R.mul(a,f),t),s),n)),0<=p&&p<=1&&Math.abs(f-p)>1e-16&&o.push(R.add(R.rot(R.add(R.mul(a,p),t),s),n))}return o.length===0?null:o.map(h=>{const f=new wt(h),p=R.uni(R.divV(R.sub(h,n),[r*r,i*i]));return f.tangent=[-p[1],p[0]],f})}function nf(t){return t>0?1:-1}function ng(t,e){const{x:n,y:r,w:i,h:s,rotate:o}=t;if(!o)return e;const a=n+i/2,l=r+s/2,c=new DOMMatrix().translateSelf(a,l).rotateSelf(o).translateSelf(-a,-l),u=new DOMPoint(...e).matrixTransform(c);return[u.x,u.y]}function uu(t,e,n,r=!0){const i=r?(s,o)=>s<o:(s,o)=>s<=o;return!(i(Math.max(t[0][n],t[1][n]),Math.min(e[0][n],e[1][n]))||i(Math.max(e[0][n],e[1][n]),Math.min(t[0][n],t[1][n])))}function rg(t,e){const{x:n,y:r,w:i,h:s,rotate:o}=t,a=n+i/2,l=r+s/2,c=i*e,u=s*e;return{x:a-c/2,y:l-u/2,w:c,h:u,rotate:o}}function dv(t,e,n,r){return`[${t},${e},${n},${r}]`}function Ml(t){try{return JSON.parse(t)}catch(e){return console.error("Failed to deserialize xywh",t),console.error(e),[0,0,0,0]}}function ig(t,e=0){let n=1/0,r=1/0,i=-1/0,s=-1/0;if(t.length<1)n=0,r=0,i=1,s=1;else for(const[o,a]of t)n=Math.min(o,n),r=Math.min(a,r),i=Math.max(o,i),s=Math.max(a,s);return e!==0?ig(t.map(o=>R.rotWith(o,[(n+i)/2,(r+s)/2],e))):{minX:n,minY:r,maxX:i,maxY:s,x:n,y:r,w:i-n,h:s-r}}class X{get bl(){return[this.x,this.y+this.h]}get br(){return[this.x+this.w,this.y+this.h]}get center(){return[this.x+this.w/2,this.y+this.h/2]}set center([e,n]){const[r,i]=this.center;this.x+=e-r,this.y+=n-i}get horizontalLine(){return[[this.x,this.y+this.h/2],[this.x+this.w,this.y+this.h/2]]}get leftLine(){return[[this.x,this.y],[this.x,this.y+this.h]]}get lowerLine(){return[[this.x,this.y+this.h],[this.x+this.w,this.y+this.h]]}get maxX(){return this.x+this.w}get maxY(){return this.y+this.h}get midPoints(){return[[this.x+this.w/2,this.y],[this.x+this.w,this.y+this.h/2],[this.x+this.w/2,this.y+this.h],[this.x,this.y+this.h/2]]}get minX(){return this.x}get minY(){return this.y}get points(){return[[this.x,this.y],[this.x+this.w,this.y],[this.x+this.w,this.y+this.h],[this.x,this.y+this.h]]}get rightLine(){return[[this.x+this.w,this.y],[this.x+this.w,this.y+this.h]]}get tl(){return[this.x,this.y]}get tr(){return[this.x+this.w,this.y]}get upperLine(){return[[this.x,this.y],[this.x+this.w,this.y]]}get verticalLine(){return[[this.x+this.w/2,this.y],[this.x+this.w/2,this.y+this.h]]}constructor(e=0,n=0,r=0,i=0){this.x=e,this.y=n,this.w=r,this.h=i}static deserialize(e){const[n,r,i,s]=Ml(e);return new X(n,r,i,s)}static from(e){return new X(e.x,e.y,e.w,e.h)}static fromCenter(e,n,r){const[i,s]=e;return new X(i-n/2,s-r/2,n,r)}static fromDOMRect({left:e,top:n,width:r,height:i}){return new X(e,n,r,i)}static fromPoints(e){return X.from(ig(e))}static fromXYWH(e){return new X(e[0],e[1],e[2],e[3])}static serialize(e){return dv(e.x,e.y,e.w,e.h)}clone(){return new X(this.x,this.y,this.w,this.h)}contains(e){return e.x>=this.x&&e.y>=this.y&&e.maxX<=this.maxX&&e.maxY<=this.maxY}containsPoint([e,n]){const{minX:r,minY:i,maxX:s,maxY:o}=this;return r<=e&&e<=s&&i<=n&&n<=o}expand(e,n,r,i){if(Array.isArray(e)){const[s,o]=e;return new X(this.x-s,this.y-o,this.w+s*2,this.h+o*2)}return n??(n=e),r??(r=e),i??(i=n),new X(this.x-e,this.y-n,this.w+e+r,this.h+n+i)}getRelativePoint([e,n]){return[this.x+e*this.w,this.y+n*this.h]}getVerticesAndMidpoints(){return[...this.points,...this.midPoints]}horizontalDistance(e){return Math.min(Math.abs(this.minX-e.maxX),Math.abs(this.maxX-e.minX))}include(e){const n=Math.min(this.x,e[0]),r=Math.min(this.y,e[1]),i=Math.max(this.maxX,e[0]),s=Math.max(this.maxY,e[1]);return new X(n,r,i-n,s-r)}intersectLine(e,n,r=!1){const i=[];return[[this.tl,this.tr],[this.tl,this.bl],[this.tr,this.br],[this.bl,this.br]].forEach(([s,o])=>{const a=Wr(e,n,s,o,r);a&&i.push(a)}),i.length===0?null:i}isHorizontalCross(e){return!(this.maxY<e.minY||this.minY>e.maxY)}isIntersectWithBound(e,n=lu){return e.maxX>this.minX-n&&e.maxY>this.minY-n&&e.minX<this.maxX+n&&e.minY<this.maxY+n&&!this.contains(e)&&!e.contains(this)}isOverlapWithBound(e,n=lu){return e.maxX>this.minX-n&&e.maxY>this.minY-n&&e.minX<this.maxX+n&&e.minY<this.maxY+n}isPointInBound([e,n],r=.01){return e>this.minX+r&&e<this.maxX-r&&n>this.minY+r&&n<this.maxY-r}isPointNearBound([e,n],r=.01){return O6(this.points,[e,n])<r}isVerticalCross(e){return!(this.maxX<e.minX||this.minX>e.maxX)}moveDelta(e,n){return new X(this.x+e,this.y+n,this.w,this.h)}serialize(){return dv(this.x,this.y,this.w,this.h)}toRelative([e,n]){const r=this.w===0?0:(e-this.x)/this.w,i=this.h===0?0:(n-this.y)/this.h;return[r,i]}toXYWH(){return[this.x,this.y,this.w,this.h]}unite(e){const n=Math.min(this.x,e.x),r=Math.min(this.y,e.y),i=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return new X(n,r,i-n,s-r)}verticalDistance(e){return Math.min(Math.abs(this.minY-e.maxY),Math.abs(this.maxY-e.minY))}}function U6(t,e){const n=Math.min(t.x,e.x),r=Math.min(t.y,e.y),i=Math.max(t.x+t.w,e.x+e.w),s=Math.max(t.y+t.h,e.y+e.h),o=Math.abs(i-n),a=Math.abs(s-r);return{x:n,y:r,w:o,h:a}}function Ke(t,e=({x:r,y:i,w:s,h:o})=>[[r,i],[r+s,i],[r+s,i+o],[r,i+o]],n=[0,0]){const{rotate:r}=t;let i=e({x:t.x-n[1],y:t.y-n[0],w:t.w+n[1]*2,h:t.h+n[0]*2});if(r){const{x:s,y:o,w:a,h:l}=t,c=s+a/2,u=o+l/2,d=new DOMMatrix().translateSelf(c,u).rotateSelf(r).translateSelf(-c,-u);i=i.map(h=>{const{x:f,y:p}=new DOMPoint(...h).matrixTransform(d);return[f,p]})}return i}function sg(t){const{x:e,y:n,w:r,h:i,rotate:s}=t,o=new DOMRect(e,n,r,i);return s?new DOMQuad(...Ke(t).map(a=>new DOMPoint(...a))).getBounds():o}function mo(t){const{x:e,y:n,width:r,height:i}=sg(t);return{x:e,y:n,w:r,h:i}}function $6(t){if(!t.length)return null;if(t.length===1){const{x:n,y:r,w:i,h:s}=t[0];return new X(n,r,i,s)}let e=t[0];for(let n=1;n<t.length;n++)e=U6(e,t[n]);return new X(e.x,e.y,e.w,e.h)}function og(t){return t.length===0?new X(0,0,0,0):t.reduce((e,n)=>e.unite(n instanceof X?n:X.from(mo(n))),X.from(mo(t[0])))}function du(t){return X.from(ig(t))}function Dl(t,e){const n=e/2,r=new X(t.x-n,t.y-n,t.w+e,t.h+e);if(r.w<=0||r.h<=0)throw new Error("Invalid delta range or bound size.");return r}function rf(t,e,n,r,i){const s=n*2,o=i*2,a=Math.max(e.w-s,1),l=Math.max(e.h-s,1),c=Math.max(r.w-o,1),u=Math.max(r.h-o,1);return{points:t.map(h=>({...h,x:c*((h.x-n)/a)+i,y:u*((h.y-n)/l)+i})),bound:new X(r.x,r.y,c+o,u+o)}}function H6(t,e,n,r){if(e==null||e<0||e>1)return null;const i=t[0][0],s=t[0][1],o=t[3][0],a=t[3][1];let l=t[1][0],c=t[1][1],u=t[2][0],d=t[2][1];cu(l-i)&&cu(c-s)&&(l=i,c=s),cu(u-o)&&cu(d-a)&&(u=o,d=a);const h=3*(l-i),f=3*(u-l)-h,p=o-i-h-f,g=3*(c-s),b=3*(d-c)-g,_=a-s-g-b;let y,x;return y=e===0?i:e===1?o:((p*e+f)*e+h)*e+i,x=e===0?s:e===1?a:((_*e+b)*e+g)*e+s,n===2?[x,-y]:[y,x]}function hu(t,e){return H6(t,e,0)}function ag(t,e){let r=1/0,i=0;function s(a){if(a>=0&&a<=1){const l=hu(t,a);if(!l)return!1;const c=R.dist2(e,l);if(c<r)return r=c,i=a,!0}return!1}for(let a=0;a<=100;a++)s(a/100);let o=1/(100*2);for(;o>D6;)!s(i-o)&&!s(i+o)&&(o/=2);return i}function z6(t,e){const n=ag(t,e);return hu(t,n)}function Nl(t){if(t.length===1){const e=t[0];return[e,e,e,e]}return[t[0],t[0].absOut,t[1].absIn,t[1]]}function W6(t){const[e,n,r,i]=t,[s,o]=e,[a,l]=n,[c,u]=r,[d,h]=i,f=[],p=[[],[]];let g,b,_,y,x,E,I,v;for(let we=0;we<2;we+=1){if(we===0?(b=6*s-12*a+6*c,g=-3*s+9*a-9*c+3*d,_=3*a-3*s):(b=6*o-12*l+6*u,g=-3*o+9*l-9*u+3*h,_=3*l-3*o),Math.abs(g)<1e-12){if(Math.abs(b)<1e-12)continue;y=-_/b,y>0&&y<1&&f.push(y);continue}I=b*b-4*_*g,v=Math.sqrt(I),!(I<0)&&(x=(-b+v)/(2*g),x>0&&x<1&&f.push(x),E=(-b-v)/(2*g),E>0&&E<1&&f.push(E))}let N,L,z,M=f.length;const B=M;for(;M;)M-=1,y=f[M],z=1-y,N=z*z*z*s+3*z*z*y*a+3*z*y*y*c+y*y*y*d,p[0][M]=N,L=z*z*z*o+3*z*z*y*l+3*z*y*y*u+y*y*y*h,p[1][M]=L;f[B]=0,f[B+1]=1,p[0][B]=s,p[1][B]=o,p[0][B+1]=d,p[1][B+1]=h,f.length=B+2,p[0].length=B+2,p[1].length=B+2;const $=Math.min.apply(null,p[0]),se=Math.min.apply(null,p[1]),be=Math.max.apply(null,p[0]),_e=Math.max.apply(null,p[1]);return new X($,se,be-$,_e-se)}function fu(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function j6(t,[e,n]){const r=e[0],i=e[1],s=-Math.atan2(n[1]-i,n[0]-r),o=function([a,l]){return[(a-r)*Math.cos(s)-(l-i)*Math.sin(s),(a-r)*Math.sin(s)+(l-i)*Math.cos(s)]};return t.map(o)}function hv(t,e,n){return e<=t&&t<=n||pu(t,e)||pu(t,n)}function pu(t,e,n,r=1e-6){return Math.abs(t-e)<=r}function Y6(t,e){const n=t.length-1,r=j6(t,e),i=function(N){return 0<=N&&N<=1};if(n===2){const N=r[0][1],L=r[1][1],z=r[2][1],M=N-2*L+z;if(M!==0){const B=-Math.sqrt(L*L-N*z),$=-N+L,se=-(B+$)/M,be=-(-B+$)/M;return[se,be].filter(i)}else if(L!==z&&M===0)return[(2*L-z)/(2*L-2*z)].filter(i);return[]}const s=r[0][1],o=r[1][1],a=r[2][1],l=r[3][1],c=-s+3*o-3*a+l;let u=3*s-6*o+3*a,d=-3*s+3*o,h=s;if(pu(c,0)){if(pu(u,0))return pu(d,0)?[]:[-h/d].filter(i);const N=Math.sqrt(d*d-4*u*h),L=2*u;return[(N-d)/L,(-d-N)/L].filter(i)}u/=c,d/=c,h/=c;const f=(3*d-u*u)/3,p=f/3,g=(2*u*u*u-9*u*d+27*h)/27,b=g/2,_=b*b+p*p*p;let y,x,E,I,v;if(_<0){const N=-f/3,L=N*N*N,z=Math.sqrt(L),M=-g/(2*z),B=M<-1?-1:M>1?1:M,$=Math.acos(B),se=fu(z),be=2*se;return E=be*Math.cos($/3)-u/3,I=be*Math.cos(($+Math.PI*2)/3)-u/3,v=be*Math.cos(($+2*Math.PI*2)/3)-u/3,[E,I,v].filter(i)}else{if(_===0)return y=b<0?fu(-b):-fu(b),E=2*y-u/3,I=-y-u/3,[E,I].filter(i);{const N=Math.sqrt(_);return y=fu(-b+N),x=fu(b+N),[y-x-u/3].filter(i)}}}function G6(t,e){const{minX:n,maxX:r,minY:i,maxY:s}=X.fromPoints(e),o=Nl(t),a=Y6(o,e).map(l=>hu(o,l)).filter(l=>l?hv(l[0],n,r)&&hv(l[1],i,s):!1).map(l=>new wt(l));return a.length>0?a:null}function fv(t,e,n,r=i=>i){return t*r(.5-e*(.5-n))}function V6(t){return[-t[0],-t[1]]}function ui(t,e){return[t[0]+e[0],t[1]+e[1]]}function jr(t,e){return[t[0]-e[0],t[1]-e[1]]}function di(t,e){return[t[0]*e,t[1]*e]}function q6(t,e){return[t[0]/e,t[1]/e]}function mu(t){return[t[1],-t[0]]}function pv(t,e){return t[0]*e[0]+t[1]*e[1]}function X6(t,e){return t[0]===e[0]&&t[1]===e[1]}function K6(t){return Math.hypot(t[0],t[1])}function Q6(t){return t[0]*t[0]+t[1]*t[1]}function mv(t,e){return Q6(jr(t,e))}function gv(t){return q6(t,K6(t))}function Z6(t,e){return Math.hypot(t[1]-e[1],t[0]-e[0])}function gu(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=t[0]-e[0],o=t[1]-e[1],a=s*i-o*r,l=s*r+o*i;return[a+e[0],l+e[1]]}function lg(t,e,n){return ui(t,di(jr(e,t),n))}function bv(t,e,n){return ui(t,di(e,n))}const{min:Ol,PI:J6}=Math,yv=.275,bu=J6+1e-4;function eP(t,e={}){const{size:n=16,smoothing:r=.5,thinning:i=.5,simulatePressure:s=!0,easing:o=de=>de,start:a={},end:l={},last:c=!1}=e,{cap:u=!0,easing:d=de=>de*(2-de)}=a,{cap:h=!0,easing:f=de=>--de*de*de+1}=l;if(t.length===0||n<=0)return[];const p=t[t.length-1].runningLength,g=a.taper===!1?0:a.taper===!0?Math.max(n,p):a.taper,b=l.taper===!1?0:l.taper===!0?Math.max(n,p):l.taper,_=Math.pow(n*r,2),y=[],x=[];let E=t.slice(0,10).reduce((de,Ue)=>{let Se=Ue.pressure;if(s){const C=Ol(1,Ue.distance/n),he=Ol(1,1-C);Se=Ol(1,de+(he-de)*(C*yv))}return(de+Se)/2},t[0].pressure),I=fv(n,i,t[t.length-1].pressure,o),v,N=t[0].vector,L=t[0].point,z=L,M=L,B=z,$=!1;for(let de=0;de<t.length;de++){let{pressure:Ue}=t[de];const{point:Se,vector:C,distance:he,runningLength:qe}=t[de];if(de<t.length-1&&p-qe<3)continue;if(i){if(s){const Gt=Ol(1,he/n),Hn=Ol(1,1-Gt);Ue=Ol(1,E+(Hn-E)*(Gt*yv))}I=fv(n,i,Ue,o)}else I=n/2;v===void 0&&(v=I);const A=qe<g?d(qe/g):1,ot=p-qe<b?f((p-qe)/b):1;I=Math.max(.01,I*Math.min(A,ot));const Ce=(de<t.length-1?t[de+1]:t[de]).vector,Xe=de<t.length-1?pv(C,Ce):1,xn=pv(C,N)<0&&!$,En=Xe!==null&&Xe<0;if(xn||En){const Gt=di(mu(N),I);for(let Hn=1/13,Jn=0;Jn<=1;Jn+=Hn)M=gu(jr(Se,Gt),Se,bu*Jn),y.push(M),B=gu(ui(Se,Gt),Se,bu*-Jn),x.push(B);L=M,z=B,En&&($=!0);continue}if($=!1,de===t.length-1){const Gt=di(mu(C),I);y.push(jr(Se,Gt)),x.push(ui(Se,Gt));continue}const $n=di(mu(lg(Ce,C,Xe)),I);M=jr(Se,$n),(de<=1||mv(L,M)>_)&&(y.push(M),L=M),B=ui(Se,$n),(de<=1||mv(z,B)>_)&&(x.push(B),z=B),E=Ue,N=C}const se=t[0].point.slice(0,2),be=t.length>1?t[t.length-1].point.slice(0,2):ui(t[0].point,[1,1]),_e=[],we=[];if(t.length===1){if(!(g||b)||c){const de=bv(se,gv(mu(jr(se,be))),-(v||I)),Ue=[];for(let Se=1/13,C=Se;C<=1;C+=Se)Ue.push(gu(de,se,bu*2*C));return Ue}}else{if(!(g||b&&t.length===1))if(u)for(let Ue=1/13,Se=Ue;Se<=1;Se+=Ue){const C=gu(x[0],se,bu*Se);_e.push(C)}else{const Ue=jr(y[0],x[0]),Se=di(Ue,.5),C=di(Ue,.51);_e.push(jr(se,Se),jr(se,C),ui(se,C),ui(se,Se))}const de=mu(V6(t[t.length-1].vector));if(b||g&&t.length===1)we.push(be);else if(h){const Ue=bv(be,de,I);for(let Se=1/29,C=Se;C<1;C+=Se)we.push(gu(Ue,be,bu*3*C))}else we.push(ui(be,di(de,I)),ui(be,di(de,I*.99)),jr(be,di(de,I*.99)),jr(be,di(de,I)))}return y.concat(we,x.reverse(),_e)}function tP(t,e={}){var n,r,i;const{streamline:s=.5,size:o=16,last:a=!1}=e;if(t.length===0)return[];const l=.15+(1-s)*.85;let c=Array.isArray(t[0])?t:t.map(({x:g,y:b,pressure:_=.5})=>[g,b,_]);if(c.length===2){const g=c[1];c=c.slice(0,-1);for(let b=1;b<5;b++)c.push(lg(c[0],g,b/4))}c.length===1&&(c=[...c,[...ui(c[0],[1,1]),...c[0].slice(2)]]);const u=[{point:[c[0][0],c[0][1]],pressure:((n=c[0][2])!=null?n:-1)>=0?c[0][2]:.25,vector:[1,1],distance:0,runningLength:0}];let d=!1,h=0,f=u[0];const p=c.length-1;for(let g=1;g<c.length;g++){const b=a&&g===p?c[g].slice(0,2):lg(f.point,c[g],l);if(X6(f.point,b))continue;const _=Z6(b,f.point);if(h+=_,g<p&&!d){if(h<o)continue;d=!0}f={point:b,pressure:((r=c[g][2])!=null?r:-1)>=0?c[g][2]:.5,vector:gv(jr(f.point,b)),distance:_,runningLength:h},u.push(f)}return u[0].vector=((i=u[1])==null?void 0:i.vector)||[0,0],u}function nP(t,e={}){return eP(tP(t,e),e)}function _v(t,e){var n;return nP(t,{size:e,thinning:.6,streamline:.5,smoothing:.5,easing:r=>Math.sin(r*Math.PI/2),simulatePressure:((n=t[0])==null?void 0:n.length)===2})}class go{static len(e){const n=e.length;if(n<2)return 0;let r=0,i=0,s,o=e[0];for(;++r<n;)s=e[r],i+=R.dist(o,s),o=s;return i}static lenAtPoint(e,n){const r=e.length;let i=r;for(let s=0;s<r-1;s++){const o=e[s],a=e[s+1];if(o[0]===n[0]&&o[1]===n[1])return i;const l=R.angle(o,n),c=R.angle(a,n);if((l+c)%Math.PI===0)return i+=R.dist(o,n),i;if(i+=R.dist(o,a),a[0]===n[0]&&a[1]===n[1])return i}return i}static nearestPoint(e,n){const r=e.length,i=[0,0];let s=1/0;for(let o=0;o<r-1;o++){const a=e[o],l=e[o+1],c=R.nearestPointOnLineSegment(a,l,n,!0),u=R.dist(c,n);u<s&&(s=u,i[0]=c[0],i[1]=c[1])}return i}static pointAt(e,n){const r=e.length;if(r===0)return null;if(r===1||n<=0)return e[0];if(n>=1)return e[r-1];const s=go.len(e)*n;return go.pointAtLen(e,s)}static pointAtLen(e,n){const r=e.length;if(r===0)return null;if(r===1)return e[0];let i=!0;n<0&&(i=!1,n=-n);let s=0;for(let a=0,l=r-1;a<l;a++){const c=i?a:l-1-a,u=e[c],d=e[c+1],h=R.dist(u,d);if(n<=s+h){const f=(i?1:-1)*(n-s)/h;return R.lrp(u,d,f)}s+=h}return i?e[r-1]:e[0]}}const va=()=>new Set,cg=t=>t[t.length-1],rP=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Ts=Array.from,iP=(t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1},ug=Array.isArray,sP=String.fromCharCode,oP=t=>t.toLowerCase(),aP=/^\s*/g,lP=t=>t.replace(aP,""),cP=/([A-Z])/g,xv=(t,e)=>lP(t.replace(cP,n=>`${e}${oP(n)}`)),uP=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},yu=typeof TextEncoder<"u"?new TextEncoder:null,dP=yu?t=>yu.encode(t):uP;let _u=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_u&&_u.decode(new Uint8Array).length===1&&(_u=null);const br=()=>new Map,dg=t=>{const e=br();return t.forEach((n,r)=>{e.set(r,n)}),e},Ss=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},hP=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},fP=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Ev=t=>t===void 0?null:t;class pP{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let vv=new pP,mP=!0;try{typeof localStorage<"u"&&localStorage&&(vv=localStorage,mP=!1)}catch{}const gP=vv,bP=Object.assign,wv=Object.keys,yP=(t,e)=>{for(const n in t)e(t[n],n)},kv=t=>wv(t).length,Tv=t=>wv(t).length,_P=t=>{for(const e in t)return!1;return!0},xP=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Sv=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),EP=(t,e)=>t===e||Tv(t)===Tv(e)&&xP(t,(n,r)=>(n!==void 0||Sv(e,r))&&e[r]===n),vP=Object.freeze,Cv=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Cv(t[e])}return vP(t)},Av=Symbol("Equality"),hg=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&hg(t,e,n+1)}},wP=t=>t,sf=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[Av]!=null)return t[Av](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!sf(t.get(n),e.get(n)))return!1;break}case Object:if(kv(t)!==kv(e))return!1;for(const n in t)if(!Sv(t,n)||!sf(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!sf(t[n],e[n]))return!1;break;default:return!1}return!0},kP=(t,e)=>e.includes(t),Pl=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",TP=typeof window<"u"&&typeof document<"u"&&!Pl;let Bi;const SP=()=>{if(Bi===void 0)if(Pl){Bi=br();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Bi.set(e,""),e=r):e!==null&&(Bi.set(e,r),e=null)}e!==null&&Bi.set(e,"")}else typeof location=="object"?(Bi=br(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Bi.set(`--${xv(e,"-")}`,n),Bi.set(`-${xv(e,"-")}`,n)}})):Bi=br();return Bi},fg=t=>SP().has(t),of=t=>Ev(Pl?process.env[t.toUpperCase().replaceAll("-","_")]:gP.getItem(t)),Iv=t=>fg("--"+t)||of(t)!==null;Iv("production");const CP=Pl&&kP(process.env.FORCE_COLOR,["true","1","2"])||!fg("--no-colors")&&!Iv("no-color")&&(!Pl||process.stdout.isTTY)&&(!Pl||fg("--color")||of("COLORTERM")!==null||(of("TERM")||"").includes("color")),Cs=Math.floor,af=Math.abs,Mv=(t,e)=>t<e?t:e,wa=(t,e)=>t>e?t:e,Dv=t=>t!==0?t<0:1/t<0,Nv=1,Ov=2,pg=4,mg=8,xu=32,As=64,ir=128,AP=1<<29,lf=31,gg=63,ka=127,IP=2147483647,Pv=Number.MAX_SAFE_INTEGER,MP=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Cs(t)===t);class Eu{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const cf=()=>new Eu,DP=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Fi=t=>{const e=new Uint8Array(DP(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},NP=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(wa(n,e)*2),t.cpos=0)},kn=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},bg=kn,Ve=(t,e)=>{for(;e>ka;)kn(t,ir|ka&e),e=Cs(e/128);kn(t,ka&e)},yg=(t,e)=>{const n=Dv(e);for(n&&(e=-e),kn(t,(e>gg?ir:0)|(n?As:0)|gg&e),e=Cs(e/64);e>0;)kn(t,(e>ka?ir:0)|ka&e),e=Cs(e/128)},_g=new Uint8Array(3e4),OP=_g.length/3,PP=(t,e)=>{if(e.length<OP){const n=yu.encodeInto(e,_g).written||0;Ve(t,n);for(let r=0;r<n;r++)kn(t,_g[r])}else Pr(t,dP(e))},LP=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Ve(t,r);for(let i=0;i<r;i++)kn(t,n.codePointAt(i))},Ll=yu&&yu.encodeInto?PP:LP,uf=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Mv(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(wa(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Pr=(t,e)=>{Ve(t,e.byteLength),uf(t,e)},xg=(t,e)=>{NP(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},RP=(t,e)=>xg(t,4).setFloat32(0,e,!1),BP=(t,e)=>xg(t,8).setFloat64(0,e,!1),FP=(t,e)=>xg(t,8).setBigInt64(0,e,!1),Lv=new DataView(new ArrayBuffer(4)),UP=t=>(Lv.setFloat32(0,t),Lv.getFloat32(0)===t),vu=(t,e)=>{switch(typeof e){case"string":kn(t,119),Ll(t,e);break;case"number":MP(e)&&af(e)<=IP?(kn(t,125),yg(t,e)):UP(e)?(kn(t,124),RP(t,e)):(kn(t,123),BP(t,e));break;case"bigint":kn(t,122),FP(t,e);break;case"object":if(e===null)kn(t,126);else if(ug(e)){kn(t,117),Ve(t,e.length);for(let n=0;n<e.length;n++)vu(t,e[n])}else if(e instanceof Uint8Array)kn(t,116),Pr(t,e);else{kn(t,118);const n=Object.keys(e);Ve(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ll(t,i),vu(t,e[i])}}break;case"boolean":kn(t,e?120:121);break;default:kn(t,127)}};class Rv extends Eu{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ve(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Bv=t=>{t.count>0&&(yg(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Ve(t.encoder,t.count-2))};class df{constructor(){this.encoder=new Eu,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Bv(this),this.count=1,this.s=e)}toUint8Array(){return Bv(this),Fi(this.encoder)}}const Fv=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);yg(t.encoder,e),t.count>1&&Ve(t.encoder,t.count-2)}};class Eg{constructor(){this.encoder=new Eu,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Fv(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Fv(this),Fi(this.encoder)}}class $P{constructor(){this.sarr=[],this.s="",this.lensE=new df}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Eu;return this.sarr.push(this.s),this.s="",Ll(e,this.sarr.join("")),uf(e,this.lensE.toUint8Array()),Fi(e)}}const bo=t=>new Error(t),Ui=()=>{throw bo("Method unimplemented")},$i=()=>{throw bo("Unexpected case")},Uv=bo("Unexpected end of array"),$v=bo("Integer out of Range");class hf{constructor(e){this.arr=e,this.pos=0}}const Rl=t=>new hf(t),HP=t=>t.pos!==t.arr.length,zP=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Lr=t=>zP(t,ze(t)),Bl=t=>t.arr[t.pos++],ze=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ka)*n,n*=128,i<ir)return e;if(e>Pv)throw $v}throw Uv},vg=t=>{let e=t.arr[t.pos++],n=e&gg,r=64;const i=(e&As)>0?-1:1;if((e&ir)===0)return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ka)*r,r*=128,e<ir)return i*n;if(n>Pv)throw $v}throw Uv},Fl=_u?t=>_u.decode(Lr(t)):t=>{let e=ze(t);if(e===0)return"";{let n=String.fromCodePoint(Bl(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Bl(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},wg=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},WP=[t=>{},t=>null,vg,t=>wg(t,4).getFloat32(0,!1),t=>wg(t,8).getFloat64(0,!1),t=>wg(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Fl,t=>{const e=ze(t),n={};for(let r=0;r<e;r++){const i=Fl(t);n[i]=wu(t)}return n},t=>{const e=ze(t),n=[];for(let r=0;r<e;r++)n.push(wu(t));return n},Lr],wu=t=>WP[127-Bl(t)](t);class Hv extends hf{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),HP(this)?this.count=ze(this)+1:this.count=-1),this.count--,this.s}}class ff extends hf{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=vg(this);const e=Dv(this.s);this.count=1,e&&(this.s=-this.s,this.count=ze(this)+2)}return this.count--,this.s}}class kg extends hf{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=vg(this),n=e&1;this.diff=Cs(e/2),this.count=1,n&&(this.count=ze(this)+2)}return this.s+=this.diff,this.count--,this.s}}class jP{constructor(e){this.decoder=new ff(e),this.str=Fl(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const YP=t=>new Uint8Array(t),GP=TP?t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=sP(t[n]);return btoa(e)}:t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),VP=t=>{const e=YP(t.byteLength);return e.set(t),e},Hi=(t,e)=>t>>>e|t<<32-e,qP=t=>Hi(t,2)^Hi(t,13)^Hi(t,22),XP=t=>Hi(t,6)^Hi(t,11)^Hi(t,25),KP=t=>Hi(t,7)^Hi(t,18)^t>>>3,QP=t=>Hi(t,17)^Hi(t,19)^t>>>10,ZP=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),JP=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);class eL{constructor(){const e=new ArrayBuffer(320);this._H=new Uint32Array(e,0,8),this._H.set(JP),this._W=new Uint32Array(e,64,64)}_updateHash(){const e=this._H,n=this._W;for(let d=16;d<64;d++)n[d]=QP(n[d-2])+n[d-7]+KP(n[d-15])+n[d-16];let r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7];for(let d=0,h,f;d<64;d++)h=u+XP(a)+(a&l^~a&c)+ZP[d]+n[d]>>>0,f=qP(r)+(r&i^r&s^i&s)>>>0,u=c,c=l,l=a,a=o+h>>>0,o=s,s=i,i=r,r=h+f>>>0;e[0]+=r,e[1]+=i,e[2]+=s,e[3]+=o,e[4]+=a,e[5]+=l,e[6]+=c,e[7]+=u}digest(e){let n=0;for(;n+56<=e.length;){let o=0;for(;o<16&&n+3<e.length;o++)this._W[o]=e[n++]<<24|e[n++]<<16|e[n++]<<8|e[n++];if(n%64!==0){for(this._W.fill(0,o,16);n<e.length;)this._W[o]|=e[n]<<(3-n%4)*8,n++;this._W[o]|=ir<<(3-n%4)*8}this._updateHash()}const r=n%64!==0;this._W.fill(0,0,16);let i=0;for(;n<e.length;i++)for(let o=3;o>=0&&n<e.length;o--)this._W[i]|=e[n++]<<o*8;r||(this._W[i-(n%4===0?0:1)]|=ir<<(3-n%4)*8),this._W[14]=e.byteLength/AP,this._W[15]=e.byteLength*8,this._updateHash();const s=new Uint8Array(32);for(let o=0;o<this._H.length;o++)for(let a=0;a<4;a++)s[o*4+a]=this._H[o]>>>(3-a)*8;return s}}const tL=t=>new eL().digest(t);async function Tg(t){const e=crypto.subtle===void 0?tL(new Uint8Array(t)):await crypto.subtle.digest("SHA-256",t);return GP(new Uint8Array(e)).replace(/\+/g,"-").replace(/\//g,"_")}async function zv(){return"scheduler"in window&&"yield"in window.scheduler?window.scheduler.yield():typeof requestIdleCallback<"u"?new Promise(t=>requestIdleCallback(t)):new Promise(t=>setTimeout(t,0))}class nL{debug(){}error(){}info(){}warn(){}}const Wv=new Map([["application/epub+zip","epub"],["application/gzip","gz"],["application/java-archive","jar"],["application/json","json"],["application/ld+json","jsonld"],["application/msword","doc"],["application/octet-stream","bin"],["application/ogg","ogx"],["application/pdf","pdf"],["application/rtf","rtf"],["application/vnd.amazon.ebook","azw"],["application/vnd.apple.installer+xml","mpkg"],["application/vnd.mozilla.xul+xml","xul"],["application/vnd.ms-excel","xls"],["application/vnd.ms-fontobject","eot"],["application/vnd.ms-powerpoint","ppt"],["application/vnd.oasis.opendocument.presentation","odp"],["application/vnd.oasis.opendocument.spreadsheet","ods"],["application/vnd.oasis.opendocument.text","odt"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","pptx"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","docx"],["application/vnd.rar","rar"],["application/vnd.visio","vsd"],["application/x-7z-compressed","7z"],["application/x-abiword","abw"],["application/x-bzip","bz"],["application/x-bzip2","bz2"],["application/x-cdf","cda"],["application/x-csh","csh"],["application/x-freearc","arc"],["application/x-httpd-php","php"],["application/x-sh","sh"],["application/x-tar","tar"],["application/xhtml+xml","xhtml"],["application/xml","xml"],["application/zip","zip"],["application/zstd","zst"],["audio/3gpp","3gp"],["audio/3gpp2","3g2"],["audio/aac","aac"],["audio/midi","mid"],["audio/mpeg","mp3"],["audio/ogg","oga"],["audio/opus","opus"],["audio/wav","wav"],["audio/webm","weba"],["audio/x-midi","midi"],["font/otf","otf"],["font/ttf","ttf"],["font/woff","woff"],["font/woff2","woff2"],["image/apng","apng"],["image/avif","avif"],["image/bmp","bmp"],["image/gif","gif"],["image/jpeg","jpeg"],["image/png","png"],["image/svg+xml","svg"],["image/tiff","tiff"],["image/vnd.microsoft.icon","ico"],["image/webp","webp"],["text/calendar","ics"],["text/css","css"],["text/csv","csv"],["text/html","html"],["text/javascript","js"],["text/plain","txt"],["text/xml","xml"],["video/3gpp","3gp"],["video/3gpp2","3g2"],["video/mp2t","ts"],["video/mp4","mp4"],["video/mpeg","mpeg"],["video/ogg","ogv"],["video/webm","webm"],["video/x-msvideo","avi"]]);new Map(Array.from(Wv.entries()).map(([t,e])=>[e,t]));const jv=t=>{var e;if(t==="")return"blob";const n=Wv.get(t);return n||((e=t.split("/").at(-1))!=null?e:"blob")};function Sg(t,e){const n=t.get(e);if(!n)throw new V(re.TransformerError,`blob not found for blobId: ${e}`);const r="name"in n&&typeof n.name=="string"?n.name:void 0;return r?r.includes(".")?r:`${r}.${jv(n.type)}`:`${e}.${jv(n.type)}`}class Yv{constructor(){this._observers=br()}on(e,n){return Ss(this._observers,e,va).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ts((this._observers.get(e)||br()).values()).forEach(r=>r(...n))}destroy(){this._observers=br()}}let rL=class{constructor(){this._observers=br()}on(e,n){Ss(this._observers,e,va).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Ts((this._observers.get(e)||br()).values()).forEach(r=>r(...n))}destroy(){this._observers=br()}};const iL=crypto.getRandomValues.bind(crypto),Gv=()=>iL(new Uint32Array(1))[0],sL="10000000-1000-4000-8000"+-1e11,oL=()=>sL.replace(/[018]/g,t=>(t^Gv()&15>>t/4).toString(16)),pf=Date.now,Vv=t=>new Promise(t);Promise.all.bind(Promise);class aL{constructor(e,n){this.left=e,this.right=n}}const Is=(t,e)=>new aL(t,e);typeof DOMParser<"u"&&new DOMParser;const lL=t=>hP(t,(e,n)=>`${n}:${e};`).join(""),Ms=Symbol,qv=Ms(),Xv=Ms(),cL=Ms(),uL=Ms(),dL=Ms(),Kv=Ms(),hL=Ms(),Cg=Ms(),fL=Ms(),pL=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},mL={[qv]:Is("font-weight","bold"),[Xv]:Is("font-weight","normal"),[cL]:Is("color","blue"),[dL]:Is("color","green"),[uL]:Is("color","grey"),[Kv]:Is("color","red"),[hL]:Is("color","purple"),[Cg]:Is("color","orange"),[fL]:Is("color","black")},Qv=CP?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=br();let i=[],s=0;for(;s<t.length;s++){const a=t[s],l=mL[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=lL(r);s>0||c.length>0?(e.push("%c"+a),n.push(c)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:pL,gL=(...t)=>{console.log(...Qv(t)),Jv.forEach(e=>e.print(t))},Zv=(...t)=>{console.warn(...Qv(t)),t.unshift(Cg),Jv.forEach(e=>e.print(t))},Jv=va(),ew=t=>({[Symbol.iterator](){return this},next:t}),bL=(t,e)=>ew(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Ag=(t,e)=>ew(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ig{constructor(e,n){this.clock=e,this.len=n}}class Ul{constructor(){this.clients=new Map}}const $l=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])yw(t,s,c.clock,c.len,n)}}),yL=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Cs((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},ku=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&yL(n,e.clock)!==null},Mg=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=wa(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},Dg=t=>{const e=new Ul;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)rP(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return Mg(e),e},Tu=(t,e,n,r)=>{Ss(t.clients,e,()=>[]).push(new Ig(n,r))},_L=()=>new Ul,xL=t=>{const e=_L();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let l=o.length;if(s+1<n.length)for(let c=n[s+1];s+1<n.length&&c.deleted;c=n[++s+1])l+=c.length;i.push(new Ig(a,l))}}i.length>0&&e.clients.set(r,i)}),e},Hl=(t,e)=>{Ve(t.restEncoder,e.clients.size),Ts(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Ve(t.restEncoder,n);const i=r.length;Ve(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},Ng=t=>{const e=new Ul,n=ze(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=ze(t.restDecoder),s=ze(t.restDecoder);if(s>0){const o=Ss(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Ig(t.readDsClock(),t.readDsLen()))}}return e},tw=(t,e,n)=>{const r=new Ul,i=ze(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=ze(t.restDecoder),a=ze(t.restDecoder),l=n.clients.get(o)||[],c=an(n,o);for(let u=0;u<a;u++){const d=t.readDsClock(),h=d+t.readDsLen();if(d<c){c<h&&Tu(r,o,c,h-c);let f=zi(l,d),p=l[f];for(!p.deleted&&p.id.clock<d&&(l.splice(f+1,0,Df(e,p,d-p.id.clock)),f++);f<l.length&&(p=l[f++],p.id.clock<h);)p.deleted||(h<p.id.clock+p.length&&l.splice(f,0,Df(e,p,h-p.id.clock)),p.delete(e))}else Tu(r,o,d,h-d)}}if(r.clients.size>0){const s=new Ta;return Ve(s.restEncoder,0),Hl(s,r),s.toUint8Array()}return null},nw=Gv;class Ds extends Yv{constructor({guid:e=oL(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=nw(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new mw,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Vv(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>Vv(c=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ht(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ts(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ht(this,e,n)}get(e,n=Tn){const r=Ss(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==Tn&&i!==n)if(i===Tn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,sr)}getText(e=""){return this.get(e,gt)}getMap(e=""){return this.get(e,at)}getXmlElement(e=""){return this.get(e,Gl)}getXmlFragment(e=""){return this.get(e,Ca)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Ts(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Ds({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ht(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class rw{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ze(this.restDecoder)}readDsLen(){return ze(this.restDecoder)}}class iw extends rw{readLeftID(){return We(ze(this.restDecoder),ze(this.restDecoder))}readRightID(){return We(ze(this.restDecoder),ze(this.restDecoder))}readClient(){return ze(this.restDecoder)}readInfo(){return Bl(this.restDecoder)}readString(){return Fl(this.restDecoder)}readParentInfo(){return ze(this.restDecoder)===1}readTypeRef(){return ze(this.restDecoder)}readLen(){return ze(this.restDecoder)}readAny(){return wu(this.restDecoder)}readBuf(){return VP(Lr(this.restDecoder))}readJSON(){return JSON.parse(Fl(this.restDecoder))}readKey(){return Fl(this.restDecoder)}}class EL{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ze(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ze(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class zl extends EL{constructor(e){super(e),this.keys=[],ze(e),this.keyClockDecoder=new kg(Lr(e)),this.clientDecoder=new ff(Lr(e)),this.leftClockDecoder=new kg(Lr(e)),this.rightClockDecoder=new kg(Lr(e)),this.infoDecoder=new Hv(Lr(e),Bl),this.stringDecoder=new jP(Lr(e)),this.parentInfoDecoder=new Hv(Lr(e),Bl),this.typeRefDecoder=new ff(Lr(e)),this.lenDecoder=new ff(Lr(e))}readLeftID(){return new Wl(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Wl(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return wu(this.restDecoder)}readBuf(){return Lr(this.restDecoder)}readJSON(){return wu(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class sw{constructor(){this.restEncoder=cf()}toUint8Array(){return Fi(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ve(this.restEncoder,e)}writeDsLen(e){Ve(this.restEncoder,e)}}class Su extends sw{writeLeftID(e){Ve(this.restEncoder,e.client),Ve(this.restEncoder,e.clock)}writeRightID(e){Ve(this.restEncoder,e.client),Ve(this.restEncoder,e.clock)}writeClient(e){Ve(this.restEncoder,e)}writeInfo(e){bg(this.restEncoder,e)}writeString(e){Ll(this.restEncoder,e)}writeParentInfo(e){Ve(this.restEncoder,e?1:0)}writeTypeRef(e){Ve(this.restEncoder,e)}writeLen(e){Ve(this.restEncoder,e)}writeAny(e){vu(this.restEncoder,e)}writeBuf(e){Pr(this.restEncoder,e)}writeJSON(e){Ll(this.restEncoder,JSON.stringify(e))}writeKey(e){Ll(this.restEncoder,e)}}class ow{constructor(){this.restEncoder=cf(),this.dsCurrVal=0}toUint8Array(){return Fi(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Ve(this.restEncoder,n)}writeDsLen(e){e===0&&$i(),Ve(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ta extends ow{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Eg,this.clientEncoder=new df,this.leftClockEncoder=new Eg,this.rightClockEncoder=new Eg,this.infoEncoder=new Rv(bg),this.stringEncoder=new $P,this.parentInfoEncoder=new Rv(bg),this.typeRefEncoder=new df,this.lenEncoder=new df}toUint8Array(){const e=cf();return Ve(e,0),Pr(e,this.keyClockEncoder.toUint8Array()),Pr(e,this.clientEncoder.toUint8Array()),Pr(e,this.leftClockEncoder.toUint8Array()),Pr(e,this.rightClockEncoder.toUint8Array()),Pr(e,Fi(this.infoEncoder)),Pr(e,this.stringEncoder.toUint8Array()),Pr(e,Fi(this.parentInfoEncoder)),Pr(e,this.typeRefEncoder.toUint8Array()),Pr(e,this.lenEncoder.toUint8Array()),uf(e,Fi(this.restEncoder)),Fi(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){vu(this.restEncoder,e)}writeBuf(e){Pr(this.restEncoder,e)}writeJSON(e){vu(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const vL=(t,e,n,r)=>{r=wa(r,e[0].id.clock);const i=zi(e,r);Ve(t.restEncoder,e.length-i),t.writeClient(n),Ve(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},Og=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{an(e,s)>i&&r.set(s,i)}),bf(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Ve(t.restEncoder,r.size),Ts(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{vL(t,e.clients.get(i),i,s)})},wL=(t,e)=>{const n=br(),r=ze(t.restDecoder);for(let i=0;i<r;i++){const s=ze(t.restDecoder),o=new Array(s),a=t.readClient();let l=ze(t.restDecoder);n.set(a,{i:0,refs:o});for(let c=0;c<s;c++){const u=t.readInfo();switch(lf&u){case 0:{const d=t.readLen();o[c]=new Yr(We(a,l),d),l+=d;break}case 10:{const d=ze(t.restDecoder);o[c]=new Gr(We(a,l),d),l+=d;break}default:{const d=(u&(As|ir))===0,h=new kt(We(a,l),null,(u&ir)===ir?t.readLeftID():null,null,(u&As)===As?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&xu)===xu?t.readString():null,qw(t,u));o[c]=h,l+=h.length}}}}return n},kL=(t,e,n)=>{const r=[];let i=Ts(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new mw,l=new Map,c=(f,p)=>{const g=l.get(f);(g==null||g>p)&&l.set(f,p)};let u=o.refs[o.i++];const d=new Map,h=()=>{for(const f of r){const p=f.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[f]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==Gr){const p=Ss(d,u.id.client,()=>an(e,u.id.client))-u.id.clock;if(p<0)r.push(u),c(u.id.client,u.id.clock-1),h();else{const g=u.getMissing(t,e);if(g!==null){r.push(u);const b=n.get(g)||{refs:[],i:0};if(b.refs.length===b.i)c(g,an(e,g)),h();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Ta;return Og(f,a,new Map),Ve(f.restEncoder,0),{missing:l,update:f.toUint8Array()}}return null},TL=(t,e)=>Og(t,e.doc.store,e.beforeState),SL=(t,e,n,r=new zl(t))=>ht(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,l=wL(r,o),c=kL(i,a,l),u=a.pendingStructs;if(u){for(const[h,f]of u.missing)if(f<an(a,h)){s=!0;break}if(c){for(const[h,f]of c.missing){const p=u.missing.get(h);(p==null||p>f)&&u.missing.set(h,f)}u.update=xf([u.update,c.update])}}else a.pendingStructs=c;const d=tw(r,i,a);if(a.pendingDs){const h=new zl(Rl(a.pendingDs));ze(h.restDecoder);const f=tw(h,i,a);d&&f?a.pendingDs=xf([d,f]):a.pendingDs=d||f}else a.pendingDs=d;if(s){const h=a.pendingStructs.update;a.pendingStructs=null,aw(i.doc,h)}},n,!1),aw=(t,e,n,r=zl)=>{const i=Rl(e);SL(i,t,n,new r(i))},lw=(t,e,n)=>aw(t,e,n,iw),CL=(t,e,n=new Map)=>{Og(t,e.store,n),Hl(t,xL(e.store))},AL=(t,e=new Uint8Array([0]),n=new Ta)=>{const r=cw(e);CL(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(WL(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Su)return kw(i.map((s,o)=>o===0?s:YL(s)));if(n.constructor===Ta)return xf(i)}return i[0]},IL=(t,e)=>AL(t,e,new Su),ML=t=>{const e=new Map,n=ze(t.restDecoder);for(let r=0;r<n;r++){const i=ze(t.restDecoder),s=ze(t.restDecoder);e.set(i,s)}return e},cw=t=>ML(new rw(Rl(t))),uw=(t,e)=>(Ve(t.restEncoder,e.size),Ts(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Ve(t.restEncoder,n),Ve(t.restEncoder,r)}),t),DL=(t,e)=>uw(t,bf(e.store)),NL=(t,e=new ow)=>(t instanceof Map?uw(e,t):DL(e,t),e.toUint8Array()),OL=t=>NL(t,new sw);class PL{constructor(){this.l=[]}}const dw=()=>new PL,hw=(t,e)=>t.l.push(e),fw=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},pw=(t,e,n)=>hg(t.l,[e,n]);class Wl{constructor(e,n){this.client=e,this.clock=n}}const mf=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,We=(t,e)=>new Wl(t,e),LL=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw $i()},gf=(t,e)=>{for(;e!==null;){if(e.parent===t)return!0;e=e.parent._item}return!1},jl=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!ku(e.ds,t.id),Pg=(t,e)=>{const n=Ss(t.meta,Pg,va),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<an(r,s)&&yr(t,We(s,i))}),$l(t,e.ds,i=>{}),n.add(e))};class mw{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const bf=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},an=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},gw=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw $i()}n.push(e)},zi=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Cs(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Cs((n+r)/2)}throw $i()},yf=(t,e)=>{const n=t.clients.get(e.client);return n[zi(n,e.clock)]},Lg=(t,e,n)=>{const r=zi(e,n),i=e[r];return i.id.clock<n&&i instanceof kt?(e.splice(r+1,0,Df(t,i,n-i.id.clock)),r+1):r},yr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Lg(t,n,e.clock)]},bw=(t,e,n)=>{const r=e.clients.get(n.client),i=zi(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Yr&&r.splice(i+1,0,Df(t,s,n.clock-s.id.clock+1)),s},RL=(t,e,n)=>{const r=t.clients.get(e.id.client);r[zi(r,e.id.clock)]=n},yw=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=Lg(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&Lg(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class BL{constructor(e,n,r){this.doc=e,this.deleteSet=new Ul,this.beforeState=bf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const _w=(t,e)=>e.deleteSet.clients.size===0&&!fP(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Mg(e.deleteSet),TL(t,e),Hl(t,e.deleteSet),!0),xw=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ss(t.changed,e,va).add(n)},_f=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof kt&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},FL=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=zi(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const d=s[c];if(a.clock+a.len<=d.id.clock)break;d instanceof kt&&d.deleted&&!d.keep&&n(d)&&d.gc(e,!1)}}}},UL=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Mv(i.length-1,1+zi(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+_f(i,l)}})},Ew=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Mg(s),n.afterState=bf(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),pw(c._dEH,l,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),hg(a,[]),n._needFormattingCleanup&&s5(n)}finally{r.gc&&FL(s,i,r.gcFilter),UL(s,i),n.afterState.forEach((u,d)=>{const h=n.beforeState.get(d)||0;if(h!==u){const f=i.clients.get(d),p=wa(zi(f,h),1);for(let g=f.length-1;g>=p;)g-=1+_f(f,g)}});for(let u=o.length-1;u>=0;u--){const{client:d,clock:h}=o[u].id,f=i.clients.get(d),p=zi(f,h);p+1<f.length&&_f(f,p+1)>1||p>0&&_f(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(gL(Cg,qv,"[yjs] ",Xv,Kv,"Changed the client-id because another client seems to be using it."),r.clientID=nw()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Su;_w(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ta;_w(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=n;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,n]),c.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Ew(t,e+1)}}},ht=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new BL(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&Ew(i,0)}}return o};class $L{constructor(e,n){this.insertions=n,this.deletions=e,this.meta=new Map}}const vw=(t,e,n)=>{$l(t,n.deletions,r=>{r instanceof kt&&e.scope.some(i=>i===t.doc||gf(i,r))&&Gg(r,!1)})},ww=(t,e,n)=>{let r=null;const i=t.doc,s=t.scope;ht(i,a=>{for(;e.length>0&&t.currStackItem===null;){const l=i.store,c=e.pop(),u=new Set,d=[];let h=!1;$l(a,c.insertions,f=>{if(f instanceof kt){if(f.redone!==null){let{item:p,diff:g}=N5(l,f.id);g>0&&(p=yr(a,We(p.id.client,p.id.clock+g))),f=p}!f.deleted&&s.some(p=>p===a.doc||gf(p,f))&&d.push(f)}}),$l(a,c.deletions,f=>{f instanceof kt&&s.some(p=>p===a.doc||gf(p,f))&&!ku(c.insertions,f.id)&&u.add(f)}),u.forEach(f=>{h=Vw(a,f,u,c.insertions,t.ignoreRemoteMapChanges,t)!==null||h});for(let f=d.length-1;f>=0;f--){const p=d[f];t.deleteFilter(p)&&(p.delete(a),h=!0)}t.currStackItem=h?c:null}a.changed.forEach((l,c)=>{l.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),r=a},t);const o=t.currStackItem;if(o!=null){const a=r.changedParentTypes;t.emit("stack-item-popped",[{stackItem:o,type:n,changedParentTypes:a,origin:t},t]),t.currStackItem=null}return o};class Sa extends Yv{constructor(e,{captureTimeout:n=500,captureTransaction:r=l=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:a=ug(e)?e[0].doc:e instanceof Ds?e:e.doc}={}){super(),this.scope=[],this.doc=a,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(b=>l.changedParentTypes.has(b)||b===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;const c=this.undoing,u=this.redoing,d=c?this.redoStack:this.undoStack;c?this.stopCapturing():u||this.clear(!1,!0);const h=new Ul;l.afterState.forEach((b,_)=>{const y=l.beforeState.get(_)||0,x=b-y;x>0&&Tu(h,_,y,x)});const f=pf();let p=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&d.length>0&&!c&&!u){const b=d[d.length-1];b.deletions=Dg([b.deletions,l.deleteSet]),b.insertions=Dg([b.insertions,h])}else d.push(new $L(l.deleteSet,h)),p=!0;!c&&!u&&(this.lastChange=f),$l(l,l.deleteSet,b=>{b instanceof kt&&this.scope.some(_=>_===l.doc||gf(_,b))&&Gg(b,!0)});const g=[{stackItem:d[d.length-1],origin:l.origin,type:c?"redo":"undo",changedParentTypes:l.changedParentTypes},this];p?this.emit("stack-item-added",g):this.emit("stack-item-updated",g)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){const n=new Set(this.scope);e=ug(e)?e:[e],e.forEach(r=>{n.has(r)||(n.add(r),(r instanceof Tn?r.doc!==this.doc:r!==this.doc)&&Zv("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,n=!0){(e&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>vw(r,this,i)),this.undoStack=[]),n&&(this.redoStack.forEach(i=>vw(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=ww(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=ww(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*HL(t){const e=ze(t.restDecoder);for(let n=0;n<e;n++){const r=ze(t.restDecoder),i=t.readClient();let s=ze(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const l=ze(t.restDecoder);yield new Gr(We(i,s),l),s+=l}else if((lf&a)!==0){const l=(a&(As|ir))===0,c=new kt(We(i,s),null,(a&ir)===ir?t.readLeftID():null,null,(a&As)===As?t.readRightID():null,l?t.readParentInfo()?t.readString():t.readLeftID():null,l&&(a&xu)===xu?t.readString():null,qw(t,a));yield c,s+=c.length}else{const l=t.readLen();yield new Yr(We(i,s),l),s+=l}}}}class Rg{constructor(e,n){this.gen=HL(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Gr);return this.curr}}class Bg{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const kw=t=>xf(t,iw,Su),zL=(t,e)=>{if(t.constructor===Yr){const{client:n,clock:r}=t.id;return new Yr(We(n,r+e),t.length-e)}else if(t.constructor===Gr){const{client:n,clock:r}=t.id;return new Gr(We(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new kt(We(r,i+e),null,We(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},xf=(t,e=zl,n=Ta)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Rl(u)));let i=r.map(u=>new Rg(u,!0)),s=null;const o=new n,a=new Bg(o);for(;i=i.filter(h=>h.curr!==null),i.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const p=h.curr.id.clock-f.curr.id.clock;return p===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===Gr?1:-1:p}else return f.curr.id.client-h.curr.id.client}),i.length!==0;){const u=i[0],d=u.curr.id.client;if(s!==null){let h=u.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=s.struct.id.clock+s.struct.length&&h.id.client>=s.struct.id.client;)h=u.next(),f=!0;if(h===null||h.id.client!==d||f&&h.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)yo(a,s.struct,s.offset),s={struct:h,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<h.id.clock)if(s.struct.constructor===Gr)s.struct.length=h.id.clock+h.length-s.struct.id.clock;else{yo(a,s.struct,s.offset);const p=h.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Gr(We(d,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-h.id.clock;p>0&&(s.struct.constructor===Gr?s.struct.length-=p:h=zL(h,p)),s.struct.mergeWith(h)||(yo(a,s.struct,s.offset),s={struct:h,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let h=u.curr;h!==null&&h.id.client===d&&h.id.clock===s.struct.id.clock+s.struct.length&&h.constructor!==Gr;h=u.next())yo(a,s.struct,s.offset),s={struct:h,offset:0}}s!==null&&(yo(a,s.struct,s.offset),s=null),Fg(a);const l=r.map(u=>Ng(u)),c=Dg(l);return Hl(o,c),o.toUint8Array()},WL=(t,e,n=zl,r=Ta)=>{const i=cw(e),s=new r,o=new Bg(s),a=new n(Rl(t)),l=new Rg(a,!1);for(;l.curr;){const u=l.curr,d=u.id.client,h=i.get(d)||0;if(l.curr.constructor===Gr){l.next();continue}if(u.id.clock+u.length>h)for(yo(o,u,wa(h-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)yo(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=h;)l.next()}Fg(o);const c=Ng(a);return Hl(s,c),s.toUint8Array()},Tw=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Fi(t.encoder.restEncoder)}),t.encoder.restEncoder=cf(),t.written=0)},yo=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Tw(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Ve(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Fg=t=>{Tw(t);const e=t.encoder.restEncoder;Ve(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Ve(e,r.written),uf(e,r.restEncoder)}},jL=(t,e,n,r)=>{const i=new n(Rl(t)),s=new Rg(i,!1),o=new r,a=new Bg(o);for(let c=s.curr;c!==null;c=s.next())yo(a,e(c),0);Fg(a);const l=Ng(i);return Hl(o,l),o.toUint8Array()},YL=t=>jL(t,wP,zl,Su),Sw="You must not compute changes after the event-handler fired.";class Ef{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=GL(this.currentTarget,this.target))}deletes(e){return ku(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw bo(Sw);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=cg(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=cg(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=cg(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw bo(Sw);const n=this.target,r=va(),i=va(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=n._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const GL=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Yn=()=>{Zv("Invalid access: Add Yjs type to a document before reading data.")},Cw=80;let Ug=0;class VL{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Ug++}}const qL=t=>{t.timestamp=Ug++},Aw=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Ug++},XL=(t,e,n)=>{if(t.length>=Cw){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Aw(r,e,n),r}else{const r=new VL(e,n);return t.push(r),r}},vf=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>af(e-s.index)<af(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,qL(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&af(n.index-i)<r.parent.length/Cw?(Aw(n,r,i),n):XL(t._searchMarker,r,i)},Cu=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=wa(e,i.index+n))}},wf=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Ss(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;pw(r._eH,n,e)};class Tn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=dw(),this._dEH=dw(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Ui()}clone(){throw Ui()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){hw(this._eH,e)}observeDeep(e){hw(this._dEH,e)}unobserve(e){fw(this._eH,e)}unobserveDeep(e){fw(this._dEH,e)}toJSON(){}}const Iw=(t,e,n)=>{t.doc??Yn(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},Mw=t=>{t.doc??Yn();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Au=(t,e)=>{let n=0,r=t._start;for(t.doc??Yn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},Dw=(t,e)=>{const n=[];return Au(t,(r,i)=>{n.push(e(r,i,t))}),n},KL=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Nw=(t,e)=>{t.doc??Yn();const n=vf(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},kf=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,l=n===null?e._start:n.right;let c=[];const u=()=>{c.length>0&&(i=new kt(We(o,an(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ia(c)),i.integrate(t,0),c=[])};r.forEach(d=>{if(d===null)c.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:i=new kt(We(o,an(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Iu(new Uint8Array(d))),i.integrate(t,0);break;case Ds:i=new kt(We(o,an(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Du(d)),i.integrate(t,0);break;default:if(d instanceof Tn)i=new kt(We(o,an(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ns(d)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Ow=()=>bo("Length exceeded!"),Pw=(t,e,n,r)=>{if(n>e._length)throw Ow();if(n===0)return e._searchMarker&&Cu(e._searchMarker,n,r.length),kf(t,e,null,r);const i=n,s=vf(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&yr(t,We(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Cu(e._searchMarker,i,r.length),kf(t,e,o,r)},QL=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return kf(t,e,i,n)},Lw=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=vf(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&yr(t,We(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&yr(t,We(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Ow();e._searchMarker&&Cu(e._searchMarker,i,-s+r)},Tf=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},$g=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new Ia([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Ia([r]);break;case Uint8Array:a=new Iu(r);break;case Ds:a=new Du(r);break;default:if(r instanceof Tn)a=new Ns(r);else throw new Error("Unexpected content type")}new kt(We(o,an(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Hg=(t,e)=>{t.doc??Yn();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Rw=t=>{const e={};return t.doc??Yn(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Bw=(t,e)=>{t.doc??Yn();const n=t._map.get(e);return n!==void 0&&!n.deleted},ZL=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&jl(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Sf=t=>(t.doc??Yn(),bL(t._map.entries(),e=>!e[1].deleted));class JL extends Ef{}class sr extends Tn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new sr;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sr}clone(){const e=new sr;return e.insert(0,this.toArray().map(n=>n instanceof Tn?n.clone():n)),e}get length(){return this.doc??Yn(),this._length}_callObserver(e,n){super._callObserver(e,n),wf(this,e,new JL(this,e))}insert(e,n){this.doc!==null?ht(this.doc,r=>{Pw(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ht(this.doc,n=>{QL(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ht(this.doc,r=>{Lw(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Nw(this,e)}toArray(){return Mw(this)}slice(e=0,n=this.length){return Iw(this,e,n)}toJSON(){return this.map(e=>e instanceof Tn?e.toJSON():e)}map(e){return Dw(this,e)}forEach(e){Au(this,e)}[Symbol.iterator](){return KL(this)}_write(e){e.writeTypeRef(k5)}}const e5=t=>new sr;class t5 extends Ef{constructor(e,n,r){super(e,n),this.keysChanged=r}}class at extends Tn{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new at}clone(){const e=new at;return this.forEach((n,r)=>{e.set(r,n instanceof Tn?n.clone():n)}),e}_callObserver(e,n){wf(this,e,new t5(this,e,n))}toJSON(){this.doc??Yn();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof Tn?i.toJSON():i}}),e}get size(){return[...Sf(this)].length}keys(){return Ag(Sf(this),e=>e[0])}values(){return Ag(Sf(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ag(Sf(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Yn(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ht(this.doc,n=>{Tf(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ht(this.doc,r=>{$g(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Hg(this,e)}has(e){return Bw(this,e)}clear(){this.doc!==null?ht(this.doc,e=>{this.forEach(function(n,r,i){Tf(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(T5)}}const n5=t=>new at,_o=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&EP(t,e);class zg{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&$i(),this.right.content.constructor){case ln:this.right.deleted||Yl(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Fw=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case ln:e.right.deleted||Yl(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&yr(t,We(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Cf=(t,e,n,r)=>{const i=new Map,s=r?vf(e,n):null;if(s){const o=new zg(s.p.left,s.p,s.index,i);return Fw(t,o,n-s.index)}else{const o=new zg(null,e._start,0,i);return Fw(t,o,n)}},Uw=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ln&&_o(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const l=n.left,c=n.right,u=new kt(We(s,an(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new ln(a,o));u.integrate(t,0),n.right=u,n.forward()})},Yl=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},$w=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===ln&&_o(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Hw=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=n.currentAttributes.get(a)??null;if(!_o(c,l)){o.set(a,c);const{left:u,right:d}=n;n.right=new kt(We(s,an(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new ln(a,l)),n.right.integrate(t,0),n.forward()}}return o},Wg=(t,e,n,r,i)=>{n.currentAttributes.forEach((h,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;$w(n,i);const a=Hw(t,e,n,i),l=r.constructor===String?new Wi(r):r instanceof Tn?new Ns(r):new Aa(r);let{left:c,right:u,index:d}=n;e._searchMarker&&Cu(e._searchMarker,n.index,l.getLength()),u=new kt(We(o,an(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(t,0),n.right=u,n.index=d,n.forward(),Uw(t,e,n,a)},zw=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;$w(n,i);const a=Hw(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===ln));){if(!n.right.deleted)switch(n.right.content.constructor){case ln:{const{key:l,value:c}=n.right.content,u=i[l];if(u!==void 0){if(_o(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}n.right.delete(t)}else n.currentAttributes.set(l,c);break}default:r<n.right.length&&yr(t,We(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new kt(We(o,an(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Wi(l)),n.right.integrate(t,0),n.forward()}Uw(t,e,n,a)},Ww=(t,e,n,r,i)=>{let s=e;const o=br();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===ln){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(n===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case ln:{const{key:u,value:d}=c,h=r.get(u)??null;(o.get(u)!==c||h===d)&&(e.delete(t),a++,!l&&(i.get(u)??null)===d&&h!==d&&(h===null?i.delete(u):i.set(u,h))),!l&&!e.deleted&&Yl(i,c);break}}}e=e.right}return a},r5=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===ln){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},i5=t=>{let e=0;return ht(t.doc,n=>{let r=t._start,i=t._start,s=br();const o=dg(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case ln:Yl(o,i.content);break;default:e+=Ww(n,r,i,s,o),s=dg(o),r=i;break}i=i.right}}),e},s5=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&yw(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===ln&&o.constructor!==Yr&&e.add(o.parent)})}ht(n,r=>{$l(t,t.deleteSet,i=>{if(i instanceof Yr||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===ln?e.add(s):r5(r,i)});for(const i of e)i5(i)})},jw=(t,e,n)=>{const r=n,i=dg(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ns:case Aa:case Wi:n<e.right.length&&yr(t,We(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Ww(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Cu(o._searchMarker,e.index,-r+n),e};class o5 extends Ef{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ht(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,d=0;const h=()=>{if(a!==null){let f=null;switch(a){case"delete":d>0&&(f={delete:d}),d=0;break;case"insert":(typeof c=="object"||c.length>0)&&(f={insert:c},i.size>0&&(f.attributes={},i.forEach((p,g)=>{p!==null&&(f.attributes[g]=p)}))),c="";break;case"retain":u>0&&(f={retain:u},_P(l)||(f.attributes=bP({},l))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case Ns:case Aa:this.adds(o)?this.deletes(o)||(h(),a="insert",c=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=1);break;case Wi:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=o.length);break;case ln:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(f)??null;_o(g,p)?p!==null&&o.delete(r):(a==="retain"&&h(),_o(p,s.get(f)??null)?delete l[f]:l[f]=p)}}else if(this.deletes(o)){s.set(f,p);const g=i.get(f)??null;_o(g,p)||(a==="retain"&&h(),l[f]=g)}else if(!o.deleted){s.set(f,p);const g=l[f];g!==void 0&&(_o(g,p)?g!==null&&o.delete(r):(a==="retain"&&h(),p===null?delete l[f]:l[f]=p))}o.deleted||(a==="insert"&&h(),Yl(i,o.content));break}}o=o.right}for(h();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class gt extends Tn{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Yn(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new gt}clone(){const e=new gt;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new o5(this,e,n);wf(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Yn();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Wi&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ht(this.doc,r=>{const i=new zg(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Wg(r,this,i,a,o.attributes||{})}else o.retain!==void 0?zw(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&jw(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Yn();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const d={};let h=!1;s.forEach((p,g)=>{h=!0,d[g]=p});const f={insert:a};h&&(f.attributes=d),i.push(f),a=""}}const u=()=>{for(;l!==null;){if(jl(l,e)||n!==void 0&&jl(l,n))switch(l.content.constructor){case Wi:{const d=s.get("ychange");e!==void 0&&!jl(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!jl(l,n)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case Ns:case Aa:{c();const d={insert:l.content.getContent()[0]};if(s.size>0){const h={};d.attributes=h,s.forEach((f,p)=>{h[p]=f})}i.push(d);break}case ln:jl(l,e)&&(c(),Yl(s,l.content));break}l=l.right}c()};return e||n?ht(o,d=>{e&&Pg(d,e),n&&Pg(d,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?ht(i,s=>{const o=Cf(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),Wg(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?ht(i,s=>{const o=Cf(s,this,e,!r);Wg(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?ht(r,i=>{jw(i,Cf(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?ht(i,s=>{const o=Cf(s,this,e,!1);o.right!==null&&zw(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?ht(this.doc,n=>{Tf(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ht(this.doc,r=>{$g(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Hg(this,e)}getAttributes(){return Rw(this)}_write(e){e.writeTypeRef(S5)}}const a5=t=>new gt;class jg{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Yn()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===Gl||n.constructor===Ca)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Ca extends Tn{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ca}clone(){const e=new Ca;return e.insert(0,this.toArray().map(n=>n instanceof Tn?n.clone():n)),e}get length(){return this.doc??Yn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new jg(this,e)}querySelector(e){e=e.toUpperCase();const r=new jg(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ts(new jg(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){wf(this,e,new u5(this,n,e))}toString(){return Dw(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Au(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?ht(this.doc,r=>{Pw(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ht(this.doc,r=>{const i=e&&e instanceof Tn?e._item:e;kf(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw bo("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?ht(this.doc,r=>{Lw(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Mw(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Nw(this,e)}slice(e=0,n=this.length){return Iw(this,e,n)}forEach(e){Au(this,e)}_write(e){e.writeTypeRef(A5)}}const l5=t=>new Ca;class Gl extends Ca{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Gl(this.nodeName)}clone(){const e=new Gl(this.nodeName),n=this.getAttributes();return yP(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof Tn?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];n.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?ht(this.doc,n=>{Tf(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ht(this.doc,r=>{$g(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Hg(this,e)}hasAttribute(e){return Bw(this,e)}getAttributes(e){return e?ZL(this,e):Rw(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Au(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(C5),e.writeKey(this.nodeName)}}const c5=t=>new Gl(t.readKey());class u5 extends Ef{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Af extends at{constructor(e){super(),this.hookName=e}_copy(){return new Af(this.hookName)}clone(){const e=new Af(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(I5),e.writeKey(this.hookName)}}const d5=t=>new Af(t.readKey());class If extends gt{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new If}clone(){const e=new If;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(M5)}}const h5=t=>new If;class Yg{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Ui()}mergeWith(e){return!1}write(e,n,r){throw Ui()}integrate(e,n){throw Ui()}}const f5=0;class Yr extends Yg{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),gw(e.doc.store,this)}write(e,n){e.writeInfo(f5),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Iu{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Iu(this.content)}splice(e){throw Ui()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const p5=t=>new Iu(t.readBuf());class Mu{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Mu(this.len)}splice(e){const n=new Mu(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Tu(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const m5=t=>new Mu(t.readLen()),Yw=(t,e)=>new Ds({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Du{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Du(Yw(this.doc.guid,this.opts))}splice(e){throw Ui()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const g5=t=>new Du(Yw(t.readString(),t.readAny()));class Aa{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Aa(this.embed)}splice(e){throw Ui()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const b5=t=>new Aa(t.readJSON());class ln{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ln(this.key,this.value)}splice(e){throw Ui()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const y5=t=>new ln(t.readKey(),t.readJSON());class Mf{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Mf(this.arr)}splice(e){const n=new Mf(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const _5=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Mf(n)},x5=of("node_env")==="development";class Ia{constructor(e){this.arr=e,x5&&Cv(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ia(this.arr)}splice(e){const n=new Ia(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const E5=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ia(n)};class Wi{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Wi(this.str)}splice(e){const n=new Wi(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const v5=t=>new Wi(t.readString()),w5=[e5,n5,a5,c5,l5,d5,h5],k5=0,T5=1,S5=2,C5=3,A5=4,I5=5,M5=6;class Ns{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ns(this.type._copy())}splice(e){throw Ui()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const D5=t=>new Ns(w5[t.readTypeRef()](t)),N5=(t,e)=>{let n=e,r=0,i;do r>0&&(n=We(n.client,n.clock+r)),i=yf(t,n),r=n.clock-i.id.clock,n=i.redone;while(n!==null&&i instanceof kt);return{item:i,diff:r}},Gg=(t,e)=>{for(;t!==null&&t.keep!==e;)t.keep=e,t=t.parent._item},Df=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new kt(We(r,i+n),e,We(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=We(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s},Gw=(t,e)=>iP(t,n=>ku(n.deletions,e)),Vw=(t,e,n,r,i,s)=>{const o=t.doc,a=o.store,l=o.clientID,c=e.redone;if(c!==null)return yr(t,c);let u=e.parent._item,d=null,h;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!n.has(u)||Vw(t,u,n,r,i,s)===null))return null;for(;u.redone!==null;)u=yr(t,u.redone)}const f=u===null?e.parent:u.content.type;if(e.parentSub===null){for(d=e.left,h=e;d!==null;){let _=d;for(;_!==null&&_.parent._item!==u;)_=_.redone===null?null:yr(t,_.redone);if(_!==null&&_.parent._item===u){d=_;break}d=d.left}for(;h!==null;){let _=h;for(;_!==null&&_.parent._item!==u;)_=_.redone===null?null:yr(t,_.redone);if(_!==null&&_.parent._item===u){h=_;break}h=h.right}}else if(h=null,e.right&&!i){for(d=e;d!==null&&d.right!==null&&(d.right.redone||ku(r,d.right.id)||Gw(s.undoStack,d.right.id)||Gw(s.redoStack,d.right.id));)for(d=d.right;d.redone;)d=yr(t,d.redone);if(d&&d.right!==null)return null}else d=f._map.get(e.parentSub)||null;const p=an(a,l),g=We(l,p),b=new kt(g,d,d&&d.lastId,h,h&&h.id,f,e.parentSub,e.content.copy());return e.redone=g,Gg(b,!0),b.integrate(t,0),b};class kt extends Yg{constructor(e,n,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?Ov:0}set marker(e){(this.info&mg)>0!==e&&(this.info^=mg)}get marker(){return(this.info&mg)>0}get keep(){return(this.info&Nv)>0}set keep(e){this.keep!==e&&(this.info^=Nv)}get countable(){return(this.info&Ov)>0}get deleted(){return(this.info&pg)>0}set deleted(e){this.deleted!==e&&(this.info^=pg)}markDeleted(){this.info|=pg}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=an(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=an(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Wl&&this.id.client!==this.parent.client&&this.parent.clock>=an(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bw(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=yr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Yr||this.right&&this.right.constructor===Yr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===kt?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===kt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Wl){const r=yf(n,this.parent);r.constructor===Yr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=bw(e,e.doc.store,We(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),mf(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(mf(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(yf(e.doc.store,i.origin)))s.has(yf(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),gw(e.doc.store,this),this.content.integrate(e,this),xw(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Yr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:We(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&mf(e.origin,this.lastId)&&this.right===e&&mf(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Tu(e.deleteSet,this.id.client,this.id.clock,this.length),xw(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw $i();this.content.gc(e),n?RL(e,this,new Yr(this.id,this.length)):this.content=new Mu(this.length)}write(e,n){const r=n>0?We(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&lf|(r===null?0:ir)|(i===null?0:As)|(s===null?0:xu);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=LL(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Wl?(e.writeParentInfo(!1),e.writeLeftID(a)):$i();s!==null&&e.writeString(s)}this.content.write(e,n)}}const qw=(t,e)=>O5[e&lf](t),O5=[()=>{$i()},m5,_5,p5,v5,b5,y5,D5,E5,g5,()=>{$i()}],P5=10;class Gr extends Yg{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){$i()}write(e,n){e.writeInfo(P5),Ve(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Xw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Kw="__ $YJS$ __";Xw[Kw]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Xw[Kw]=!0;var L5=Symbol.for("preact-signals");function Vg(){if(Vl>1)Vl--;else{for(var t,e=!1;Nu!==void 0;){var n=Nu;for(Nu=void 0,qg++;n!==void 0;){var r=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Jw(n))try{n.c()}catch(i){e||(t=i,e=!0)}n=r}}if(qg=0,Vl--,e)throw t}}var lt=void 0;function Qw(t){var e=lt;lt=void 0;try{return t()}finally{lt=e}}var Nu=void 0,Vl=0,qg=0,Nf=0;function Zw(t){if(lt!==void 0){var e=t.n;if(e===void 0||e.t!==lt)return e={i:0,S:t,p:lt.s,n:void 0,t:lt,e:void 0,x:void 0,r:e},lt.s!==void 0&&(lt.s.n=e),lt.s=e,t.n=e,32&lt.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=lt.s,e.n=void 0,lt.s.n=e,lt.s=e),e}}function cn(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched}cn.prototype.brand=L5,cn.prototype.h=function(){return!0},cn.prototype.S=function(t){var e=this,n=this.t;n!==t&&t.e===void 0&&(t.x=n,this.t=t,n!==void 0?n.e=t:Qw(function(){var r;(r=e.W)==null||r.call(e)}))},cn.prototype.U=function(t){var e=this;if(this.t!==void 0){var n=t.e,r=t.x;n!==void 0&&(n.x=r,t.e=void 0),r!==void 0&&(r.e=n,t.x=void 0),t===this.t&&(this.t=r,r===void 0&&Qw(function(){var i;(i=e.Z)==null||i.call(e)}))}},cn.prototype.subscribe=function(t){var e=this;return Pu(function(){var n=e.value,r=lt;lt=void 0;try{t(n)}finally{lt=r}})},cn.prototype.valueOf=function(){return this.value},cn.prototype.toString=function(){return this.value+""},cn.prototype.toJSON=function(){return this.value},cn.prototype.peek=function(){var t=lt;lt=void 0;try{return this.value}finally{lt=t}},Object.defineProperty(cn.prototype,"value",{get:function(){var t=Zw(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(qg>100)throw new Error("Cycle detected");this.v=t,this.i++,Nf++,Vl++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Vg()}}}});function un(t,e){return new cn(t,e)}function Jw(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function ek(t){for(var e=t.s;e!==void 0;e=e.n){var n=e.S.n;if(n!==void 0&&(e.r=n),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function tk(t){for(var e=t.s,n=void 0;e!==void 0;){var r=e.p;e.i===-1?(e.S.U(e),r!==void 0&&(r.n=e.n),e.n!==void 0&&(e.n.p=r)):n=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=r}t.s=n}function Ma(t,e){cn.call(this,void 0),this.x=t,this.s=void 0,this.g=Nf-1,this.f=4,this.W=e==null?void 0:e.watched,this.Z=e==null?void 0:e.unwatched}Ma.prototype=new cn,Ma.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Nf))return!0;if(this.g=Nf,this.f|=1,this.i>0&&!Jw(this))return this.f&=-2,!0;var t=lt;try{ek(this),lt=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return lt=t,tk(this),this.f&=-2,!0},Ma.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}cn.prototype.S.call(this,t)},Ma.prototype.U=function(t){if(this.t!==void 0&&(cn.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Ma.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}},Object.defineProperty(Ma.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=Zw(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Os(t,e){return new Ma(t,e)}function nk(t){var e=t.u;if(t.u=void 0,typeof e=="function"){Vl++;var n=lt;lt=void 0;try{e()}catch(r){throw t.f&=-2,t.f|=8,Xg(t),r}finally{lt=n,Vg()}}}function Xg(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,nk(t)}function R5(t){if(lt!==this)throw new Error("Out-of-order effect");tk(this),lt=t,this.f&=-2,8&this.f&&Xg(this),Vg()}function Ou(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Ou.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}},Ou.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,nk(this),ek(this),Vl++;var t=lt;return lt=this,R5.bind(this,t)},Ou.prototype.N=function(){2&this.f||(this.f|=2,this.o=Nu,Nu=this)},Ou.prototype.d=function(){this.f|=8,1&this.f||Xg(this)};function Pu(t){var e=new Ou(t);try{e.c()}catch(n){throw e.d(),n}return e.d.bind(e)}class Kg{constructor(){this._getOrigin=e=>({doc:e,proxy:!0,target:this}),this._onObserve=(e,n)=>{var r,i,s,o;(((r=e.transaction.origin)==null?void 0:r.force)===!0||((i=e.transaction.origin)==null?void 0:i.proxy)!==!0&&(!e.transaction.local||e.transaction.origin instanceof Sa))&&n();const a=!e.transaction.origin||!this._ySource.doc||e.transaction.origin instanceof Sa||e.transaction.origin.proxy?!0:e.transaction.origin===this._ySource.doc.clientID;(o=(s=this._options)==null?void 0:s.onChange)==null||o.call(s,this._proxy,a)},this._skipNext=!1,this._stashed=new Set,this._transact=(e,n)=>{e.transact(n,this._getOrigin(e))},this._updateWithSkip=e=>{this._skipNext||(this._skipNext=!0,e(),this._skipNext=!1)}}get proxy(){return this._proxy}}const Qg="Schema not found. The block flavour may not be registered.",rk="$blocksuite:internal:text$",Lu="$blocksuite:internal:native$",ik=new Set(["id","flavour","children","version"]),Of=class{constructor(e){this.getValue=()=>this._map.get("value"),this.setValue=n=>this._map.set("value",n),e instanceof at&&e.doc&&e.get("type")===Lu?this._map=e:(this._map=new at,this._map.set("type",Lu),this._map.set("value",e)),this._map.observeDeep(n=>{n.forEach(r=>{var i;const s=!r.transaction.origin||!this._map.doc||r.transaction.origin instanceof Sa||r.transaction.origin.proxy?!0:r.transaction.origin===this._map.doc.clientID;(i=this._onChange)==null||i.call(this,this.getValue(),s)})})}get yMap(){return this._map}bind(e){this._onChange=e}};Of.from=(t,e)=>{const n=new Of(t.get("value"));return e&&n.bind(e),n},Of.is=t=>t instanceof at&&t.get("type")===Lu;let Vr=Of;const ji=new WeakMap;function Da(t){return t!==null&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&[Object,void 0,null].some(e=>e===t.constructor)}var Ze;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},t.getValidEnumValues=i=>{const s=t.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return t.objectValues(o)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},t.find=(i,s)=>{for(const o of i)if(s(o))return o},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}t.joinValues=r,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(Ze||(Ze={}));var Zg;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Zg||(Zg={}));const ce=Ze.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ps=t=>{switch(typeof t){case"undefined":return ce.undefined;case"string":return ce.string;case"number":return Number.isNaN(t)?ce.nan:ce.number;case"boolean":return ce.boolean;case"function":return ce.function;case"bigint":return ce.bigint;case"symbol":return ce.symbol;case"object":return Array.isArray(t)?ce.array:t===null?ce.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ce.promise:typeof Map<"u"&&t instanceof Map?ce.map:typeof Set<"u"&&t instanceof Set?ce.set:typeof Date<"u"&&t instanceof Date?ce.date:ce.object;default:return ce.unknown}},q=Ze.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),B5=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class Rr extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let a=r,l=0;for(;l<o.path.length;){const c=o.path[l];l===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(n(o))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return i(this),r}static assert(e){if(!(e instanceof Rr))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ze.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const i of this.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Rr.create=t=>new Rr(t);const ql=(t,e)=>{let n;switch(t.code){case q.invalid_type:t.received===ce.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case q.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Ze.jsonStringifyReplacer)}`;break;case q.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ze.joinValues(t.keys,", ")}`;break;case q.invalid_union:n="Invalid input";break;case q.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ze.joinValues(t.options)}`;break;case q.invalid_enum_value:n=`Invalid enum value. Expected ${Ze.joinValues(t.options)}, received '${t.received}'`;break;case q.invalid_arguments:n="Invalid function arguments";break;case q.invalid_return_type:n="Invalid function return type";break;case q.invalid_date:n="Invalid date";break;case q.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Ze.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case q.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case q.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case q.custom:n="Invalid input";break;case q.invalid_intersection_types:n="Intersection results could not be merged";break;case q.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case q.not_finite:n="Number must be finite";break;default:n=e.defaultError,Ze.assertNever(t)}return{message:n}};let sk=ql;function F5(t){sk=t}function Pf(){return sk}const Lf=t=>{const{data:e,path:n,errorMaps:r,issueData:i}=t,s=[...n,...i.path||[]],o={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let a="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)a=c(o,{data:e,defaultError:a}).message;return{...i,path:s,message:a}},U5=[];function oe(t,e){const n=Pf(),r=Lf({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===ql?void 0:ql].filter(i=>!!i)});t.common.issues.push(r)}class Gn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const i of n){if(i.status==="aborted")return ke;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const i of n){const s=await i.key,o=await i.value;r.push({key:s,value:o})}return Gn.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const i of n){const{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return ke;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:e.value,value:r}}}const ke=Object.freeze({status:"aborted"}),Xl=t=>({status:"dirty",value:t}),or=t=>({status:"valid",value:t}),Jg=t=>t.status==="aborted",e0=t=>t.status==="dirty",Na=t=>t.status==="valid",Ru=t=>typeof Promise<"u"&&t instanceof Promise;var ge;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ge||(ge={}));class Yi{constructor(e,n,r,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ok=(t,e)=>{if(Na(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Rr(t.common.issues);return this._error=n,this._error}}};function Pe(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{const{message:l}=t;return o.code==="invalid_enum_value"?{message:l??a.defaultError}:typeof a.data>"u"?{message:l??r??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:l??n??a.defaultError}},description:i}}class Fe{get description(){return this._def.description}_getType(e){return Ps(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Ps(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Gn,ctx:{common:e.parent.common,data:e.data,parsedType:Ps(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Ru(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ps(e)},i=this._parseSync({data:e,path:r.path,parent:r});return ok(r,i)}"~validate"(e){var r,i;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ps(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:n});return Na(s)?{value:s.value}:{issues:n.common.issues}}catch(s){(i=(r=s==null?void 0:s.message)==null?void 0:r.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(s=>Na(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ps(e)},i=this._parse({data:e,path:r.path,parent:r}),s=await(Ru(i)?i:Promise.resolve(i));return ok(r,s)}refine(e,n){const r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,s)=>{const o=e(i),a=()=>s.addIssue({code:q.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,n){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(e){return new pi({schema:this,typeName:Te.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Vi.create(this,this._def)}nullable(){return wo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fi.create(this)}promise(){return Jl.create(this,this._def)}or(e){return $u.create([this,e],this._def)}and(e){return Hu.create(this,e,this._def)}transform(e){return new pi({...Pe(this._def),schema:this,typeName:Te.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Gu({...Pe(this._def),innerType:this,defaultValue:n,typeName:Te.ZodDefault})}brand(){return new r0({typeName:Te.ZodBranded,type:this,...Pe(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Vu({...Pe(this._def),innerType:this,catchValue:n,typeName:Te.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return qu.create(this,e)}readonly(){return Xu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const $5=/^c[^\s-]{8,}$/i,H5=/^[0-9a-z]+$/,z5=/^[0-9A-HJKMNP-TV-Z]{26}$/i,W5=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,j5=/^[a-z0-9_-]{21}$/i,Y5=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,G5=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,V5=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,q5="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let t0;const X5=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,K5=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Q5=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Z5=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,J5=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,eR=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ak="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tR=new RegExp(`^${ak}$`);function lk(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function nR(t){return new RegExp(`^${lk(t)}$`)}function ck(t){let e=`${ak}T${lk(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function rR(t,e){return!!((e==="v4"||!e)&&X5.test(t)||(e==="v6"||!e)&&Q5.test(t))}function iR(t,e){if(!Y5.test(t))return!1;try{const[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function sR(t,e){return!!((e==="v4"||!e)&&K5.test(t)||(e==="v6"||!e)&&Z5.test(t))}class hi extends Fe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ce.string){const s=this._getOrReturnCtx(e);return oe(s,{code:q.invalid_type,expected:ce.string,received:s.parsedType}),ke}const r=new Gn;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),oe(i,{code:q.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),oe(i,{code:q.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,a=e.data.length<s.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?oe(i,{code:q.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&oe(i,{code:q.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")V5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"email",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")t0||(t0=new RegExp(q5,"u")),t0.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"emoji",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")W5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"uuid",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")j5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"nanoid",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")$5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"cuid",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")H5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"cuid2",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")z5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"ulid",code:q.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),oe(i,{validation:"url",code:q.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"regex",code:q.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?ck(s).test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?tR.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?nR(s).test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{code:q.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?G5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"duration",code:q.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?rR(e.data,s.version)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"ip",code:q.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?iR(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"jwt",code:q.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?sR(e.data,s.version)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"cidr",code:q.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?J5.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"base64",code:q.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?eR.test(e.data)||(i=this._getOrReturnCtx(e,i),oe(i,{validation:"base64url",code:q.invalid_string,message:s.message}),r.dirty()):Ze.assertNever(s);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(i=>e.test(i),{validation:n,code:q.invalid_string,...ge.errToObj(r)})}_addCheck(e){return new hi({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ge.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ge.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ge.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ge.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ge.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ge.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ge.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ge.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ge.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ge.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ge.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ge.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ge.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ge.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ge.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ge.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...ge.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...ge.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...ge.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...ge.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...ge.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...ge.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...ge.errToObj(n)})}nonempty(e){return this.min(1,ge.errToObj(e))}trim(){return new hi({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new hi({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new hi({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}hi.create=t=>new hi({checks:[],typeName:Te.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...Pe(t)});function oR(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r,s=Number.parseInt(t.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return s%o/10**i}class xo extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ce.number){const s=this._getOrReturnCtx(e);return oe(s,{code:q.invalid_type,expected:ce.number,received:s.parsedType}),ke}let r;const i=new Gn;for(const s of this._def.checks)s.kind==="int"?Ze.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),oe(r,{code:q.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?oR(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),oe(r,{code:q.not_finite,message:s.message}),i.dirty()):Ze.assertNever(s);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,ge.toString(n))}gt(e,n){return this.setLimit("min",e,!1,ge.toString(n))}lte(e,n){return this.setLimit("max",e,!0,ge.toString(n))}lt(e,n){return this.setLimit("max",e,!1,ge.toString(n))}setLimit(e,n,r,i){return new xo({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:ge.toString(i)}]})}_addCheck(e){return new xo({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ge.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ge.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ge.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ge.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ge.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:ge.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:ge.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ge.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ge.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ze.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}xo.create=t=>new xo({checks:[],typeName:Te.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...Pe(t)});class Eo extends Fe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ce.bigint)return this._getInvalidInput(e);let r;const i=new Gn;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),oe(r,{code:q.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):Ze.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return oe(n,{code:q.invalid_type,expected:ce.bigint,received:n.parsedType}),ke}gte(e,n){return this.setLimit("min",e,!0,ge.toString(n))}gt(e,n){return this.setLimit("min",e,!1,ge.toString(n))}lte(e,n){return this.setLimit("max",e,!0,ge.toString(n))}lt(e,n){return this.setLimit("max",e,!1,ge.toString(n))}setLimit(e,n,r,i){return new Eo({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:ge.toString(i)}]})}_addCheck(e){return new Eo({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ge.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ge.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ge.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ge.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:ge.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Eo.create=t=>new Eo({checks:[],typeName:Te.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...Pe(t)});class Bu extends Fe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ce.boolean){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.boolean,received:r.parsedType}),ke}return or(e.data)}}Bu.create=t=>new Bu({typeName:Te.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...Pe(t)});class Oa extends Fe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ce.date){const s=this._getOrReturnCtx(e);return oe(s,{code:q.invalid_type,expected:ce.date,received:s.parsedType}),ke}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return oe(s,{code:q.invalid_date}),ke}const r=new Gn;let i;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),oe(i,{code:q.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),oe(i,{code:q.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Ze.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Oa({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:ge.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:ge.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Oa.create=t=>new Oa({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Te.ZodDate,...Pe(t)});class Rf extends Fe{_parse(e){if(this._getType(e)!==ce.symbol){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.symbol,received:r.parsedType}),ke}return or(e.data)}}Rf.create=t=>new Rf({typeName:Te.ZodSymbol,...Pe(t)});class Fu extends Fe{_parse(e){if(this._getType(e)!==ce.undefined){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.undefined,received:r.parsedType}),ke}return or(e.data)}}Fu.create=t=>new Fu({typeName:Te.ZodUndefined,...Pe(t)});class Uu extends Fe{_parse(e){if(this._getType(e)!==ce.null){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.null,received:r.parsedType}),ke}return or(e.data)}}Uu.create=t=>new Uu({typeName:Te.ZodNull,...Pe(t)});class Kl extends Fe{constructor(){super(...arguments),this._any=!0}_parse(e){return or(e.data)}}Kl.create=t=>new Kl({typeName:Te.ZodAny,...Pe(t)});class Pa extends Fe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return or(e.data)}}Pa.create=t=>new Pa({typeName:Te.ZodUnknown,...Pe(t)});class Ls extends Fe{_parse(e){const n=this._getOrReturnCtx(e);return oe(n,{code:q.invalid_type,expected:ce.never,received:n.parsedType}),ke}}Ls.create=t=>new Ls({typeName:Te.ZodNever,...Pe(t)});class Bf extends Fe{_parse(e){if(this._getType(e)!==ce.undefined){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.void,received:r.parsedType}),ke}return or(e.data)}}Bf.create=t=>new Bf({typeName:Te.ZodVoid,...Pe(t)});class fi extends Fe{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),i=this._def;if(n.parsedType!==ce.array)return oe(n,{code:q.invalid_type,expected:ce.array,received:n.parsedType}),ke;if(i.exactLength!==null){const o=n.data.length>i.exactLength.value,a=n.data.length<i.exactLength.value;(o||a)&&(oe(n,{code:o?q.too_big:q.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(oe(n,{code:q.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(oe(n,{code:q.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,a)=>i.type._parseAsync(new Yi(n,o,n.path,a)))).then(o=>Gn.mergeArray(r,o));const s=[...n.data].map((o,a)=>i.type._parseSync(new Yi(n,o,n.path,a)));return Gn.mergeArray(r,s)}get element(){return this._def.type}min(e,n){return new fi({...this._def,minLength:{value:e,message:ge.toString(n)}})}max(e,n){return new fi({...this._def,maxLength:{value:e,message:ge.toString(n)}})}length(e,n){return new fi({...this._def,exactLength:{value:e,message:ge.toString(n)}})}nonempty(e){return this.min(1,e)}}fi.create=(t,e)=>new fi({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Te.ZodArray,...Pe(e)});function Ql(t){if(t instanceof Pt){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=Vi.create(Ql(r))}return new Pt({...t._def,shape:()=>e})}else return t instanceof fi?new fi({...t._def,type:Ql(t.element)}):t instanceof Vi?Vi.create(Ql(t.unwrap())):t instanceof wo?wo.create(Ql(t.unwrap())):t instanceof Gi?Gi.create(t.items.map(e=>Ql(e))):t}class Pt extends Fe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Ze.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==ce.object){const c=this._getOrReturnCtx(e);return oe(c,{code:q.invalid_type,expected:ce.object,received:c.parsedType}),ke}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Ls&&this._def.unknownKeys==="strip"))for(const c in i.data)o.includes(c)||a.push(c);const l=[];for(const c of o){const u=s[c],d=i.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Yi(i,d,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Ls){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of a)l.push({key:{status:"valid",value:u},value:{status:"valid",value:i.data[u]}});else if(c==="strict")a.length>0&&(oe(i,{code:q.unrecognized_keys,keys:a}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of a){const d=i.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Yi(i,d,i.path,u)),alwaysSet:u in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,h=await u.value;c.push({key:d,value:h,alwaysSet:u.alwaysSet})}return c}).then(c=>Gn.mergeObjectSync(r,c)):Gn.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return ge.errToObj,new Pt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,o;const i=((o=(s=this._def).errorMap)==null?void 0:o.call(s,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:ge.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Pt({...this._def,unknownKeys:"strip"})}passthrough(){return new Pt({...this._def,unknownKeys:"passthrough"})}extend(e){return new Pt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Pt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Te.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new Pt({...this._def,catchall:e})}pick(e){const n={};for(const r of Ze.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Pt({...this._def,shape:()=>n})}omit(e){const n={};for(const r of Ze.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new Pt({...this._def,shape:()=>n})}deepPartial(){return Ql(this)}partial(e){const n={};for(const r of Ze.objectKeys(this.shape)){const i=this.shape[r];e&&!e[r]?n[r]=i:n[r]=i.optional()}return new Pt({...this._def,shape:()=>n})}required(e){const n={};for(const r of Ze.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Vi;)s=s._def.innerType;n[r]=s}return new Pt({...this._def,shape:()=>n})}keyof(){return uk(Ze.objectKeys(this.shape))}}Pt.create=(t,e)=>new Pt({shape:()=>t,unknownKeys:"strip",catchall:Ls.create(),typeName:Te.ZodObject,...Pe(e)}),Pt.strictCreate=(t,e)=>new Pt({shape:()=>t,unknownKeys:"strict",catchall:Ls.create(),typeName:Te.ZodObject,...Pe(e)}),Pt.lazycreate=(t,e)=>new Pt({shape:t,unknownKeys:"strip",catchall:Ls.create(),typeName:Te.ZodObject,...Pe(e)});class $u extends Fe{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function i(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new Rr(a.ctx.common.issues));return oe(n,{code:q.invalid_union,unionErrors:o}),ke}if(n.common.async)return Promise.all(r.map(async s=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(i);{let s;const o=[];for(const l of r){const c={...n,common:{...n.common,issues:[]},parent:null},u=l._parseSync({data:n.data,path:n.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(l=>new Rr(l));return oe(n,{code:q.invalid_union,unionErrors:a}),ke}}get options(){return this._def.options}}$u.create=(t,e)=>new $u({options:t,typeName:Te.ZodUnion,...Pe(e)});const Rs=t=>t instanceof Wu?Rs(t.schema):t instanceof pi?Rs(t.innerType()):t instanceof ju?[t.value]:t instanceof vo?t.options:t instanceof Yu?Ze.objectValues(t.enum):t instanceof Gu?Rs(t._def.innerType):t instanceof Fu?[void 0]:t instanceof Uu?[null]:t instanceof Vi?[void 0,...Rs(t.unwrap())]:t instanceof wo?[null,...Rs(t.unwrap())]:t instanceof r0||t instanceof Xu?Rs(t.unwrap()):t instanceof Vu?Rs(t._def.innerType):[];class Ff extends Fe{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ce.object)return oe(n,{code:q.invalid_type,expected:ce.object,received:n.parsedType}),ke;const r=this.discriminator,i=n.data[r],s=this.optionsMap.get(i);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(oe(n,{code:q.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ke)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const i=new Map;for(const s of n){const o=Rs(s.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,s)}}return new Ff({typeName:Te.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:i,...Pe(r)})}}function n0(t,e){const n=Ps(t),r=Ps(e);if(t===e)return{valid:!0,data:t};if(n===ce.object&&r===ce.object){const i=Ze.objectKeys(e),s=Ze.objectKeys(t).filter(a=>i.indexOf(a)!==-1),o={...t,...e};for(const a of s){const l=n0(t[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(n===ce.array&&r===ce.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<t.length;s++){const o=t[s],a=e[s],l=n0(o,a);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return n===ce.date&&r===ce.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Hu extends Fe{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=(s,o)=>{if(Jg(s)||Jg(o))return ke;const a=n0(s.value,o.value);return a.valid?((e0(s)||e0(o))&&n.dirty(),{status:n.value,value:a.data}):(oe(r,{code:q.invalid_intersection_types}),ke)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Hu.create=(t,e,n)=>new Hu({left:t,right:e,typeName:Te.ZodIntersection,...Pe(n)});class Gi extends Fe{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ce.array)return oe(r,{code:q.invalid_type,expected:ce.array,received:r.parsedType}),ke;if(r.data.length<this._def.items.length)return oe(r,{code:q.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ke;!this._def.rest&&r.data.length>this._def.items.length&&(oe(r,{code:q.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((o,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new Yi(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>Gn.mergeArray(n,o)):Gn.mergeArray(n,s)}get items(){return this._def.items}rest(e){return new Gi({...this._def,rest:e})}}Gi.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gi({items:t,typeName:Te.ZodTuple,rest:null,...Pe(e)})};class zu extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ce.object)return oe(r,{code:q.invalid_type,expected:ce.object,received:r.parsedType}),ke;const i=[],s=this._def.keyType,o=this._def.valueType;for(const a in r.data)i.push({key:s._parse(new Yi(r,a,r.path,a)),value:o._parse(new Yi(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?Gn.mergeObjectAsync(n,i):Gn.mergeObjectSync(n,i)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof Fe?new zu({keyType:e,valueType:n,typeName:Te.ZodRecord,...Pe(r)}):new zu({keyType:hi.create(),valueType:e,typeName:Te.ZodRecord,...Pe(n)})}}class Uf extends Fe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ce.map)return oe(r,{code:q.invalid_type,expected:ce.map,received:r.parsedType}),ke;const i=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,l],c)=>({key:i._parse(new Yi(r,a,r.path,[c,"key"])),value:s._parse(new Yi(r,l,r.path,[c,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of o){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return ke;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),a.set(c.value,u.value)}return{status:n.value,value:a}})}else{const a=new Map;for(const l of o){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return ke;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),a.set(c.value,u.value)}return{status:n.value,value:a}}}}Uf.create=(t,e,n)=>new Uf({valueType:e,keyType:t,typeName:Te.ZodMap,...Pe(n)});class La extends Fe{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ce.set)return oe(r,{code:q.invalid_type,expected:ce.set,received:r.parsedType}),ke;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(oe(r,{code:q.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(oe(r,{code:q.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const s=this._def.valueType;function o(l){const c=new Set;for(const u of l){if(u.status==="aborted")return ke;u.status==="dirty"&&n.dirty(),c.add(u.value)}return{status:n.value,value:c}}const a=[...r.data.values()].map((l,c)=>s._parse(new Yi(r,l,r.path,c)));return r.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,n){return new La({...this._def,minSize:{value:e,message:ge.toString(n)}})}max(e,n){return new La({...this._def,maxSize:{value:e,message:ge.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}La.create=(t,e)=>new La({valueType:t,minSize:null,maxSize:null,typeName:Te.ZodSet,...Pe(e)});class Zl extends Fe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ce.function)return oe(n,{code:q.invalid_type,expected:ce.function,received:n.parsedType}),ke;function r(a,l){return Lf({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Pf(),ql].filter(c=>!!c),issueData:{code:q.invalid_arguments,argumentsError:l}})}function i(a,l){return Lf({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Pf(),ql].filter(c=>!!c),issueData:{code:q.invalid_return_type,returnTypeError:l}})}const s={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof Jl){const a=this;return or(async function(...l){const c=new Rr([]),u=await a._def.args.parseAsync(l,s).catch(f=>{throw c.addIssue(r(l,f)),c}),d=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(d,s).catch(f=>{throw c.addIssue(i(d,f)),c})})}else{const a=this;return or(function(...l){const c=a._def.args.safeParse(l,s);if(!c.success)throw new Rr([r(l,c.error)]);const u=Reflect.apply(o,this,c.data),d=a._def.returns.safeParse(u,s);if(!d.success)throw new Rr([i(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Zl({...this._def,args:Gi.create(e).rest(Pa.create())})}returns(e){return new Zl({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new Zl({args:e||Gi.create([]).rest(Pa.create()),returns:n||Pa.create(),typeName:Te.ZodFunction,...Pe(r)})}}class Wu extends Fe{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Wu.create=(t,e)=>new Wu({getter:t,typeName:Te.ZodLazy,...Pe(e)});class ju extends Fe{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return oe(n,{received:n.data,code:q.invalid_literal,expected:this._def.value}),ke}return{status:"valid",value:e.data}}get value(){return this._def.value}}ju.create=(t,e)=>new ju({value:t,typeName:Te.ZodLiteral,...Pe(e)});function uk(t,e){return new vo({values:t,typeName:Te.ZodEnum,...Pe(e)})}class vo extends Fe{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return oe(n,{expected:Ze.joinValues(r),received:n.parsedType,code:q.invalid_type}),ke}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return oe(n,{received:n.data,code:q.invalid_enum_value,options:r}),ke}return or(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return vo.create(e,{...this._def,...n})}exclude(e,n=this._def){return vo.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}vo.create=uk;class Yu extends Fe{_parse(e){const n=Ze.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ce.string&&r.parsedType!==ce.number){const i=Ze.objectValues(n);return oe(r,{expected:Ze.joinValues(i),received:r.parsedType,code:q.invalid_type}),ke}if(this._cache||(this._cache=new Set(Ze.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=Ze.objectValues(n);return oe(r,{received:r.data,code:q.invalid_enum_value,options:i}),ke}return or(e.data)}get enum(){return this._def.values}}Yu.create=(t,e)=>new Yu({values:t,typeName:Te.ZodNativeEnum,...Pe(e)});class Jl extends Fe{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ce.promise&&n.common.async===!1)return oe(n,{code:q.invalid_type,expected:ce.promise,received:n.parsedType}),ke;const r=n.parsedType===ce.promise?n.data:Promise.resolve(n.data);return or(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Jl.create=(t,e)=>new Jl({type:t,typeName:Te.ZodPromise,...Pe(e)});class pi extends Fe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Te.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=this._def.effect||null,s={addIssue:o=>{oe(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const o=i.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(n.value==="aborted")return ke;const l=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return l.status==="aborted"?ke:l.status==="dirty"||n.value==="dirty"?Xl(l.value):l});{if(n.value==="aborted")return ke;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?ke:a.status==="dirty"||n.value==="dirty"?Xl(a.value):a}}if(i.type==="refinement"){const o=a=>{const l=i.refinement(a,s);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ke:(a.status==="dirty"&&n.dirty(),o(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?ke:(a.status==="dirty"&&n.dirty(),o(a.value).then(()=>({status:n.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Na(o))return ke;const a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>Na(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:n.value,value:a})):ke);Ze.assertNever(i)}}pi.create=(t,e,n)=>new pi({schema:t,typeName:Te.ZodEffects,effect:e,...Pe(n)}),pi.createWithPreprocess=(t,e,n)=>new pi({schema:e,effect:{type:"preprocess",transform:t},typeName:Te.ZodEffects,...Pe(n)});class Vi extends Fe{_parse(e){return this._getType(e)===ce.undefined?or(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Vi.create=(t,e)=>new Vi({innerType:t,typeName:Te.ZodOptional,...Pe(e)});class wo extends Fe{_parse(e){return this._getType(e)===ce.null?or(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}wo.create=(t,e)=>new wo({innerType:t,typeName:Te.ZodNullable,...Pe(e)});class Gu extends Fe{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===ce.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Gu.create=(t,e)=>new Gu({innerType:t,typeName:Te.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Pe(e)});class Vu extends Fe{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ru(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Rr(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Rr(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Vu.create=(t,e)=>new Vu({innerType:t,typeName:Te.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Pe(e)});class $f extends Fe{_parse(e){if(this._getType(e)!==ce.nan){const r=this._getOrReturnCtx(e);return oe(r,{code:q.invalid_type,expected:ce.nan,received:r.parsedType}),ke}return{status:"valid",value:e.data}}}$f.create=t=>new $f({typeName:Te.ZodNaN,...Pe(t)});const aR=Symbol("zod_brand");class r0 extends Fe{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class qu extends Fe{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ke:s.status==="dirty"?(n.dirty(),Xl(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ke:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,n){return new qu({in:e,out:n,typeName:Te.ZodPipeline})}}class Xu extends Fe{_parse(e){const n=this._def.innerType._parse(e),r=i=>(Na(i)&&(i.value=Object.freeze(i.value)),i);return Ru(n)?n.then(i=>r(i)):r(n)}unwrap(){return this._def.innerType}}Xu.create=(t,e)=>new Xu({innerType:t,typeName:Te.ZodReadonly,...Pe(e)});function dk(t,e){const n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function Ra(t,e={},n){return t?Kl.create().superRefine((r,i)=>{const s=t(r);if(s instanceof Promise)return s.then(o=>{if(!o){const a=dk(e,r),l=a.fatal??n??!0;i.addIssue({code:"custom",...a,fatal:l})}});if(!s){const o=dk(e,r),a=o.fatal??n??!0;i.addIssue({code:"custom",...o,fatal:a})}}):Kl.create()}const lR={object:Pt.lazycreate};var Te;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Te||(Te={}));const cR=(t,e={message:`Input not instance of ${t.name}`})=>Ra(n=>n instanceof t,e),pe=hi.create,dn=xo.create,uR=$f.create,dR=Eo.create,Ba=Bu.create,hR=Oa.create,fR=Rf.create,pR=Fu.create,mR=Uu.create,hk=Kl.create,i0=Pa.create,fk=Ls.create,gR=Bf.create,ec=fi.create,$e=Pt.create,bR=Pt.strictCreate,ko=$u.create,yR=Ff.create,tc=Hu.create,s0=Gi.create,o0=zu.create,_R=Uf.create,xR=La.create,Hf=Zl.create,a0=Wu.create,_r=ju.create,zf=vo.create,qr=Yu.create,ER=Jl.create,pk=pi.create,mk=Vi.create,vR=wo.create,wR=pi.createWithPreprocess,kR=qu.create,le=Object.freeze(Object.defineProperty({__proto__:null,BRAND:aR,DIRTY:Xl,EMPTY_PATH:U5,INVALID:ke,NEVER:ke,OK:or,ParseStatus:Gn,Schema:Fe,ZodAny:Kl,ZodArray:fi,ZodBigInt:Eo,ZodBoolean:Bu,ZodBranded:r0,ZodCatch:Vu,ZodDate:Oa,ZodDefault:Gu,ZodDiscriminatedUnion:Ff,ZodEffects:pi,ZodEnum:vo,ZodError:Rr,get ZodFirstPartyTypeKind(){return Te},ZodFunction:Zl,ZodIntersection:Hu,ZodIssueCode:q,ZodLazy:Wu,ZodLiteral:ju,ZodMap:Uf,ZodNaN:$f,ZodNativeEnum:Yu,ZodNever:Ls,ZodNull:Uu,ZodNullable:wo,ZodNumber:xo,ZodObject:Pt,ZodOptional:Vi,ZodParsedType:ce,ZodPipeline:qu,ZodPromise:Jl,ZodReadonly:Xu,ZodRecord:zu,ZodSchema:Fe,ZodSet:La,ZodString:hi,ZodSymbol:Rf,ZodTransformer:pi,ZodTuple:Gi,ZodType:Fe,ZodUndefined:Fu,ZodUnion:$u,ZodUnknown:Pa,ZodVoid:Bf,addIssueToContext:oe,any:hk,array:ec,bigint:dR,boolean:Ba,coerce:{string:t=>hi.create({...t,coerce:!0}),number:t=>xo.create({...t,coerce:!0}),boolean:t=>Bu.create({...t,coerce:!0}),bigint:t=>Eo.create({...t,coerce:!0}),date:t=>Oa.create({...t,coerce:!0})},custom:Ra,date:hR,datetimeRegex:ck,defaultErrorMap:ql,discriminatedUnion:yR,effect:pk,enum:zf,function:Hf,getErrorMap:Pf,getParsedType:Ps,instanceof:cR,intersection:tc,isAborted:Jg,isAsync:Ru,isDirty:e0,isValid:Na,late:lR,lazy:a0,literal:_r,makeIssue:Lf,map:_R,nan:uR,nativeEnum:qr,never:fk,null:mR,nullable:vR,number:dn,object:$e,get objectUtil(){return Zg},oboolean:()=>Ba().optional(),onumber:()=>dn().optional(),optional:mk,ostring:()=>pe().optional(),pipeline:kR,preprocess:wR,promise:ER,quotelessJson:B5,record:o0,set:xR,setErrorMap:F5,strictObject:bR,string:pe,symbol:fR,transformer:pk,tuple:s0,undefined:pR,union:ko,unknown:i0,get util(){return Ze},void:gR},Symbol.toStringTag,{value:"Module"}));class Qt{get deltas$(){return this._deltas$}get length(){return this._length$.value}get yText(){return this._yText}constructor(e){let n=0;if(typeof e=="string"){const r=e.replaceAll(`\r
`,`
`);n=r.length,this._yText=new gt(r)}else if(e instanceof gt)this._yText=e,e.doc&&(n=e.length);else if(e instanceof Array){for(const i of e)i.insert&&(i.insert=i.insert.replaceAll(`\r
`,`
`),n+=i.insert.length);const r=new gt;r.applyDelta(e),this._yText=r}else this._yText=new gt;this._length$=un(n),this._deltas$=un(this._yText.doc?this._yText.toDelta():[]),this._yText.observe(r=>{var i;const s=!r.transaction.origin||!this._yText.doc||r.transaction.origin instanceof Sa||r.transaction.origin.proxy?!0:r.transaction.origin===this._yText.doc.clientID;this._length$.value=this._yText.length,this._deltas$.value=this._yText.toDelta(),(i=this._onChange)==null||i.call(this,this._yText,s)})}_transact(e){const n=this._yText.doc;if(!n)throw new V(re.ReactiveProxyError,"Failed to transact text! yText is not attached to a doc");n.transact(()=>{e()},n.clientID)}applyDelta(e){this._transact(()=>{var n;(n=this._yText)==null||n.applyDelta(e)})}bind(e){this._onChange=e}clear(){this._yText.length&&this._transact(()=>{this._yText.delete(0,this._yText.length)})}clone(){const e=new Qt(this._yText.clone());return e.bind(this._onChange),e}delete(e,n){if(n!==0){if(e<0||n<0||e+n>this._yText.length)throw new V(re.ReactiveProxyError,"Failed to delete text! Index or length out of range, index: "+e+", length: "+n+", text length: "+this._yText.length);this._transact(()=>{this._yText.delete(e,n)})}}format(e,n,r){if(n!==0){if(e<0||n<0||e+n>this._yText.length)throw new V(re.ReactiveProxyError,"Failed to format text! Index or length out of range, index: "+e+", length: "+n+", text length: "+this._yText.length);this._transact(()=>{this._yText.format(e,n,r)})}}insert(e,n,r){if(e.length){if(n<0||n>this._yText.length)throw new V(re.ReactiveProxyError,"Failed to insert text! Index or length out of range, index: "+n+", length: "+e.length+", text length: "+this._yText.length);this._transact(()=>{this._yText.insert(n,e,r)})}}join(e){!e||!e.toDelta().length||this._transact(()=>{const r=e._yText.toDelta();r.unshift({retain:this._yText.length}),this._yText.applyDelta(r)})}replace(e,n,r,i){if(e<0||n<0||e+n>this._yText.length)throw new V(re.ReactiveProxyError,"Failed to replace text! The length of the text is"+this._yText.length+", but you are trying to replace from"+e+"to"+e+n);this._transact(()=>{this._yText.delete(e,n),this._yText.insert(e,r,i)})}sliceToDelta(e,n){const r=[];if(n&&e>=n)return r;if(e===0&&n===0)return[];const i=this.toDelta();if(e<1&&!n)return i;if(i&&i instanceof Array){let s=0;for(let o=0;o<i.length;o++){const a=i[o];let l=a.insert||"";const c=l.length,u=n&&s+c>n,d=s+c>e&&r.length===0;if(d&&u){l=l.slice(e-s,n-s),r.push({...a,insert:l});break}else d||u?(l=u?l.slice(0,n-s):l.slice(e-s),r.push({...a,insert:l})):r.length>0&&r.push(a);if(n&&s+c>n)break;s=s+c}}return r}split(e,n=0){if(e<0||n<0||e+n>this._yText.length)throw new V(re.ReactiveProxyError,"Failed to split text! Index or length out of range, index: "+e+", length: "+n+", text length: "+this._yText.length);const r=this._yText.toDelta();if(!(r instanceof Array))throw new V(re.ReactiveProxyError,"This text cannot be split because we failed to get the deltas of it.");let i=0;const s=[];for(let l=0;l<r.length;l++){const c=r[l].insert;if(typeof c=="string"){if(i+c.length>=e+n){const u=c.slice(e+n-i);s.push({insert:u,attributes:r[l].attributes}),s.push(...r.slice(l+1));break}i+=c.length}else throw new V(re.ReactiveProxyError,"This text cannot be split because it contains non-string insert.")}this.delete(e,this.length-e);const o=new gt;o.applyDelta(s);const a=new Qt(o);return a.bind(this._onChange),a}toDelta(){var e;return((e=this._yText)==null?void 0:e.toDelta())||[]}toString(){var e;return((e=this._yText)==null?void 0:e.toString())||""}}function Xr(t,{deep:e=!0,transform:n=r=>r}={}){if(t instanceof Vr)return n(t.yMap,t);if(t instanceof Qt)return t.yText.doc?n(t.yText.clone(),t):n(t.yText,t);if(Array.isArray(t)){const r=new sr,i=t.map(s=>e?Xr(s,{deep:e,transform:n}):s);return r.insert(0,i),n(r,t)}if(Da(t)){const r=new at;return Object.entries(t).forEach(([i,s])=>{r.set(i,e?Xr(s,{deep:e,transform:n}):s)}),n(r,t)}return n(t,t)}function Fa(t,{deep:e=!0,transform:n=r=>r}={}){if(Vr.is(t)){const r=new Vr(t);return n(r,t)}if(t instanceof gt){const r=new Qt(t);return n(r,t)}if(t instanceof sr){const r=t.toArray().map(i=>e?Fa(i,{deep:e,transform:n}):i);return n(r,t)}if(t instanceof at){const r=Object.fromEntries(Array.from(t.entries()).map(([i,s])=>[i,e?Fa(s,{deep:e,transform:n}):s]));return n(r,t)}return n(t,t)}class gk extends Kg{constructor(e,n,r){super(),this._source=e,this._ySource=n,this._options=r,this._observer=i=>{this._onObserve(i,()=>{let s=0;i.changes.delta.forEach(o=>{if(o.retain){s+=o.retain;return}if(o.delete){this._updateWithSkip(()=>{this._source.splice(s,o.delete)});return}if(o.insert){const l=[o.insert].flat().map(c=>To(c));this._updateWithSkip(()=>{this._source.splice(s,0,...l)}),s+=o.insert.length}})})},this._getProxy=()=>new Proxy(this._source,{has:(i,s)=>Reflect.has(i,s),set:(i,s,o,a)=>{var l,c;if(typeof s!="string")throw new V(re.ReactiveProxyError,"key cannot be a symbol");const u=Number(s);if(this._skipNext||Number.isNaN(u))return Reflect.set(i,s,o,a);if(this._stashed.has(u)){const g=Reflect.set(i,s,o,a);return(c=(l=this._options).onChange)==null||c.call(l,this._proxy,!0),g}if(!ji.get(this._ySource))throw new V(re.ReactiveProxyError,"YData is not subscribed before changes");const h=this._ySource.doc;if(!h)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");const f=Xr(o);this._transact(h,()=>{u<this._ySource.length&&this._ySource.delete(u,1),this._ySource.insert(u,[f])});const p=To(f,this._options);return Reflect.set(i,s,p,a)},get:(i,s,o)=>s==="splice"?(a,l,...c)=>{const u=this._ySource.doc;if(!u)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");const d=l??i.length-a,h=c.map(p=>Xr(p));return this._transact(u,()=>{this._ySource.delete(a,d),this._ySource.insert(a,h)}),Array.prototype.splice.apply(i,[a,d,...h.map(p=>To(p,this._options))])}:s==="shift"?()=>{const a=this._ySource.doc;if(!a)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");if(i.length===0)return;const l=Array.prototype.shift.call(i);return this._transact(a,()=>{this._ySource.delete(0,1)}),l}:s==="unshift"?(...a)=>{const l=this._ySource.doc;if(!l)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");const c=a.map(u=>Xr(u));return this._transact(l,()=>{this._ySource.insert(0,c)}),Array.prototype.unshift.apply(i,c.map(u=>To(u,this._options)))}:Reflect.get(i,s,o),deleteProperty:(i,s)=>{if(typeof s!="string")throw new V(re.ReactiveProxyError,"key cannot be a symbol");if(!ji.get(this._ySource))throw new V(re.ReactiveProxyError,"YData is not subscribed before changes");const a=this._ySource.doc;if(!a)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");const l=Number(s);return this._skipNext||Number.isNaN(l)||this._transact(a,()=>{this._ySource.delete(l,1)}),Reflect.deleteProperty(i,s)}}),this._proxy=this._getProxy(),ji.set(n,this),n.observe(this._observer)}pop(e){const n=this._source[e];this._stashed.delete(e),this._proxy[e]=n}stash(e){this._stashed.add(e)}}class TR extends Kg{constructor(e,n,r){super(),this._source=e,this._ySource=n,this._options=r,this._observer=i=>{this._onObserve(i,()=>{i.keysChanged.forEach(s=>{const o=i.changes.keys.get(s);if(o){if(o.action==="delete")this._updateWithSkip(()=>{delete this._source[s]});else if(o.action==="add"||o.action==="update"){const a=this._ySource.get(s);this._updateWithSkip(()=>{this._source[s]=ji.has(a)?ji.get(a):To(a,this._options)})}}})})},this._getProxy=()=>new Proxy(this._source,{has:(i,s)=>Reflect.has(i,s),set:(i,s,o,a)=>{var l,c;if(typeof s!="string")throw new V(re.ReactiveProxyError,"key cannot be a symbol");if(this._skipNext)return Reflect.set(i,s,o,a);if(this._stashed.has(s)){const p=Reflect.set(i,s,o,a);return(c=(l=this._options).onChange)==null||c.call(l,this._proxy,!0),p}if(!ji.get(this._ySource))throw new V(re.ReactiveProxyError,"YData is not subscribed before changes");const d=this._ySource.doc;if(!d)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");const h=Xr(o);this._transact(d,()=>{this._ySource.set(s,h)});const f=To(h,this._options);return Reflect.set(i,s,f,a)},get:(i,s,o)=>Reflect.get(i,s,o),deleteProperty:(i,s)=>{if(typeof s!="string")throw new V(re.ReactiveProxyError,"key cannot be a symbol");if(this._skipNext)return Reflect.deleteProperty(i,s);if(!ji.get(this._ySource))throw new V(re.ReactiveProxyError,"YData is not subscribed before changes");const a=this._ySource.doc;if(!a)throw new V(re.ReactiveProxyError,"YData is not bound to a Y.Doc");return this._transact(a,()=>{this._ySource.delete(s)}),Reflect.deleteProperty(i,s)}}),this._proxy=this._getProxy(),ji.set(n,this),n.observe(this._observer)}pop(e){const n=this._source[e];this._stashed.delete(e),this._proxy[e]=n}stash(e){this._stashed.add(e)}}function To(t,e={}){return ji.has(t)?ji.get(t).proxy:Fa(t,{transform:(r,i)=>r instanceof Qt||Vr.is(i)?(r.bind(e.onChange),r):i instanceof sr?new gk(r,i,e).proxy:i instanceof at?new TR(r,i,e).proxy:r})}const Ku=t=>t.replace(/(prop|sys):/,""),l0=t=>ik.has(t)?`sys:${t}`:`prop:${t}`,bk=Symbol("proxy");function yk(t){return bk in Object.getPrototypeOf(t)}function SR(t){return Object.setPrototypeOf(t,{[bk]:!0}),t}function _k(t){return Object.keys(t).length===0}function CR(t,e,n){_k(t)&&delete n[e]}function Ua(t){const e=t.split(".").at(0);if(!e)throw new Error(`Invalid key for: ${t}`);return e}function xk(t,e){(t instanceof Qt||Vr.is(t))&&t.bind(e)}const AR=({getProxy:t,transform:e,yMap:n})=>{const r={};return Array.from(n.entries()).forEach(([i,s])=>{if(i.startsWith("sys"))return;const o=Ku(i).split("."),a=o[0];let l=s;if(Vr.is(s))l=e(a,new Vr(s),s);else if(s instanceof sr)l=e(a,s.toArray(),s);else if(s instanceof gt){const u=new Qt(s);l=e(a,u,s)}else{if(s instanceof at)throw new V(V.ErrorCode.ReactiveProxyError,"flatY2Native does not support Y.Map as value of Y.Map");l=e(a,s,s)}const c=o.length;o.reduce((u,d,h)=>{if(!u[d]&&h!==c-1){const f=o.slice(0,h+1).join("."),p=t({},r,f);u[d]=p}return h===c-1&&(u[d]=l),u[d]},r)}),r};function IR({root:t,firstKey:e,shouldByPassSignal:n,byPassSignalUpdate:r,onChange:i,basePath:s,value:o,handleNestedUpdate:a,shouldByPassYjs:l}){const c=!s;if(n())return;const u=`${e}$`;if(!(u in t)){if(!c)return;a(u);return}r(()=>{const d=t[e],h=c?o:Da(d)?{...d}:Array.isArray(d)?[...d]:d;t[u].value=h,l()||i==null||i(e,!0)})}function MR({shouldByPassYjs:t,yMap:e,initialized:n,onChange:r,fullPath:i,value:s}){var o;const a=Ua(i);if(t())return;const l=[];e.forEach((u,d)=>{n()&&Ku(d).startsWith(i)&&e.delete(d)});const c=(u,d)=>{Object.entries(u).forEach(([h,f])=>{const p=d?`${d}.${h}`:h;Da(f)?c(f,p):l.push(()=>{xk(f,()=>{r==null||r(a,!0)}),e.set(l0(p),Xr(f))})})};c(s,i),l.length&&n()&&((o=e.doc)==null||o.transact(()=>{l.forEach(u=>u())},{proxy:!0}))}function c0(t){const{base:e}=t;if(yk(e))return e;DR(t);const n=NR(t),r=new Proxy(e,n);return SR(r),r}function DR(t){const{basePath:e,yMap:n,base:r,root:i}=t;Object.entries(r).forEach(([s,o])=>{if(Da(o)&&!yk(o)){const a=c0({...t,yMap:n,base:o,root:i,basePath:e?`${e}.${s}`:s});r[s]=a}})}function u0(t,e,n,r){const{root:i,shouldByPassSignal:s,byPassSignalUpdate:o,onChange:a,basePath:l,initialized:c,onDispose:u,shouldByPassYjs:d}=r,h=l?`${l}.${e}`:e,f=Ua(h);IR({root:i,firstKey:f,shouldByPassSignal:s,shouldByPassYjs:d,byPassSignalUpdate:o,onChange:a,basePath:l,value:t,handleNestedUpdate:p=>{if(t===void 0){delete i[p];return}const g=un(t);i[p]=g;const b=g.subscribe(y=>{c()&&o(()=>{n[e]=y,a==null||a(f,!0)})}),_=u.subscribe(()=>{_.unsubscribe(),b()})}})}function NR(t){const{yMap:e,shouldByPassYjs:n,basePath:r,onChange:i,initialized:s,transform:o,stashed:a}=t;return{has:(l,c)=>Reflect.has(l,c),get:(l,c,u)=>Reflect.get(l,c,u),set:(l,c,u,d)=>{var h;if(typeof c=="string"){const f=r?`${r}.${c}`:c,p=Ua(f),g=a.has(p);if(Da(u)){g||MR({shouldByPassYjs:n,yMap:e,initialized:s,onChange:i,fullPath:f,value:u});const E=c0({...t,basePath:f,base:u}),I=Reflect.set(l,c,E,d);return u0(E,c,d,t),I}xk(u,()=>{i==null||i(p,!0)});const b=Xr(u),_=o(p,u,b);!g&&s()&&!n()&&((h=e.doc)==null||h.transact(()=>{e.set(l0(f),b)},{proxy:!0}));const y=Reflect.set(l,c,_,d);return u0(_,c,d,t),y}return Reflect.set(l,c,u,d)},deleteProperty:(l,c)=>{var u;if(typeof c=="string"){const d=r?`${r}.${c}`:c,h=Ua(d);!a.has(h)&&s()&&!n()&&((u=e.doc)==null||u.transact(()=>{const g=l0(d);e.forEach((b,_)=>{_.startsWith(g)&&e.delete(_)})},{proxy:!0}));const p=Reflect.deleteProperty(l,c);return u0(void 0,c,void 0,t),p}return Reflect.deleteProperty(l,c)}}}const OR=t=>{const{event:e}=t,{keysChanged:n,changes:r}=e;n.forEach(i=>{const s=r.keys.get(i);if(s){if(s.action==="update"||s.action==="add")return PR(i,t);if(s.action==="delete")return LR(i,t)}})};function Ek(t,e){const n=Ku(t),r=Ua(n);return e.has(r)}function PR(t,{yMap:e,proxy:n,stashed:r,updateWithYjsSkip:i,transform:s,onChange:o}){if(Ek(t,r))return;const a=Ku(t),l=Ua(a);i(()=>{const c=e.get(t);a.split(".").reduce((d,h,f,p)=>(!d[h]&&f!==p.length-1&&(d[h]={}),f===p.length-1&&(d[h]=Fa(c,{transform:(g,b)=>s(l,g,b)})),d[h]),n)}),o==null||o(l,!1)}function LR(t,{proxy:e,stashed:n,updateWithYjsSkip:r,onChange:i}){if(Ek(t,n))return;const s=Ku(t),o=Ua(s);r(()=>{const a=s.split(".");a.reduce((l,c,u)=>{if(u===a.length-1){delete l[c];let d=l,h=a[u-1],f=e,p=a.slice(0,-2);for(let g=a.length-2;g>0;g--){for(const b of p)f=f[b];if(!_k(d))break;CR(d,h,f),d=f,h=a[g-1],p=p.slice(0,-1),f=e}}return l[c]},e)}),i==null||i(o,!1)}class RR extends Kg{constructor(e,n,r){super(),this._ySource=e,this._onDispose=n,this._onChange=r,this._observer=o=>{const a=this._ySource,l=this._proxy;this._onObserve(o,()=>{OR({yMap:a,proxy:l,stashed:this._stashed,updateWithYjsSkip:this._updateWithYjsSkip,transform:this._transform,onChange:this._onChange,event:o})})},this._transform=(o,a,l)=>{const c=this._getPropOnChange(o);return a instanceof Qt||Vr.is(l)?(a.bind(c),a):l instanceof sr?new gk(a,l,{onChange:c}).proxy:a},this._getPropOnChange=o=>(a,l)=>{var c;(c=this._onChange)==null||c.call(this,o,l)},this._byPassYjs=!1,this._getProxy=(o,a,l)=>c0({yMap:this._ySource,base:o,root:a,onDispose:this._onDispose,shouldByPassSignal:()=>this._skipNext,byPassSignalUpdate:this._updateWithSkip,shouldByPassYjs:()=>this._byPassYjs,basePath:l,onChange:this._onChange,transform:this._transform,stashed:this._stashed,initialized:()=>this._initialized}),this._updateWithYjsSkip=o=>{this._byPassYjs=!0,o(),this._byPassYjs=!1},this.pop=o=>{const a=this._source[o];this._stashed.delete(o),this._proxy[o]=a},this.stash=o=>{this._stashed.add(o)},this._initialized=!1;const i=AR({getProxy:this._getProxy,transform:this._transform,yMap:this._ySource});this._source=i;const s=this._getProxy(i,i);Object.entries(i).forEach(([o,a])=>{const l=un(a);i[`${o}$`]=l;const c=l.subscribe(d=>{this._initialized&&this._updateWithSkip(()=>{var h;s[o]=d,(h=this._onChange)==null||h.call(this,o,!0)})}),u=n.subscribe(()=>{u.unsubscribe(),c()})}),this._proxy=s,this._ySource.observe(this._observer),this._initialized=!0}}var d0=function(t,e){return d0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},d0(t,e)};function Bs(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");d0(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function BR(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}function vk(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function nc(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function jf(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function rc(t){return this instanceof rc?(this.v=t,this):new rc(t)}function FR(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(f){return function(p){return Promise.resolve(p).then(f,d)}}function a(f,p){r[f]&&(i[f]=function(g){return new Promise(function(b,_){s.push([f,g,b,_])>1||l(f,g)})},p&&(i[f]=p(i[f])))}function l(f,p){try{c(r[f](p))}catch(g){h(s[0][3],g)}}function c(f){f.value instanceof rc?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function h(f,p){f(p),s.shift(),s.length&&l(s[0][0],s[0][1])}}function UR(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof nc=="function"?nc(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}typeof SuppressedError=="function"&&SuppressedError;function Sn(t){return typeof t=="function"}function wk(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var h0=wk(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Yf(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ic=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=nc(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Sn(u))try{u()}catch(g){s=g instanceof h0?g.errors:[g]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=nc(d),f=h.next();!f.done;f=h.next()){var p=f.value;try{Sk(p)}catch(g){s=s??[],g instanceof h0?s=jf(jf([],Wf(s)),Wf(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}if(s)throw new h0(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Sk(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Yf(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Yf(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),kk=ic.EMPTY;function Tk(t){return t instanceof ic||t&&"closed"in t&&Sn(t.remove)&&Sn(t.add)&&Sn(t.unsubscribe)}function Sk(t){Sn(t)?t():t.unsubscribe()}var $R={Promise:void 0},HR={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,jf([t,e],Wf(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Ck(t){HR.setTimeout(function(){throw t})}function Ak(){}function Gf(t){t()}var f0=function(t){Bs(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Tk(n)&&n.add(r)):r.destination=jR,r}return e.create=function(n,r,i){return new p0(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ic),zR=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Vf(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Vf(r)}else Vf(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Vf(n)}},t}(),p0=function(t){Bs(e,t);function e(n,r,i){var s=t.call(this)||this,o;return Sn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new zR(o),s}return e}(f0);function Vf(t){Ck(t)}function WR(t){throw t}var jR={closed:!0,next:Ak,error:WR,complete:Ak},m0=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function YR(t){return t}function GR(t){return t.length===0?YR:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var mi=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=qR(e)?e:new p0(e,n,r);return Gf(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Ik(n),new n(function(i,s){var o=new p0({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[m0]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return GR(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Ik(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function Ik(t){var e;return(e=t??$R.Promise)!==null&&e!==void 0?e:Promise}function VR(t){return t&&Sn(t.next)&&Sn(t.error)&&Sn(t.complete)}function qR(t){return t&&t instanceof f0||VR(t)&&Tk(t)}function XR(t){return Sn(t==null?void 0:t.lift)}function $a(t){return function(e){if(XR(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fs(t,e,n,r,i){return new Mk(t,e,n,r,i)}var Mk=function(t){Bs(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(f0),KR=wk(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ie=function(t){Bs(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Dk(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new KR},e.prototype.next=function(n){var r=this;Gf(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=nc(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Gf(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Gf(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?kk:(this.currentObservers=null,a.push(n),new ic(function(){r.currentObservers=null,Yf(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new mi;return n.source=this,n},e.create=function(n,r){return new Dk(n,r)},e}(mi),Dk=function(t){Bs(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:kk},e}(Ie),Nk=function(t){Bs(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Ie),QR={now:function(){return Date.now()}},ZR=function(t){Bs(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(ic),Ok={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,jf([t,e],Wf(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},JR=function(t){Bs(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Ok.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Ok.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Yf(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(ZR),Pk=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=QR.now,t}(),eB=function(t){Bs(e,t);function e(n,r){r===void 0&&(r=Pk.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(Pk),g0=new eB(JR),tB=g0,nB=new mi(function(t){return t.complete()});function rB(t){return t&&Sn(t.schedule)}var iB=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function sB(t){return Sn(t==null?void 0:t.then)}function oB(t){return Sn(t[m0])}function aB(t){return Symbol.asyncIterator&&Sn(t==null?void 0:t[Symbol.asyncIterator])}function lB(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function cB(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var uB=cB();function dB(t){return Sn(t==null?void 0:t[uB])}function hB(t){return FR(this,arguments,function(){var n,r,i,s;return vk(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,rc(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,rc(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,rc(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function fB(t){return Sn(t==null?void 0:t.getReader)}function qf(t){if(t instanceof mi)return t;if(t!=null){if(oB(t))return pB(t);if(iB(t))return mB(t);if(sB(t))return gB(t);if(aB(t))return Lk(t);if(dB(t))return bB(t);if(fB(t))return yB(t)}throw lB(t)}function pB(t){return new mi(function(e){var n=t[m0]();if(Sn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function mB(t){return new mi(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function gB(t){return new mi(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Ck)})}function bB(t){return new mi(function(e){var n,r;try{for(var i=nc(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Lk(t){return new mi(function(e){_B(t,e).catch(function(n){return e.error(n)})})}function yB(t){return Lk(hB(t))}function _B(t,e){var n,r,i,s;return BR(this,void 0,void 0,function(){var o,a;return vk(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=UR(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Pge(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function xB(t){return t instanceof Date&&!isNaN(t)}function EB(t,e){return $a(function(n,r){var i=0;n.subscribe(Fs(r,function(s){r.next(t.call(e,s,i++))}))})}function vB(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,d=!1,h=function(){d&&!l.length&&!c&&e.complete()},f=function(g){return c<r?p(g):l.push(g)},p=function(g){c++;var b=!1;qf(n(g,u++)).subscribe(Fs(e,function(_){e.next(_)},function(){b=!0},void 0,function(){if(b)try{c--;for(var _=function(){var y=l.shift();o||p(y)};l.length&&c<r;)_();h()}catch(y){e.error(y)}}))};return t.subscribe(Fs(e,f,function(){d=!0,h()})),function(){}}function Rk(t,e,n){return n===void 0&&(n=1/0),Sn(e)?Rk(function(r,i){return EB(function(s,o){return e(r,s,i,o)})(qf(t(r,i)))},n):(typeof e=="number"&&(n=e),$a(function(r,i){return vB(r,i,t,n)}))}function wB(t,e,n){n===void 0&&(n=tB);var r=-1;return e!=null&&(rB(e)?n=e:r=e),new mi(function(i){var s=xB(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function kB(t,e){return $a(function(n,r){var i=0;n.subscribe(Fs(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function TB(t,e){return e===void 0&&(e=g0),$a(function(n,r){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var c=s;s=null,r.next(c)}};function l(){var c=o+t,u=e.now();if(u<c){i=this.schedule(void 0,c-u),r.add(i);return}a()}n.subscribe(Fs(r,function(c){s=c,o=e.now(),i||(i=e.schedule(l,t),r.add(i))},function(){a(),r.complete()},void 0,function(){s=i=null}))})}function Bk(t){return t<=0?function(){return nB}:$a(function(e,n){var r=0;e.subscribe(Fs(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function SB(t,e,n,r){return $a(function(i,s){var o;(!e||typeof e=="function")&&(o=e);var a=new Map,l=function(p){a.forEach(p),p(s)},c=function(p){return l(function(g){return g.error(p)})},u=0,d=!1,h=new Mk(s,function(p){try{var g=t(p),b=a.get(g);if(!b){a.set(g,b=r?r():new Ie);var _=f(g,b);if(s.next(_),n){var y=Fs(b,function(){b.complete(),y==null||y.unsubscribe()},void 0,void 0,function(){return a.delete(g)});h.add(qf(n(_)).subscribe(y))}}b.next(o?o(p):p)}catch(x){c(x)}},function(){return l(function(p){return p.complete()})},c,function(){return a.clear()},function(){return d=!0,u===0});i.subscribe(h);function f(p,g){var b=new mi(function(_){u++;var y=g.subscribe(_);return function(){y.unsubscribe(),--u===0&&d&&h.unsubscribe()}});return b.key=p,b}})}function CB(t,e){return $a(function(n,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,l=a===void 0?!1:a,c=!1,u=null,d=null,h=!1,f=function(){d==null||d.unsubscribe(),d=null,l&&(b(),h&&r.complete())},p=function(){d=null,h&&r.complete()},g=function(_){return d=qf(t(_)).subscribe(Fs(r,f,p))},b=function(){if(c){c=!1;var _=u;u=null,r.next(_),!h&&g(_)}};n.subscribe(Fs(r,function(_){c=!0,u=_,!(d&&!d.closed)&&(o?b():g(_))},function(){h=!0,!(l&&c&&d&&!d.closed)&&r.complete()}))})}function AB(t,e,n){e===void 0&&(e=g0);var r=wB(t,e);return CB(function(){return r},n)}var Fk;const IB=Symbol("model_label");class Qe{constructor(){this._children=un([]),this._childModels=Os(()=>{const e=[];return this._children.value.forEach(n=>{const r=this._store.getBlock$(n);r&&e.push(r.model)}),e}),this.childMap=Os(()=>this._children.value.reduce((e,n,r)=>(e.set(n,r),e),new Map)),this.created=new Ie,this.deleted=new Ie,this[Fk]="type_info_label",this.propsUpdated=new Ie,this._onCreated={dispose:this.created.pipe(Bk(1)).subscribe(()=>{this._children.value=this.yBlock.get("sys:children").toArray(),this.yBlock.get("sys:children").observe(e=>{this._children.value=e.target.toArray()}),this.yBlock.observe(e=>{e.keysChanged.has("sys:children")&&(this._children.value=this.yBlock.get("sys:children").toArray())})}).unsubscribe},this._onDeleted={dispose:this.deleted.pipe(Bk(1)).subscribe(()=>{this._onCreated.dispose()}).unsubscribe}}isEmpty(){return this.children.length===0}get text(){return this.props.text}set text(e){this.keys.includes("text")&&(this.props.text=e)}get props(){if(!this._props)throw new Error("props is only supported in flat data model");return this._props}get flavour(){return this.schema.model.flavour}get version(){return this.schema.version}get children(){return this._childModels.value}get store(){return this._store}set store(e){this._store=e}get parent(){return this.store.getParent(this)}get role(){return this.schema.model.role}dispose(){this.created.complete(),this.deleted.complete(),this.propsUpdated.complete()}firstChild(){return this.children[0]||null}lastChild(){return this.children.length?this.children[this.children.length-1].lastChild():this}[(Fk=IB,Symbol.dispose)](){this._onCreated.dispose(),this._onDeleted.dispose()}}const MB=pe(),DB=ec(pe()).optional(),NB=ec(pe()).optional(),OB=pe(),sc=Object.freeze({Text:(t="")=>new Qt(t),Boxed:t=>new Vr(t)}),Uk=$e({version:dn(),model:$e({role:OB,flavour:MB,parent:DB,children:NB,isFlatData:Ba().optional(),props:Hf().args(Ra()).returns(o0(hk())).optional(),toModel:Hf().args().returns(Ra()).optional()}),transformer:Hf().args(Ra()).returns(Ra()).optional()});function Zt({flavour:t,props:e,metadata:n,toModel:r,transformer:i}){const s={version:n.version,model:{role:n.role,parent:n.parent,children:n.children,flavour:t,props:e,toModel:r,isFlatData:n.isFlatData},transformer:i};return Uk.parse(s),s}class PB{constructor(e,n,r,i){this.schema=e,this.yBlock=n,this.doc=r,this.onChange=i;const{id:s,flavour:o,version:a,yChildren:l,props:c}=this._parseYBlock();this.id=s,this.flavour=o,this.yChildren=l,this.version=a,this.model=this._createModel(c)}_createModel(e){var n,r,i,s,o;const a=this.schema.flavourSchemaMap.get(this.flavour);if(!a)throw new V(re.ModelCRUDError,`schema for flavour: ${this.flavour} not found`);const l=(i=(r=(n=a.model).toModel)==null?void 0:r.call(n))!=null?i:new Qe;l.schema=a,l.id=this.id,l.keys=Array.from(e),l.yBlock=this.yBlock;const c=new RR(this.yBlock,l.deleted,this.onChange);this._reactive=c;const u=c.proxy;l._props=u,l.stash=this.stash,l.pop=this.pop,this.doc&&(l.store=this.doc);const d=(o=(s=a.model).props)==null?void 0:o.call(s,sc);return d&&Object.entries(d).forEach(([h,f])=>{h in u||f!==void 0&&(u[h]=f)}),l}_parseYBlock(){var e,n;let r,i,s,o;const a=new Set;if(this.yBlock.forEach((u,d)=>{if(d==="sys:id"&&typeof u=="string"){r=u;return}if(d==="sys:flavour"&&typeof u=="string"){i=u;return}if(d==="sys:children"&&u instanceof sr){o=u;return}if(d==="sys:version"&&typeof u=="number"){s=u;return}if(d.startsWith("prop:")){const p=d.replace("prop:","").split(".")[0];a.add(p);return}}),!r)throw new V(re.ModelCRUDError,"block id is not found when creating model");if(!i)throw new V(re.ModelCRUDError,"block flavour is not found when creating model");if(!o)throw new V(re.ModelCRUDError,"block children is not found when creating model");const l=this.schema.flavourSchemaMap.get(i);if(!l)throw new V(re.ModelCRUDError,`schema for flavour: ${i} not found`);typeof s!="number"&&(s=l.version);const c=(n=(e=l.model).props)==null?void 0:n.call(e,sc);return c&&Object.keys(c).forEach(u=>{a.has(u)||a.add(u)}),{id:r,flavour:i,version:s,props:a,yChildren:o}}get stash(){return this._reactive.stash}get pop(){return this._reactive.pop}}const b0=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else n!==void 0&&n()}};class LB{constructor(e,n,r,i){this.schema=e,this.yBlock=n,this.doc=r,this.onChange=i,this._byPassProxy=!1,this._byPassUpdate=u=>{this._byPassProxy=!0,u(),this._byPassProxy=!1},this._mutex=b0(),this._observeYBlockChanges=()=>{this.yBlock.observe(u=>{u.keysChanged.forEach(d=>{var h,f;const p=u.changes.keys.get(d);if(!p)return;const g=!this.yBlock.doc||!u.transaction.origin||u.transaction.origin instanceof Sa||u.transaction.origin.proxy?!0:u.transaction.origin===this.yBlock.doc.clientID;if(p.action==="update"||p.action==="add"){const b=this.yBlock.get(d),_=d.replace("prop:",""),y=this._getPropsProxy(_,b);this._byPassUpdate(()=>{this.model.props[_]=y;const x=`${_}$`;this._mutex(()=>{x in this.model.props&&(this.model.props[x].value=Fa(b))})}),(h=this.onChange)==null||h.call(this,_,g);return}if(p.action==="delete"){const b=d.replace("prop:","");this._byPassUpdate(()=>{delete this.model.props[b],`${b}$`in this.model.props&&(this.model.props[`${b}$`].value=void 0)}),(f=this.onChange)==null||f.call(this,b,g);return}})})},this._stashed=new Set,this.pop=u=>{this._stashed.has(u)&&this._popProp(u)},this.stash=u=>{this._stashed.has(u)||(this._stashed.add(u),this._stashProp(u))};const{id:s,flavour:o,version:a,yChildren:l,props:c}=this._parseYBlock();this.id=s,this.flavour=o,this.yChildren=l,this.version=a,this.model=this._createModel(c),this._observeYBlockChanges()}_createModel(e){var n,r,i;const s=this._mutex,o=this.schema.flavourSchemaMap.get(this.flavour);if(!o)throw new V(re.ModelCRUDError,`schema for flavour: ${this.flavour} not found`);const a=(i=(r=(n=o.model).toModel)==null?void 0:r.call(n))!=null?i:new Qe;a.schema=o;const l=Object.entries(e).reduce((d,[h,f])=>{const p=un(f),g=Pu(()=>{const _=p.value;this.model&&s(()=>{this.model.props[h]=_})}),b=a.deleted.subscribe(()=>{b.unsubscribe(),g()});return{...d,[`${h}$`]:p,[h]:f}},{});a.id=this.id,a.keys=Object.keys(e),a.yBlock=this.yBlock,a.stash=this.stash,a.pop=this.pop,this.doc&&(a.store=this.doc);const c=new Proxy(l,{has:(d,h)=>Reflect.has(d,h),set:(d,h,f,p)=>{var g;if(!this._byPassProxy&&typeof h=="string"&&a.keys.includes(h)){if(this._stashed.has(h)){u(d,h,f);const y=Reflect.set(d,h,f,p);return(g=this.onChange)==null||g.call(this,h,!0),y}const b=Xr(f);if(this.yBlock.get(`prop:${h}`)===b)return Reflect.set(d,h,f,p);this.yBlock.set(`prop:${h}`,b);const _=this._getPropsProxy(h,b);return u(d,h,f),Reflect.set(d,h,_,p)}return Reflect.set(d,h,f,p)},get:(d,h,f)=>Reflect.get(d,h,f),deleteProperty:(d,h)=>(!this._byPassProxy&&typeof h=="string"&&a.keys.includes(h)&&(this.yBlock.delete(`prop:${h}`),u(d,h,void 0)),Reflect.deleteProperty(d,h))});a._props=c;function u(d,h,f){s(()=>{d[`${h}$`].value=f})}return a}_getPropsProxy(e,n){return To(n,{onChange:(r,i)=>{var s;(s=this.onChange)==null||s.call(this,e,i);const o=`${e}$`;o in this.model.props&&this._mutex(()=>{this.model.props[o].value=Fa(n)})}})}_parseYBlock(){var e,n;let r,i,s,o;const a={};if(this.yBlock.forEach((u,d)=>{if(d.startsWith("prop:")){const h=d.replace("prop:","");a[h]=this._getPropsProxy(h,u);return}if(d==="sys:id"&&typeof u=="string"){r=u;return}if(d==="sys:flavour"&&typeof u=="string"){i=u;return}if(d==="sys:children"&&u instanceof sr){o=u;return}if(d==="sys:version"&&typeof u=="number"){s=u;return}}),!r)throw new V(re.ModelCRUDError,"block id is not found when creating model");if(!i)throw new V(re.ModelCRUDError,"block flavour is not found when creating model");if(!o)throw new V(re.ModelCRUDError,"block children is not found when creating model");const l=this.schema.flavourSchemaMap.get(i);if(!l)throw new V(re.ModelCRUDError,`schema for flavour: ${i} not found`);const c=(n=(e=l.model).props)==null?void 0:n.call(e,sc);return typeof s!="number"&&(s=l.version),c&&Object.entries(c).forEach(([u,d])=>{if(u in a)return;const h=Xr(d);d!==void 0&&this.yBlock.set(`prop:${u}`,h),a[u]=this._getPropsProxy(u,h)}),{id:r,flavour:i,version:s,props:a,yChildren:o}}_popProp(e){const n=this.model,r=n.props[e];this._stashed.delete(e),n.props[e]=r}_stashProp(e){this.model.props[e]=Fa(this.yBlock.get(`prop:${e}`),{transform:(n,r)=>Vr.is(r)?n:r instanceof at?new Proxy(n,{get:(i,s,o)=>Reflect.get(i,s,o),set:(i,s,o,a)=>{var l;const c=Reflect.set(i,s,o,a);return(l=this.onChange)==null||l.call(this,e,!0),c},deleteProperty:(i,s)=>{var o;const a=Reflect.deleteProperty(i,s);return(o=this.onChange)==null||o.call(this,e,!0),a}}):r instanceof sr?new Proxy(n,{get:(i,s,o)=>Reflect.get(i,s,o),set:(i,s,o,a)=>{var l;const c=Number(s);if(Number.isNaN(c))return Reflect.set(i,s,o,a);const u=Reflect.set(i,s,o,a);return(l=this.onChange)==null||l.call(this,e,!0),u},deleteProperty:(i,s)=>{var o;const a=Reflect.deleteProperty(i,s);return(o=this.onChange)==null||o.call(this,s,!0),a}}):n})}}class RB{constructor(e,n,r,i={}){this.schema=e,this.yBlock=n,this.doc=r,this.options=i,this.blockViewType="display";const s=i.onChange?(l,c)=>{var u;!this._syncController||!this.model||(u=i.onChange)==null||u.call(i,this,l,c)}:void 0,o=n.get("sys:flavour"),a=this.schema.get(o);a!=null&&a.model.isFlatData?this._syncController=new PB(e,n,r,s):this._syncController=new LB(e,n,r,s)}get flavour(){return this._syncController.flavour}get id(){return this._syncController.id}get model(){return this._syncController.model}get pop(){return this._syncController.pop}get stash(){return this._syncController.stash}get version(){return this._syncController.version}}function Ha(t){const{id:e,version:n,flavour:r,role:i,keys:s,text:o,children:a}=t,l=t.keys.reduce((c,u)=>{const h=t.props[u];return{...c,[u]:h}},{});return{id:e,version:n,flavour:r,role:i,keys:s,text:o,children:a.map(Ha),props:l}}const Xf="default",Qu=[];class BB extends Error{constructor(){super("Dynamic resolve recursion limit reached")}}class FB extends Error{constructor(e){super(`A circular dependency was detected.
`+Hk(e)),this.dependencyStack=e}}class y0 extends Error{constructor(e){super(`Service ${Zu(e)} not found in container`),this.identifier=e}}class $k extends Error{constructor(e,n,r){super(`Missing dependency ${Zu(n)} in creating service ${Zu(e)}.
${Hk(r)}`),this.from=e,this.target=n,this.dependencyStack=r}}class UB extends Error{constructor(e){super(`Service ${Zu(e)} already exists`),this.identifier=e}}function Zu(t){return`[${t.identifierName}]${t.variant!==Xf?`(${t.variant})`:""}`}function Hk(t){return t.map(e=>`${Zu(e)}`).join(" -> ")}const Kf=new WeakMap;let $B=0;function _0(t){const e=typeof t,n=t&&t.constructor,r=n===Date;if(Object(t)===t&&!r&&n!==RegExp){let i=Kf.get(t);if(i)return i;i=++$B+"~",Kf.set(t,i);let s;if(n===Array){for(i="@",s=0;s<t.length;s++)i+=_0(t[s])+",";Kf.set(t,i)}else if(n===Object){i="#";const o=Object.keys(t).sort();for(;(s=o.pop())!==void 0;)t[s]!==void 0&&(i+=s+":"+_0(t[s])+",");Kf.set(t,i)}return i}return r?t.toJSON():e==="symbol"?t.toString():e==="string"?JSON.stringify(t):""+t}function Me(t,e=Xf){return Object.assign(n=>Me(t,n),{identifierName:t,variant:e})}function HB(t){return Me(`${t.name}${_0(t)}`)}function Ju(t){if(t.identifierName)return t;if(typeof t=="function"&&t.name)return HB(t);throw new Error("Input is not a service identifier.")}class x0{get(e,n){return this.getRaw(Ju(e),{...n,optional:!1})}getAll(e,n){return this.getAllRaw(Ju(e),{...n})}getOptional(e,n){return this.getRaw(Ju(e),{...n,optional:!0})}}class zB{constructor(){this.cache=new Map}getOrInsert(e,n){var r;const i=(r=this.cache.get(e.identifierName))!=null?r:new Map;i.has(e.variant)||i.set(e.variant,n());const s=i.get(e.variant);return this.cache.set(e.identifierName,i),s}}class Qf extends x0{constructor(e,n=0,r=[]){super(),this.provider=e,this.depth=n,this.stack=r,this.container=this.provider.container}getAllRaw(e,{sameScope:n=!1}={}){const r=this.provider.container.getFactoryAll(e,this.provider.scope);if(r===void 0)return this.provider.parent&&!n?this.provider.parent.getAllRaw(e):new Map;const i=new Map;for(const[s,o]of r){const a=this.provider.cache.getOrInsert({identifierName:e.identifierName,variant:s},()=>{const l=this.track(e);try{return o(l)}catch(c){throw c instanceof y0?new $k(e,c.identifier,this.stack):c}});i.set(s,a)}return i}getRaw(e,{sameScope:n=!1,optional:r=!1}={}){const i=this.provider.container.getFactory(e,this.provider.scope);if(!i){if(this.provider.parent&&!n)return this.provider.parent.getRaw(e,{sameScope:n,optional:r});if(r)return;throw new y0(e)}return this.provider.cache.getOrInsert(e,()=>{const s=this.track(e);try{return i(s)}catch(o){throw o instanceof y0?new $k(e,o.identifier,this.stack):o}})}track(e){const n=this.depth+1;if(n>=100)throw new BB;if(this.stack.find(i=>i.identifierName===e.identifierName&&i.variant===e.variant))throw new FB([...this.stack,e]);return new Qf(this.provider,n,[...this.stack,e])}}class WB extends x0{constructor(e,n,r){super(),this.scope=n,this.parent=r,this.cache=new zB,this.container=e.clone(),this.container.addValue(x0,this,{scope:n,override:!0})}getAllRaw(e,n){return new Qf(this).getAllRaw(e,n)}getRaw(e,n){return new Qf(this).getRaw(e,n)}}function E0(t){return t.join("/")}class ed{constructor(){this.services=new Map}get add(){return new Zf(this).add}get addImpl(){return new Zf(this).addImpl}static get EMPTY(){return new ed}get override(){return new Zf(this).override}get scope(){return new Zf(this).scope}get size(){let e=0;for(const[,n]of this.services)for(const[,r]of n)e+=r.size;return e}addFactory(e,n,{scope:r,override:i}={}){var s,o,a;const l=E0(r??Qu),c=Ju(e),u=(s=c.variant)!=null?s:Xf,d=(o=this.services.get(l))!=null?o:new Map,h=(a=d.get(c.identifierName))!=null?a:new Map;if(h.has(u)&&!i)throw new UB(c);h.set(u,n),d.set(c.identifierName,h),this.services.set(l,d)}addValue(e,n,{scope:r,override:i}={}){this.addFactory(Ju(e),()=>n,{scope:r,override:i})}clone(){const e=new ed;for(const[n,r]of this.services){const i=new Map;for(const[s,o]of r)i.set(s,new Map(o));e.services.set(n,i)}return e}getFactory(e,n=Qu){var r,i,s;return(s=(r=this.services.get(E0(n)))==null?void 0:r.get(e.identifierName))==null?void 0:s.get((i=e.variant)!=null?i:Xf)}getFactoryAll(e,n=Qu){var r;return new Map((r=this.services.get(E0(n)))==null?void 0:r.get(e.identifierName))}provider(e=Qu,n=null){return new WB(this,e,n)}}class Zf{constructor(e){this.container=e,this.currentScope=Qu,this.add=(n,...[r])=>(this.container.addFactory(n,v0(n,r),{scope:this.currentScope}),this),this.addImpl=(n,r,...[i])=>(r instanceof Function?this.container.addFactory(n,v0(r,i),{scope:this.currentScope}):this.container.addValue(n,r,{scope:this.currentScope}),this),this.override=(n,r,...[i])=>(r instanceof Function?this.container.addFactory(n,v0(r,i),{scope:this.currentScope,override:!0}):this.container.addValue(n,r,{scope:this.currentScope,override:!0}),this),this.scope=n=>(this.currentScope=n,this)}}function v0(t,e=[]){return n=>{const r=[];for(const i of e){let s,o;if(Array.isArray(i)){if(i.length!==1)throw new Error("Invalid dependency");s=!0,o=i[0]}else s=!1,o=i;s?r.push(Array.from(n.getAll(o).values())):r.push(n.get(o))}return jB(t)?new t(...r,n):t(...r,n)}}function jB(t){try{return Reflect.construct(function(){},[],t),!0}catch{return!1}}const zk=Me("Store");var Jf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ep(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var td={exports:{}};td.exports;var Wk;function YB(){return Wk||(Wk=1,function(t,e){var n=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Function]",f="[object GeneratorFunction]",p="[object Map]",g="[object Number]",b="[object Object]",_="[object Promise]",y="[object RegExp]",x="[object Set]",E="[object String]",I="[object Symbol]",v="[object WeakMap]",N="[object ArrayBuffer]",L="[object DataView]",z="[object Float32Array]",M="[object Float64Array]",B="[object Int8Array]",$="[object Int16Array]",se="[object Int32Array]",be="[object Uint8Array]",_e="[object Uint8ClampedArray]",we="[object Uint16Array]",de="[object Uint32Array]",Ue=/[\\^$.*+?()[\]{}|]/g,Se=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,he={};he[z]=he[M]=he[B]=he[$]=he[se]=he[be]=he[_e]=he[we]=he[de]=!0,he[a]=he[l]=he[N]=he[c]=he[L]=he[u]=he[d]=he[h]=he[p]=he[g]=he[b]=he[y]=he[x]=he[E]=he[v]=!1;var qe=typeof Jf=="object"&&Jf&&Jf.Object===Object&&Jf,A=typeof self=="object"&&self&&self.Object===Object&&self,ot=qe||A||Function("return this")(),Ce=e&&!e.nodeType&&e,Xe=Ce&&!0&&t&&!t.nodeType&&t,Zn=Xe&&Xe.exports===Ce,xn=Zn&&qe.process,En=function(){try{return xn&&xn.binding("util")}catch{}}(),$n=En&&En.isTypedArray;function Gt(T,O){for(var Z=-1,xe=T?T.length:0;++Z<xe;)if(O(T[Z],Z,T))return!0;return!1}function Hn(T,O){for(var Z=-1,xe=Array(T);++Z<T;)xe[Z]=O(Z);return xe}function Jn(T){return function(O){return T(O)}}function Di(T,O){return T==null?void 0:T[O]}function xs(T){var O=!1;if(T!=null&&typeof T.toString!="function")try{O=!!(T+"")}catch{}return O}function ma(T){var O=-1,Z=Array(T.size);return T.forEach(function(xe,ct){Z[++O]=[ct,xe]}),Z}function Ni(T,O){return function(Z){return T(O(Z))}}function ga(T){var O=-1,Z=Array(T.size);return T.forEach(function(xe){Z[++O]=xe}),Z}var co=Array.prototype,El=Function.prototype,uo=Object.prototype,vl=ot["__core-js_shared__"],ba=function(){var T=/[^.]+$/.exec(vl&&vl.keys&&vl.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),Es=El.toString,On=uo.hasOwnProperty,U=uo.toString,te=RegExp("^"+Es.call(On).replace(Ue,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ae=ot.Symbol,Be=ot.Uint8Array,nt=uo.propertyIsEnumerable,er=co.splice,Cr=Ni(Object.keys,Object),Pn=su(ot,"DataView"),Vt=su(ot,"Map"),tr=su(ot,"Promise"),qt=su(ot,"Set"),Ar=su(ot,"WeakMap"),zn=su(Object,"create"),nu=kl(Pn),ru=kl(Vt),HE=kl(tr),wl=kl(qt),zE=kl(Ar),Rm=Ae?Ae.prototype:void 0,$t=Rm?Rm.valueOf:void 0;function Ir(T){var O=-1,Z=T?T.length:0;for(this.clear();++O<Z;){var xe=T[O];this.set(xe[0],xe[1])}}function WE(){this.__data__=zn?zn(null):{}}function Bm(T){return this.has(T)&&delete this.__data__[T]}function qh(T){var O=this.__data__;if(zn){var Z=O[T];return Z===r?void 0:Z}return On.call(O,T)?O[T]:void 0}function Fm(T){var O=this.__data__;return zn?O[T]!==void 0:On.call(O,T)}function Um(T,O){var Z=this.__data__;return Z[T]=zn&&O===void 0?r:O,this}Ir.prototype.clear=WE,Ir.prototype.delete=Bm,Ir.prototype.get=qh,Ir.prototype.has=Fm,Ir.prototype.set=Um;function Oi(T){var O=-1,Z=T?T.length:0;for(this.clear();++O<Z;){var xe=T[O];this.set(xe[0],xe[1])}}function oi(){this.__data__=[]}function ya(T){var O=this.__data__,Z=ws(O,T);if(Z<0)return!1;var xe=O.length-1;return Z==xe?O.pop():er.call(O,Z,1),!0}function $m(T){var O=this.__data__,Z=ws(O,T);return Z<0?void 0:O[Z][1]}function Hm(T){return ws(this.__data__,T)>-1}function Xh(T,O){var Z=this.__data__,xe=ws(Z,T);return xe<0?Z.push([T,O]):Z[xe][1]=O,this}Oi.prototype.clear=oi,Oi.prototype.delete=ya,Oi.prototype.get=$m,Oi.prototype.has=Hm,Oi.prototype.set=Xh;function vs(T){var O=-1,Z=T?T.length:0;for(this.clear();++O<Z;){var xe=T[O];this.set(xe[0],xe[1])}}function Pi(){this.__data__={hash:new Ir,map:new(Vt||Oi),string:new Ir}}function zm(T){return qm(this,T).delete(T)}function Wm(T){return qm(this,T).get(T)}function jm(T){return qm(this,T).has(T)}function Ym(T,O){return qm(this,T).set(T,O),this}vs.prototype.clear=Pi,vs.prototype.delete=zm,vs.prototype.get=Wm,vs.prototype.has=jm,vs.prototype.set=Ym;function iu(T){var O=-1,Z=T?T.length:0;for(this.__data__=new vs;++O<Z;)this.add(T[O])}function Ee(T){return this.__data__.set(T,r),this}function D(T){return this.__data__.has(T)}iu.prototype.add=iu.prototype.push=Ee,iu.prototype.has=D;function Y(T){this.__data__=new Oi(T)}function me(){this.__data__=new Oi}function vt(T){return this.__data__.delete(T)}function Ln(T){return this.__data__.get(T)}function Xt(T){return this.__data__.has(T)}function nr(T,O){var Z=this.__data__;if(Z instanceof Oi){var xe=Z.__data__;if(!Vt||xe.length<n-1)return xe.push([T,O]),this;Z=this.__data__=new vs(xe)}return Z.set(T,O),this}Y.prototype.clear=me,Y.prototype.delete=vt,Y.prototype.get=Ln,Y.prototype.has=Xt,Y.prototype.set=nr;function Li(T,O){var Z=jE(T)||hge(T)?Hn(T.length,String):[],xe=Z.length,ct=!!xe;for(var Oe in T)On.call(T,Oe)&&!(ct&&(Oe=="length"||age(Oe,xe)))&&Z.push(Oe);return Z}function ws(T,O){for(var Z=T.length;Z--;)if(b6(T[Z][0],O))return Z;return-1}function Kh(T){return U.call(T)}function vn(T,O,Z,xe,ct){return T===O?!0:T==null||O==null||!Xm(T)&&!YE(O)?T!==T&&O!==O:Gm(T,O,vn,Z,xe,ct)}function Gm(T,O,Z,xe,ct,Oe){var Ot=jE(T),Wn=jE(O),wn=l,rr=l;Ot||(wn=_a(T),wn=wn==a?b:wn),Wn||(rr=_a(O),rr=rr==a?b:rr);var Mr=wn==b&&!xs(T),Dr=rr==b&&!xs(O),mr=wn==rr;if(mr&&!Mr)return Oe||(Oe=new Y),Ot||mge(T)?g6(T,O,Z,xe,ct,Oe):ige(T,O,wn,Z,xe,ct,Oe);if(!(ct&s)){var ai=Mr&&On.call(T,"__wrapped__"),li=Dr&&On.call(O,"__wrapped__");if(ai||li){var xa=ai?T.value():T,ho=li?O.value():O;return Oe||(Oe=new Y),Z(xa,ho,xe,ct,Oe)}}return mr?(Oe||(Oe=new Y),sge(T,O,Z,xe,ct,Oe)):!1}function Vm(T,O,Z,xe){var ct=Z.length,Oe=ct;if(T==null)return!Oe;for(T=Object(T);ct--;){var Ot=Z[ct];if(Ot[2]?Ot[1]!==T[Ot[0]]:!(Ot[0]in T))return!1}for(;++ct<Oe;){Ot=Z[ct];var Wn=Ot[0],wn=T[Wn],rr=Ot[1];if(Ot[2]){if(wn===void 0&&!(Wn in T))return!1}else{var Mr=new Y,Dr;if(!(Dr===void 0?vn(rr,wn,xe,i|s,Mr):Dr))return!1}}return!0}function tge(T){if(!Xm(T)||cge(T))return!1;var O=_6(T)||xs(T)?te:Se;return O.test(kl(T))}function nge(T){return YE(T)&&x6(T.length)&&!!he[U.call(T)]}function rge(T){if(!uge(T))return Cr(T);var O=[];for(var Z in Object(T))On.call(T,Z)&&Z!="constructor"&&O.push(Z);return O}function g6(T,O,Z,xe,ct,Oe){var Ot=ct&s,Wn=T.length,wn=O.length;if(Wn!=wn&&!(Ot&&wn>Wn))return!1;var rr=Oe.get(T);if(rr&&Oe.get(O))return rr==O;var Mr=-1,Dr=!0,mr=ct&i?new iu:void 0;for(Oe.set(T,O),Oe.set(O,T);++Mr<Wn;){var ai=T[Mr],li=O[Mr];if(xe)var xa=Ot?xe(li,ai,Mr,O,T,Oe):xe(ai,li,Mr,T,O,Oe);if(xa!==void 0){if(xa)continue;Dr=!1;break}if(mr){if(!Gt(O,function(ho,Tl){if(!mr.has(Tl)&&(ai===ho||Z(ai,ho,xe,ct,Oe)))return mr.add(Tl)})){Dr=!1;break}}else if(!(ai===li||Z(ai,li,xe,ct,Oe))){Dr=!1;break}}return Oe.delete(T),Oe.delete(O),Dr}function ige(T,O,Z,xe,ct,Oe,Ot){switch(Z){case L:if(T.byteLength!=O.byteLength||T.byteOffset!=O.byteOffset)return!1;T=T.buffer,O=O.buffer;case N:return!(T.byteLength!=O.byteLength||!xe(new Be(T),new Be(O)));case c:case u:case g:return b6(+T,+O);case d:return T.name==O.name&&T.message==O.message;case y:case E:return T==O+"";case p:var Wn=ma;case x:var wn=Oe&s;if(Wn||(Wn=ga),T.size!=O.size&&!wn)return!1;var rr=Ot.get(T);if(rr)return rr==O;Oe|=i,Ot.set(T,O);var Mr=g6(Wn(T),Wn(O),xe,ct,Oe,Ot);return Ot.delete(T),Mr;case I:if($t)return $t.call(T)==$t.call(O)}return!1}function sge(T,O,Z,xe,ct,Oe){var Ot=ct&s,Wn=GE(T),wn=Wn.length,rr=GE(O),Mr=rr.length;if(wn!=Mr&&!Ot)return!1;for(var Dr=wn;Dr--;){var mr=Wn[Dr];if(!(Ot?mr in O:On.call(O,mr)))return!1}var ai=Oe.get(T);if(ai&&Oe.get(O))return ai==O;var li=!0;Oe.set(T,O),Oe.set(O,T);for(var xa=Ot;++Dr<wn;){mr=Wn[Dr];var ho=T[mr],Tl=O[mr];if(xe)var E6=Ot?xe(Tl,ho,mr,O,T,Oe):xe(ho,Tl,mr,T,O,Oe);if(!(E6===void 0?ho===Tl||Z(ho,Tl,xe,ct,Oe):E6)){li=!1;break}xa||(xa=mr=="constructor")}if(li&&!xa){var Km=T.constructor,Qm=O.constructor;Km!=Qm&&"constructor"in T&&"constructor"in O&&!(typeof Km=="function"&&Km instanceof Km&&typeof Qm=="function"&&Qm instanceof Qm)&&(li=!1)}return Oe.delete(T),Oe.delete(O),li}function qm(T,O){var Z=T.__data__;return lge(O)?Z[typeof O=="string"?"string":"hash"]:Z.map}function oge(T){for(var O=GE(T),Z=O.length;Z--;){var xe=O[Z],ct=T[xe];O[Z]=[xe,ct,dge(ct)]}return O}function su(T,O){var Z=Di(T,O);return tge(Z)?Z:void 0}var _a=Kh;(Pn&&_a(new Pn(new ArrayBuffer(1)))!=L||Vt&&_a(new Vt)!=p||tr&&_a(tr.resolve())!=_||qt&&_a(new qt)!=x||Ar&&_a(new Ar)!=v)&&(_a=function(T){var O=U.call(T),Z=O==b?T.constructor:void 0,xe=Z?kl(Z):void 0;if(xe)switch(xe){case nu:return L;case ru:return p;case HE:return _;case wl:return x;case zE:return v}return O});function age(T,O){return O=O??o,!!O&&(typeof T=="number"||C.test(T))&&T>-1&&T%1==0&&T<O}function lge(T){var O=typeof T;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?T!=="__proto__":T===null}function cge(T){return!!ba&&ba in T}function uge(T){var O=T&&T.constructor,Z=typeof O=="function"&&O.prototype||uo;return T===Z}function dge(T){return T===T&&!Xm(T)}function kl(T){if(T!=null){try{return Es.call(T)}catch{}try{return T+""}catch{}}return""}function b6(T,O){return T===O||T!==T&&O!==O}function hge(T){return fge(T)&&On.call(T,"callee")&&(!nt.call(T,"callee")||U.call(T)==a)}var jE=Array.isArray;function y6(T){return T!=null&&x6(T.length)&&!_6(T)}function fge(T){return YE(T)&&y6(T)}function _6(T){var O=Xm(T)?U.call(T):"";return O==h||O==f}function x6(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=o}function Xm(T){var O=typeof T;return!!T&&(O=="object"||O=="function")}function YE(T){return!!T&&typeof T=="object"}function pge(T,O){return T===O||Vm(T,O,oge(O))}var mge=$n?Jn($n):nge;function GE(T){return y6(T)?Li(T):rge(T)}t.exports=pge}(td,td.exports)),td.exports}var GB=YB();const VB=ep(GB);function qB(t,e){const n=XB(t,e);if(e.blockViewType=n,n!=="hidden"){const r=t.mode;KB(r,e)}}function XB(t,e){const n=e.model.flavour,r=e.model.id,i=t.mode,s=e.model.keys.reduce((a,l)=>({...a,[l]:e.model.props[l]}),{});let o=i==="loose"?"display":"hidden";return t.match.some(a=>{const{id:l,flavour:c,props:u,viewType:d}=a,h=l==null?!0:l===r,f=c==null?!0:c===n,p=u==null?!0:VB(s,u);return h&&f&&p?(o=d,!0):!1}),o}function KB(t,e){const n=e.model.store;let r=n.getParent(e.model);for(;r;){const i=n.getBlock(r.id);i&&i.blockViewType==="hidden"&&(i.blockViewType=t==="include"?"display":"bypass"),r=n.getParent(r)}}class hn{constructor(){this._disposables=[],this._disposed=!1}get disposed(){return this._disposed}add(e){if(this._disposed){jk(e);return}this._disposables.push(e)}addFromEvent(e,n,r,i){this.add({dispose:()=>{e.removeEventListener(n,r,i)}}),e.addEventListener(n,r,i)}dispose(){QB(this._disposables),this._disposables=[],this._disposed=!0}}function jk(t){try{t instanceof ic?t.unsubscribe():t instanceof Ie?t.complete():typeof t=="function"?t():t.dispose()}catch(e){console.error(e)}}function QB(t){t.forEach(jk)}class nd{static setup(e){}}var Yk,Gk;const w0=Me("StoreExtension"),ZB=Symbol("StoreExtension");class za extends(Gk=nd,Yk=ZB,Gk){constructor(e){super(),this.store=e}loaded(){}disposed(){}static setup(e){if(!this.key)throw new V(re.ValueNotExists,"Key is not defined in the StoreExtension");e.add(this,[zk]),e.addImpl(w0(this.key),n=>n.get(this))}}za[Yk]=!0;class k0 extends za{constructor(e){super(e),this._canRedo=un(!1),this._canUndo=un(!1),this.onUpdated=new Ie,this._updateCanUndoRedoSignals=()=>{const n=this._history.canRedo(),r=this._history.canUndo();this._canRedo.peek()!==n&&(this._canRedo.value=n),this._canUndo.peek()!==r&&(this._canUndo.value=r)},this._historyObserver=()=>{this._updateCanUndoRedoSignals(),this.onUpdated.next()},this._history=new Sa([this.store.doc.yBlocks],{trackedOrigins:new Set([this.store.doc.spaceDoc.clientID])})}get canRedo(){return this._canRedo.peek()}get canUndo(){return this._canUndo.peek()}get canRedo$(){return this._canRedo}get canUndo$(){return this._canUndo}get undoManager(){return this._history}loaded(){this._updateCanUndoRedoSignals(),this._history.on("stack-cleared",this._historyObserver),this._history.on("stack-item-added",this._historyObserver),this._history.on("stack-item-popped",this._historyObserver),this._history.on("stack-item-updated",this._historyObserver)}disposed(){super.disposed(),this._history.off("stack-cleared",this._historyObserver),this._history.off("stack-item-added",this._historyObserver),this._history.off("stack-item-popped",this._historyObserver),this._history.off("stack-item-updated",this._historyObserver),this.onUpdated.complete()}}k0.key="history";const Vk=Me("BlockSchema");function bt(t){return{setup:e=>{e.addImpl(Vk(t.model.flavour),()=>t)}}}class Us{get group(){return this.constructor.group}get type(){return this.constructor.type}constructor({blockId:e}){this.blockId=e}static fromJSON(e){throw new V(re.SelectionError,"You must override this method")}is(e){return this.type===e.type}}Us.recoverable=!1;const qk=Me("Selection");function So(t){return{setup:e=>{e.addImpl(qk(t.type),()=>t)}}}const JB="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let e8=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=JB[n[t]&63];return e};const K=()=>e8(10);class T0 extends za{constructor(){super(...arguments),this._id=`${this.store.id}:${K()}`,this._selectionConstructors={},this._selections=un([]),this._remoteSelections=un(new Map),this._itemAdded=e=>{e.stackItem.meta.set("selection-state",this._selections.value)},this._itemPopped=e=>{const n=e.stackItem.meta.get("selection-state");n&&this.set(n)},this._jsonToSelection=e=>{const n=this._selectionConstructors[e.type];if(!n)throw new V(re.SelectionError,`Unknown selection type: ${e.type}`);return n.fromJSON(e)},this.slots={changed:new Ie,remoteChanged:new Ie}}loaded(){this.store.provider.getAll(qk).forEach(e=>{[e].flat().forEach(n=>{this._selectionConstructors[n.type]=n})}),this.store.awarenessStore.awareness.on("change",e=>{const n=e.updated.concat(e.added).concat(e.removed),r=this.store.awarenessStore.awareness.clientID;if(n.filter(s=>s!==r).length>0){const s=new Map;this.store.awarenessStore.getStates().forEach((o,a)=>{if(a===this.store.awarenessStore.awareness.clientID)return;const c=Object.entries(o.selectionV2).filter(([u])=>u.startsWith(this.store.id)).flatMap(([u,d])=>d).map(u=>{try{return this._jsonToSelection(u)}catch(d){return console.error("Parse remote selection failed:",a,u,d),null}}).filter(u=>!!u);s.set(a,c)}),this._remoteSelections.value=s,this.slots.remoteChanged.next(s)}}),this.store.history.undoManager.on("stack-item-added",this._itemAdded),this.store.history.undoManager.on("stack-item-popped",this._itemPopped)}disposed(){super.disposed(),this.store.history.undoManager.off("stack-item-added",this._itemAdded),this.store.history.undoManager.off("stack-item-popped",this._itemPopped)}get value(){return this._selections.value}get remoteSelections(){return this._remoteSelections.value}clear(e){if(e){const n=this.value.filter(r=>!e.includes(r.type));this.set(n)}else this.set([])}create(e,...n){return new e(...n)}getGroup(e){return this.value.filter(n=>n.group===e)}filter(e){return this.filter$(e).value}filter$(e){return Os(()=>this.value.filter(n=>n.is(e)))}find(e){return this.find$(e).value}find$(e){return Os(()=>this.value.find(n=>n.is(e)))}set(e){this.store.awarenessStore.setLocalSelection(this._id,e.map(n=>n.toJSON())),this._selections.value=e,this.slots.changed.next(e)}setGroup(e,n){const r=this.value.filter(i=>i.group!==e);this.set([...r,...n])}clearRemote(){this.store.awarenessStore.setLocalSelection(this._id,[])}update(e){const n=e(this.value);this.set(n)}fromJSON(e){const n=e.map(r=>this._jsonToSelection(r));return this.set(n)}}T0.key="selection";const Xk=Me("store-doc");var S0,Kk;function t8(){if(Kk)return S0;Kk=1,S0=t;function t(r,i,s){r instanceof RegExp&&(r=e(r,s)),i instanceof RegExp&&(i=e(i,s));var o=n(r,i,s);return o&&{start:o[0],end:o[1],pre:s.slice(0,o[0]),body:s.slice(o[0]+r.length,o[1]),post:s.slice(o[1]+i.length)}}function e(r,i){var s=i.match(r);return s?s[0]:null}t.range=n;function n(r,i,s){var o,a,l,c,u,d=s.indexOf(r),h=s.indexOf(i,d+1),f=d;if(d>=0&&h>0){if(r===i)return[d,h];for(o=[],l=s.length;f>=0&&!u;)f==d?(o.push(f),d=s.indexOf(r,f+1)):o.length==1?u=[o.pop(),h]:(a=o.pop(),a<l&&(l=a,c=h),h=s.indexOf(i,f+1)),f=d<h&&d>=0?d:h;o.length&&(u=[l,c])}return u}return S0}var C0,Qk;function n8(){if(Qk)return C0;Qk=1;var t=t8();C0=u;var e="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",r="\0CLOSE"+Math.random()+"\0",i="\0COMMA"+Math.random()+"\0",s="\0PERIOD"+Math.random()+"\0";function o(b){return parseInt(b,10)==b?parseInt(b,10):b.charCodeAt(0)}function a(b){return b.split("\\\\").join(e).split("\\{").join(n).split("\\}").join(r).split("\\,").join(i).split("\\.").join(s)}function l(b){return b.split(e).join("\\").split(n).join("{").split(r).join("}").split(i).join(",").split(s).join(".")}function c(b){if(!b)return[""];var _=[],y=t("{","}",b);if(!y)return b.split(",");var x=y.pre,E=y.body,I=y.post,v=x.split(",");v[v.length-1]+="{"+E+"}";var N=c(I);return I.length&&(v[v.length-1]+=N.shift(),v.push.apply(v,N)),_.push.apply(_,v),_}function u(b){return b?(b.substr(0,2)==="{}"&&(b="\\{\\}"+b.substr(2)),g(a(b),!0).map(l)):[]}function d(b){return"{"+b+"}"}function h(b){return/^-?0\d/.test(b)}function f(b,_){return b<=_}function p(b,_){return b>=_}function g(b,_){var y=[],x=t("{","}",b);if(!x)return[b];var E=x.pre,I=x.post.length?g(x.post,!1):[""];if(/\$$/.test(x.pre))for(var v=0;v<I.length;v++){var N=E+"{"+x.body+"}"+I[v];y.push(N)}else{var L=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(x.body),z=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(x.body),M=L||z,B=x.body.indexOf(",")>=0;if(!M&&!B)return x.post.match(/,.*\}/)?(b=x.pre+"{"+x.body+r+x.post,g(b)):[b];var $;if(M)$=x.body.split(/\.\./);else if($=c(x.body),$.length===1&&($=g($[0],!1).map(d),$.length===1))return I.map(function(Xe){return x.pre+$[0]+Xe});var se;if(M){var be=o($[0]),_e=o($[1]),we=Math.max($[0].length,$[1].length),de=$.length==3?Math.abs(o($[2])):1,Ue=f,Se=_e<be;Se&&(de*=-1,Ue=p);var C=$.some(h);se=[];for(var he=be;Ue(he,_e);he+=de){var qe;if(z)qe=String.fromCharCode(he),qe==="\\"&&(qe="");else if(qe=String(he),C){var A=we-qe.length;if(A>0){var ot=new Array(A+1).join("0");he<0?qe="-"+ot+qe.slice(1):qe=ot+qe}}se.push(qe)}}else{se=[];for(var Ce=0;Ce<$.length;Ce++)se.push.apply(se,g($[Ce],!1))}for(var Ce=0;Ce<se.length;Ce++)for(var v=0;v<I.length;v++){var N=E+se[Ce]+I[v];(!_||M||N)&&y.push(N)}}return y}return C0}var r8=n8();const i8=ep(r8),s8=1024*64,tp=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>s8)throw new TypeError("pattern is too long")},o8={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},rd=t=>t.replace(/[[\]\\-]/g,"\\$&"),a8=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Zk=t=>t.join(""),l8=(t,e)=>{const n=e;if(t.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],i=[];let s=n+1,o=!1,a=!1,l=!1,c=!1,u=n,d="";e:for(;s<t.length;){const g=t.charAt(s);if((g==="!"||g==="^")&&s===n+1){c=!0,s++;continue}if(g==="]"&&o&&!l){u=s+1;break}if(o=!0,g==="\\"&&!l){l=!0,s++;continue}if(g==="["&&!l){for(const[b,[_,y,x]]of Object.entries(o8))if(t.startsWith(b,s)){if(d)return["$.",!1,t.length-n,!0];s+=b.length,x?i.push(_):r.push(_),a=a||y;continue e}}if(l=!1,d){g>d?r.push(rd(d)+"-"+rd(g)):g===d&&r.push(rd(g)),d="",s++;continue}if(t.startsWith("-]",s+1)){r.push(rd(g+"-")),s+=2;continue}if(t.startsWith("-",s+1)){d=g,s+=2;continue}r.push(rd(g)),s++}if(u<s)return["",!1,0,!1];if(!r.length&&!i.length)return["$.",!1,t.length-n,!0];if(i.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!c){const g=r[0].length===2?r[0].slice(-1):r[0];return[a8(g),!1,u-n,!1]}const h="["+(c?"^":"")+Zk(r)+"]",f="["+(c?"":"^")+Zk(i)+"]";return[r.length&&i.length?"("+h+"|"+f+")":r.length?h:f,a,u-n,!0]},id=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),c8=new Set(["!","?","+","*","@"]),Jk=t=>c8.has(t),u8="(?!(?:^|/)\\.\\.?(?:$|/))",np="(?!\\.)",d8=new Set(["[","."]),h8=new Set(["..","."]),f8=new Set("().*{}+?[]^$\\!"),p8=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),A0="[^/]",eT=A0+"*?",tT=A0+"+?",pr=class pr{constructor(e,n,r={}){Nr(this,xl);J(this,"type");Nr(this,_n);Nr(this,Nn);Nr(this,lo,!1);Nr(this,Nt,[]);Nr(this,on);Nr(this,ha);Nr(this,yl);Nr(this,fa,!1);Nr(this,_s);Nr(this,_l);Nr(this,Vh,!1);this.type=e,e&&Kt(this,Nn,!0),Kt(this,on,n),Kt(this,_n,ne(this,on)?ne(ne(this,on),_n):this),Kt(this,_s,ne(this,_n)===this?r:ne(ne(this,_n),_s)),Kt(this,yl,ne(this,_n)===this?[]:ne(ne(this,_n),yl)),e==="!"&&!ne(ne(this,_n),fa)&&ne(this,yl).push(this),Kt(this,ha,ne(this,on)?ne(ne(this,on),Nt).length:0)}get hasMagic(){if(ne(this,Nn)!==void 0)return ne(this,Nn);for(const e of ne(this,Nt))if(typeof e!="string"&&(e.type||e.hasMagic))return Kt(this,Nn,!0);return ne(this,Nn)}toString(){return ne(this,_l)!==void 0?ne(this,_l):this.type?Kt(this,_l,this.type+"("+ne(this,Nt).map(e=>String(e)).join("|")+")"):Kt(this,_l,ne(this,Nt).map(e=>String(e)).join(""))}push(...e){for(const n of e)if(n!==""){if(typeof n!="string"&&!(n instanceof pr&&ne(n,on)===this))throw new Error("invalid part: "+n);ne(this,Nt).push(n)}}toJSON(){var n;const e=this.type===null?ne(this,Nt).slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...ne(this,Nt).map(r=>r.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===ne(this,_n)||ne(ne(this,_n),fa)&&((n=ne(this,on))==null?void 0:n.type)==="!")&&e.push({}),e}isStart(){var n;if(ne(this,_n)===this)return!0;if(!((n=ne(this,on))!=null&&n.isStart()))return!1;if(ne(this,ha)===0)return!0;const e=ne(this,on);for(let r=0;r<ne(this,ha);r++){const i=ne(e,Nt)[r];if(!(i instanceof pr&&i.type==="!"))return!1}return!0}isEnd(){var n,r,i;if(ne(this,_n)===this||((n=ne(this,on))==null?void 0:n.type)==="!")return!0;if(!((r=ne(this,on))!=null&&r.isEnd()))return!1;if(!this.type)return(i=ne(this,on))==null?void 0:i.isEnd();const e=ne(this,on)?ne(ne(this,on),Nt).length:0;return ne(this,ha)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const n=new pr(this.type,e);for(const r of ne(this,Nt))n.copyIn(r);return n}static fromGlob(e,n={}){var i;const r=new pr(null,void 0,n);return Ea(i=pr,pa,Zm).call(i,e,r,0,n),r}toMMPattern(){if(this!==ne(this,_n))return ne(this,_n).toMMPattern();const e=this.toString(),[n,r,i,s]=this.toRegExpSource();if(!(i||ne(this,Nn)||ne(this,_s).nocase&&!ne(this,_s).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return r;const a=(ne(this,_s).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${n}$`,a),{_src:n,_glob:e})}get options(){return ne(this,_s)}toRegExpSource(e){var l;const n=e??!!ne(this,_s).dot;if(ne(this,_n)===this&&Ea(this,xl,w6).call(this),!this.type){const c=this.isStart()&&this.isEnd(),u=ne(this,Nt).map(p=>{var x;const[g,b,_,y]=typeof p=="string"?Ea(x=pr,pa,k6).call(x,p,ne(this,Nn),c):p.toRegExpSource(e);return Kt(this,Nn,ne(this,Nn)||_),Kt(this,lo,ne(this,lo)||y),g}).join("");let d="";if(this.isStart()&&typeof ne(this,Nt)[0]=="string"&&!(ne(this,Nt).length===1&&h8.has(ne(this,Nt)[0]))){const g=d8,b=n&&g.has(u.charAt(0))||u.startsWith("\\.")&&g.has(u.charAt(2))||u.startsWith("\\.\\.")&&g.has(u.charAt(4)),_=!n&&!e&&g.has(u.charAt(0));d=b?u8:_?np:""}let h="";return this.isEnd()&&ne(ne(this,_n),fa)&&((l=ne(this,on))==null?void 0:l.type)==="!"&&(h="(?:$|\\/)"),[d+u+h,id(u),Kt(this,Nn,!!ne(this,Nn)),ne(this,lo)]}const r=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:";let s=Ea(this,xl,XE).call(this,n);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){const c=this.toString();return Kt(this,Nt,[c]),this.type=null,Kt(this,Nn,void 0),[c,id(this.toString()),!1,!1]}let o=!r||e||n||!np?"":Ea(this,xl,XE).call(this,!0);o===s&&(o=""),o&&(s=`(?:${s})(?:${o})*?`);let a="";if(this.type==="!"&&ne(this,Vh))a=(this.isStart()&&!n?np:"")+tT;else{const c=this.type==="!"?"))"+(this.isStart()&&!n&&!e?np:"")+eT+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;a=i+s+c}return[a,id(s),Kt(this,Nn,!!ne(this,Nn)),ne(this,lo)]}};_n=new WeakMap,Nn=new WeakMap,lo=new WeakMap,Nt=new WeakMap,on=new WeakMap,ha=new WeakMap,yl=new WeakMap,fa=new WeakMap,_s=new WeakMap,_l=new WeakMap,Vh=new WeakMap,xl=new WeakSet,w6=function(){if(this!==ne(this,_n))throw new Error("should only call on root");if(ne(this,fa))return this;this.toString(),Kt(this,fa,!0);let e;for(;e=ne(this,yl).pop();){if(e.type!=="!")continue;let n=e,r=ne(n,on);for(;r;){for(let i=ne(n,ha)+1;!r.type&&i<ne(r,Nt).length;i++)for(const s of ne(e,Nt)){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(ne(r,Nt)[i])}n=r,r=ne(n,on)}}return this},pa=new WeakSet,Zm=function(e,n,r,i){var f,p;let s=!1,o=!1,a=-1,l=!1;if(n.type===null){let g=r,b="";for(;g<e.length;){const _=e.charAt(g++);if(s||_==="\\"){s=!s,b+=_;continue}if(o){g===a+1?(_==="^"||_==="!")&&(l=!0):_==="]"&&!(g===a+2&&l)&&(o=!1),b+=_;continue}else if(_==="["){o=!0,a=g,l=!1,b+=_;continue}if(!i.noext&&Jk(_)&&e.charAt(g)==="("){n.push(b),b="";const y=new pr(_,n);g=Ea(f=pr,pa,Zm).call(f,e,y,g,i),n.push(y);continue}b+=_}return n.push(b),g}let c=r+1,u=new pr(null,n);const d=[];let h="";for(;c<e.length;){const g=e.charAt(c++);if(s||g==="\\"){s=!s,h+=g;continue}if(o){c===a+1?(g==="^"||g==="!")&&(l=!0):g==="]"&&!(c===a+2&&l)&&(o=!1),h+=g;continue}else if(g==="["){o=!0,a=c,l=!1,h+=g;continue}if(Jk(g)&&e.charAt(c)==="("){u.push(h),h="";const b=new pr(g,u);u.push(b),c=Ea(p=pr,pa,Zm).call(p,e,b,c,i);continue}if(g==="|"){u.push(h),h="",d.push(u),u=new pr(null,n);continue}if(g===")")return h===""&&ne(n,Nt).length===0&&Kt(n,Vh,!0),u.push(h),h="",n.push(...d,u),c;h+=g}return n.type=null,Kt(n,Nn,void 0),Kt(n,Nt,[e.substring(r-1)]),c},XE=function(e){return ne(this,Nt).map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[r,i,s,o]=n.toRegExpSource(e);return Kt(this,lo,ne(this,lo)||o),r}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")},k6=function(e,n,r=!1){let i=!1,s="",o=!1;for(let a=0;a<e.length;a++){const l=e.charAt(a);if(i){i=!1,s+=(f8.has(l)?"\\":"")+l;continue}if(l==="\\"){a===e.length-1?s+="\\\\":i=!0;continue}if(l==="["){const[c,u,d,h]=l8(e,a);if(d){s+=c,o=o||u,a+=d-1,n=n||h;continue}}if(l==="*"){r&&e==="*"?s+=tT:s+=eT,n=!0;continue}if(l==="?"){s+=A0,n=!0;continue}s+=p8(l)}return[s,id(e),!!n,o]},Nr(pr,pa);let rp=pr;const m8=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),Rn=(t,e,n={})=>(tp(e),!n.nocomment&&e.charAt(0)==="#"?!1:new ip(e,n).match(t)),g8=/^\*+([^+@!?\*\[\(]*)$/,b8=t=>e=>!e.startsWith(".")&&e.endsWith(t),y8=t=>e=>e.endsWith(t),_8=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),x8=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),E8=/^\*+\.\*+$/,v8=t=>!t.startsWith(".")&&t.includes("."),w8=t=>t!=="."&&t!==".."&&t.includes("."),k8=/^\.\*+$/,T8=t=>t!=="."&&t!==".."&&t.startsWith("."),S8=/^\*+$/,C8=t=>t.length!==0&&!t.startsWith("."),A8=t=>t.length!==0&&t!=="."&&t!=="..",I8=/^\?+([^+@!?\*\[\(]*)?$/,M8=([t,e=""])=>{const n=nT([t]);return e?(e=e.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(e)):n},D8=([t,e=""])=>{const n=rT([t]);return e?(e=e.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(e)):n},N8=([t,e=""])=>{const n=rT([t]);return e?r=>n(r)&&r.endsWith(e):n},O8=([t,e=""])=>{const n=nT([t]);return e?r=>n(r)&&r.endsWith(e):n},nT=([t])=>{const e=t.length;return n=>n.length===e&&!n.startsWith(".")},rT=([t])=>{const e=t.length;return n=>n.length===e&&n!=="."&&n!==".."},iT=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",sT={win32:{sep:"\\"},posix:{sep:"/"}},P8=iT==="win32"?sT.win32.sep:sT.posix.sep;Rn.sep=P8;const Kr=Symbol("globstar **");Rn.GLOBSTAR=Kr;const L8="[^/]"+"*?",R8="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",B8="(?:(?!(?:\\/|^)\\.).)*?",F8=(t,e={})=>n=>Rn(n,t,e);Rn.filter=F8;const Qr=(t,e={})=>Object.assign({},t,e),U8=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return Rn;const e=Rn;return Object.assign((r,i,s={})=>e(r,i,Qr(t,s)),{Minimatch:class extends e.Minimatch{constructor(i,s={}){super(i,Qr(t,s))}static defaults(i){return e.defaults(Qr(t,i)).Minimatch}},AST:class extends e.AST{constructor(i,s,o={}){super(i,s,Qr(t,o))}static fromGlob(i,s={}){return e.AST.fromGlob(i,Qr(t,s))}},unescape:(r,i={})=>e.unescape(r,Qr(t,i)),escape:(r,i={})=>e.escape(r,Qr(t,i)),filter:(r,i={})=>e.filter(r,Qr(t,i)),defaults:r=>e.defaults(Qr(t,r)),makeRe:(r,i={})=>e.makeRe(r,Qr(t,i)),braceExpand:(r,i={})=>e.braceExpand(r,Qr(t,i)),match:(r,i,s={})=>e.match(r,i,Qr(t,s)),sep:e.sep,GLOBSTAR:Kr})};Rn.defaults=U8;const oT=(t,e={})=>(tp(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:i8(t));Rn.braceExpand=oT;const $8=(t,e={})=>new ip(t,e).makeRe();Rn.makeRe=$8;const H8=(t,e,n={})=>{const r=new ip(e,n);return t=t.filter(i=>r.match(i)),r.options.nonull&&!t.length&&t.push(e),t};Rn.match=H8;const aT=/[?*]|[+@!]\(.*?\)|\[|\]/,z8=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class ip{constructor(e,n={}){J(this,"options");J(this,"set");J(this,"pattern");J(this,"windowsPathsNoEscape");J(this,"nonegate");J(this,"negate");J(this,"comment");J(this,"empty");J(this,"preserveMultipleSlashes");J(this,"partial");J(this,"globSet");J(this,"globParts");J(this,"nocase");J(this,"isWindows");J(this,"platform");J(this,"windowsNoMagicRoot");J(this,"regexp");tp(e),n=n||{},this.options=n,this.pattern=e,this.platform=n.platform||iT,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const n of e)if(typeof n!="string")return!0;return!1}debug(...e){}make(){const e=this.pattern,n=this.options;if(!n.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let i=this.globParts.map((s,o,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){const l=s[0]===""&&s[1]===""&&(s[2]==="?"||!aT.test(s[2]))&&!aT.test(s[3]),c=/^[a-z]:/i.test(s[0]);if(l)return[...s.slice(0,4),...s.slice(4).map(u=>this.parse(u))];if(c)return[s[0],...s.slice(1).map(u=>this.parse(u))]}return s.map(l=>this.parse(l))});if(this.debug(this.pattern,i),this.set=i.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const o=this.set[s];o[0]===""&&o[1]===""&&this.globParts[s][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)e[r][i]==="**"&&(e[r][i]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):n>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let i=r;for(;n[i+1]==="**";)i++;i!==r&&n.splice(r,i-r)}return n})}levelOneOptimize(e){return e.map(n=>(n=n.reduce((r,i)=>{const s=r[r.length-1];return i==="**"&&s==="**"?r:i===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(i),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let i=1;i<e.length-1;i++){const s=e[i];i===1&&s===""&&e[0]===""||(s==="."||s==="")&&(n=!0,e.splice(i,1),i--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(n=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){const i=e[r-1];i&&i!=="."&&i!==".."&&i!=="**"&&(n=!0,e.splice(r-1,2),r-=2)}}while(n);return e.length===0?[""]:e}firstPhasePreProcess(e){let n=!1;do{n=!1;for(let r of e){let i=-1;for(;(i=r.indexOf("**",i+1))!==-1;){let o=i;for(;r[o+1]==="**";)o++;o>i&&r.splice(i+1,o-i);let a=r[i+1];const l=r[i+2],c=r[i+3];if(a!==".."||!l||l==="."||l===".."||!c||c==="."||c==="..")continue;n=!0,r.splice(i,1);const u=r.slice(0);u[i]="**",e.push(u),i--}if(!this.preserveMultipleSlashes){for(let o=1;o<r.length-1;o++){const a=r[o];o===1&&a===""&&r[0]===""||(a==="."||a==="")&&(n=!0,r.splice(o,1),o--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){const o=r[s-1];if(o&&o!=="."&&o!==".."&&o!=="**"){n=!0;const l=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...l),r.length===0&&r.push(""),s-=2}}}}while(n);return e}secondPhasePreProcess(e){for(let n=0;n<e.length-1;n++)for(let r=n+1;r<e.length;r++){const i=this.partsMatch(e[n],e[r],!this.preserveMultipleSlashes);if(i){e[n]=[],e[r]=i;break}}return e.filter(n=>n.length)}partsMatch(e,n,r=!1){let i=0,s=0,o=[],a="";for(;i<e.length&&s<n.length;)if(e[i]===n[s])o.push(a==="b"?n[s]:e[i]),i++,s++;else if(r&&e[i]==="**"&&n[s]===e[i+1])o.push(e[i]),i++;else if(r&&n[s]==="**"&&e[i]===n[s+1])o.push(n[s]),s++;else if(e[i]==="*"&&n[s]&&(this.options.dot||!n[s].startsWith("."))&&n[s]!=="**"){if(a==="b")return!1;a="a",o.push(e[i]),i++,s++}else if(n[s]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(a==="a")return!1;a="b",o.push(n[s]),i++,s++}else return!1;return e.length===n.length&&o}parseNegate(){if(this.nonegate)return;const e=this.pattern;let n=!1,r=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)n=!n,r++;r&&(this.pattern=e.slice(r)),this.negate=n}matchOne(e,n,r=!1){const i=this.options;if(this.isWindows){const g=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),b=!g&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),_=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),y=!_&&n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]),x=b?3:g?0:void 0,E=y?3:_?0:void 0;if(typeof x=="number"&&typeof E=="number"){const[I,v]=[e[x],n[E]];I.toLowerCase()===v.toLowerCase()&&(n[E]=I,E>x?n=n.slice(E):x>E&&(e=e.slice(x)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:n}),this.debug("matchOne",e.length,n.length);for(var o=0,a=0,l=e.length,c=n.length;o<l&&a<c;o++,a++){this.debug("matchOne loop");var u=n[a],d=e[o];if(this.debug(n,u,d),u===!1)return!1;if(u===Kr){this.debug("GLOBSTAR",[n,u,d]);var h=o,f=a+1;if(f===c){for(this.debug("** at the end");o<l;o++)if(e[o]==="."||e[o]===".."||!i.dot&&e[o].charAt(0)===".")return!1;return!0}for(;h<l;){var p=e[h];if(this.debug(`
globstar while`,e,h,n,f,p),this.matchOne(e.slice(h),n.slice(f),r))return this.debug("globstar found match!",h,l,p),!0;if(p==="."||p===".."||!i.dot&&p.charAt(0)==="."){this.debug("dot detected!",e,h,n,f);break}this.debug("globstar swallow a segment, and continue"),h++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,h,n,f),h===l))}let g;if(typeof u=="string"?(g=d===u,this.debug("string match",u,d,g)):(g=u.test(d),this.debug("pattern match",u,d,g)),!g)return!1}if(o===l&&a===c)return!0;if(o===l)return r;if(a===c)return o===l-1&&e[o]==="";throw new Error("wtf?")}braceExpand(){return oT(this.pattern,this.options)}parse(e){tp(e);const n=this.options;if(e==="**")return Kr;if(e==="")return"";let r,i=null;(r=e.match(S8))?i=n.dot?A8:C8:(r=e.match(g8))?i=(n.nocase?n.dot?x8:_8:n.dot?y8:b8)(r[1]):(r=e.match(I8))?i=(n.nocase?n.dot?D8:M8:n.dot?N8:O8)(r):(r=e.match(E8))?i=n.dot?w8:v8:(r=e.match(k8))&&(i=T8);const s=rp.fromGlob(e,this.options).toMMPattern();return i&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:i}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?L8:n.dot?R8:B8,i=new Set(n.nocase?["i"]:[]);let s=e.map(l=>{const c=l.map(u=>{if(u instanceof RegExp)for(const d of u.flags.split(""))i.add(d);return typeof u=="string"?z8(u):u===Kr?Kr:u._src});return c.forEach((u,d)=>{const h=c[d+1],f=c[d-1];u!==Kr||f===Kr||(f===void 0?h!==void 0&&h!==Kr?c[d+1]="(?:\\/|"+r+"\\/)?"+h:c[d]=r:h===void 0?c[d-1]=f+"(?:\\/|"+r+")?":h!==Kr&&(c[d-1]=f+"(?:\\/|\\/"+r+"\\/)"+h,c[d+1]=Kr))}),c.filter(u=>u!==Kr).join("/")}).join("|");const[o,a]=e.length>1?["(?:",")"]:["",""];s="^"+o+s+a+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,n=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&n)return!0;const r=this.options;this.isWindows&&(e=e.split("\\").join("/"));const i=this.slashSplit(e);this.debug(this.pattern,"split",i);const s=this.set;this.debug(this.pattern,"set",s);let o=i[i.length-1];if(!o)for(let a=i.length-2;!o&&a>=0;a--)o=i[a];for(let a=0;a<s.length;a++){const l=s[a];let c=i;if(r.matchBase&&l.length===1&&(c=[o]),this.matchOne(c,l,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(e){return Rn.defaults(e).Minimatch}}Rn.AST=rp,Rn.Minimatch=ip,Rn.escape=m8,Rn.unescape=id;class Wa extends V{constructor(e,n){super(re.SchemaValidateError,`Invalid schema for ${e}: ${n}`)}}let lT=class{constructor(){this.flavourSchemaMap=new Map,this.safeValidate=(e,n,r)=>{try{return this.validate(e,n,r),!0}catch{return!1}},this.validate=(e,n,r)=>{const i=this.flavourSchemaMap.get(e);if(!i)throw new Wa(e,Qg);const s=()=>{r==null||r.forEach(a=>{const l=this.flavourSchemaMap.get(a);if(!l)throw new Wa(a,Qg);this.validateSchema(l,i)})};if(i.model.role==="root"){if(n)throw new Wa(i.model.flavour,"Root block cannot have parent.");s();return}if(!n)throw new Wa(i.model.flavour,"None root block must have parent.");const o=this.flavourSchemaMap.get(n);if(!o)throw new Wa(n,Qg);this.validateSchema(i,o),s()}}get(e){return this.flavourSchemaMap.get(e)}get versions(){return Object.fromEntries(Array.from(this.flavourSchemaMap.values()).map(e=>[e.model.flavour,e.version]))}_matchFlavour(e,n){return Rn(e,n)||Rn(n,e)}_matchFlavourOrRole(e,n,r,i){const s=e.startsWith("@"),o=n.startsWith("@");return s&&o?e===n:s?e===`@${i}`:o?n===`@${r}`:this._matchFlavour(e,n)}_validateParent(e,n){const r=e.model.flavour,i=n.model.flavour,s=e.model.role,o=n.model.role,a=e.model.parent||["*"];return(n.model.children||["*"]).some(c=>a.some(u=>c==="*"&&u==="*"?!0:c==="*"?this._matchFlavourOrRole(u,i,s,o):u==="*"?this._matchFlavourOrRole(r,c,s,o):this._matchFlavourOrRole(r,c,s,o)&&this._matchFlavourOrRole(u,i,s,o)))}_validateRole(e,n){const r=e.model.role,i=e.model.flavour,s=n.model.flavour;if(r==="root")throw new Wa(i,`Root block cannot have parent: ${s}.`)}isValid(e,n){const r=this.flavourSchemaMap.get(e),i=this.flavourSchemaMap.get(n);if(!r||!i)return!1;try{return this.validateSchema(r,i),!0}catch{return!1}}register(e){return e.forEach(n=>{Uk.parse(n),this.flavourSchemaMap.set(n.model.flavour,n)}),this}toJSON(){return Object.fromEntries(Array.from(this.flavourSchemaMap.values()).map(e=>[e.model.flavour,{role:e.model.role,parent:e.model.parent,children:e.model.children}]))}validateSchema(e,n){if(this._validateRole(e,n),!this._validateParent(e,n))throw new Wa(e.model.flavour,`Block cannot have parent: ${n.model.flavour}.`)}};function W8(t,e){var n;let r=1;const i=(n=e.split(".").at(-1))!=null?n:"";let s=e.replace(new RegExp(`.${i}$`),` (${r}).${i}`);for(;t.has(s);)s=e.replace(new RegExp(`.${i}$`),` (${r}).${i}`),r++;return s}class j8{constructor(e){this.uploadingAssetsMap=new Map,this._assetsMap=new Map,this._names=new Set,this._pathBlobIdMap=new Map,this._blob=e.blob}cleanup(){this._assetsMap.clear(),this._names.clear()}getAssets(){return this._assetsMap}getPathBlobIdMap(){return this._pathBlobIdMap}isEmpty(){return this._assetsMap.size===0}async readFromBlob(e){if(this._assetsMap.has(e))return;const n=await this._blob.get(e);if(!n){console.error(`Blob ${e} not found in blob manager`);return}if(n instanceof File){let o=n;if(this._names.has(n.name)){const a=W8(this._names,n.name);o=new File([n],a,{type:n.type})}this._assetsMap.set(e,o),this._names.add(o.name);return}if(n.type&&n.type!=="application/octet-stream"){this._assetsMap.set(e,n);return}const r=await n.arrayBuffer(),s=await(await Promise.resolve().then(()=>ege)).fileTypeFromBuffer(r);if(s){const o=new File([n],"",{type:s.mime});this._assetsMap.set(e,o);return}this._assetsMap.set(e,n)}async writeToBlob(e){const n=this._assetsMap.get(e);if(!n)throw new V(re.TransformerError,`Blob ${e} not found in assets manager`);await this._blob.set(e,n)}}function I0(t){return t instanceof Vr?{[Lu]:!0,value:t.getValue()}:t instanceof Qt?{[rk]:!0,delta:t.yText.toDelta()}:Array.isArray(t)?t.map(I0):Da(t)?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,I0(n)])):t}function M0(t){return Array.isArray(t)?t.map(M0):typeof t=="object"&&t!=null?Reflect.has(t,Lu)?new Vr(Reflect.get(t,"value")):Reflect.has(t,rk)?new Qt(Reflect.get(t,"delta")):Object.fromEntries(Object.entries(t).map(([e,n])=>[e,M0(n)])):t}class sp{constructor(e){this.transformerConfigs=e,this._internal=sc}_propsFromSnapshot(e){return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,M0(r)]))}_propsToSnapshot(e){let n;return e instanceof Qe?n=Ha(e):n=e,Object.fromEntries(n.keys.map(r=>{const i=n.props[r];return[r,I0(i)]}))}fromSnapshot({json:e}){const{flavour:n,id:r,version:i,props:s}=e,o=this._propsFromSnapshot(s);return{id:r,flavour:n,version:i??-1,props:o}}toSnapshot({model:e}){const{id:n,flavour:r,version:i}=e,s=this._propsToSnapshot(e);return{id:n,flavour:r,version:i,props:s}}}class D0{constructor(e){this.data=e}get content(){return this.data.content}get docId(){return this.data.pageId}get workspaceId(){return this.data.workspaceId}static fromModels(e,n){const r=n.map(i=>i instanceof Qe?Ha(i):i);return new D0({content:r,workspaceId:e.workspace.id,pageId:e.id})}}const qi=$e({type:_r("block"),id:pe(),flavour:pe(),version:dn().optional(),props:o0(i0()),children:a0(()=>qi.array())}),cT=$e({type:_r("slice"),content:qi.array(),workspaceId:pe(),pageId:pe()}),Y8=$e({id:pe(),title:pe(),createDate:dn(),tags:ec(pe())}),uT=$e({type:_r("page"),meta:Y8,blocks:qi}),G8=100;class V8{constructor({blobCRUD:e,schema:n,docCRUD:r,middlewares:i=[]}){this._adapterConfigs=new Map,this._transformerConfigs=new Map,this._disposables=new hn,this._slots={beforeImport:new Ie,afterImport:new Ie,beforeExport:new Ie,afterExport:new Ie},this.blockToSnapshot=s=>{try{const o=s instanceof Qe?Ha(s):s,a=this._blockToSnapshot(o);return a?(qi.parse(a),a):void 0}catch(o){console.error("Error when transforming block to snapshot:"),console.error(o);return}},this.docToSnapshot=s=>{try{this._slots.beforeExport.next({type:"page",page:s});const o=s.root,a=this._exportDocMeta(s);if(!o)throw new V(re.TransformerError,"Root block not found in doc");const l=this.blockToSnapshot(Ha(o));if(!l)return;const c={type:"page",meta:a,blocks:l};return this._slots.afterExport.next({type:"page",page:s,snapshot:c}),uT.parse(c),c}catch(o){console.error("Error when transforming doc to snapshot:"),console.error(o);return}},this.sliceToSnapshot=s=>{try{this._slots.beforeExport.next({type:"slice",slice:s});const{content:o,pageId:a,workspaceId:l}=s.data,c=[];for(const d of o){const h=this.blockToSnapshot(d);if(!h)return;c.push(h)}const u={type:"slice",workspaceId:l,pageId:a,content:c};return this._slots.afterExport.next({type:"slice",slice:s,snapshot:u}),cT.parse(u),u}catch(o){console.error("Error when transforming slice to snapshot:"),console.error(o);return}},this.snapshotToBlock=async(s,o,a,l)=>{try{qi.parse(s);const c=await this._snapshotToBlock(s,o,a,l);return c||void 0}catch(c){console.error("Error when transforming snapshot to block:"),console.error(c);return}},this.snapshotToDoc=async s=>{try{this._slots.beforeImport.next({type:"page",snapshot:s}),uT.parse(s);const{meta:o,blocks:a}=s,l=this.docCRUD.create(o.id);return l.load(),await this.snapshotToBlock(a,l),this._slots.afterImport.next({type:"page",snapshot:s,page:l}),l}catch(o){console.error("Error when transforming snapshot to doc:"),console.error(o);return}},this.snapshotToModelData=async s=>{try{const{children:o,flavour:a,props:l,id:c}=s,u=this._getSchema(a),d={id:c,flavour:a,props:l};return await this._getTransformer(u).fromSnapshot({json:d,assets:this._assetsManager,children:o})}catch(o){console.error("Error when transforming snapshot to model data:"),console.error(o);return}},this.snapshotToSlice=async(s,o,a,l)=>{var c;try{cT.parse(s),this._slots.beforeImport.next({type:"slice",snapshot:s});const{content:u,workspaceId:d,pageId:h}=s,f={id:"temporary-root",flavour:"affine:page",props:{},type:"block",children:u};for(const x of u)this._triggerBeforeImportEvent(x,a,l);const p=[];this._flattenSnapshot(f,p,a,l);const g=await this._convertFlatSnapshots(p),b=u[0];if(b&&o.hasBlock(b.id)){const x=u.map(v=>{var N;return(N=o.getBlock(v.id))==null?void 0:N.model}).filter(Boolean),E=a?(c=o.getBlock(a))==null?void 0:c.model:void 0;if(!E)throw new V(re.TransformerError,"Parent block not found in doc when moving slice");const I=l!==void 0?E.children[l]:null;o.moveBlocks(x,E,I)}else await this._insertBlockTree(g.children,o,a,l);const _=g.children.map(x=>o.getModelById(x.draft.id)).filter(x=>x!==null).map(x=>Ha(x)),y=new D0({content:_,workspaceId:d,pageId:h});return this._slots.afterImport.next({type:"slice",snapshot:s,slice:y}),y}catch(u){console.error("Error when transforming snapshot to slice:"),console.error(u);return}},this.walk=(s,o)=>{const a=l=>{try{o(l)}catch(c){console.error("Error when walking snapshot:"),console.error(c)}l.children&&l.children.forEach(a)};a(s.blocks)},this._assetsManager=new j8({blob:e}),this._schema=n,this._docCRUD=r,i.forEach(s=>{const o=s({slots:this._slots,docCRUD:this._docCRUD,assetsManager:this._assetsManager,adapterConfigs:this._adapterConfigs,transformerConfigs:this._transformerConfigs});o&&this._disposables.add(o)})}get adapterConfigs(){return this._adapterConfigs}get assets(){return this._assetsManager.getAssets()}get assetsManager(){return this._assetsManager}get schema(){return this._schema}get docCRUD(){return this._docCRUD}_blockToSnapshot(e){this._slots.beforeExport.next({type:"block",model:e});const n=this._getSchema(e.flavour),i=this._getTransformer(n).toSnapshot({model:e,assets:this._assetsManager}),s=e.children.map(a=>this._blockToSnapshot(a)).filter(Boolean),o={type:"block",...i,children:s};return this._slots.afterExport.next({type:"block",model:e,snapshot:o}),o}async _convertFlatSnapshots(e){const n=[];for(const s of e){const o=await this._convertSnapshotToDraftModel(s);o&&(o.id=s.snapshot.id),n.push({draft:o,snapshot:s.snapshot,parentId:s.parentId,index:s.index})}const r=n.filter(s=>!!s.draft);return this._rebuildBlockTree(r)}async _convertSnapshotToDraftModel(e){try{const{children:n,flavour:r}=e.snapshot,i=this._getSchema(r),s=this._getTransformer(i),{props:o}=await s.fromSnapshot({json:{id:e.snapshot.id,flavour:e.snapshot.flavour,props:e.snapshot.props},assets:this._assetsManager,children:n});return{id:e.snapshot.id,flavour:e.snapshot.flavour,children:[],props:o}}catch(n){console.error("Error when transforming snapshot to model data:"),console.error(n);return}}_exportDocMeta(e){const n=e.meta;if(!n)throw new V(re.TransformerError,"Doc meta not found");return{id:n.id,title:n.title,createDate:n.createDate,tags:[]}}_flattenSnapshot(e,n,r,i){n.push({snapshot:e,parentId:r,index:i}),e.children&&e.children.forEach((s,o)=>{this._flattenSnapshot(s,n,e.id,o)})}_getSchema(e){const n=this.schema.flavourSchemaMap.get(e);if(!n)throw new V(re.TransformerError,`Flavour schema not found for ${e}`);return n}_getTransformer(e){var n,r;return(r=(n=e.transformer)==null?void 0:n.call(e,this._transformerConfigs))!=null?r:new sp(this._transformerConfigs)}async _insertBlockTree(e,n,r,i,s=0){var o;for(let a=0;a<e.length;a++){const l=e[a],{draft:c}=l,{id:u,flavour:d,props:h}=c,f=i!==void 0?i+a:void 0;n.addBlock(d,{id:u,...h},r,f);const p=(o=n.getBlock(u))==null?void 0:o.model;if(!p)throw new V(re.TransformerError,`Block not found by id ${u}`);this._slots.afterImport.next({type:"block",model:p,snapshot:l.snapshot}),s++,s%G8===0&&await zv(),l.children.length>0&&(s=await this._insertBlockTree(l.children,n,u,void 0,s))}return s}_rebuildBlockTree(e){const n=new Map;e.forEach(({draft:i,snapshot:s})=>{n.set(i.id,{draft:i,snapshot:s,children:[]})});const r=n.get(e[0].draft.id);if(e.forEach(({draft:i,parentId:s,index:o})=>{const a=n.get(i.id);if(a&&s){const l=n.get(s);l&&o!==void 0&&(l.children[o]=a)}}),!r)throw new Error("No root node found in the tree");return r}async _snapshotToBlock(e,n,r,i){var s,o;this._triggerBeforeImportEvent(e,r,i);const a=[];this._flattenSnapshot(e,a,r,i);const l=await this._convertFlatSnapshots(a);return await this._insertBlockTree([l],n,r,i),(o=(s=n.getBlock(e.id))==null?void 0:s.model)!=null?o:null}_triggerBeforeImportEvent(e,n,r){const i=(s,o,a)=>{this._slots.beforeImport.next({type:"block",snapshot:s,parent:o,index:a}),s.children&&s.children.forEach((l,c)=>{i(l,s.id,c)})};i(e,n,r)}reset(){this._assetsManager.cleanup()}[Symbol.dispose](){this._disposables.dispose(),this._assetsManager.cleanup()}}class q8{constructor(e,n){this._yBlocks=e,this._schema=n}get root(){let e=null;return this._yBlocks.forEach(n=>{const r=n.get("sys:flavour"),i=this._schema.flavourSchemaMap.get(r);i&&i.model.role==="root"&&(e=n.get("sys:id"))}),e}_getSiblings(e,n){const r=this.getParent(e);if(!r)return null;const i=this._yBlocks.get(r);if(!i)return null;const o=i.get("sys:children").toArray().indexOf(e);return o===-1?null:n(o,i)}addBlock(e,n,r={},i,s){var o,a,l,c,u;const d=this._schema.flavourSchemaMap.get(n);if(!d)throw new V(re.ModelCRUDError,`schema for flavour: ${n} not found`);if(this._yBlocks.has(e))throw new V(re.ModelCRUDError,`Should not add existing block: ${e}`);const f=i?(o=this._yBlocks.get(i))==null?void 0:o.get("sys:flavour"):void 0;this._schema.validate(n,f);const p=new at;this._yBlocks.set(e,p);const g=d.version,b=(a=r.children)==null?void 0:a.map(L=>typeof L=="string"?L:L.id);p.set("sys:id",e),p.set("sys:flavour",n),p.set("sys:version",g),p.set("sys:children",sr.from(b??[]));const y={...(u=(c=(l=d.model).props)==null?void 0:c.call(l,sc))!=null?u:{},...r};if(delete y.id,delete y.flavour,delete y.children,d.model.isFlatData){const L=(z,M)=>{Da(z)?Object.entries(z).forEach(([B,$])=>{const se=M?`${M}.${B}`:B;L($,se)}):p.set(`prop:${M}`,Xr(z))};L(y,"")}else Object.entries(y).forEach(([L,z])=>{z!==void 0&&p.set(`prop:${L}`,Xr(z))});const E=i??(d.model.role==="root"?null:this.root);if(!E)return;const I=this._yBlocks.get(E);if(!I)return;const v=I.get("sys:children"),N=s!=null?s>v.length?v.length:s:v.length;v.insert(N,[e])}deleteBlock(e,n={deleteChildren:!0}){const{bringChildrenTo:r,deleteChildren:i}=n;if(r&&i){console.error("Cannot bring children to another block and delete them at the same time");return}const s=this._yBlocks.get(e);if(!s)return;const o=s.get("sys:children"),a=this.getParent(e);if(!a)return;const c=this._yBlocks.get(a).get("sys:children"),u=c.toArray().indexOf(e);u>-1&&c.delete(u,1),(()=>{if(r){(()=>{if(!r)throw new V(re.ModelCRUDError,"bringChildrenTo is not provided when deleting block");const f=this._yBlocks.get(r);if(!f)return;const p=f.get("sys:flavour");if(o.forEach(_=>{const y=this._yBlocks.get(_);y&&this._schema.validate(y.get("sys:flavour"),p)}),r===a){c.insert(u,o.toArray());return}const g=this._yBlocks.get(r);if(!g)return;g.get("sys:children").push(o.toArray())})();return}if(i){const h=f=>{this._yBlocks.get(f).get("sys:children").forEach(b=>h(b)),this._yBlocks.delete(f)};o.forEach(f=>h(f))}})(),this._yBlocks.delete(e)}getNext(e){return this._getSiblings(e,(n,r)=>{var i;return(i=r.get("sys:children").toArray().at(n+1))!=null?i:null})}getParent(e){const n=this.root;if(!n||n===e)return null;const r=i=>{const s=this._yBlocks.get(i);if(!s)return null;const o=s.get("sys:children");for(const a of o.toArray()){if(a===e)return i;const l=r(a);if(l!=null)return l}return null};return r(n)}getPrev(e){return this._getSiblings(e,(n,r)=>{var i;return(i=r.get("sys:children").toArray().at(n-1))!=null?i:null})}moveBlocks(e,n,r=null,i=!0){if(e.length>1&&r&&e.includes(r)){console.error("Cannot move blocks when the target sibling is in the blocks to move");return}if(e.length===1&&r===e[0])return;if(e.includes(n)){console.error("Cannot move blocks when the new parent is in the blocks to move");return}const s=new Map,o=this._yBlocks.get(n);if(!o)return;const a=o.get("sys:flavour");e.forEach(c=>{const u=this.getParent(c);if(!u)return;const d=this._yBlocks.get(c);if(!d)return;this._schema.validate(d.get("sys:flavour"),a);const h=s.get(u);if(!h){s.set(u,[c]);return}const f=h[h.length-1];if(this.getNext(f)!==c)throw new V(re.ModelCRUDError,"The blocks to move are not contiguous under their parent");h.push(c)});let l=0;Array.from(s.entries()).forEach(([c,u],d)=>{const h=this._yBlocks.get(n);if(!h)return;const f=h.get("sys:children"),p=this._yBlocks.get(c);if(!p)return;const g=p.get("sys:children"),b=g.toArray().findIndex(y=>y===u[0]);g.delete(b,u.length),(()=>{if(!(d===0)){l++;return}if(!r){l=f.length;return}let x=f.toArray().findIndex(E=>E===r);x===-1&&(console.error("Target sibling not found, just insert to the end"),x=f.length),l=i?x:x+1})(),f.insert(l,u)})}updateBlockChildren(e,n){const r=this._yBlocks.get(e);if(!r)return;const i=r.get("sys:children");i.delete(0,i.length),i.push(n)}}function X8(t,e,n,r){var i,s,o;const a=(o=(s=(i=t.model).props)==null?void 0:s.call(i,sc))!=null?o:{};Object.entries(r).forEach(([l,c])=>{ik.has(l)||c!==void 0&&(e.props[l]=c)}),Object.entries(a).forEach(([l,c])=>{(!n.has(`prop:${l}`)||n.get(`prop:${l}`)===void 0)&&(e[l]=c)})}const K8=[T0,k0];class N0{constructor({readonly:e,query:n,provider:r,extensions:i}){this.disposableGroup=new hn,this._shouldTransact=!0,this._runQuery=a=>{qB(this._query,a)},this._blocks=un({}),this._query={match:[],mode:"loose"},this._readonly=un(!1),this._isEmpty=Os(()=>{var a,l;return(l=(a=this.root)==null?void 0:a.isEmpty())!=null?l:!0}),this.undo=()=>{if(this.readonly){console.error("cannot undo in readonly mode");return}this._history.undoManager.undo()},this.redo=()=>{if(this.readonly){console.error("cannot undo in readonly mode");return}this._history.undoManager.redo()},this.resetHistory=()=>this._history.undoManager.clear(),this.captureSync=()=>{this._history.undoManager.stopCapturing()},this._isDisposed=!1,this._subscribeToSlots=()=>{this.disposableGroup.add(this.slots.yBlockUpdated.subscribe(({type:a,id:l,isLocal:c})=>{switch(a){case"add":{this._onBlockAdded(l,c,!1);return}case"delete":{this._onBlockRemoved(l,c);return}}})),this.disposableGroup.add(this.slots.ready),this.disposableGroup.add(this.slots.blockUpdated),this.disposableGroup.add(this.slots.rootAdded),this.disposableGroup.add(this.slots.rootDeleted)},this._handleYEvents=a=>{a.forEach(l=>this._handleYEvent(l))},this.slots={ready:new Ie,rootAdded:new Ie,rootDeleted:new Ie,blockUpdated:new Ie,yBlockUpdated:new Ie},this._schema=new lT;const s=new ed;s.addImpl(zk,()=>this),K8.forEach(a=>{a.setup(s)});const o=i??[];this.userExtensions=o,o.forEach(a=>{a.setup(s)}),this._provider=s.provider(void 0,r),this._provider.getAll(Vk).forEach(a=>{this._schema.register([a])}),this._doc=this._provider.get(Xk),this._crud=new q8(this._yBlocks,this._schema),e!==void 0&&(this._readonly.value=e),n&&(this._query=n),this._yBlocks.observeDeep(this._handleYEvents),this._yBlocks.forEach((a,l)=>{this._handleYBlockAdd(l,!1),!(l in this._blocks.peek())&&this._onBlockAdded(l,!1,!0)}),this._subscribeToSlots()}get id(){return this._doc.id}get _yBlocks(){return this._doc.yBlocks}get awarenessStore(){return this._doc.awarenessStore}get provider(){return this._provider}get blobSync(){return this.workspace.blobSync}get doc(){return this._doc}get blocks(){return this._blocks}get blockSize(){return Object.values(this._blocks.peek()).length}get canRedo(){return this.readonly?!1:this._history.canRedo}get canUndo(){return this.readonly?!1:this._history.canUndo}transact(e,n=this._shouldTransact){const r=this._doc.spaceDoc;r.transact(()=>{try{e()}catch(i){console.error(`An error occurred while Y.doc ${r.guid} transacting:`),console.error(i)}},n?this.spaceDoc.clientID:null)}withoutTransact(e){this._shouldTransact=!1,e(),this._shouldTransact=!0}get workspace(){return this._doc.workspace}get history(){return this._history}get isEmpty(){return this._isEmpty.peek()}get isEmpty$(){return this._isEmpty}get loaded(){return this._doc.loaded}get meta(){return this._doc.meta}get readonly(){return this._readonly.value===!0}get readonly$(){return this._readonly}set readonly(e){this._readonly.value=e}get ready(){return this._doc.ready}get root(){var e,n;const r=this._crud.root;return r&&(n=(e=this.getBlock(r))==null?void 0:e.model)!=null?n:null}get rootDoc(){return this._doc.rootDoc}get schema(){return this._schema}get spaceDoc(){return this._doc.spaceDoc}get _history(){return this._provider.get(k0)}_getSiblings(e,n){var r;const i=this.getParent(e);if(!i)return null;const s=typeof e=="string"?(r=this.getBlock(e))==null?void 0:r.model:e;if(!s)return null;const o=i.children.indexOf(s);return o===-1?null:n(i,o)}_onBlockAdded(e,n,r){try{if(e in this._blocks.peek())return;const i=this._yBlocks.get(e);if(!i){console.warn(`Could not find block with id ${e}`);return}const s={onChange:(a,l,c)=>{l&&a.model.propsUpdated.next({key:l}),this.slots.blockUpdated.next({type:"update",id:e,flavour:a.flavour,props:{key:l},isLocal:c})}},o=new RB(this._schema,i,this,s);this._runQuery(o),this._blocks.value={...this._blocks.value,[e]:o},o.model.created.next(),o.model.role==="root"&&this.slots.rootAdded.next(e),this.slots.blockUpdated.next({type:"add",id:e,init:r,flavour:o.model.flavour,model:o.model,isLocal:n})}catch(i){console.error("An error occurred while adding block:"),console.error(i)}}_onBlockRemoved(e,n){var r,i;try{const s=this.getBlock(e);if(!s)return;s.model.role==="root"&&this.slots.rootDeleted.next(e),this.slots.blockUpdated.next({type:"delete",id:e,flavour:s.flavour,parent:(i=(r=this.getParent(s.model))==null?void 0:r.id)!=null?i:"",model:s.model,isLocal:n});const{[e]:o,...a}=this._blocks.peek();this._blocks.value=a,s.model.deleted.next(),s.model.dispose()}catch(s){console.error("An error occurred while removing block:"),console.error(s)}}addBlock(e,n={},r,i){var s;if(this.readonly)throw new V(re.ModelCRUDError,"cannot modify data in readonly mode");const o=(s=n.id)!=null?s:this._doc.workspace.idGenerator();return this.transact(()=>{this._crud.addBlock(o,e,{...n},typeof r=="string"?r:r==null?void 0:r.id,i)}),o}addBlocks(e,n,r){const i=[];return e.forEach(s=>{var o;const a=this.addBlock(s.flavour,(o=s.blockProps)!=null?o:{},n,r);i.push(a),typeof r=="number"&&r++}),i}addSiblingBlocks(e,n,r="after"){var i,s;if(!n.length)return[];const o=this.getParent(e);if(!o)return[];const a=(i=o.children.findIndex(({id:u})=>u===e.id))!=null?i:0,l=r==="before"?a:a+1;if(n.length<=1){if(!((s=n[0])!=null&&s.flavour))return[];const{flavour:u,...d}=n[0];return[this.addBlock(u,d,o.id,l)]}const c=[];return n.forEach(u=>{const{flavour:d,...h}=u;d&&c.push({flavour:d,blockProps:h})}),this.addBlocks(c,o.id,l)}updateBlock(e,n){var r,i;if(this.readonly){console.error("cannot modify data in readonly mode");return}const s=typeof n=="function",o=typeof e=="string"?(r=this.getBlock(e))==null?void 0:r.model:e;if(!o)throw new V(re.ModelCRUDError,`updating block: ${e} not found`);if(!s){const c=this.getParent(o);this.schema.validate(o.flavour,c==null?void 0:c.flavour,(i=n.children)==null?void 0:i.map(u=>u.flavour))}const a=this._yBlocks.get(o.id);if(!a)throw new V(re.ModelCRUDError,`updating block: ${o.id} not found`);const l=this.getBlock(o.id);l&&this.transact(()=>{if(s){n(),this._runQuery(l);return}n.children&&this._crud.updateBlockChildren(o.id,n.children.map(u=>u.id));const c=this.schema.flavourSchemaMap.get(o.flavour);if(!c)throw new V(re.ModelCRUDError,`schema for flavour: ${o.flavour} not found`);X8(c,o,a,n),this._runQuery(l)})}deleteBlock(e,n={deleteChildren:!0}){if(this.readonly){console.error("cannot modify data in readonly mode");return}const r=n&&n.bringChildrenTo?{...n,bringChildrenTo:n.bringChildrenTo.id}:n;this.transact(()=>{this._crud.deleteBlock(typeof e=="string"?e:e.id,r)})}getBlock(e){return this._blocks.peek()[e]}getBlock$(e){return this._blocks.value[e]}getModelById(e){var n,r;return(r=(n=this.getBlock(e))==null?void 0:n.model)!=null?r:null}getBlocksByFlavour(e){const n=typeof e=="string"?[e]:e;return Object.values(this._blocks.peek()).filter(({flavour:r})=>n.includes(r))}getAllModels(){return Object.values(this._blocks.peek()).map(e=>e.model)}getModelsByFlavour(e){return this.getBlocksByFlavour(e).map(n=>n.model)}getParent(e){const n=typeof e=="string"?e:e.id,r=this._crud.getParent(n);if(!r)return null;const i=this._blocks.peek()[r];return i?i.model:null}getPrev(e){return this._getSiblings(e,(n,r)=>{var i;return(i=n.children[r-1])!=null?i:null})}getPrevs(e){var n;return(n=this._getSiblings(e,(r,i)=>r.children.slice(0,i)))!=null?n:[]}getNext(e){return this._getSiblings(e,(n,r)=>{var i;return(i=n.children[r+1])!=null?i:null})}getNexts(e){var n;return(n=this._getSiblings(e,(r,i)=>r.children.slice(i+1)))!=null?n:[]}hasBlock(e){return e in this._blocks.peek()}moveBlocks(e,n,r=null,i=!0){if(this.readonly){console.error("Cannot modify data in read-only mode");return}this.transact(()=>{var s;this._crud.moveBlocks(e.map(o=>o.id),n.id,(s=r==null?void 0:r.id)!=null?s:null,i)})}getTransformer(e=[]){return new V8({schema:this.schema,blobCRUD:this.workspace.blobSync,docCRUD:{create:n=>this.workspace.createDoc(n).getStore({id:n}),get:n=>{var r,i;return(i=(r=this.workspace.getDoc(n))==null?void 0:r.getStore({id:n}))!=null?i:null},delete:n=>this.workspace.removeDoc(n)},middlewares:e})}get get(){return this.provider.get.bind(this.provider)}get getOptional(){return this.provider.getOptional.bind(this.provider)}load(e){var n,r;return this._isDisposed&&(this.disposableGroup=new hn,this._subscribeToSlots(),this._isDisposed=!1),this._doc.load(e),this._provider.getAll(w0).forEach(i=>{i.loaded()}),this.slots.ready.next(),this.slots.rootAdded.next((r=(n=this.root)==null?void 0:n.id)!=null?r:""),this}dispose(){this._provider.getAll(w0).forEach(e=>{e.disposed()}),this._doc.ready&&this._yBlocks.unobserveDeep(this._handleYEvents),this.slots.ready.complete(),this.slots.rootAdded.complete(),this.slots.rootDeleted.complete(),this.slots.blockUpdated.complete(),this.slots.yBlockUpdated.complete(),this.disposableGroup.dispose(),this._isDisposed=!0}_handleYBlockAdd(e,n){this.slots.yBlockUpdated.next({type:"add",id:e,isLocal:n})}_handleYBlockDelete(e,n){this.slots.yBlockUpdated.next({type:"delete",id:e,isLocal:n})}_handleYEvent(e){if(e.target!==this._yBlocks)return;const n=!e.transaction.origin||!this._yBlocks.doc||e.transaction.origin instanceof Sa||e.transaction.origin.proxy?!0:e.transaction.origin===this._yBlocks.doc.clientID;e.keys.forEach((r,i)=>{try{if(r.action==="add"){this._handleYBlockAdd(i,n);return}if(r.action==="delete"){this._handleYBlockDelete(i,n);return}}catch(s){console.error("An error occurred while handling Yjs event:"),console.error(s)}})}}class Q8{constructor(e){this.doc=e,this._storeMap=new Map,this.getStore=({readonly:n,query:r,provider:i,extensions:s,id:o}={})=>{let a;n||r?a={readonly:n,query:r}:o?a=o:a=this.doc.workspace.idGenerator();const l=this._getQueryKey(a);if(this._storeMap.has(l))return this._storeMap.get(l);const c={setup:d=>{d.addImpl(Xk,()=>this.doc)}},u=new N0({doc:this.doc,readonly:n,query:r,provider:i,extensions:[c].concat(s??[])});return this._storeMap.set(l,u),u},this.removeStore=({readonly:n,query:r,id:i})=>{let s;if(n||r)s={readonly:n,query:r};else if(i)s=i;else return;const o=this._getQueryKey(s);this._storeMap.delete(o)},this._getQueryKey=n=>{if(typeof n=="string")return n;const{readonly:r,query:i}=n,s=this._getReadonlyKey(r);return JSON.stringify({readonlyKey:s,query:i})}}_getReadonlyKey(e){var n;return(n=e==null?void 0:e.toString())!=null?n:"false"}}class Z8{constructor(){this._defaultProp="children",this._globalContext=Object.create(null),this._stack=[],this._skip=!1,this._skipChildrenNum=0,this.setDefaultProp=e=>{this._defaultProp=e}}get stack(){return this._stack}current(){return this._stack[this._stack.length-1]}cleanGlobalContextStack(e){this._globalContext[e]instanceof Array&&(this._globalContext[e]=[])}closeNode(){const e=this._stack.pop();if(!e)return this;const n=this._stack.pop();return n?(n.node[e.prop]instanceof Array&&n.node[e.prop].push(e.node),this._stack.push(n),this):(this._stack.push(e),this)}currentNode(){var e;return(e=this.current())==null?void 0:e.node}getGlobalContext(e){return this._globalContext[e]}getGlobalContextStack(e){const n=this._globalContext[e];return n instanceof Array?n:[]}getNodeContext(e){return this.current().context[e]}getPreviousNodeContext(e){var n;return(n=this._stack[this._stack.length-2])==null?void 0:n.context[e]}openNode(e,n){return this._stack.push({node:e,prop:n??this._defaultProp,context:Object.create(null)}),this}previousNode(){var e;return(e=this._stack[this._stack.length-2])==null?void 0:e.node}pushGlobalContextStack(e,n){const r=this._globalContext[e];r instanceof Array?r.push(n):this._globalContext[e]=[n]}setGlobalContext(e,n){return this._globalContext[e]=n,this}setGlobalContextStack(e,n){this._globalContext[e]=n}setNodeContext(e,n){return this._stack[this._stack.length-1].context[e]=n,this}skipAllChildren(){this._skip=!0}skipChildren(e=1){this._skipChildrenNum=e}}function J8(t){var e;((e=t.content[0])==null?void 0:e.flavour)!=="affine:note"&&(t.content=[{type:"block",id:"",flavour:"affine:note",props:{},children:t.content}])}class oc{constructor(e,n){this.provider=n,this.job=e}get configs(){return this.job.adapterConfigs}async fromBlock(e){try{const n=e instanceof Qe?Ha(e):e,r=this.job.blockToSnapshot(n);return r?await this.fromBlockSnapshot({snapshot:r,assets:this.job.assetsManager}):void 0}catch(n){console.error("Cannot convert block to snapshot"),console.error(n);return}}async fromDoc(e){try{const n=this.job.docToSnapshot(e);return n?await this.fromDocSnapshot({snapshot:n,assets:this.job.assetsManager}):void 0}catch(n){console.error("Cannot convert doc to snapshot"),console.error(n);return}}async fromSlice(e){try{const n=this.job.sliceToSnapshot(e);return n?(J8(n),await this.fromSliceSnapshot({snapshot:n,assets:this.job.assetsManager})):void 0}catch(n){console.error("Cannot convert slice to snapshot"),console.error(n);return}}async toBlock(e,n,r,i){try{const s=await this.toBlockSnapshot(e);return s?await this.job.snapshotToBlock(s,n,r,i):void 0}catch(s){console.error("Cannot convert block snapshot to block"),console.error(s);return}}async toDoc(e){try{const n=await this.toDocSnapshot(e);return n?await this.job.snapshotToDoc(n):void 0}catch(n){console.error("Cannot convert doc snapshot to doc"),console.error(n);return}}async toSlice(e,n,r,i){try{const s=await this.toSliceSnapshot(e);return s?await this.job.snapshotToSlice(s,n,r,i):void 0}catch(s){console.error("Cannot convert slice snapshot to slice"),console.error(s);return}}}class Co{constructor(){this._visit=async e=>{var n;if(e.node){if(this.context._skipChildrenNum=0,this.context._skip=!1,this._enter&&await this._enter(e,this.context),this.context._skip){this._leave&&await this._leave(e,this.context);return}for(const r in e.node){const i=e.node[r];if(i&&typeof i=="object")if(Array.isArray(i))for(let s=this.context._skipChildrenNum;s<i.length;s+=1){const o=i[s];if(o!==null&&typeof o=="object"&&this._isONode(o)){const a=(n=i[s+1])!=null?n:null;await this._visit({node:o,next:a,parent:e,prop:r,index:s})}}else this.context._skipChildrenNum===0&&this._isONode(i)&&await this._visit({node:i,next:null,parent:e,prop:r,index:null})}this._leave&&await this._leave(e,this.context)}},this.setEnter=e=>{this._enter=e},this.setLeave=e=>{this._leave=e},this.setONodeTypeGuard=e=>{this._isONode=e},this.walk=async(e,n)=>{if(this.context.openNode(n),await this._visit({node:e,parent:null,prop:null,index:null}),this.context.stack.length!==1)throw new V(1,"There are unclosed nodes");return this.context.currentNode()},this.walkONode=async e=>{await this._visit({node:e,parent:null,prop:null,index:null})},this.context=new Z8}}class e9{constructor(e){this.awareness=e,this.awareness.setLocalStateField("selectionV2",{})}destroy(){this.awareness.destroy()}getLocalSelection(e){var n,r,i;return(i=((r=(n=this.awareness.getLocalState())==null?void 0:n.selectionV2)!=null?r:{})[e])!=null?i:[]}getStates(){return this.awareness.getStates()}getLocalState(){return this.awareness.getLocalState()}setLocalState(e){this.awareness.setLocalState(e)}setLocalStateField(e,n){this.awareness.setLocalStateField(e,n)}setLocalSelection(e,n){var r,i;const s=(i=(r=this.awareness.getLocalState())==null?void 0:r.selectionV2)!=null?i:{};this.awareness.setLocalStateField("selectionV2",{...s,[e]:n})}}function t9(t,e,n){const r=new Set,i=s=>{r.has(s)||(r.add(s),!(e&&e(s))&&gr(s)&&s.childElements.forEach(o=>{i(o)}))};i(t)}function dT(t){const e=[];return t.childElements.forEach(n=>{t9(n,r=>{e.push(r)})}),e}function hT(t,e){let n=e.group;for(;n;){if(n===t)return!0;n=n.group}return!1}function O0(t,e){return!(e===t||gr(e)&&e.hasDescendant(t))}function P0(t){return t.groups.some(op)}function op(t){var e;return(e=t.lockedBySelf)!=null?e:!1}function fT(t){return op(t)||P0(t)}function pT(t,e){t.transact(()=>{e.lockedBySelf=!0})}function mT(t,e){t.transact(()=>{e.lockedBySelf=!1})}class Zr extends Qe{constructor(){super(...arguments),this._cacheDeserKey=null,this._cacheDeserXYWH=null,this._externalXYWH=void 0,this.connectable=!0,this.responseExtension=[0,0]}get xywh(){return this.props.xywh}get xywh$(){return this.props.xywh$}set xywh(e){this.props.xywh=e}get index(){return this.props.index}get index$(){return this.props.index$}set index(e){this.props.index=e}get lockedBySelf(){return this.props.lockedBySelf}get lockedBySelf$(){return this.props.lockedBySelf$}set lockedBySelf(e){this.props.lockedBySelf=e}get rotate(){return"rotate"in this.props?this.props.rotate:0}set rotate(e){"rotate"in this.props&&(this.props.rotate=e)}get deserializedXYWH(){return(this._cacheDeserKey!==this.xywh||!this._cacheDeserXYWH)&&(this._cacheDeserKey=this.xywh,this._cacheDeserXYWH=Ml(this.xywh)),this._cacheDeserXYWH}get elementBound(){return X.from(mo(this))}get externalBound(){return this._externalXYWH?X.deserialize(this._externalXYWH):null}get externalXYWH(){return this._externalXYWH}set externalXYWH(e){this._externalXYWH=e}get group(){var e;return this.surface&&(e=this.surface.getGroup(this.id))!=null?e:null}get groups(){return this.surface?this.surface.getGroups(this.id):[]}get h(){return this.deserializedXYWH[3]}get responseBound(){return this.elementBound.expand(this.responseExtension)}get surface(){const e=this.store.getBlocksByFlavour("affine:surface");return e.length===0?null:e[0].model}get w(){return this.deserializedXYWH[2]}get x(){return this.deserializedXYWH[0]}get y(){return this.deserializedXYWH[1]}containsBound(e){const n=X.deserialize(this.xywh);return Ke({x:n.x,y:n.y,w:n.w,h:n.h,rotate:this.rotate}).some(i=>e.containsPoint(i))}getLineIntersections(e,n){var r;const i=X.deserialize(this.xywh);return Ri(e,n,Or(i.points,i.center,(r=this.rotate)!=null?r:0))}getNearestPoint(e){var n;const r=X.deserialize(this.xywh);return fo(Or(r.points,r.center,(n=this.rotate)!=null?n:0),e)}getRelativePointLocation(e){var n,r;const i=X.deserialize(this.xywh),s=i.getRelativePoint(e),o=Or([s],i.center,(n=this.rotate)!=null?n:0)[0],a=Or(i.points,i.center,(r=this.rotate)!=null?r:0),l=Cl(a,o);return new wt(o,l)}includesPoint(e,n,r,i){return(r.useElementBound?this.elementBound:this.responseBound).isPointInBound([e,n],0)}intersectsBound(e){return this.containsBound(e)||e.points.some((n,r,i)=>this.getLineIntersections(n,i[(r+1)%i.length]))}isLocked(){return fT(this)}isLockedByAncestor(){return P0(this)}isLockedBySelf(){return op(this)}lock(){pT(this.store,this)}unlock(){mT(this.store,this)}}function $s(t){if(t===Qe)return Zr;{let e=t;for(;Object.getPrototypeOf(e.prototype)!==Qe.prototype&&Object.getPrototypeOf(e.prototype)!==null;)e=Object.getPrototypeOf(e.prototype).constructor;if(Object.getPrototypeOf(e.prototype)===null)throw new V(re.GfxBlockElementError,"The SuperClass is not a subclass of BlockModel");Object.setPrototypeOf(e.prototype,Zr.prototype)}return t}var n9=Object.create,gT=Object.defineProperty,r9=Object.getOwnPropertyDescriptor,i9=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),sd=t=>{throw TypeError(t)},s9=(t,e,n)=>e in t?gT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,o9=t=>{var e;return[,,,n9((e=void 0)!=null?e:null)]},bT=["class","method","getter","setter","accessor","field","value","get","set"],od=t=>t!==void 0&&typeof t!="function"?sd("Function expected"):t,a9=(t,e,n,r,i)=>({kind:bT[t],name:e,metadata:r,addInitializer:s=>n._?sd("Already initialized"):i.push(od(s||null))}),l9=(t,e)=>s9(e,i9("metadata"),t[3]),Vn=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Ao=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=bT[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,r9({get[n](){return c9(this,s)},set[n](E){return u9(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=a9(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?od(a)&&(y[g]=a):typeof a!="object"||a===null?sd("Object expected"):(od(o=a.get)&&(y.get=o),od(o=a.set)&&(y.set=o),od(o=a.init)&&b.unshift(o));return y&&gT(i,n,y),i},yT=(t,e,n)=>e.has(t)||sd("Cannot "+n),c9=(t,e,n)=>(yT(t,e,"read from private field"),e.get(t)),Io=(t,e,n)=>e.has(t)?sd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),u9=(t,e,n,r)=>(yT(t,e,"write to private field"),e.set(t,n),n),_T,xT,ET,vT,wT,kT,TT,ST,yt,L0,R0,B0,F0,U0,$0,H0,z0;function _t(){return function(e,n){const r=n.name;return{init(i){this._props.add(r),this._local.set(r,i)},get(){return this._local.get(r)},set(i){this._local.set(r,i)}}}}ST=[_t()],TT=[_t()],kT=[_t()],wT=[_t()],vT=[_t()],ET=[_t()],xT=[_t()],_T=[_t()];class Ht{constructor(e){this._mutex=b0(),this._local=new Map,this._props=new Set,this._surface=void 0,this.cache=new Map,this.id="",this.creator=null,Io(this,L0,Vn(yt,8,this,"")),Vn(yt,11,this),Io(this,R0,Vn(yt,12,this,!1)),Vn(yt,15,this),Io(this,B0,Vn(yt,16,this,"a0")),Vn(yt,19,this),Io(this,F0,Vn(yt,20,this,1)),Vn(yt,23,this),Io(this,U0,Vn(yt,24,this,[0,0])),Vn(yt,27,this),Io(this,$0,Vn(yt,28,this,0)),Vn(yt,31,this),Io(this,H0,Vn(yt,32,this,Math.random())),Vn(yt,35,this),Io(this,z0,Vn(yt,36,this,"[0,0,0,0]")),Vn(yt,39,this),this._surface=e;const n=new Proxy(this,{set:(r,i,s)=>{i==="xywh"&&this._local.delete("deserializedXYWH");const o=r[i];return o===s||(r[i]=s,!this._props.has(i))||e.localElementModels.has(n)&&this._mutex(()=>{e.localElementUpdated.next({model:n,props:{[i]:s},oldValues:{[i]:o}})}),!0}});return n}get deserializedXYWH(){if(!this._local.has("deserializedXYWH")){const e=this.xywh,n=Ml(e);this._local.set("deserializedXYWH",n)}return this._local.get("deserializedXYWH")}get elementBound(){return new X(this.x,this.y,this.w,this.h)}get group(){return this.groupId?this._surface.getElementById(this.groupId):null}get groups(){if(this.group){const e=this._surface.getGroups(this.group.id);return e.unshift(this.group),e}return[]}get h(){return this.deserializedXYWH[3]}get responseBound(){return this.elementBound.expand(this.responseExtension)}get surface(){return this._surface}get w(){return this.deserializedXYWH[2]}get x(){return this.deserializedXYWH[0]}get y(){return this.deserializedXYWH[1]}containsBound(e){return Ke(this).some(n=>e.containsPoint(n))}getLineIntersections(e,n){const r=Ke(this);return Ri(e,n,r)}getNearestPoint(e){const n=Ke(this);return fo(n,e)}getRelativePointLocation(e){const n=X.deserialize(this.xywh),r=n.getRelativePoint(e),i=Or([r],n.center,this.rotate)[0],s=Or(n.points,n.center,this.rotate),o=Cl(s,i);return new wt(i,o)}includesPoint(e,n,r,i){return(r.useElementBound?this.elementBound:this.responseBound).isPointInBound([e,n])}intersectsBound(e){return this.containsBound(e)||e.points.some((n,r,i)=>this.getLineIntersections(n,i[(r+1)%i.length]))}isLocked(){return!1}isLockedByAncestor(){return!1}isLockedBySelf(){return!1}lock(){}unlock(){}}yt=o9(),L0=new WeakMap,R0=new WeakMap,B0=new WeakMap,F0=new WeakMap,U0=new WeakMap,$0=new WeakMap,H0=new WeakMap,z0=new WeakMap,Ao(yt,4,"groupId",ST,Ht,L0),Ao(yt,4,"hidden",TT,Ht,R0),Ao(yt,4,"index",kT,Ht,B0),Ao(yt,4,"opacity",wT,Ht,F0),Ao(yt,4,"responseExtension",vT,Ht,U0),Ao(yt,4,"rotate",ET,Ht,$0),Ao(yt,4,"seed",xT,Ht,H0),Ao(yt,4,"xywh",_T,Ht,z0),l9(yt,Ht);function d9(t,e){const n=t[e];return n?n.type==="block"?n.zIndex+n.elements.length-1:n.zIndex:0}function Hs(t,e){let r=t[e].zIndex;for(let i=e;i<t.length;++i){const s=t[i];s.zIndex=r,r+=s.type==="block"?s.elements.length:1}}function Mo(t){const e=t.groups;return e.length?`${e.map(r=>r.index).reverse().join("-")}-${t.index}`:t.index}function CT(t){return t.split("-")[0]}function AT(t,e){let n=0;for(;n<t.length&&[-1,0].includes(Br(t[n],e));)++n;t.splice(n,0,e)}function ap(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}var W0=(t=>(t[t.AFTER=1]="AFTER",t[t.BEFORE=-1]="BEFORE",t[t.SAME=0]="SAME",t))(W0||{});function h9(t,e){return Br(e,t[0])>=0&&Br(e,t[1])<0}function IT(t,e){return t===e?0:t<e?-1:1}function f9(t,e){const n=t instanceof Ht,r=e instanceof Ht;return n&&t.creator&&t.creator===e?1:r&&e.creator&&e.creator===t?-1:n&&r&&t.creator&&t.creator===e.creator?IT(t.index,e.index):{a:n&&t.creator?t.creator:t,b:r&&e.creator?e.creator:e}}function Br(t,e){const n=f9(t,e);if(typeof n=="number")return n;if(t=n.a,e=n.b,gr(t)&&e.groups.includes(t))return-1;if(gr(e)&&t.groups.includes(e))return 1;{const r=t.groups,i=e.groups;let s=1,o=r.at(-s),a=i.at(-s);for(;o===a&&o;)++s,o=r.at(-s),a=i.at(-s);return o=o??t,a=a??e,IT(o.index,a.index)}}function Jt(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}const j0=Me("BlockService");Me("BlockFlavour"),Me("Commands"),Me("Config");const p9=Me("BlockView"),MT=Me("WidgetView"),lp=Me("LifeCycleWatcher"),Y0=Me("Std"),m9=Me("Keymap");class Xi extends nd{constructor(e){super(),this.std=e}static setup(e){if(!this.key)throw new V(re.ValueNotExists,"Key is not defined in the LifeCycleWatcher");e.add(this,[Y0]),e.addImpl(lp(this.key),n=>n.get(this))}created(){}mounted(){}rendered(){}unmounted(){}}function cp(t,e,n,r){var i;e[t]=(i=e[t])!=null?i:{},e[t][n]=r}function ac(t,e,n){var r,i,s;return n?(i=(r=t[e])==null?void 0:r[n])!=null?i:null:(s=t[e])!=null?s:{}}function lc(t){return t._decoratorState}function g9(){return{creating:!1,deriving:!1,skipField:!1}}const DT=Symbol("convert");function G0(t){return function(n,r){const i=String(r.name);return{init(s){const o=Object.getPrototypeOf(this);return cp(DT,o,i,t),s}}}}function b9(t,e){return ac(t,DT,e)}function V0(t,e,n){const r=Object.getPrototypeOf(n),i=b9(r,t);return i?i(e,n):e}const NT=Symbol("derive"),y9=Object.keys;function OT(t,e){return ac(t,NT,e)}function q0(t,e,n){const r=Object.getPrototypeOf(n),i=lc(n.surface);if(i.deriving||i.creating)return null;const s=OT(r,t);return s?s.reduce((o,a)=>{const l=a(e,n);return Object.entries(l).forEach(([c,u])=>{o[c]=u}),o},{}):null}function X0(t,e){if(t){const n=lc(e.surface);n.deriving=!0,y9(t).forEach(r=>{e[r]=t[r]}),n.deriving=!1}}function ja(t){return function(n,r){const i=String(r.name);return{init(s){const o=Object.getPrototypeOf(this),a=OT(o,i);return Array.isArray(a)?a.push(t):cp(NT,o,i,[t]),s}}}}const K0=Symbol("observe"),Q0=Symbol("observerDisposable");function PT(t){return function(n,r){const i=r.name;return{init(s){return cp(K0,Object.getPrototypeOf(this),i,t),s}}}}function _9(t,e){return ac(t,K0,e)}function LT(t,e){var n;const r=Object.getPrototypeOf(e),i=_9(r,t),s=(n=e[Q0])!=null?n:{};if(e[Q0]=s,s[t]&&(s[t](),delete s[t]),!i)return;const o=e[t];i(null,e,null);const a=(l,c)=>{i(l,e,c)};o&&"observe"in o?(o.observe(a),s[t]=()=>{o.unobserve(a)}):console.warn(`Failed to observe "${t.toString()}" of ${e.type} element, make sure it's a Y type.`)}function x9(t,e){const n=ac(t,K0);Object.keys(n).forEach(r=>{LT(r,e)}),e._disposable.add(()=>{var r;Object.values((r=e[Q0])!=null?r:{}).forEach(i=>i())})}const Z0=Symbol("yProps");function J0(t){const e=Object.getPrototypeOf(t);return Object.hasOwn(e,Z0)||(e[Z0]=new Set),e[Z0]}function ue(t){return function(n,r){const i=r.name;return{init(s){var o,a;if(J0(this).add(i),!((a=lc((o=this.surface)!=null?o:Object.getPrototypeOf(this).constructor))!=null&&a.skipField))return this.yMap&&(this.yMap.doc?this.surface.store.transact(()=>{this.yMap.set(i,s)}):(this.yMap.set(i,s),this._preserved.set(i,s))),s},get(){var s,o;return(o=(s=this.yMap.doc?this.yMap.get(i):null)!=null?s:this._preserved.get(i))!=null?o:t},set(s){var o,a;const l=(o=lc(this.surface))==null?void 0:o.creating;if((a=lc(this.surface))!=null&&a.skipField)return;const c=q0(i,s,this),u=l?s:V0(i,s,this);this.yMap.doc?this.surface.store.transact(()=>{this.yMap.set(i,u)}):(this.yMap.set(i,u),this._preserved.set(i,u)),LT(i,this),l||X0(c,this)}}}}function gi(){return function(e,n){const r=n.name;return{init(i){return this._local.set(r,i),i},get(){return this._local.get(r)},set(i){var s;const o=(s=lc(this.surface))==null?void 0:s.creating,a=this._local.get(r),l=o?i:V0(r,i,this),c=q0(r,i,this);this._local.set(r,l),o||(X0(c,this),this._onChange({props:{[r]:l},oldValues:{[r]:a},local:!0}))}}}}const eb=Symbol("watch");function Ya(t){return function(n,r){const i=r.name;return{init(s){return cp(eb,Object.getPrototypeOf(this),i,t),s}}}}function E9(t,e){return ac(t,eb,e)}function v9(t,e){const n=Object.getPrototypeOf(e),r=E9(n,t);r&&e._disposable.add(e.surface.elementUpdated.subscribe(i=>{i.id===e.id&&t in i.props&&r(i.oldValues[t],e,i.local)}))}function w9(t,e){const n=ac(t,eb);Object.keys(n).forEach(r=>{v9(r,e)})}function k9(){this.__data__=[],this.size=0}function tb(t,e){return t===e||t!==t&&e!==e}function up(t,e){for(var n=t.length;n--;)if(tb(t[n][0],e))return n;return-1}var T9=Array.prototype,S9=T9.splice;function C9(t){var e=this.__data__,n=up(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():S9.call(e,n,1),--this.size,!0}function A9(t){var e=this.__data__,n=up(e,t);return n<0?void 0:e[n][1]}function I9(t){return up(this.__data__,t)>-1}function M9(t,e){var n=this.__data__,r=up(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function zs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}zs.prototype.clear=k9,zs.prototype.delete=C9,zs.prototype.get=A9,zs.prototype.has=I9,zs.prototype.set=M9;function D9(){this.__data__=new zs,this.size=0}function N9(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function O9(t){return this.__data__.get(t)}function P9(t){return this.__data__.has(t)}var RT=typeof global=="object"&&global&&global.Object===Object&&global,L9=typeof self=="object"&&self&&self.Object===Object&&self,Ki=RT||L9||Function("return this")(),Qi=Ki.Symbol,BT=Object.prototype,R9=BT.hasOwnProperty,B9=BT.toString,ad=Qi?Qi.toStringTag:void 0;function F9(t){var e=R9.call(t,ad),n=t[ad];try{t[ad]=void 0;var r=!0}catch{}var i=B9.call(t);return r&&(e?t[ad]=n:delete t[ad]),i}var U9=Object.prototype,$9=U9.toString;function H9(t){return $9.call(t)}var z9="[object Null]",W9="[object Undefined]",FT=Qi?Qi.toStringTag:void 0;function cc(t){return t==null?t===void 0?W9:z9:FT&&FT in Object(t)?F9(t):H9(t)}function Ws(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var j9="[object AsyncFunction]",Y9="[object Function]",G9="[object GeneratorFunction]",V9="[object Proxy]";function UT(t){if(!Ws(t))return!1;var e=cc(t);return e==Y9||e==G9||e==j9||e==V9}var nb=Ki["__core-js_shared__"],$T=function(){var t=/[^.]+$/.exec(nb&&nb.keys&&nb.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function q9(t){return!!$T&&$T in t}var X9=Function.prototype,K9=X9.toString;function Ga(t){if(t!=null){try{return K9.call(t)}catch{}try{return t+""}catch{}}return""}var Q9=/[\\^$.*+?()[\]{}|]/g,Z9=/^\[object .+?Constructor\]$/,J9=Function.prototype,eF=Object.prototype,tF=J9.toString,nF=eF.hasOwnProperty,rF=RegExp("^"+tF.call(nF).replace(Q9,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function iF(t){if(!Ws(t)||q9(t))return!1;var e=UT(t)?rF:Z9;return e.test(Ga(t))}function sF(t,e){return t==null?void 0:t[e]}function Va(t,e){var n=sF(t,e);return iF(n)?n:void 0}var ld=Va(Ki,"Map"),cd=Va(Object,"create");function oF(){this.__data__=cd?cd(null):{},this.size=0}function aF(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var lF="__lodash_hash_undefined__",cF=Object.prototype,uF=cF.hasOwnProperty;function dF(t){var e=this.__data__;if(cd){var n=e[t];return n===lF?void 0:n}return uF.call(e,t)?e[t]:void 0}var hF=Object.prototype,fF=hF.hasOwnProperty;function pF(t){var e=this.__data__;return cd?e[t]!==void 0:fF.call(e,t)}var mF="__lodash_hash_undefined__";function gF(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=cd&&e===void 0?mF:e,this}function qa(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}qa.prototype.clear=oF,qa.prototype.delete=aF,qa.prototype.get=dF,qa.prototype.has=pF,qa.prototype.set=gF;function bF(){this.size=0,this.__data__={hash:new qa,map:new(ld||zs),string:new qa}}function yF(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function dp(t,e){var n=t.__data__;return yF(e)?n[typeof e=="string"?"string":"hash"]:n.map}function _F(t){var e=dp(this,t).delete(t);return this.size-=e?1:0,e}function xF(t){return dp(this,t).get(t)}function EF(t){return dp(this,t).has(t)}function vF(t,e){var n=dp(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function js(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}js.prototype.clear=bF,js.prototype.delete=_F,js.prototype.get=xF,js.prototype.has=EF,js.prototype.set=vF;var wF=200;function kF(t,e){var n=this.__data__;if(n instanceof zs){var r=n.__data__;if(!ld||r.length<wF-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new js(r)}return n.set(t,e),this.size=n.size,this}function Ys(t){var e=this.__data__=new zs(t);this.size=e.size}Ys.prototype.clear=D9,Ys.prototype.delete=N9,Ys.prototype.get=O9,Ys.prototype.has=P9,Ys.prototype.set=kF;var TF="__lodash_hash_undefined__";function SF(t){return this.__data__.set(t,TF),this}function CF(t){return this.__data__.has(t)}function hp(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new js;++e<n;)this.add(t[e])}hp.prototype.add=hp.prototype.push=SF,hp.prototype.has=CF;function AF(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function IF(t,e){return t.has(e)}var MF=1,DF=2;function HT(t,e,n,r,i,s){var o=n&MF,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var c=s.get(t),u=s.get(e);if(c&&u)return c==e&&u==t;var d=-1,h=!0,f=n&DF?new hp:void 0;for(s.set(t,e),s.set(e,t);++d<a;){var p=t[d],g=e[d];if(r)var b=o?r(g,p,d,e,t,s):r(p,g,d,t,e,s);if(b!==void 0){if(b)continue;h=!1;break}if(f){if(!AF(e,function(_,y){if(!IF(f,y)&&(p===_||i(p,_,n,r,s)))return f.push(y)})){h=!1;break}}else if(!(p===g||i(p,g,n,r,s))){h=!1;break}}return s.delete(t),s.delete(e),h}var zT=Ki.Uint8Array;function NF(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function OF(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var PF=1,LF=2,RF="[object Boolean]",BF="[object Date]",FF="[object Error]",UF="[object Map]",$F="[object Number]",HF="[object RegExp]",zF="[object Set]",WF="[object String]",jF="[object Symbol]",YF="[object ArrayBuffer]",GF="[object DataView]",WT=Qi?Qi.prototype:void 0,rb=WT?WT.valueOf:void 0;function VF(t,e,n,r,i,s,o){switch(n){case GF:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case YF:return!(t.byteLength!=e.byteLength||!s(new zT(t),new zT(e)));case RF:case BF:case $F:return tb(+t,+e);case FF:return t.name==e.name&&t.message==e.message;case HF:case WF:return t==e+"";case UF:var a=NF;case zF:var l=r&PF;if(a||(a=OF),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=LF,o.set(t,e);var u=HT(a(t),a(e),r,i,s,o);return o.delete(t),u;case jF:if(rb)return rb.call(t)==rb.call(e)}return!1}function jT(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var bi=Array.isArray;function qF(t,e,n){var r=e(t);return bi(t)?r:jT(r,n(t))}function XF(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function KF(){return[]}var QF=Object.prototype,ZF=QF.propertyIsEnumerable,YT=Object.getOwnPropertySymbols,JF=YT?function(t){return t==null?[]:(t=Object(t),XF(YT(t),function(e){return ZF.call(t,e)}))}:KF;function e7(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function uc(t){return t!=null&&typeof t=="object"}var t7="[object Arguments]";function GT(t){return uc(t)&&cc(t)==t7}var VT=Object.prototype,n7=VT.hasOwnProperty,r7=VT.propertyIsEnumerable,ib=GT(function(){return arguments}())?GT:function(t){return uc(t)&&n7.call(t,"callee")&&!r7.call(t,"callee")};function i7(){return!1}var qT=typeof He=="object"&&He&&!He.nodeType&&He,XT=qT&&typeof module=="object"&&module&&!module.nodeType&&module,s7=XT&&XT.exports===qT,KT=s7?Ki.Buffer:void 0,o7=KT?KT.isBuffer:void 0,sb=o7||i7,a7=9007199254740991,l7=/^(?:0|[1-9]\d*)$/;function ob(t,e){var n=typeof t;return e=e??a7,!!e&&(n=="number"||n!="symbol"&&l7.test(t))&&t>-1&&t%1==0&&t<e}var c7=9007199254740991;function ab(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=c7}var u7="[object Arguments]",d7="[object Array]",h7="[object Boolean]",f7="[object Date]",p7="[object Error]",m7="[object Function]",g7="[object Map]",b7="[object Number]",y7="[object Object]",_7="[object RegExp]",x7="[object Set]",E7="[object String]",v7="[object WeakMap]",w7="[object ArrayBuffer]",k7="[object DataView]",T7="[object Float32Array]",S7="[object Float64Array]",C7="[object Int8Array]",A7="[object Int16Array]",I7="[object Int32Array]",M7="[object Uint8Array]",D7="[object Uint8ClampedArray]",N7="[object Uint16Array]",O7="[object Uint32Array]",Tt={};Tt[T7]=Tt[S7]=Tt[C7]=Tt[A7]=Tt[I7]=Tt[M7]=Tt[D7]=Tt[N7]=Tt[O7]=!0,Tt[u7]=Tt[d7]=Tt[w7]=Tt[h7]=Tt[k7]=Tt[f7]=Tt[p7]=Tt[m7]=Tt[g7]=Tt[b7]=Tt[y7]=Tt[_7]=Tt[x7]=Tt[E7]=Tt[v7]=!1;function P7(t){return uc(t)&&ab(t.length)&&!!Tt[cc(t)]}function L7(t){return function(e){return t(e)}}var QT=typeof He=="object"&&He&&!He.nodeType&&He,ud=QT&&typeof module=="object"&&module&&!module.nodeType&&module,R7=ud&&ud.exports===QT,lb=R7&&RT.process,ZT=function(){try{var t=ud&&ud.require&&ud.require("util").types;return t||lb&&lb.binding&&lb.binding("util")}catch{}}(),JT=ZT&&ZT.isTypedArray,eS=JT?L7(JT):P7,B7=Object.prototype,F7=B7.hasOwnProperty;function U7(t,e){var n=bi(t),r=!n&&ib(t),i=!n&&!r&&sb(t),s=!n&&!r&&!i&&eS(t),o=n||r||i||s,a=o?e7(t.length,String):[],l=a.length;for(var c in t)F7.call(t,c)&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ob(c,l)))&&a.push(c);return a}var $7=Object.prototype;function H7(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||$7;return t===n}function z7(t,e){return function(n){return t(e(n))}}var W7=z7(Object.keys,Object),j7=Object.prototype,Y7=j7.hasOwnProperty;function G7(t){if(!H7(t))return W7(t);var e=[];for(var n in Object(t))Y7.call(t,n)&&n!="constructor"&&e.push(n);return e}function tS(t){return t!=null&&ab(t.length)&&!UT(t)}function cb(t){return tS(t)?U7(t):G7(t)}function nS(t){return qF(t,cb,JF)}var V7=1,q7=Object.prototype,X7=q7.hasOwnProperty;function K7(t,e,n,r,i,s){var o=n&V7,a=nS(t),l=a.length,c=nS(e),u=c.length;if(l!=u&&!o)return!1;for(var d=l;d--;){var h=a[d];if(!(o?h in e:X7.call(e,h)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var g=!0;s.set(t,e),s.set(e,t);for(var b=o;++d<l;){h=a[d];var _=t[h],y=e[h];if(r)var x=o?r(y,_,h,e,t,s):r(_,y,h,t,e,s);if(!(x===void 0?_===y||i(_,y,n,r,s):x)){g=!1;break}b||(b=h=="constructor")}if(g&&!b){var E=t.constructor,I=e.constructor;E!=I&&"constructor"in t&&"constructor"in e&&!(typeof E=="function"&&E instanceof E&&typeof I=="function"&&I instanceof I)&&(g=!1)}return s.delete(t),s.delete(e),g}var ub=Va(Ki,"DataView"),db=Va(Ki,"Promise"),hb=Va(Ki,"Set"),fb=Va(Ki,"WeakMap"),rS="[object Map]",Q7="[object Object]",iS="[object Promise]",sS="[object Set]",oS="[object WeakMap]",aS="[object DataView]",Z7=Ga(ub),J7=Ga(ld),eU=Ga(db),tU=Ga(hb),nU=Ga(fb),Do=cc;(ub&&Do(new ub(new ArrayBuffer(1)))!=aS||ld&&Do(new ld)!=rS||db&&Do(db.resolve())!=iS||hb&&Do(new hb)!=sS||fb&&Do(new fb)!=oS)&&(Do=function(t){var e=cc(t),n=e==Q7?t.constructor:void 0,r=n?Ga(n):"";if(r)switch(r){case Z7:return aS;case J7:return rS;case eU:return iS;case tU:return sS;case nU:return oS}return e});var rU=1,lS="[object Arguments]",cS="[object Array]",fp="[object Object]",iU=Object.prototype,uS=iU.hasOwnProperty;function sU(t,e,n,r,i,s){var o=bi(t),a=bi(e),l=o?cS:Do(t),c=a?cS:Do(e);l=l==lS?fp:l,c=c==lS?fp:c;var u=l==fp,d=c==fp,h=l==c;if(h&&sb(t)){if(!sb(e))return!1;o=!0,u=!1}if(h&&!u)return s||(s=new Ys),o||eS(t)?HT(t,e,n,r,i,s):VF(t,e,l,n,r,i,s);if(!(n&rU)){var f=u&&uS.call(t,"__wrapped__"),p=d&&uS.call(e,"__wrapped__");if(f||p){var g=f?t.value():t,b=p?e.value():e;return s||(s=new Ys),i(g,b,n,r,s)}}return h?(s||(s=new Ys),K7(t,e,n,r,i,s)):!1}function pp(t,e,n,r,i){return t===e?!0:t==null||e==null||!uc(t)&&!uc(e)?t!==t&&e!==e:sU(t,e,n,r,pp,i)}function mp(t,e){return pp(t,e)}var oU=Object.create,dS=Object.defineProperty,aU=Object.getOwnPropertyDescriptor,lU=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),dd=t=>{throw TypeError(t)},cU=(t,e,n)=>e in t?dS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uU=t=>{var e;return[,,,oU((e=void 0)!=null?e:null)]},hS=["class","method","getter","setter","accessor","field","value","get","set"],hd=t=>t!==void 0&&typeof t!="function"?dd("Function expected"):t,dU=(t,e,n,r,i)=>({kind:hS[t],name:e,metadata:r,addInitializer:s=>n._?dd("Already initialized"):i.push(hd(s||null))}),hU=(t,e)=>cU(e,lU("metadata"),t[3]),qn=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},No=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=hS[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,aU({get[n](){return fU(this,s)},set[n](E){return pU(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=dU(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?hd(a)&&(y[g]=a):typeof a!="object"||a===null?dd("Object expected"):(hd(o=a.get)&&(y.get=o),hd(o=a.set)&&(y.set=o),hd(o=a.init)&&b.unshift(o));return y&&dS(i,n,y),i},fS=(t,e,n)=>e.has(t)||dd("Cannot "+n),fU=(t,e,n)=>(fS(t,e,"read from private field"),e.get(t)),Oo=(t,e,n)=>e.has(t)?dd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),pU=(t,e,n,r)=>(fS(t,e,"write to private field"),e.set(t,n),n),pS,mS,gS,bS,yS,_S,xS,ES,xt,pb,mb,gb,bb,yb,_b,xb,Eb,vS,wS;ES=[gi()],xS=[Ya((t,e)=>{e._local.delete("externalBound")}),gi()],_S=[ue(!1)],yS=[ue()],bS=[ue()],gS=[gi()],mS=[gi()],pS=[ue()];class Lt{constructor(e){this._lastXYWH=void 0,this._disposable=new hn,this._id=void 0,this._local=new Map,this._onChange=void 0,this._preserved=new Map,this._stashed=void 0,this.propsUpdated=new Ie,this.surface=void 0,this.yMap=void 0,Oo(this,pb,qn(xt,8,this,!0)),qn(xt,11,this),Oo(this,mb,qn(xt,12,this)),qn(xt,15,this),Oo(this,gb,qn(xt,16,this,!1)),qn(xt,19,this),Oo(this,bb,qn(xt,20,this)),qn(xt,23,this),Oo(this,yb,qn(xt,24,this,!1)),qn(xt,27,this),Oo(this,_b,qn(xt,28,this,1)),qn(xt,31,this),Oo(this,xb,qn(xt,32,this,[0,0])),qn(xt,35,this),Oo(this,Eb,qn(xt,36,this)),qn(xt,39,this);const{id:n,yMap:r,model:i,stashedStore:s,onChange:o}=e;this._id=n,this.yMap=r,this.surface=i,this._stashed=s,this._onChange=o,this.index="a0",this.seed=N6()}get connectable(){return!0}get deserializedXYWH(){var e;if(!this._lastXYWH||this.xywh!==this._lastXYWH){const n=this.xywh;this._local.set("deserializedXYWH",Ml(n)),this._lastXYWH=n}return(e=this._local.get("deserializedXYWH"))!=null?e:[0,0,0,0]}get elementBound(){return this.rotate?X.from(mo(this)):X.deserialize(this.xywh)}get externalBound(){if(!this._local.has("externalBound")){const e=this.externalXYWH?X.deserialize(this.externalXYWH):null;this._local.set("externalBound",e)}return this._local.get("externalBound")}get group(){return this.surface.getGroup(this.id)}get groups(){return this.surface.getGroups(this.id)}get h(){return this.deserializedXYWH[3]}get id(){return this._id}get isConnected(){return this.surface.hasElementById(this.id)}get responseBound(){return this.elementBound.expand(this.responseExtension)}get w(){return this.deserializedXYWH[2]}get x(){return this.deserializedXYWH[0]}get y(){return this.deserializedXYWH[1]}containsBound(e){return Ke(this).some(n=>e.containsPoint(n))}getLineIntersections(e,n){const r=Ke(this);return Ri(e,n,r)}getNearestPoint(e){const n=Ke(this);return fo(n,e)}getRelativePointLocation(e){const n=X.deserialize(this.xywh),r=n.getRelativePoint(e),i=Or([r],n.center,this.rotate)[0],s=Or(n.points,n.center,this.rotate),o=Cl(s,i);return new wt(i,o)}includesPoint(e,n,r,i){return(r.useElementBound?this.elementBound:this.responseBound).isPointInBound([e,n])}intersectsBound(e){return this.containsBound(e)||e.points.some((n,r,i)=>this.getLineIntersections(n,i[(r+1)%i.length]))}isLocked(){return fT(this)}isLockedByAncestor(){return P0(this)}isLockedBySelf(){return op(this)}lock(){pT(this.surface.store,this)}onCreated(){}onDestroyed(){this._disposable.dispose(),this.propsUpdated.complete()}pop(e){if(!this._stashed.has(e))return;const n=this._stashed.get(e);this._stashed.delete(e),delete this[e],J0(this).has(e)?mp(n,this.yMap.get(e))||this.yMap.set(e,n):console.warn("pop a prop that is not field or local:",e)}serialize(){const e=this.yMap.toJSON();return e.xywh=this.xywh,e}stash(e){if(this._stashed.has(e)||!J0(this).has(e))return;const n=this[e];this._stashed.set(e,n),Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:()=>this._stashed.get(e),set:r=>{const i=V0(e,r,this),s=this._stashed.get(e),o=q0(e,r,this);this._stashed.set(e,i),this._onChange({props:{[e]:i},oldValues:{[e]:s},local:!0}),X0(o,this)}})}unlock(){mT(this.surface.store,this)}}xt=uU(),pb=new WeakMap,mb=new WeakMap,gb=new WeakMap,bb=new WeakMap,yb=new WeakMap,_b=new WeakMap,xb=new WeakMap,Eb=new WeakMap,No(xt,4,"display",ES,Lt,pb),No(xt,4,"externalXYWH",xS,Lt,mb),No(xt,4,"hidden",_S,Lt,gb),No(xt,4,"index",yS,Lt,bb),No(xt,4,"lockedBySelf",bS,Lt,yb),No(xt,4,"opacity",gS,Lt,_b),No(xt,4,"responseExtension",mS,Lt,xb),No(xt,4,"seed",pS,Lt,Eb),hU(xt,Lt);class dc extends(wS=Lt,vS=Qh,wS){constructor(){super(...arguments),this._childIds=[],this._mutex=b0(),this[vS]=!0}get childElements(){const e=[];for(const n of this.childIds){const r=this.surface.getElementById(n)||this.surface.store.getModelById(n);r&&e.push(r)}return e}get childIds(){return this._childIds}get descendantElements(){return dT(this)}get xywh(){var e;return this._mutex(()=>{var n;const r=(n=this._local.get("xywh"))!=null?n:"[0,0,0,0]",i=this._getXYWH().serialize();(r!==i||!this._local.has("xywh"))&&(this._local.set("xywh",i),r!==i&&this._onChange({props:{xywh:i},oldValues:{xywh:r},local:!0}))}),(e=this._local.get("xywh"))!=null?e:"[0,0,0,0]"}set xywh(e){}_getXYWH(){let e;return this.childElements.forEach(n=>{n instanceof Lt&&n.hidden||(e=e?e.unite(n.elementBound):n.elementBound)}),e?this._local.set("xywh",e.serialize()):this._local.delete("xywh"),e??new X(0,0,0,0)}hasChild(e){return this.childElements.includes(e)}hasDescendant(e){return hT(this,e)}setChildIds(e,n){const r=this.childIds;this._childIds=e,this._onChange({props:{childIds:e},oldValues:{childIds:r},local:n})}}function mU(t,e){const n={},r=(i,s)=>{const o={},a={};i.keysChanged.forEach(l=>{var c,u;const d=i.changes.keys.get(l),h=(c=i.changes.keys.get(l))==null?void 0:c.oldValue;if(d)if(d.action==="update"||d.action==="add"){const f=t.yMap.get(l);f instanceof gt&&((u=n[l])==null||u.call(n),n[l]=kS(l,f,e)),t._preserved.set(l,f),o[l]=f,a[l]=h}else t._preserved.delete(l),a[l]=h}),e({props:o,oldValues:a,local:s.local})};return Array.from(t.yMap.entries()).forEach(([i,s])=>{s instanceof gt&&(n[i]=kS(i,s,e)),t._preserved.set(i,s)}),t.yMap.observe(r),n.ymap=()=>{t.yMap.unobserve(r)},()=>{Object.values(n).forEach(i=>i())}}function kS(t,e,n){const r=(i,s)=>{n({props:{[t]:e},oldValues:{},local:s.local})};return e.observe(r),()=>{e.unobserve(r)}}const vb="affine:surface:text",wb="affine:surface:ymap";let hc=class extends Qe{constructor(){super(),this._decoratorState=g9(),this._elementCtorMap=Object.create(null),this._elementModels=new Map,this._elementTypeMap=new Map,this._groupLikeModels=new Map,this._middlewares=[],this._surfaceBlockModel=!0,this.localElements=new Set,this.elementAdded=new Ie,this.elementRemoved=new Ie,this.elementUpdated=new Ie,this.localElementAdded=new Ie,this.localElementDeleted=new Ie,this.localElementUpdated=new Ie,this._isEmpty$=un(!1);const e=this.created.subscribe(()=>{this._init(),e.unsubscribe()})}get elementModels(){const e=[];return this._elementModels.forEach(n=>e.push(n.model)),e}get elements(){return this.props.elements}get localElementModels(){return this.localElements}get registeredElementTypes(){return Object.keys(this._elementCtorMap)}isEmpty(){return this._isEmpty$.value}_createElementFromProps(e,n){const{type:r,id:i,...s}=e;if(!i)throw new Error("Cannot find id in props");const o=new at,a=this._createElementFromYMap(r,i,o,{...n,newCreate:!0});return e=this._propsToY(r,e),o.set("type",r),o.set("id",i),Object.keys(s).forEach(l=>{e[l]!==void 0&&(a.model[l]=e[l])}),a}_createElementFromYMap(e,n,r,i){var s;const o=new Map,a=this._elementCtorMap[e];if(!a)throw new Error(`Invalid element type: ${r.get("type")}`);const l=this._decoratorState;l.creating=!0,l.skipField=(s=i.skipFieldInit)!=null?s:!1;let c=!1;a._decoratorState=l;const u=new a({id:n,yMap:r,model:this,stashedStore:o,onChange:f=>c&&i.onChange({id:n,...f})});return delete a._decoratorState,l.creating=!1,l.skipField=!1,{model:u,mount:()=>{x9(a.prototype,u),w9(a.prototype,u),u._disposable.add(mU(u,f=>{c&&i.onChange({id:n,...f})})),c=!0,u.onCreated()},unmount:()=>{c=!1,u.onDestroyed()}}}_initElementModels(){const e=this.elements.getValue(),n=(o,a)=>{const l=this._elementTypeMap.get(o)||[];l.indexOf(a)===-1&&l.push(a),this._elementTypeMap.set(o,l),gr(a)&&this._groupLikeModels.set(a.id,a)},r=(o,a)=>{const l=this._elementTypeMap.get(o)||[],c=l.indexOf(a);c!==-1&&l.splice(c,1),this._groupLikeModels.has(a.id)&&this._groupLikeModels.delete(a.id)},i=(o,a)=>{const{changes:l,keysChanged:c}=o,u=[],d=[];c.forEach(h=>{const f=l.keys.get(h),p=this.elements.getValue().get(h);switch(f==null?void 0:f.action){case"add":if(p){const g=this._elementModels.has(h),b=g?this._elementModels.get(h):this._createElementFromYMap(p.get("type"),p.get("id"),p,{onChange:_=>{this.elementUpdated.next(_),Object.keys(_.props).forEach(y=>{b.model.propsUpdated.next({key:y})})},skipFieldInit:!0});!g&&this._elementModels.set(h,b),n(b.model.type,b.model),u.push(b)}break;case"delete":if(this._elementModels.has(h)){const{model:g,unmount:b}=this._elementModels.get(h);r(g.type,g),this._elementModels.delete(h),d.push({model:g,unmount:b})}break}}),u.forEach(({mount:h,model:f})=>{h(),this.elementAdded.next({id:f.id,local:a.local})}),d.forEach(({unmount:h,model:f})=>{h(),this.elementRemoved.next({id:f.id,type:f.type,model:f,local:a.local})})};e.forEach((o,a)=>{const l=this._createElementFromYMap(o.get("type"),o.get("id"),o,{onChange:c=>{this.elementUpdated.next(c),Object.keys(c.props).forEach(u=>{l.model.propsUpdated.next({key:u})})},skipFieldInit:!0});this._elementModels.set(a,l)}),this._elementModels.forEach(({mount:o,model:a})=>{n(a.type,a),o()}),Object.values(this.store.blocks.peek()).forEach(o=>{gr(o.model)&&this._groupLikeModels.set(o.id,o.model)}),e.observe(i);const s=this.store.slots.blockUpdated.subscribe(o=>{switch(o.type){case"add":gr(o.model)&&this._groupLikeModels.set(o.id,o.model);break;case"delete":gr(o.model)&&this._groupLikeModels.delete(o.id);{const a=this.getGroup(o.id);a&&a.removeChild(o.model)}break}});this.deleted.subscribe(()=>{e.unobserve(i),s.unsubscribe()})}_propsToY(e,n){const r=this._elementCtorMap[e];if(!r)throw new Error(`Invalid element type: ${e}`);return Object.entries(n).forEach(([i,s])=>{if(s instanceof Object){if(Reflect.has(s,vb)){const o=new gt;o.applyDelta(Reflect.get(s,"delta")),Reflect.set(n,i,o)}if(Reflect.has(s,wb)){const o=Reflect.get(s,"json"),a=new at;Object.keys(o).forEach(l=>{a.set(l,o[l])}),Reflect.set(n,i,a)}}}),r.propsToY?r.propsToY(n):n}_watchGroupRelationChange(){const e=r=>r instanceof dc,n=this.elementUpdated.subscribe(({id:r,oldValues:i})=>{const s=this.getElementById(r);e(s)&&i.childIds&&s.childIds.length===0&&this.deleteElement(r)});this.deleted.subscribe(()=>{n.unsubscribe()})}_watchChildrenChange(){const e=()=>{this._isEmpty$.value=this._elementModels.size===0&&this.children.length===0},n=new hn;n.add(this.elementAdded.subscribe(e)),n.add(this.elementRemoved.subscribe(e)),this.store.slots.blockUpdated.subscribe(r=>{["add","delete"].includes(r.type)&&e()}),this.deleted.subscribe(()=>{n.dispose()})}_extendElement(e){Object.assign(this._elementCtorMap,e)}_init(){this._initElementModels(),this._watchGroupRelationChange(),this._watchChildrenChange()}getConstructor(e){return this._elementCtorMap[e]}addElement(e){if(this.store.readonly)throw new Error("Cannot add element in readonly mode");const n={type:"beforeAdd",payload:{type:e.type,props:e}};this._middlewares.forEach(s=>s(n)),e=n.payload.props;const r=K();e.id=r;const i=this._createElementFromProps(e,{onChange:s=>{this.elementUpdated.next(s),Object.keys(s.props).forEach(o=>{i.model.propsUpdated.next({key:o})})}});return this._elementModels.set(r,i),this.store.transact(()=>{this.elements.getValue().set(r,i.model.yMap)}),r}addLocalElement(e){this.localElements.add(e),this.localElementAdded.next(e)}applyMiddlewares(e){this._middlewares=e}deleteElement(e){if(this.store.readonly)throw new Error("Cannot remove element in readonly mode");this.hasElementById(e)&&this.store.transact(()=>{const n=this.getElementById(e),r=this.getGroup(e);n instanceof dc&&n.childIds.forEach(i=>{this.hasElementById(i)?this.deleteElement(i):this.store.hasBlock(i)&&this.store.deleteBlock(this.store.getBlock(i).model)}),r==null||r.removeChild(n),this.elements.getValue().delete(e)})}deleteLocalElement(e){this.localElements.delete(e)&&this.localElementDeleted.next(e)}dispose(){super.dispose(),this.elementAdded.complete(),this.elementRemoved.complete(),this.elementUpdated.complete(),this._elementModels.forEach(({unmount:e})=>e()),this._elementModels.clear()}getElementById(e){var n,r;return(r=(n=this._elementModels.get(e))==null?void 0:n.model)!=null?r:null}getElementsByType(e){return this._elementTypeMap.get(e)||[]}getGroup(e){var n,r;if(e=typeof e=="string"?(r=this.getElementById(e))!=null?r:(n=this.store.getBlock(e))==null?void 0:n.model:e,!e)return null;for(const i of this._groupLikeModels.values())if(i.hasChild(e))return i;return null}getGroups(e){const n=[],r=new Set;let i=this.getGroup(e);for(;i;){if(r.has(i)){console.warn("Exists a cycle in group relation");break}r.add(i),n.push(i),i=this.getGroup(i.id)}return n}hasElementById(e){return this._elementModels.has(e)}isGroup(e){var n;if(typeof e=="string"){const r=this.getElementById(e);if(r)return gr(r);const i=(n=this.store.getBlock(e))==null?void 0:n.model;return i?gr(i):!1}else return gr(e)}updateElement(e,n){if(this.store.readonly)throw new Error("Cannot update element in readonly mode");const r=this.getElementById(e);if(!r)throw new Error(`Element ${e} is not found`);this.store.transact(()=>{n=this._propsToY(r.type,n),Object.entries(n).forEach(([i,s])=>{r[i]=s})})}};function kb(t,e){let n=!1,r="";return Pu(()=>{if(!(n&&t.getBlock(r))){for(const s of Object.values(t.blocks.value))if(s.model instanceof hc){e(s.model),n=!0,r=s.id;return}e(null)}})}const TS="GfxController",Tb=lp(TS),fd=Me("GfxExtension"),SS=Me("GfxClassExtender");class gp extends nd{constructor(e){super(),this.gfx=e}get std(){return this.gfx.std}static extendGfx(e){}static setup(e){if(!this.key)throw new V(re.ValueNotExists,"key is not defined in the GfxExtension");e.addImpl(SS(this.key),{extendFn:this.extendGfx}),e.add(this,[Tb]),e.addImpl(fd(this.key),n=>n.get(this))}mounted(){}unmounted(){}}function Jr(t){return Math.ceil(t/yU)-1}function pd(t){t.rotate&&(t=mo(t));const e=Jr(t.x),n=Jr(t.x+t.w),r=Jr(t.y),i=Jr(t.y+t.h);return[e,n,r,i]}function gU(t){const e=t.elementBound;e.w+=t.responseExtension[0]*2,e.h+=t.responseExtension[1]*2,e.x-=t.responseExtension[0],e.y-=t.responseExtension[1];const n=Jr(e.x),r=Jr(e.maxX),i=Jr(e.y),s=Jr(e.maxY);return[n,r,i,s]}function bU(t){if(!t.externalXYWH)return null;const e=X.deserialize(t.externalXYWH),n=Jr(e.x),r=Jr(e.maxX),i=Jr(e.y),s=Jr(e.maxY);return[n,r,i,s]}const yU=3e3,_U={block:t=>t instanceof Zr,canvas:t=>t instanceof Lt,local:t=>t instanceof Ht};class Sb extends gp{constructor(){super(...arguments),this._elementToGrids=new Map,this._externalElementToGrids=new Map,this._externalGrids=new Map,this._grids=new Map,this._disposables=new hn}get isEmpty(){return this._grids.size===0}_addToExternalGrids(e){const n=bU(e);if(!n){this._removeFromExternalGrids(e);return}const[r,i,s,o]=n,a=new Set;this._externalElementToGrids.set(e,a);for(let l=r;l<=i;l++)for(let c=s;c<=o;c++){let u=this._getExternalGrid(l,c);u||(u=this._createExternalGrid(l,c)),u.add(e),a.add(u)}}_createExternalGrid(e,n){const r=e+"|"+n,i=new Set;return this._externalGrids.set(r,i),i}_createGrid(e,n){const r=e+"|"+n,i=new Set;return this._grids.set(r,i),i}_getExternalGrid(e,n){const r=e+"|"+n;return this._externalGrids.get(r)}_getGrid(e,n){const r=e+"|"+n;return this._grids.get(r)}_removeFromExternalGrids(e){const n=this._externalElementToGrids.get(e);if(n)for(const r of n)r.delete(e)}_searchExternal(e,n){const[r,i,s,o]=pd(e),a=new Set,l=X.from(e);for(let c=r;c<=i;c++)for(let u=s;u<=o;u++){const d=this._getExternalGrid(c,u);if(d)for(const h of d){const f=h.externalBound;n.filterFunc(h)&&f&&(n.strict?l.contains(f):Jh(f,e))&&a.add(h)}}return a}_toFilterFunc(e){const n=e.map(r=>typeof r=="function"?r:_U[r]);return r=>n.some(i=>i(r))}add(e){e instanceof Ht||this._addToExternalGrids(e);const[n,r,i,s]=gU(e),o=new Set;this._elementToGrids.set(e,o);for(let a=n;a<=r;a++)for(let l=i;l<=s;l++){let c=this._getGrid(a,l);c||(c=this._createGrid(a,l)),c.add(e),o.add(c)}}boundHasChanged(e,n){const[r,i,s,o]=pd(e),[a,l,c,u]=pd(n);return r!==a||i!==l||s!==c||o!==u}has(e,n=!1,r=!1,i){const[s,o,a,l]=pd(e),c=X.from(e),u=r?d=>n?d.contains(c):Jh(c,d):d=>n?c.contains(d):Jh(d,c);for(let d=s;d<=o;d++)for(let h=a;h<=l;h++){const f=this._getGrid(d,h);if(f){for(const p of f)if((!i||i(p))&&u(p.elementBound))return!0}}return!1}remove(e){const n=this._elementToGrids.get(e);if(n)for(const r of n)r.delete(e);this._elementToGrids.delete(e),e instanceof Ht||this._removeFromExternalGrids(e)}search(e,n={useSet:!1}){var r,i,s;const o=(r=n.strict)!=null?r:!1,[a,l,c,u]=pd(e),d=X.from(e),h=(i=n.useSet)!=null?i:!1,f=(s=Array.isArray(n.filter)?this._toFilterFunc(n.filter):n.filter)!=null?s:this._toFilterFunc(["canvas","block"]),p=this._searchExternal(e,{filterFunc:f,strict:o});for(let b=a;b<=l;b++)for(let _=c;_<=u;_++){const y=this._getGrid(b,_);if(y)for(const x of y)!x.hidden&&f(x)&&(o?d.contains(x.elementBound):Jh(x.responseBound,d))&&p.add(x)}return h?p:Array.from(p).sort(Br)}update(e){this.remove(e),this.add(e)}unmounted(){this._disposables.dispose()}mounted(){const e=this._disposables,{store:n}=this.std,r=s=>{var o;return s instanceof Zr&&(((o=s.parent)==null?void 0:o.role)==="root"||s.parent instanceof hc)};e.add(n.slots.blockUpdated.subscribe(s=>{if(s.type==="add"&&r(s.model)&&this.add(s.model),s.type==="update"){const o=n.getModelById(s.id);if(!o)return;s.props.key==="xywh"&&r(o)&&this.update(o)}s.type==="delete"&&s.model instanceof Zr&&this.remove(s.model)})),Object.values(n.blocks.peek()).forEach(s=>{r(s.model)&&this.add(s.model)});const i=s=>{let o=new Map(s.childMap.peek());e.add(s.childMap.subscribe(a=>{a.forEach((l,c)=>{if(o.has(c)){o.delete(c);return}}),o.forEach((l,c)=>{const u=n.getModelById(c);u&&this.remove(u)}),a.forEach((l,c)=>{const u=n.getModelById(c);u&&this.add(u)}),o=new Map(a)})),e.add(s.elementAdded.subscribe(a=>{this.add(s.getElementById(a.id))})),e.add(s.elementRemoved.subscribe(a=>{this.remove(a.model)})),e.add(s.elementUpdated.subscribe(a=>{(a.props.xywh||a.props.externalXYWH||a.props.responseExtension)&&this.update(s.getElementById(a.id))})),e.add(s.localElementAdded.subscribe(a=>{this.add(a)})),e.add(s.localElementUpdated.subscribe(a=>{(a.props.xywh||a.props.responseExtension)&&this.update(a.model)})),e.add(s.localElementDeleted.subscribe(a=>{this.remove(a)})),s.elementModels.forEach(a=>{this.add(a)}),s.localElementModels.forEach(a=>{this.add(a)})};this.gfx.surface?i(this.gfx.surface):e.add(this.gfx.surface$.subscribe(s=>{s&&i(s)}))}}Sb.key="grid";class xU{constructor(e){this.std=e,this._disposable=new hn,this.shiftKey$=new cn(!1),this.spaceKey$=new cn(!1),this._init()}_init(){this._disposable.add(this._listenKeyboard("keydown",e=>{this.shiftKey$.value=e.shiftKey&&e.key==="Shift",this.spaceKey$.value=e.code==="Space"})),this._disposable.add(this._listenKeyboard("keyup",e=>{this.shiftKey$.value=!!(e.shiftKey&&e.key==="Shift"),e.code==="Space"&&(this.spaceKey$.value=!1)}))}_listenKeyboard(e,n){return document.addEventListener(e,n,!1),()=>{document.removeEventListener(e,n,!1)}}dispose(){this._disposable.dispose()}}const Cb=class ks extends gp{constructor(e){super(e),this._disposable=new hn,this.blocks=[],this.canvasElements=[],this.canvasLayers=[],this.layers=[],this.slots={layerUpdated:new Ie},this._reset()}get _doc(){return this.std.store}get _surface(){return this.gfx.surface}_buildCanvasLayers(){var e;const n=this.layers.filter(r=>r.type==="canvas").map(r=>({set:r.set,elements:r.elements,zIndex:r.zIndex,indexes:r.indexes}));(!n.length||((e=Jt(this.layers))==null?void 0:e.type)!=="canvas")&&n.push({set:new Set,elements:[],zIndex:0,indexes:[ks.INITIAL_INDEX,ks.INITIAL_INDEX]}),this.canvasLayers=n}_getModelType(e){return e instanceof Ht||e instanceof Lt?"canvas":"block"}_initLayers(){var e;let n=0,r=0;const i=[];let s,o=1;const a=()=>{s&&(s.indexes=[Mo(s.elements[0]),Mo(Jt(s.elements))],s.zIndex=o,i.push(s),o+=s.type==="block"?s.elements.length:1)},l=c=>{a(),s=c==="canvas"?{type:c,indexes:[ks.INITIAL_INDEX,ks.INITIAL_INDEX],zIndex:0,set:new Set,elements:[],bound:new X}:{type:c,indexes:[ks.INITIAL_INDEX,ks.INITIAL_INDEX],zIndex:0,set:new Set,elements:[]}};for(;n<this.blocks.length||r<this.canvasElements.length;){const c=this.blocks[n],u=this.canvasElements[r];if(!c&&!u)break;if(!c){(s==null?void 0:s.type)!=="canvas"&&l("canvas");const h=this.canvasElements.slice(r);s.elements=s.elements.concat(h),h.forEach(f=>s.set.add(f));break}if(!u){(s==null?void 0:s.type)!=="block"&&l("block");const h=this.blocks.slice(n);s.elements=s.elements.concat(h),h.forEach(f=>s.set.add(f));break}switch(Br(c,u)){case-1:(s==null?void 0:s.type)!=="block"&&l("block"),s.set.add(c),s.elements.push(c),++n;break;case 1:(s==null?void 0:s.type)!=="canvas"&&l("canvas"),s.set.add(u),s.elements.push(u),++r;break;case 0:s||l("block"),s.type==="block"?(s.set.add(c),s.elements.push(c),++n):(s.set.add(u),s.elements.push(u),++r);break}}s&&s.elements.length&&a(),this.layers=i,(e=this._surface)==null||e.localElementModels.forEach(c=>this.add(c))}_insertIntoLayer(e,n){const r=this.layers;let i=r.length-1;const s=(a,l,c)=>{c==="tail"?a.elements.push(l):a.elements.splice(c,0,l),a.set.add(l),(c==="tail"||c===0||c===a.elements.length-1)&&(a.indexes=[Mo(a.elements[0]),Mo(Jt(a.elements))])},o=(a,l,c)=>({type:a,set:new Set(l),indexes:[Mo(l[0]),Mo(Jt(l))],zIndex:c+1,elements:l});if(!Jt(this.layers)||[W0.AFTER,W0.SAME].includes(Br(e,Jt(Jt(this.layers).elements)))){const a=Jt(this.layers);(a==null?void 0:a.type)===n?(s(a,e,"tail"),Hs(r,i)):this.layers.push(o(n,[e],d9(r,r.length-1)))}else for(;i>-1;){const a=r[i],l=a.elements;if(h9([l[0],Jt(l)],e)){const c=l.findIndex((u,d)=>{const h=l[d-1];return Br(e,l[d])<0&&(!h||Br(e,h)>=0)});if(a.type===n)s(a,e,c),Hs(r,i);else{const u=a.elements.splice(c);a.set=new Set(a.elements),r.splice(i+1,0,o(a.type,u,1)),r.splice(i+1,0,o(n,[e],1)),Hs(r,i)}break}else{const c=r[i-1];if(!c||Br(e,Jt(c.elements))>=0){a.type===n?(s(a,e,0),Hs(r,i)):c?(s(c,e,"tail"),Hs(r,i-1)):(r.unshift(o(n,[e],1)),Hs(r,0));break}}--i}}_removeFromLayer(e,n){const r=this.layers,i=r.findIndex(o=>o.type!==n?!1:o.set.has(e)?(o.set.delete(e),o.elements.indexOf(e)!==-1&&(o.elements.splice(o.elements.indexOf(e),1),o.elements.length&&(o.indexes=[Mo(o.elements[0]),Mo(Jt(o.elements))])),!0):!1);if(i===-1)return;const s=i===0||i===r.length-1;if(r[i].set.size===0){if(s)r.splice(i,1),r[i]&&Hs(r,i);else{const o=r[i-1],a=r[i+1];o.elements=o.elements.concat(a.elements),o.set=new Set(o.elements),r.splice(i,2),Hs(r,i-1)}return}Hs(r,i)}_reset(){var e,n;const r=this._doc.getAllModels().filter(i=>{var s;return i instanceof Zr&&(i.parent instanceof hc||((s=i.parent)==null?void 0:s.role)==="root")}).concat((n=(e=this._surface)==null?void 0:e.elementModels)!=null?n:[]);this.canvasElements=[],this.blocks=[],r.forEach(i=>{i instanceof Lt?this.canvasElements.push(i):this.blocks.push(i)}),this.canvasElements.sort(Br),this.blocks.sort(Br),this._initLayers(),this._buildCanvasLayers()}_updateLayer(e,n){const r=this._getModelType(e),i=e instanceof Ht,s=!n||"index"in n,o=n&&("childIds"in n||"childElementIds"in n),a=gr(e)&&(s||o),l=(c,u)=>{s&&(ap(c,u),AT(c,u))};return a?(this._reset(),!0):(i||l(r==="canvas"?this.canvasElements:this.blocks,e),s||o?(this._removeFromLayer(e,r),this._insertIntoLayer(e,r),!0):!1)}add(e){const n=this._getModelType(e),r=gr(e),i=e instanceof Ht;r&&e.childElements.forEach(s=>{const o=this._getModelType(s);ap(o==="canvas"?this.canvasElements:this.blocks,s)}),i||AT(n==="canvas"?this.canvasElements:this.blocks,e),this._insertIntoLayer(e,n),r&&e.childElements.forEach(s=>s&&this._updateLayer(s)),this._buildCanvasLayers(),this.slots.layerUpdated.next({type:"add",initiatingElement:e})}compare(e,n){return Br(e,n)}createIndexGenerator(){const e=new ks(this.gfx);return e._reset(),()=>{const n=e.generateIndex(),r=new X(0,0,10,10),i={index:n,type:"shape",x:0,y:0,w:10,h:10,elementBound:r,xywh:"[0, 0, 10, 10]",get group(){return null},get groups(){return[]}};return e.add(i),n}}delete(e){let n;const r=gr(e),i=e instanceof Ht;if(r){this._reset(),this.slots.layerUpdated.next({type:"delete",initiatingElement:e});return}e instanceof Lt||e instanceof Ht?(n="canvas",i||ap(this.canvasElements,e)):(n="block",ap(this.blocks,e)),this._removeFromLayer(e,n),this._buildCanvasLayers(),this.slots.layerUpdated.next({type:"delete",initiatingElement:e})}unmounted(){this.slots.layerUpdated.complete(),this._disposable.dispose()}generateIndex(e=!1){var n,r;if(e){const i=(n=this.layers[0])==null?void 0:n.indexes[0];return i?jn(null,CT(i)):ks.INITIAL_INDEX}else{const i=(r=Jt(this.layers))==null?void 0:r.indexes[1];return i?jn(CT(i),null):ks.INITIAL_INDEX}}getCanvasLayers(){return this.canvasLayers}getReorderedIndex(e,n){const r=e.group||null;let i;r!==null?(i=r.childElements,i.sort(Br)):i=this.layers.reduce((o,a)=>o.concat(a.elements.filter(l=>l.group==null)),[]);const s=i.indexOf(e);switch(n){case"forward":case"front":if(s===-1||s===i.length-1)return e.index;{const o=n==="forward"?i[s+1]:i[i.length-1],a=n==="forward"?i[s+2]:null;return jn(o.index,a!=null&&a.index&&o.index<a.index?a.index:null)}case"backward":case"back":if(s===-1||s===0)return e.index;{const o=n==="backward"?i[s-1]:i[0],a=n==="backward"?i[s-2]:null;return jn(!a||(a==null?void 0:a.index)>=o.index?null:a.index,o.index)}}}getZIndex(e){const n=this.layers.find(r=>r.set.has(e));return n?n.zIndex+n.elements.indexOf(e):0}update(e,n){this._updateLayer(e,n)&&(this._buildCanvasLayers(),this.slots.layerUpdated.next({type:"update",initiatingElement:e}))}mounted(){const e=this._doc;this._disposable.add(e.slots.blockUpdated.subscribe(r=>{var i,s;if(r.type==="add"){const o=e.getModelById(r.id);o instanceof Zr&&(o.parent instanceof hc||((i=o.parent)==null?void 0:i.role)==="root")&&this.blocks.indexOf(o)===-1&&this.add(o)}if(r.type==="update"){const o=e.getModelById(r.id);(r.props.key==="index"||r.props.key==="childElementIds")&&o instanceof Zr&&(o.parent instanceof hc||((s=o.parent)==null?void 0:s.role)==="root")&&this.update(o,{[r.props.key]:!0})}if(r.type==="delete"){const o=e.getModelById(r.id);o instanceof Zr&&this.delete(o)}}));const n=r=>{let i=new Map(r.childMap.peek());this._disposable.add(r.childMap.subscribe(s=>{s.forEach((o,a)=>{if(i.has(a)){i.delete(a);return}}),i.forEach((o,a)=>{const l=this._doc.getModelById(a);l instanceof Zr&&this.delete(l)}),s.forEach((o,a)=>{const l=e.getModelById(a);l instanceof Zr&&!this.blocks.includes(l)&&this.add(l)}),i=new Map(s)})),this._disposable.add(r.elementAdded.subscribe(s=>this.add(r.getElementById(s.id)))),this._disposable.add(r.elementUpdated.subscribe(s=>{(s.props.index||s.props.childIds)&&this.update(r.getElementById(s.id),s.props)})),this._disposable.add(r.elementRemoved.subscribe(s=>this.delete(s.model))),this._disposable.add(r.localElementAdded.subscribe(s=>{this.add(s)})),this._disposable.add(r.localElementUpdated.subscribe(s=>{(s.props.index||s.props.groupId)&&this.update(s.model,s.props)})),this._disposable.add(r.localElementDeleted.subscribe(s=>{this.delete(s)}))};this.gfx.surface?n(this.gfx.surface):this._disposable.add(this.gfx.surface$.subscribe(r=>{r&&n(r)}))}};Cb.key="layerManager",Cb.INITIAL_INDEX="a0";let CS=Cb;var Ab=function(){return Ki.Date.now()},EU=/\s/;function vU(t){for(var e=t.length;e--&&EU.test(t.charAt(e)););return e}var wU=/^\s+/;function kU(t){return t&&t.slice(0,vU(t)+1).replace(wU,"")}var TU="[object Symbol]";function bp(t){return typeof t=="symbol"||uc(t)&&cc(t)==TU}var AS=NaN,SU=/^[-+]0x[0-9a-f]+$/i,CU=/^0b[01]+$/i,AU=/^0o[0-7]+$/i,IU=parseInt;function IS(t){if(typeof t=="number")return t;if(bp(t))return AS;if(Ws(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ws(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=kU(t);var n=CU.test(t);return n||AU.test(t)?IU(t.slice(2),n?2:8):SU.test(t)?AS:+t}var MU="Expected a function",DU=Math.max,NU=Math.min;function Ib(t,e,n){var r,i,s,o,a,l,c=0,u=!1,d=!1,h=!0;if(typeof t!="function")throw new TypeError(MU);e=IS(e)||0,Ws(n)&&(u=!!n.leading,d="maxWait"in n,s=d?DU(IS(n.maxWait)||0,e):s,h="trailing"in n?!!n.trailing:h);function f(v){var N=r,L=i;return r=i=void 0,c=v,o=t.apply(L,N),o}function p(v){return c=v,a=setTimeout(_,e),u?f(v):o}function g(v){var N=v-l,L=v-c,z=e-N;return d?NU(z,s-L):z}function b(v){var N=v-l,L=v-c;return l===void 0||N>=e||N<0||d&&L>=s}function _(){var v=Ab();if(b(v))return y(v);a=setTimeout(_,g(v))}function y(v){return a=void 0,h&&r?f(v):(r=i=void 0,o)}function x(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function E(){return a===void 0?o:y(Ab())}function I(){var v=Ab(),N=b(v);if(r=arguments,i=this,l=v,N){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(_,e),f(l)}return a===void 0&&(a=setTimeout(_,e)),o}return I.cancel=x,I.flush=E,I}function Mb(t,e,n){return n>0&&t>e||n<0&&t<e?e:t}const Db=6,Nb=.1,OU=1,PU=100;function LU(t,e){const{left:n,top:r,viewportX:i,viewportY:s,zoom:o,viewScale:a}=t,[l,c]=e,u=l-n,d=c-r,h=i+u/o/a,f=s+d/o/a;return[h,f]}class RU{constructor(){this._cachedBoundingClientRect=null,this._cachedOffsetWidth=null,this._resizeObserver=null,this._resizeSubject=new Ie,this._isResizing=!1,this._initialTopLeft=null,this._center={x:0,y:0},this._shell=null,this._element=null,this._height=0,this._left=0,this._locked=!1,this._rafId=null,this._top=0,this._width=0,this._zoom=1,this.elementReady=new Ie,this.sizeUpdated=new Ie,this.viewportMoved=new Ie,this.viewportUpdated=new Ie,this.zooming$=new Nk(!1),this.panning$=new Nk(!1),this.ZOOM_MAX=Db,this.ZOOM_MIN=Nb,this._resetZooming=Ib(()=>{this.zooming$.next(!1)},200),this._resetPanning=Ib(()=>{this.panning$.next(!1)},200);const e=this.elementReady.subscribe(n=>{this._element=n,e.unsubscribe()});this._setupResizeObserver()}_setupResizeObserver(){this._resizeSubject.pipe(TB(200)).subscribe(({width:e,height:n,left:r,top:i})=>{!this._shell||!this._initialTopLeft||this._completeResize(e,n,r,i)})}_completeResize(e,n,r,i){if(!this._initialTopLeft)return;const[s,o]=this._initialTopLeft,a=s+e/(2*this.zoom),l=o+n/(2*this.zoom);this.setCenter(a,l,!1),this._width=e,this._height=n,this._left=r,this._top=i,this._isResizing=!1,this._initialTopLeft=null,this.sizeUpdated.next({left:r,top:i,width:e,height:n})}_forceCompleteResize(){if(this._isResizing&&this._shell){const{width:e,height:n,left:r,top:i}=this.boundingClientRect;this._completeResize(e,n,r,i)}}get boundingClientRect(){return this._shell?(this._cachedBoundingClientRect||(this._cachedBoundingClientRect=this._shell.getBoundingClientRect()),this._cachedBoundingClientRect):new DOMRect(0,0,0,0)}get element(){return this._element}get center(){return this._center}get centerX(){return this._center.x}get centerY(){return this._center.y}get height(){return this.boundingClientRect.height}get left(){return this._left}get locked(){return this._locked}set locked(e){this._locked=e}get viewScale(){return!this._shell||this._cachedOffsetWidth===null||this._cachedOffsetWidth===0?1:this.boundingClientRect.width/this._cachedOffsetWidth}get top(){return this._top}get translateX(){return-this.viewportX*this.zoom}get translateY(){return-this.viewportY*this.zoom}get viewportBounds(){const{viewportMinXY:e,viewportMaxXY:n}=this;return X.from({...e,w:n.x-e.x,h:n.y-e.y})}get viewportMaxXY(){const{centerX:e,centerY:n,width:r,height:i,zoom:s}=this;return{x:e+r/2/s,y:n+i/2/s}}get viewportMinXY(){const{centerX:e,centerY:n,width:r,height:i,zoom:s}=this;return{x:e-r/2/s,y:n-i/2/s}}get viewportX(){const{centerX:e,width:n,zoom:r}=this;return e-n/2/r}get viewportY(){const{centerY:e,height:n,zoom:r}=this;return e-n/2/r}get width(){return this.boundingClientRect.width}get zoom(){return this._zoom}applyDeltaCenter(e,n){this.setCenter(this.centerX+e,this.centerY+n)}clearViewportElement(){this._resizeObserver&&this._shell&&(this._resizeObserver.unobserve(this._shell),this._resizeObserver.disconnect()),this._resizeObserver=null,this._shell=null,this._cachedBoundingClientRect=null,this._cachedOffsetWidth=null}dispose(){this.clearViewportElement(),this.sizeUpdated.complete(),this.viewportMoved.complete(),this.viewportUpdated.complete(),this._resizeSubject.complete(),this.zooming$.complete(),this.panning$.complete()}getFitToScreenData(e,n=[0,0,0,0],r=Db,i=100){let{centerX:s,centerY:o,zoom:a}=this;if(!e)return{zoom:a,centerX:s,centerY:o};const{x:l,y:c,w:u,h:d}=e,[h,f,p,g]=n,{width:b,height:_}=this;return a=Math.min((b-i-(f+g))/u,(_-i-(h+p))/d),a=Il(a,Nb,Il(r,Nb,Db)),s=l+(u+f/a)/2-g/a/2,o=c+(d+p/a)/2-h/a/2,{zoom:a,centerX:s,centerY:o}}isInViewport(e){const n=X.from(this.viewportBounds);return n.contains(e)||n.isIntersectWithBound(e)}onResize(){if(!this._shell)return;this._isResizing||(this._isResizing=!0,this._initialTopLeft=this.toModelCoord(0,0));const{left:e,top:n,width:r,height:i}=this.boundingClientRect;this._cachedOffsetWidth=this._shell.offsetWidth,this._left=e,this._top=n,this._resizeSubject.next({left:e,top:n,width:r,height:i})}setCenter(e,n,r=!0){r&&this._isResizing&&this._forceCompleteResize(),this._center.x=e,this._center.y=n,this.panning$.next(!0),this.viewportUpdated.next({zoom:this.zoom,center:R.toVec(this.center)}),this._resetPanning()}setRect(e,n,r,i){if(this._isResizing){this._left=e,this._top=n;return}this._left=e,this._top=n,this.sizeUpdated.next({left:e,top:n,width:r,height:i})}setViewport(e,n=R.toVec(this.center),r=!1,i=!0){i&&this._isResizing&&this._forceCompleteResize();const s=this._zoom;if(r){const o=s/e;if(o===1)this.smoothTranslate(n[0],n[1]);else{const a=[this.centerX,this.centerY],l=R.mul(R.sub(n,R.mul(a,o)),1/(1-o));this.smoothZoom(e,R.toPoint(l))}}else this._center.x=n[0],this._center.y=n[1],this.setZoom(e,void 0,!1,i)}setViewportByBound(e,n=[0,0,0,0],r=!1,i=!0){let[s,o,a,l]=n;s>0&&s<1&&(s*=this.height),o>0&&o<1&&(o*=this.width),a>0&&a<1&&(a*=this.height),l>0&&l<1&&(l*=this.width);let c=Math.min((this.width-(o+l))/e.w,(this.height-(s+a))/e.h);if(c<this.ZOOM_MIN){c=this.ZOOM_MIN;const d=this.width-e.w*c,h=this.height-e.h*c;o=l=Math.max(d/2,1),s=a=Math.max(h/2,1)}c>this.ZOOM_MAX&&(c=this.ZOOM_MAX);const u=[e.x+(e.w+o/c)/2-l/c/2,e.y+(e.h+a/c)/2-s/c/2];this.setViewport(c,u,r,i)}setShellElement(e){this._shell=e,this._cachedBoundingClientRect=e.getBoundingClientRect(),this._cachedOffsetWidth=e.offsetWidth;const{left:n,top:r,width:i,height:s}=this._cachedBoundingClientRect;this.setRect(n,r,i,s),this._resizeObserver=new ResizeObserver(()=>{this._cachedBoundingClientRect=null,this._cachedOffsetWidth=null,this.onResize()}),this._resizeObserver.observe(e)}setZoom(e,n,r=!1,i=!0){i&&this._isResizing&&this._forceCompleteResize();const s=this.zoom;n=n??this._center,this._zoom=Il(e,this.ZOOM_MIN,this.ZOOM_MAX);const o=this.zoom,a=R.sub(R.toVec(this.center),R.toVec(n)),l=R.add(R.toVec(n),R.mul(a,s/o));r&&this.zooming$.next(!0),this.setCenter(l[0],l[1],i),this.viewportUpdated.next({zoom:this.zoom,center:R.toVec(this.center)}),this._resetZooming()}smoothTranslate(e,n,r=10){const{center:i}=this,s={x:e-i.x,y:n-i.y},o=()=>{this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(()=>{const a={x:s.x/r,y:s.y/r},l={x:this.centerX+a.x,y:this.centerY+a.y},c=s.x>0?1:-1,u=s.y>0?1:-1;l.x=Mb(l.x,e,c),l.y=Mb(l.y,n,u),this.setCenter(l.x,l.y,!0),(l.x!=e||l.y!=n)&&o()})};o()}smoothZoom(e,n,r=10){const i=e-this.zoom;this._rafId&&cancelAnimationFrame(this._rafId);const s=()=>{this._rafId=requestAnimationFrame(()=>{const o=i>0?1:-1,a=i/r,l=Mb(this.zoom+a,e,o);this.setZoom(l,n,void 0,!0),l!=e&&s()})};s()}toModelBound(e){const{w:n,h:r}=e,[i,s]=this.toModelCoord(e.x,e.y);return new X(i,s,n/this.zoom,r/this.zoom)}toModelCoord(e,n,r=this.zoom,i){const{viewScale:s}=this,o=i?i.x-this.width/2/r:this.viewportX,a=i?i.y-this.height/2/r:this.viewportY;return[o+e/r/s,a+n/r/s]}toModelCoordFromClientCoord([e,n]){return LU(this,[e,n])}toViewBound(e){const{w:n,h:r}=e,[i,s]=this.toViewCoord(e.x,e.y);return new X(i,s,n*this.zoom,r*this.zoom)}toViewCoord(e,n){const{viewportX:r,viewportY:i,zoom:s,viewScale:o}=this;return[(e-r)*s*o,(n-i)*s*o]}toViewCoordFromClientCoord([e,n]){const{left:r,top:i}=this;return[e-r,n-i]}serializeRecord(){return JSON.stringify({left:this.left,top:this.top,viewportX:this.viewportX,viewportY:this.viewportY,zoom:this.zoom,viewScale:this.viewScale})}deserializeRecord(e){try{const n=JSON.parse(e||"{}");return"zoom"in n?n:null}catch(n){return console.error("Failed to deserialize viewport record:",n),null}}}class MS extends Xi{constructor(e){super(e),this._disposables=new hn,this._surface$=new cn(null),this.cursor$=new cn,this.viewport=new RU,this.keyboard=new xU(e),this._disposables.add(kb(this.doc,n=>{this._surface$.value=n})),this._disposables.add(this.viewport),this._disposables.add(this.keyboard),this.std.provider.getAll(SS).forEach(n=>{n.extendFn(this)})}get grid(){return this.std.get(Sb)}get layer(){return this.std.get(CS)}get doc(){return this.std.store}get elementsBound(){return og(this.gfxElements)}get gfxElements(){return[...this.layer.blocks,...this.layer.canvasElements]}get surface$(){return this._surface$}get surface(){return this._surface$.peek()}get surfaceComponent(){var e;return this.surface&&(e=this.std.view.getBlock(this.surface.id))!=null?e:null}deleteElement(e){var n,r;if(e=typeof e=="string"?e:e.id,(n=this.surface)!=null&&n.hasElementById(e))this.surface.deleteElement(e);else{const i=(r=this.doc.getBlock(e))==null?void 0:r.model;i&&this.doc.deleteBlock(i)}}getElementById(e){var n,r,i,s;return(s=(i=(n=this.surface)==null?void 0:n.getElementById(e))!=null?i:(r=this.doc.getBlock(e))==null?void 0:r.model)!=null?s:null}getElementByPoint(e,n,r={all:!1,hitThreshold:10}){var i,s,o,a;r.zoom=this.viewport.zoom,(i=r.hitThreshold)!=null||(r.hitThreshold=10);const l=r.hitThreshold,c=(s=r.responsePadding)!=null?s:[l/2,l/2],u=(o=r.all)!=null?o:!1,d={x:e-c[0],y:n-c[1],w:c[0]*2,h:c[1]*2},f=this.grid.search(d).filter(p=>{var g;return p.includesPoint(e,n,r,this.std.host)||((g=p.externalBound)==null?void 0:g.isPointInBound([e,n]))});return f.sort(this.layer.compare),u?f:(a=Jt(f))!=null?a:null}getElementsByBound(e,n={type:"all"}){e=e instanceof X?e:X.from(e);let r=this.grid.search(e);if(n.type!=="all"){const i=n.type==="block"?s=>s instanceof Zr:s=>s instanceof Lt;r=r.filter(i)}return r.sort(this.layer.compare),r}getElementsByType(e){var n,r;return(r=(n=this.surface)==null?void 0:n.getElementsByType(e))!=null?r:this.doc.getBlocksByFlavour(e).map(i=>i.model)}mounted(){this.viewport.setShellElement(this.std.host),this.std.provider.getAll(fd).forEach(e=>{e.mounted()})}unmounted(){this.std.provider.getAll(fd).forEach(e=>{e.unmounted()}),this.viewport.clearViewportElement(),this._disposables.dispose()}updateElement(e,n){var r;const i=typeof e=="string"?e:e.id;if((r=this.surface)!=null&&r.hasElementById(i))this.surface.updateElement(i,n);else{const s=this.doc.getBlock(i);s&&this.doc.updateBlock(s.model,n)}}fitToScreen(e={smooth:!1,padding:[0,0,0,0]}){var n;const r=(n=e.bounds)!=null?n:this.gfxElements.map(l=>X.deserialize(l.xywh)),i=$6(r),{zoom:s,centerX:o,centerY:a}=this.viewport.getFitToScreenData(i,e.padding,OU,PU);this.viewport.setViewport(s,[o,a],e.smooth)}}MS.key=TS;var yp=function(){try{var t=Va(Object,"defineProperty");return t({},"",{}),t}catch{}}();function DS(t,e,n){e=="__proto__"&&yp?yp(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function BU(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function FU(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var l=o[++i];if(n(s[l],l,s)===!1)break}return e}}var UU=FU();function $U(t,e){return t&&UU(t,e,cb)}function HU(t,e){return function(n,r){if(n==null)return n;if(!tS(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var zU=HU($U);function WU(t,e,n,r){return zU(t,function(i,s,o){e(r,i,n(i),o)}),r}var jU=1,YU=2;function GU(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],l=t[a],c=o[1];if(o[2]){if(l===void 0&&!(a in t))return!1}else{var u=new Ys,d;if(!(d===void 0?pp(c,l,jU|YU,r,u):d))return!1}}return!0}function NS(t){return t===t&&!Ws(t)}function VU(t){for(var e=cb(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,NS(i)]}return e}function OS(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function qU(t){var e=VU(t);return e.length==1&&e[0][2]?OS(e[0][0],e[0][1]):function(n){return n===t||GU(n,t,e)}}var XU=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KU=/^\w*$/;function Ob(t,e){if(bi(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||bp(t)?!0:KU.test(t)||!XU.test(t)||e!=null&&t in Object(e)}var QU="Expected a function";function Pb(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(QU);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Pb.Cache||js),n}Pb.Cache=js;var ZU=500;function JU(t){var e=Pb(t,function(r){return n.size===ZU&&n.clear(),r}),n=e.cache;return e}var e$=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,t$=/\\(\\)?/g,n$=JU(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(e$,function(n,r,i,s){e.push(i?s.replace(t$,"$1"):r||n)}),e});function r$(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var PS=Qi?Qi.prototype:void 0,LS=PS?PS.toString:void 0;function RS(t){if(typeof t=="string")return t;if(bi(t))return r$(t,RS)+"";if(bp(t))return LS?LS.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function i$(t){return t==null?"":RS(t)}function _p(t,e){return bi(t)?t:Ob(t,e)?[t]:n$(i$(t))}function md(t){if(typeof t=="string"||bp(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Lb(t,e){e=_p(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[md(e[n++])];return n&&n==r?t:void 0}function s$(t,e,n){var r=t==null?void 0:Lb(t,e);return r===void 0?n:r}function o$(t,e){return t!=null&&e in Object(t)}function a$(t,e,n){e=_p(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=md(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&ab(i)&&ob(o,i)&&(bi(t)||ib(t)))}function BS(t,e){return t!=null&&a$(t,e,o$)}var l$=1,c$=2;function u$(t,e){return Ob(t)&&NS(e)?OS(md(t),e):function(n){var r=s$(n,t);return r===void 0&&r===e?BS(n,t):pp(e,r,l$|c$)}}function FS(t){return t}function d$(t){return function(e){return e==null?void 0:e[t]}}function h$(t){return function(e){return Lb(e,t)}}function f$(t){return Ob(t)?d$(md(t)):h$(t)}function p$(t){return typeof t=="function"?t:t==null?FS:typeof t=="object"?bi(t)?u$(t[0],t[1]):qU(t):f$(t)}function m$(t,e){return function(n,r){var i=bi(n)?BU:WU,s=e?e():{};return i(n,t,p$(r),s)}}var g$=Object.prototype,b$=g$.hasOwnProperty,US=m$(function(t,e,n){b$.call(t,n)?t[n].push(e):DS(t,n,[e])});const y$=le.object({blockId:le.string()}),Rb=class KE extends Us{static fromJSON(e){const n=y$.parse(e);return new KE(n)}equals(e){return e instanceof KE?this.blockId===e.blockId:!1}toJSON(){return{type:"block",blockId:this.blockId}}};Rb.group="note",Rb.type="block";let Bb=Rb;const _$=So(Bb),x$=le.object({x:le.number(),y:le.number()}),Fb=class QE extends Us{constructor(e,n){super({blockId:"[gfx-cursor]"}),this.x=e,this.y=n}static fromJSON(e){const{x:n,y:r}=x$.parse(e);return new QE(n,r)}equals(e){return e instanceof QE?this.x===e.x&&this.y===e.y:!1}toJSON(){return{type:"cursor",x:this.x,y:this.y}}};Fb.group="gfx",Fb.type="cursor";let xp=Fb;const E$=So(xp),v$=le.object({blockId:le.string(),elements:le.array(le.string()),editing:le.boolean(),inoperable:le.boolean().optional()}),Ep=class ZE extends Us{constructor(e,n,r,i=!1){super({blockId:e}),this.elements=n,this.editing=r,this.inoperable=i}static fromJSON(e){const{blockId:n,elements:r,editing:i,inoperable:s}=v$.parse(e);return new ZE(n,r,i,s)}equals(e){return e instanceof ZE?this.blockId===e.blockId&&this.editing===e.editing&&this.inoperable===e.inoperable&&this.elements.length===e.elements.length&&this.elements.every((n,r)=>n===e.elements[r]):!1}isEmpty(){return this.elements.length===0&&!this.editing}toJSON(){return{type:"surface",blockId:this.blockId,elements:this.elements,editing:this.editing,inoperable:this.inoperable}}};Ep.group="gfx",Ep.type="surface",Ep.recoverable=!0;let gd=Ep;const w$=So(gd),k$=le.object({from:le.object({blockId:le.string(),index:le.number(),length:le.number()}),to:le.object({blockId:le.string(),index:le.number(),length:le.number()}).nullable(),reverse:le.boolean().optional()}),vp=class JE extends Us{get end(){var e;return this.reverse?this.from:(e=this.to)!=null?e:this.from}get start(){var e;return this.reverse?(e=this.to)!=null?e:this.from:this.from}constructor({from:e,to:n,reverse:r}){super({blockId:e.blockId}),this.from=e,this.to=this._equalPoint(e,n)?null:n,this.reverse=!!r}static fromJSON(e){const n=k$.parse(e);return new JE(n)}_equalPoint(e,n){return e&&n?e.blockId===n.blockId&&e.index===n.index&&e.length===n.length:e===n}empty(){return!!this.to}equals(e){return e instanceof JE?this.blockId===e.blockId&&this._equalPoint(e.from,this.from)&&this._equalPoint(e.to,this.to):!1}isCollapsed(){return this.to===null&&this.from.length===0}isInSameBlock(){return this.to===null||this.from.blockId===this.to.blockId}toJSON(){return{type:"text",from:this.from,to:this.to,reverse:this.reverse}}};vp.group="note",vp.type="text",vp.recoverable=!0;let Po=vp;const T$=So(Po);class $S extends gp{constructor(){super(...arguments),this._activeGroup=null,this._cursorSelection=null,this._lastSurfaceSelections=[],this._remoteCursorSelectionMap=new Map,this._remoteSelectedSet=new Set,this._remoteSurfaceSelectionsMap=new Map,this._selectedSet=new Set,this._surfaceSelections=[],this.disposable=new hn,this.slots={updated:new Ie,remoteUpdated:new Ie,cursorUpdated:new Ie,remoteCursorUpdated:new Ie}}get activeGroup(){return this._activeGroup}get cursorSelection(){return this._cursorSelection}get editing(){return this.surfaceSelections.some(e=>e.editing)}get empty(){return this.surfaceSelections.every(e=>e.elements.length===0)}get firstElement(){return this.selectedElements[0]}get inoperable(){return this.surfaceSelections.some(e=>e.inoperable)}get lastSurfaceSelections(){return this._lastSurfaceSelections}get remoteCursorSelectionMap(){return this._remoteCursorSelectionMap}get remoteSelectedSet(){return this._remoteSelectedSet}get remoteSurfaceSelectionsMap(){return this._remoteSurfaceSelectionsMap}get selectedBound(){return og(this.selectedElements)}get selectedElements(){const e=[];return this.selectedIds.forEach(n=>{const r=this.gfx.getElementById(n);r&&e.push(r)}),e}get selectedIds(){return[...this._selectedSet]}get selectedSet(){return this._selectedSet}get stdSelection(){return this.std.selection}get surfaceModel(){return this.gfx.surface}get surfaceSelections(){return this._surfaceSelections}static extendGfx(e){Object.defineProperty(e,"selection",{get(){return this.std.get(fd("gfxSelection"))}})}clear(){this.stdSelection.clear(),this.set({elements:[],editing:!1})}clearLast(){this._lastSurfaceSelections=[]}equals(e){let n=0,r=!1;return e.every(s=>{const o=s.elements.every(a=>this._selectedSet.has(a));return o&&(n+=s.elements.length),s.editing&&(r=!0),o})&&n===this._selectedSet.size&&r===this.editing}has(e){return this._selectedSet.has(e)}hasRemote(e){return this._remoteSelectedSet.has(e)}isEmpty(e){return e.every(n=>n.elements.length===0)}isInSelectedRect(e,n){const r=this.selectedElements;if(!r.length)return!1;const i=og(r);return!!(i&&i.isPointInBound([e,n]))}mounted(){this.disposable.add(this.stdSelection.slots.changed.subscribe(e=>{var n;const{cursor:r=[],surface:i=[]}=US(e,s=>s.is(gd)?"surface":s.is(xp)?"cursor":"none");r[0]&&!((n=this.cursorSelection)!=null&&n.equals(r[0]))&&(this._cursorSelection=r[0],this.slots.cursorUpdated.next(r[0])),!(i.length===0&&this.empty||this.equals(i))&&(this._lastSurfaceSelections=this.surfaceSelections,this._surfaceSelections=i,this._selectedSet=new Set,i.forEach(s=>s.elements.forEach(o=>{this._selectedSet.add(o)})),this.slots.updated.next(this.surfaceSelections))})),this.disposable.add(this.stdSelection.slots.remoteChanged.subscribe(e=>{const n=new Map,r=new Map,i=new Set;e.forEach((s,o)=>{let a=!1,l=!1;s.forEach(c=>{var u;if(c.is(Po)&&(a=!0),c.is(Bb)&&(l=!0),c.is(gd)){const d=(u=n.get(o))!=null?u:[];d.push(c),n.set(o,d),c.elements.forEach(h=>i.add(h))}c.is(xp)&&r.set(o,c)}),(l||a)&&n.delete(o),a&&r.delete(o)}),this._remoteCursorSelectionMap=r,this._remoteSurfaceSelectionsMap=n,this._remoteSelectedSet=i,this.slots.remoteUpdated.next(),this.slots.remoteCursorUpdated.next()}))}set(e){var n;if(Array.isArray(e)){this.stdSelection.setGroup("gfx",this.cursorSelection?[...e,this.cursorSelection]:e);return}const{blocks:r=[],elements:i=[]}=US(e.elements,o=>this.std.store.hasBlock(o)?"blocks":"elements");let s=[];i.length>0&&this.surfaceModel&&s.push(this.stdSelection.create(gd,this.surfaceModel.id,i,(n=e.editing)!=null?n:!1,e.inoperable)),r.length>0&&(s=s.concat(r.map(o=>{var a;return this.stdSelection.create(gd,o,[o],(a=e.editing)!=null?a:!1,e.inoperable)}))),this.stdSelection.setGroup("gfx",this.cursorSelection?s.concat([this.cursorSelection]):s),s.length>0&&this.stdSelection.setGroup("note",[]),e.elements.length===1&&this.firstElement instanceof dc?this._activeGroup=this.firstElement:(this.selectedElements.some(o=>o.group!==this._activeGroup)||this.selectedElements.length===0)&&(this._activeGroup=null)}toggle(e){e=typeof e=="string"?e:e.id,this.set({elements:this.has(e)?this.selectedIds.filter(n=>n!==e):[...this.selectedIds,e]})}setCursor(e){const n=this.stdSelection.create(xp,e.x,e.y);this.stdSelection.setGroup("gfx",[...this.surfaceSelections,n])}unmounted(){this.disposable.dispose()}}$S.key="gfxSelection";class S$ extends nd{constructor(e){super(),this.std=e}get gfx(){return this.std.provider.get(Tb)}static setup(e){if(!this.key)throw new V(re.ValueNotExists,"The surface middleware builder should have a static key property.");e.addImpl(HS(this.key),this,[Y0])}mounted(){}unmounted(){}}S$.key="";const HS=Me("SurfaceMiddlewareBuilder");class zS extends Xi{mounted(){const e=Array.from(this.std.provider.getAll(HS).values()),n=kb(this.std.store,r=>{r&&(r.applyMiddlewares(e.map(i=>i.middleware)),queueMicrotask(()=>n()))})}}zS.key="surfaceMiddleware";const WS=Me("GfxElementModelView");class C${constructor(e,n){this.gfx=n,this._handlers=new Map,this._isConnected=!0,this.disposable=new hn,this.model=e}get isConnected(){return this._isConnected}get rotate(){return this.model.rotate}get surface(){return this.model.surface}get type(){return this.model.type}get std(){return this.gfx.std}static setup(e){if(!this.type)throw new V(re.ValueNotExists,"The GfxElementModelView should have a static `type` property.");e.addImpl(WS(this.type),()=>this)}containsBound(e){return this.model.containsBound(e)}dispatch(e,n){const r=this._handlers.get(e);return r!=null&&r.length?(r.forEach(i=>i(n)),!0):!1}getLineIntersections(e,n){return this.model.getLineIntersections(e,n)}getNearestPoint(e){return this.model.getNearestPoint(e)}getRelativePointLocation(e){return this.model.getRelativePointLocation(e)}includesPoint(e,n,r,i){return this.model.includesPoint(e,n,r,i)}intersectsBound(e){return this.containsBound(e)||e.points.some((n,r,i)=>this.getLineIntersections(n,i[(r+1)%i.length]))}off(e,n){if(!this._handlers.has(e))return;const r=this._handlers.get(e),i=r.indexOf(n);i!==-1&&r.splice(i,1)}on(e,n){return this._handlers.has(e)||this._handlers.set(e,[]),this._handlers.get(e).push(n),()=>this.off(e,n)}once(e,n){const r=this.on(e,i=>{r(),n(i)});return r}onCreated(){}onDragStart(e){this.model instanceof Lt&&this.model.stash("xywh")}onDragEnd(e){this.model instanceof Lt&&this.model.pop("xywh")}onDragMove({dx:e,dy:n,currentBound:r}){this.model.xywh=r.moveDelta(e,n).serialize()}onBoxSelected(e){}onDestroyed(){this._isConnected=!1,this.disposable.dispose(),this._handlers.clear()}render(e){}}const fc={string:t=>typeof t=="string",number:t=>typeof t=="number",boolean:t=>typeof t=="boolean",object:t=>typeof t=="object",array:t=>Array.isArray(t),instanceOf:t=>e=>e instanceof t,arrayOf:t=>e=>Array.isArray(e)&&e.every(t),recordOf:t=>e=>typeof e!="object"||e===null?!1:Object.values(e).every(t),of:t=>e=>t(e)};function A$(t,e){for(const[n,r]of Object.entries(e)){const i=n;if(t[i]===void 0)throw new V(re.DefaultRuntimeError,`Property ${n} is required to ${t.constructor.name}.`);if(r&&!r(t[i]))throw new V(re.DefaultRuntimeError,`Property ${n} is invalid to ${t.constructor.name}.`)}}function jS(t){return function(e){const n=e.prototype.connectedCallback;e.prototype.connectedCallback=function(){n&&n.call(this),A$(this,t)}}}/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Ub(t){class e extends t{connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){var r;super.disconnectedCallback(),(r=this.__dispose)==null||r.call(this)}performUpdate(){var r;if(this.isUpdatePending===!1||this.isConnected===!1)return;(r=this.__dispose)==null||r.call(this);let i=!0;this.__dispose=Pu(()=>{i?(i=!1,super.performUpdate()):this.requestUpdate()})}}return e}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const bd=globalThis,wp=bd.trustedTypes,YS=wp?wp.createPolicy("lit-html",{createHTML:t=>t}):void 0,GS="$lit$",Lo=`lit$${Math.random().toFixed(9).slice(2)}$`,VS="?"+Lo,I$=`<${VS}>`,Xa=document,yd=()=>Xa.createComment(""),_d=t=>t===null||typeof t!="object"&&typeof t!="function",$b=Array.isArray,M$=t=>$b(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",Hb=`[ 	
\f\r]`,xd=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,qS=/-->/g,XS=/>/g,Ka=RegExp(`>|${Hb}(?:([^\\s"'>=/]+)(${Hb}*=${Hb}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),KS=/'/g,QS=/"/g,ZS=/^(?:script|style|textarea|title)$/i,D$=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),kp=D$(1),Qa=Symbol.for("lit-noChange"),St=Symbol.for("lit-nothing"),JS=new WeakMap,Za=Xa.createTreeWalker(Xa,129);function e2(t,e){if(!$b(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return YS!==void 0?YS.createHTML(e):e}const N$=(t,e)=>{const n=t.length-1,r=[];let i,s=e===2?"<svg>":e===3?"<math>":"",o=xd;for(let a=0;a<n;a++){const l=t[a];let c,u,d=-1,h=0;for(;h<l.length&&(o.lastIndex=h,u=o.exec(l),u!==null);)h=o.lastIndex,o===xd?u[1]==="!--"?o=qS:u[1]!==void 0?o=XS:u[2]!==void 0?(ZS.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=Ka):u[3]!==void 0&&(o=Ka):o===Ka?u[0]===">"?(o=i??xd,d=-1):u[1]===void 0?d=-2:(d=o.lastIndex-u[2].length,c=u[1],o=u[3]===void 0?Ka:u[3]==='"'?QS:KS):o===QS||o===KS?o=Ka:o===qS||o===XS?o=xd:(o=Ka,i=void 0);const f=o===Ka&&t[a+1].startsWith("/>")?" ":"";s+=o===xd?l+I$:d>=0?(r.push(c),l.slice(0,d)+GS+l.slice(d)+Lo+f):l+Lo+(d===-2?a:f)}return[e2(t,s+(t[n]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};class Ed{constructor({strings:e,_$litType$:n},r){let i;this.parts=[];let s=0,o=0;const a=e.length-1,l=this.parts,[c,u]=N$(e,n);if(this.el=Ed.createElement(c,r),Za.currentNode=this.el.content,n===2||n===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(i=Za.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const d of i.getAttributeNames())if(d.endsWith(GS)){const h=u[o++],f=i.getAttribute(d).split(Lo),p=/([.?@])?(.*)/.exec(h);l.push({type:1,index:s,name:p[2],strings:f,ctor:p[1]==="."?P$:p[1]==="?"?L$:p[1]==="@"?R$:Tp}),i.removeAttribute(d)}else d.startsWith(Lo)&&(l.push({type:6,index:s}),i.removeAttribute(d));if(ZS.test(i.tagName)){const d=i.textContent.split(Lo),h=d.length-1;if(h>0){i.textContent=wp?wp.emptyScript:"";for(let f=0;f<h;f++)i.append(d[f],yd()),Za.nextNode(),l.push({type:2,index:++s});i.append(d[h],yd())}}}else if(i.nodeType===8)if(i.data===VS)l.push({type:2,index:s});else{let d=-1;for(;(d=i.data.indexOf(Lo,d+1))!==-1;)l.push({type:7,index:s}),d+=Lo.length-1}s++}}static createElement(e,n){const r=Xa.createElement("template");return r.innerHTML=e,r}}function pc(t,e,n=t,r){var o,a;if(e===Qa)return e;let i=r!==void 0?(o=n._$Co)==null?void 0:o[r]:n._$Cl;const s=_d(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==s&&((a=i==null?void 0:i._$AO)==null||a.call(i,!1),s===void 0?i=void 0:(i=new s(t),i._$AT(t,n,r)),r!==void 0?(n._$Co??(n._$Co=[]))[r]=i:n._$Cl=i),i!==void 0&&(e=pc(t,i._$AS(t,e.values),i,r)),e}let O$=class{constructor(e,n){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:n},parts:r}=this._$AD,i=((e==null?void 0:e.creationScope)??Xa).importNode(n,!0);Za.currentNode=i;let s=Za.nextNode(),o=0,a=0,l=r[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new mc(s,s.nextSibling,this,e):l.type===1?c=new l.ctor(s,l.name,l.strings,this,e):l.type===6&&(c=new B$(s,this,e)),this._$AV.push(c),l=r[++a]}o!==(l==null?void 0:l.index)&&(s=Za.nextNode(),o++)}return Za.currentNode=Xa,i}p(e){let n=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,n),n+=r.strings.length-2):r._$AI(e[n])),n++}};class mc{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,n,r,i){this.type=2,this._$AH=St,this._$AN=void 0,this._$AA=e,this._$AB=n,this._$AM=r,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=n.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,n=this){e=pc(this,e,n),_d(e)?e===St||e==null||e===""?(this._$AH!==St&&this._$AR(),this._$AH=St):e!==this._$AH&&e!==Qa&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):M$(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==St&&_d(this._$AH)?this._$AA.nextSibling.data=e:this.T(Xa.createTextNode(e)),this._$AH=e}$(e){var s;const{values:n,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=Ed.createElement(e2(r.h,r.h[0]),this.options)),r);if(((s=this._$AH)==null?void 0:s._$AD)===i)this._$AH.p(n);else{const o=new O$(i,this),a=o.u(this.options);o.p(n),this.T(a),this._$AH=o}}_$AC(e){let n=JS.get(e.strings);return n===void 0&&JS.set(e.strings,n=new Ed(e)),n}k(e){$b(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let r,i=0;for(const s of e)i===n.length?n.push(r=new mc(this.O(yd()),this.O(yd()),this,this.options)):r=n[i],r._$AI(s),i++;i<n.length&&(this._$AR(r&&r._$AB.nextSibling,i),n.length=i)}_$AR(e=this._$AA.nextSibling,n){var r;for((r=this._$AP)==null?void 0:r.call(this,!1,!0,n);e&&e!==this._$AB;){const i=e.nextSibling;e.remove(),e=i}}setConnected(e){var n;this._$AM===void 0&&(this._$Cv=e,(n=this._$AP)==null||n.call(this,e))}}let Tp=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,n,r,i,s){this.type=1,this._$AH=St,this._$AN=void 0,this.element=e,this.name=n,this._$AM=i,this.options=s,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=St}_$AI(e,n=this,r,i){const s=this.strings;let o=!1;if(s===void 0)e=pc(this,e,n,0),o=!_d(e)||e!==this._$AH&&e!==Qa,o&&(this._$AH=e);else{const a=e;let l,c;for(e=s[0],l=0;l<s.length-1;l++)c=pc(this,a[r+l],n,l),c===Qa&&(c=this._$AH[l]),o||(o=!_d(c)||c!==this._$AH[l]),c===St?e=St:e!==St&&(e+=(c??"")+s[l+1]),this._$AH[l]=c}o&&!i&&this.j(e)}j(e){e===St?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}};class P$ extends Tp{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===St?void 0:e}}class L$ extends Tp{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==St)}}class R$ extends Tp{constructor(e,n,r,i,s){super(e,n,r,i,s),this.type=5}_$AI(e,n=this){if((e=pc(this,e,n,0)??St)===Qa)return;const r=this._$AH,i=e===St&&r!==St||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==St&&(r===St||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var n;typeof this._$AH=="function"?this._$AH.call(((n=this.options)==null?void 0:n.host)??this.element,e):this._$AH.handleEvent(e)}}class B${constructor(e,n,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=n,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){pc(this,e)}}const F$={I:mc},zb=bd.litHtmlPolyfillSupport;zb==null||zb(Ed,mc),(bd.litHtmlVersions??(bd.litHtmlVersions=[])).push("3.3.0");const U$=(t,e,n)=>{const r=(n==null?void 0:n.renderBefore)??e;let i=r._$litPart$;if(i===void 0){const s=(n==null?void 0:n.renderBefore)??null;r._$litPart$=i=new mc(e.insertBefore(yd(),s),s,void 0,n??{})}return i._$AI(t),i};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{I:$$}=F$,t2=()=>document.createComment(""),vd=(t,e,n)=>{var s;const r=t._$AA.parentNode,i=e===void 0?t._$AB:e._$AA;if(n===void 0){const o=r.insertBefore(t2(),i),a=r.insertBefore(t2(),i);n=new $$(o,a,t,t.options)}else{const o=n._$AB.nextSibling,a=n._$AM,l=a!==t;if(l){let c;(s=n._$AQ)==null||s.call(n,t),n._$AM=t,n._$AP!==void 0&&(c=t._$AU)!==a._$AU&&n._$AP(c)}if(o!==i||l){let c=n._$AA;for(;c!==o;){const u=c.nextSibling;r.insertBefore(c,i),c=u}}}return n},Ja=(t,e,n=t)=>(t._$AI(e,n),t),H$={},n2=(t,e=H$)=>t._$AH=e,z$=t=>t._$AH,Wb=t=>{var r;(r=t._$AP)==null||r.call(t,!1,!0);let e=t._$AA;const n=t._$AB.nextSibling;for(;e!==n;){const i=e.nextSibling;e.remove(),e=i}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const W$={CHILD:2},r2=t=>(...e)=>({_$litDirective$:t,values:e});let i2=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,n,r){this._$Ct=e,this._$AM=n,this._$Ci=r}_$AS(e,n){return this.update(e,n)}update(e,n){return this.render(...n)}};function jb(t){class e extends t{constructor(){super(...arguments),this._disposables=new hn}get disposables(){return this._disposables}connectedCallback(){super.connectedCallback(),this._disposables.disposed&&(this._disposables=new hn)}disconnectedCallback(){super.disconnectedCallback(),this._disposables.dispose()}}return e}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let s2=class extends Event{constructor(e,n,r,i){super("context-request",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=n,this.callback=r,this.subscribe=i??!1}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Rge(t){return t}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let o2=class{constructor(e,n,r,i){if(this.subscribe=!1,this.provided=!1,this.value=void 0,this.t=(s,o)=>{this.unsubscribe&&(this.unsubscribe!==o&&(this.provided=!1,this.unsubscribe()),this.subscribe||this.unsubscribe()),this.value=s,this.host.requestUpdate(),this.provided&&!this.subscribe||(this.provided=!0,this.callback&&this.callback(s,o)),this.unsubscribe=o},this.host=e,n.context!==void 0){const s=n;this.context=s.context,this.callback=s.callback,this.subscribe=s.subscribe??!1}else this.context=n,this.callback=r,this.subscribe=i??!1;this.host.addController(this)}hostConnected(){this.dispatchRequest()}hostDisconnected(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}dispatchRequest(){this.host.dispatchEvent(new s2(this.context,this.host,this.t,this.subscribe))}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let j$=class{get value(){return this.o}set value(e){this.setValue(e)}setValue(e,n=!1){const r=n||!Object.is(e,this.o);this.o=e,r&&this.updateObservers()}constructor(e){this.subscriptions=new Map,this.updateObservers=()=>{for(const[n,{disposer:r}]of this.subscriptions)n(this.o,r)},e!==void 0&&(this.value=e)}addCallback(e,n,r){if(!r)return void e(this.value);this.subscriptions.has(e)||this.subscriptions.set(e,{disposer:()=>{this.subscriptions.delete(e)},consumerHost:n});const{disposer:i}=this.subscriptions.get(e);e(this.value,i)}clearCallbacks(){this.subscriptions.clear()}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Y$=class extends Event{constructor(e,n){super("context-provider",{bubbles:!0,composed:!0}),this.context=e,this.contextTarget=n}},a2=class extends j${constructor(e,n,r){var i,s;super(n.context!==void 0?n.initialValue:r),this.onContextRequest=o=>{if(o.context!==this.context)return;const a=o.contextTarget??o.composedPath()[0];a!==this.host&&(o.stopPropagation(),this.addCallback(o.callback,a,o.subscribe))},this.onProviderRequest=o=>{if(o.context!==this.context||(o.contextTarget??o.composedPath()[0])===this.host)return;const a=new Set;for(const[l,{consumerHost:c}]of this.subscriptions)a.has(l)||(a.add(l),c.dispatchEvent(new s2(this.context,c,l,!0)));o.stopPropagation()},this.host=e,n.context!==void 0?this.context=n.context:this.context=n,this.attachListeners(),(s=(i=this.host).addController)==null||s.call(i,this)}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest),this.host.addEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new Y$(this.context,this.host))}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Sp({context:t}){return(e,n)=>{const r=new WeakMap;if(typeof n=="object")return{get(){return e.get.call(this)},set(i){return r.get(this).setValue(i),e.set.call(this,i)},init(i){return r.set(this,new a2(this,{context:t,initialValue:i})),i}};{e.constructor.addInitializer(o=>{r.set(o,new a2(o,{context:t}))});const i=Object.getOwnPropertyDescriptor(e,n);let s;if(i===void 0){const o=new WeakMap;s={get(){return o.get(this)},set(a){r.get(this).setValue(a),o.set(this,a)},configurable:!0,enumerable:!0}}else{const o=i.set;s={...i,set(a){r.get(this).setValue(a),o==null||o.call(this,a)}}}return void Object.defineProperty(e,n,s)}}}/**
 * @license
 * Copyright 2022 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function l2({context:t,subscribe:e}){return(n,r)=>{typeof r=="object"?r.addInitializer(function(){new o2(this,{context:t,callback:i=>{n.set.call(this,i)},subscribe:e})}):n.constructor.addInitializer(i=>{new o2(i,{context:t,callback:s=>{i[r]=s},subscribe:e})})}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Cp=globalThis,Yb=Cp.ShadowRoot&&(Cp.ShadyCSS===void 0||Cp.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Gb=Symbol(),c2=new WeakMap;let Ap=class{constructor(e,n,r){if(this._$cssResult$=!0,r!==Gb)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=n}get styleSheet(){let e=this.o;const n=this.t;if(Yb&&e===void 0){const r=n!==void 0&&n.length===1;r&&(e=c2.get(n)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&c2.set(n,e))}return e}toString(){return this.cssText}};const G$=t=>new Ap(typeof t=="string"?t:t+"",void 0,Gb),u2=(t,...e)=>{const n=t.length===1?t[0]:e.reduce((r,i,s)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[s+1],t[0]);return new Ap(n,t,Gb)},V$=(t,e)=>{if(Yb)t.adoptedStyleSheets=e.map(n=>n instanceof CSSStyleSheet?n:n.styleSheet);else for(const n of e){const r=document.createElement("style"),i=Cp.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=n.cssText,t.appendChild(r)}},d2=Yb?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let n="";for(const r of e.cssRules)n+=r.cssText;return G$(n)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:q$,defineProperty:X$,getOwnPropertyDescriptor:K$,getOwnPropertyNames:Q$,getOwnPropertySymbols:Z$,getPrototypeOf:J$}=Object,Ro=globalThis,h2=Ro.trustedTypes,eH=h2?h2.emptyScript:"",Vb=Ro.reactiveElementPolyfillSupport,wd=(t,e)=>t,Ip={toAttribute(t,e){switch(e){case Boolean:t=t?eH:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=t!==null;break;case Number:n=t===null?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch{n=null}}return n}},qb=(t,e)=>!q$(t,e),f2={attribute:!0,type:String,converter:Ip,reflect:!1,useDefault:!1,hasChanged:qb};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Ro.litPropertyMetadata??(Ro.litPropertyMetadata=new WeakMap);let gc=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,n=f2){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(e,n),!n.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(e,r,n);i!==void 0&&X$(this.prototype,e,i)}}static getPropertyDescriptor(e,n,r){const{get:i,set:s}=K$(this.prototype,e)??{get(){return this[n]},set(o){this[n]=o}};return{get:i,set(o){const a=i==null?void 0:i.call(this);s==null||s.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??f2}static _$Ei(){if(this.hasOwnProperty(wd("elementProperties")))return;const e=J$(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(wd("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(wd("properties"))){const n=this.properties,r=[...Q$(n),...Z$(n)];for(const i of r)this.createProperty(i,n[i])}const e=this[Symbol.metadata];if(e!==null){const n=litPropertyMetadata.get(e);if(n!==void 0)for(const[r,i]of n)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[n,r]of this.elementProperties){const i=this._$Eu(n,r);i!==void 0&&this._$Eh.set(i,n)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const n=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const i of r)n.unshift(d2(i))}else e!==void 0&&n.push(d2(e));return n}static _$Eu(e,n){const r=n.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(n=>this.enableUpdating=n),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(n=>n(this))}addController(e){var n;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)==null||n.call(e))}removeController(e){var n;(n=this._$EO)==null||n.delete(e)}_$E_(){const e=new Map,n=this.constructor.elementProperties;for(const r of n.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return V$(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(n=>{var r;return(r=n.hostConnected)==null?void 0:r.call(n)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(n=>{var r;return(r=n.hostDisconnected)==null?void 0:r.call(n)})}attributeChangedCallback(e,n,r){this._$AK(e,r)}_$ET(e,n){var s;const r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){const o=(((s=r.converter)==null?void 0:s.toAttribute)!==void 0?r.converter:Ip).toAttribute(n,r.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,n){var s,o;const r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const a=r.getPropertyOptions(i),l=typeof a.converter=="function"?{fromAttribute:a.converter}:((s=a.converter)==null?void 0:s.fromAttribute)!==void 0?a.converter:Ip;this._$Em=i,this[i]=l.fromAttribute(n,a.type)??((o=this._$Ej)==null?void 0:o.get(i))??null,this._$Em=null}}requestUpdate(e,n,r){var i;if(e!==void 0){const s=this.constructor,o=this[e];if(r??(r=s.getPropertyOptions(e)),!((r.hasChanged??qb)(o,n)||r.useDefault&&r.reflect&&o===((i=this._$Ej)==null?void 0:i.get(e))&&!this.hasAttribute(s._$Eu(e,r))))return;this.C(e,n,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,n,{useDefault:r,reflect:i,wrapped:s},o){r&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??n??this[e]),s!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(n=void 0),this._$AL.set(e,n)),i===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(n){Promise.reject(n)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var r;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[s,o]of this._$Ep)this[s]=o;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[s,o]of i){const{wrapped:a}=o,l=this[s];a!==!0||this._$AL.has(s)||l===void 0||this.C(s,void 0,o,l)}}let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),(r=this._$EO)==null||r.forEach(i=>{var s;return(s=i.hostUpdate)==null?void 0:s.call(i)}),this.update(n)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(n)}willUpdate(e){}_$AE(e){var n;(n=this._$EO)==null||n.forEach(r=>{var i;return(i=r.hostUpdated)==null?void 0:i.call(r)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(n=>this._$ET(n,this[n]))),this._$EM()}updated(e){}firstUpdated(e){}};gc.elementStyles=[],gc.shadowRootOptions={mode:"open"},gc[wd("elementProperties")]=new Map,gc[wd("finalized")]=new Map,Vb==null||Vb({ReactiveElement:gc}),(Ro.reactiveElementVersions??(Ro.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const el=globalThis;let bc=class extends gc{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var n;const e=super.createRenderRoot();return(n=this.renderOptions).renderBefore??(n.renderBefore=e.firstChild),e}update(e){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=U$(n,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Qa}};bc._$litElement$=!0,bc.finalized=!0,(m6=el.litElementHydrateSupport)==null||m6.call(el,{LitElement:bc});const Xb=el.litElementPolyfillSupport;Xb==null||Xb({LitElement:bc}),(el.litElementVersions??(el.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const tH={attribute:!0,type:String,converter:Ip,reflect:!1,hasChanged:qb},nH=(t=tH,e,n)=>{const{kind:r,metadata:i}=n;let s=globalThis.litPropertyMetadata.get(i);if(s===void 0&&globalThis.litPropertyMetadata.set(i,s=new Map),r==="setter"&&((t=Object.create(t)).wrapped=!0),s.set(n.name,t),r==="accessor"){const{name:o}=n;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,t)},init(a){return a!==void 0&&this.C(o,void 0,t,a),a}}}if(r==="setter"){const{name:o}=n;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,t)}}throw Error("Unsupported decorator location: "+r)};function yc(t){return(e,n)=>typeof n=="object"?nH(t,e,n):((r,i,s)=>{const o=i.hasOwnProperty(s);return i.constructor.createProperty(s,r),o?Object.getOwnPropertyDescriptor(i,s):void 0})(t,e,n)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Kb(t){return yc({...t,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const rH=(t,e,n)=>{for(const r of e)if(r[0]===t)return(0,r[1])();return n==null?void 0:n()};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function p2(t,e,n){return t?e(t):n==null?void 0:n(t)}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const m2=Symbol.for(""),iH=t=>{if((t==null?void 0:t.r)===m2)return t==null?void 0:t._$litStatic$},g2=t=>({_$litStatic$:t,r:m2}),b2=new Map,sH=t=>(e,...n)=>{const r=n.length;let i,s;const o=[],a=[];let l,c=0,u=!1;for(;c<r;){for(l=e[c];c<r&&(s=n[c],(i=iH(s))!==void 0);)l+=i+e[++c],u=!0;c!==r&&a.push(s),o.push(l),c++}if(c===r&&o.push(e[r]),u){const d=o.join("$$lit$$");(e=b2.get(d))===void 0&&(o.raw=o,b2.set(d,e=o)),n=a}return t(e,...n)},_c=sH(kp),oH="model",aH="service",lH=Symbol("blockComponent"),cH="data-widget-id",Qb="data-block-id";/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const y2=(t,e,n)=>{const r=new Map;for(let i=e;i<=n;i++)r.set(t[i],i);return r},uH=r2(class extends i2{constructor(t){if(super(t),t.type!==W$.CHILD)throw Error("repeat() can only be used in text expressions")}dt(t,e,n){let r;n===void 0?n=e:e!==void 0&&(r=e);const i=[],s=[];let o=0;for(const a of t)i[o]=r?r(a,o):o,s[o]=n(a,o),o++;return{values:s,keys:i}}render(t,e,n){return this.dt(t,e,n).values}update(t,[e,n,r]){const i=z$(t),{values:s,keys:o}=this.dt(e,n,r);if(!Array.isArray(i))return this.ut=o,s;const a=this.ut??(this.ut=[]),l=[];let c,u,d=0,h=i.length-1,f=0,p=s.length-1;for(;d<=h&&f<=p;)if(i[d]===null)d++;else if(i[h]===null)h--;else if(a[d]===o[f])l[f]=Ja(i[d],s[f]),d++,f++;else if(a[h]===o[p])l[p]=Ja(i[h],s[p]),h--,p--;else if(a[d]===o[p])l[p]=Ja(i[d],s[p]),vd(t,l[p+1],i[d]),d++,p--;else if(a[h]===o[f])l[f]=Ja(i[h],s[f]),vd(t,i[d],i[h]),h--,f++;else if(c===void 0&&(c=y2(o,f,p),u=y2(a,d,h)),c.has(a[d]))if(c.has(a[h])){const g=u.get(o[f]),b=g!==void 0?i[g]:null;if(b===null){const _=vd(t,i[d]);Ja(_,s[f]),l[f]=_}else l[f]=Ja(b,s[f]),vd(t,i[d],b),i[g]=null;f++}else Wb(i[h]),h--;else Wb(i[d]),d++;for(;f<=p;){const g=vd(t,l[p+1]);Ja(g,s[f]),l[f++]=g}for(;d<=h;){const g=i[d++];g!==null&&Wb(g)}return this.ut=o,n2(t,l),Qa}});class kd extends bc{static finalizeStyles(e){const n=super.finalizeStyles(e);return n.forEach(r=>{if(r instanceof Ap&&typeof document<"u"){const i=document.head,s=document.createElement("style");s.textContent=r.cssText,i.append(s)}}),n}getConnectedCount(){var e,n;const r=this.constructor;return(n=(e=r.connectedCount.get(r))==null?void 0:e.get(this.getRootNode()))!=null?n:0}setConnectedCount(e){var n;const r=this.constructor;r.connectedCount.has(r)||r.connectedCount.set(r,new WeakMap),(n=r.connectedCount.get(r))==null||n.set(this.getRootNode(),e)}connectedCallback(){var e;super.connectedCallback();const n=this.getRootNode(),r=this.constructor,i=n instanceof ShadowRoot,s=this.getConnectedCount();if(s===0&&i){const o=r.elementStyles,a=[];o.forEach(l=>{if(l instanceof Ap&&typeof document<"u"){const c=document.createElement("style");c.textContent=l.cssText,n.prepend(c),a.push(c)}}),r.onDisconnectedMap.has(r)||r.onDisconnectedMap.set(r,new WeakMap),(e=r.onDisconnectedMap.get(r))==null||e.set(n,()=>{a.forEach(l=>l.remove())})}this.setConnectedCount(s+1)}createRenderRoot(){return this}disconnectedCallback(){var e,n;const r=this.getRootNode();super.disconnectedCallback();const i=this.constructor;let s=this.getConnectedCount();s--,this.setConnectedCount(s),s===0&&((n=(e=i.onDisconnectedMap.get(i))==null?void 0:e.get(r))==null||n())}}kd.connectedCount=new WeakMap,kd.onDisconnectedMap=new WeakMap;var dH=Object.create,Zb=Object.defineProperty,hH=Object.getOwnPropertyDescriptor,_2=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),xc=t=>{throw TypeError(t)},fH=(t,e,n)=>e in t?Zb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,x2=(t,e)=>Zb(t,"name",{value:e,configurable:!0}),pH=t=>{var e;return[,,,dH((e=t==null?void 0:t[_2("metadata")])!=null?e:null)]},E2=["class","method","getter","setter","accessor","field","value","get","set"],Td=t=>t!==void 0&&typeof t!="function"?xc("Function expected"):t,mH=(t,e,n,r,i)=>({kind:E2[t],name:e,metadata:r,addInitializer:s=>n._?xc("Already initialized"):i.push(Td(s||null))}),gH=(t,e)=>fH(e,_2("metadata"),t[3]),Sd=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Jb=(t,e,n,r,i,s)=>{var o,a,l,c,u,d=e&7,h=!!(e&8),f=!!(e&16),p=d>3?t.length+1:d?h?1:2:0,g=E2[d+5],b=d>3&&(t[p-1]=[]),_=t[p]||(t[p]=[]),y=d&&(!f&&!h&&(i=i.prototype),d<5&&(d>3||!f)&&hH(d<4?i:{get[n](){return v2(this,s)},set[n](E){return k2(this,s,E)}},n));d?f&&d<4&&x2(s,(d>2?"set ":d>1?"get ":"")+n):x2(i,n);for(var x=r.length-1;x>=0;x--)c=mH(d,n,l={},t[3],_),d&&(c.static=h,c.private=f,u=c.access={has:f?E=>bH(i,E):E=>n in E},d^3&&(u.get=f?E=>(d^1?v2:yH)(E,i,d^4?s:y.get):E=>E[n]),d>2&&(u.set=f?(E,I)=>k2(E,i,I,d^4?s:y.set):(E,I)=>E[n]=I)),a=(0,r[x])(d?d<4?f?s:y[g]:d>4?void 0:{get:y.get,set:y.set}:i,c),l._=1,d^4||a===void 0?Td(a)&&(d>4?b.unshift(a):d?f?s=a:y[g]=a:i=a):typeof a!="object"||a===null?xc("Object expected"):(Td(o=a.get)&&(y.get=o),Td(o=a.set)&&(y.set=o),Td(o=a.init)&&b.unshift(o));return d||gH(t,i),y&&Zb(i,n,y),f?d^4?s:y:i},e1=(t,e,n)=>e.has(t)||xc("Cannot "+n),bH=(t,e)=>Object(e)!==e?xc('Cannot use the "in" operator on this value'):t.has(e),v2=(t,e,n)=>(e1(t,e,"read from private field"),n?n.call(t):e.get(t)),w2=(t,e,n)=>e.has(t)?xc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),k2=(t,e,n,r)=>(e1(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),yH=(t,e,n)=>(e1(t,e,"access private method"),n),T2,S2,t1,C2,Gs,n1,r1;const A2="store",I2="std";C2=[jS({store:fc.instanceOf(N0),std:fc.object})];class Vs extends(t1=Ub(jb(kd)),S2=[Sp({context:A2}),yc({attribute:!1})],T2=[Sp({context:I2}),yc({attribute:!1})],t1){constructor(){super(...arguments),this._renderModel=e=>{const{flavour:n}=e,r=this.store.getBlock(e.id);if(!r||r.blockViewType==="hidden")return _c`${St}`;const i=this.store.schema.flavourSchemaMap.get(n),s=this.std.getView(n);if(!i||!s)return console.warn(`Cannot find render flavour ${n}.`),_c`${St}`;const o=this.std.provider.getAll(MT),a=Array.from(o.entries()).reduce((c,[u,d])=>{const[h,f]=u.split("|");if(h===n){const p=_c`<${d} ${g2(cH)}=${f}></${d}>`;c[f]=p}return c},{}),l=typeof s=="function"?s(e):s;return _c`<${l}
      ${g2(Qb)}=${e.id}
      .widgets=${a}
      .viewType=${r.blockViewType}
    ></${l}>`},this.renderChildren=(e,n)=>_c`${uH(e.children.filter(n??(()=>!0)),r=>r.id,r=>this._renderModel(r))}`,w2(this,n1,Sd(Gs,8,this)),Sd(Gs,11,this),w2(this,r1,Sd(Gs,12,this)),Sd(Gs,15,this)}get command(){return this.std.command}get event(){return this.std.event}get range(){return this.std.range}get selection(){return this.std.selection}get view(){return this.std.view}connectedCallback(){if(super.connectedCallback(),!this.store.root)throw new V(re.NoRootModelError,"This doc is missing root block. Please initialize the default block structure before connecting the editor to DOM.");this.std.mount(),this.tabIndex=0}disconnectedCallback(){super.disconnectedCallback(),this.std.unmount()}async getUpdateComplete(){try{const e=await super.getUpdateComplete(),n=this.store.root;if(!n)return e;const r=this.std.getView(n.flavour);if(!r)return e;const i=this.std.provider.getAll(MT(n.flavour)),s=Object.entries(i).reduce((a,[l,c])=>{const[u,d]=l.split("|");return u===n.flavour&&(a[d]=c),a},{}),o=[typeof r=="function"?r(n):r,...Object.values(s)];return await Promise.all(o.map(a=>{const l=this.renderRoot.querySelector(a._$litStatic$);return l instanceof bc?l.updateComplete:null})),e}catch(e){return e instanceof Error?I6(e):console.error(e),!0}}render(){const{root:e}=this.store;return e?this._renderModel(e):St}}Gs=pH(t1),n1=new WeakMap,r1=new WeakMap,Jb(Gs,4,"store",S2,Vs,n1),Jb(Gs,4,"std",T2,Vs,r1),Vs=Jb(Gs,0,"EditorHost",C2,Vs),Vs.styles=u2`
    editor-host {
      outline: none;
      isolation: isolate;
      display: block;
      height: 100%;
    }
  `,Sd(Gs,1,Vs);var _H=Object.create,i1=Object.defineProperty,xH=Object.getOwnPropertyDescriptor,M2=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Ec=t=>{throw TypeError(t)},EH=(t,e,n)=>e in t?i1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,D2=(t,e)=>i1(t,"name",{value:e,configurable:!0}),vH=t=>{var e;return[,,,_H((e=t==null?void 0:t[M2("metadata")])!=null?e:null)]},N2=["class","method","getter","setter","accessor","field","value","get","set"],Cd=t=>t!==void 0&&typeof t!="function"?Ec("Function expected"):t,wH=(t,e,n,r,i)=>({kind:N2[t],name:e,metadata:r,addInitializer:s=>n._?Ec("Already initialized"):i.push(Cd(s||null))}),kH=(t,e)=>EH(e,M2("metadata"),t[3]),ar=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Bo=(t,e,n,r,i,s)=>{var o,a,l,c,u,d=e&7,h=!!(e&8),f=!!(e&16),p=d>3?t.length+1:d?h?1:2:0,g=N2[d+5],b=d>3&&(t[p-1]=[]),_=t[p]||(t[p]=[]),y=d&&(!f&&!h&&(i=i.prototype),d<5&&(d>3||!f)&&xH(d<4?i:{get[n](){return O2(this,s)},set[n](E){return P2(this,s,E)}},n));d?f&&d<4&&D2(s,(d>2?"set ":d>1?"get ":"")+n):D2(i,n);for(var x=r.length-1;x>=0;x--)c=wH(d,n,l={},t[3],_),d&&(c.static=h,c.private=f,u=c.access={has:f?E=>TH(i,E):E=>n in E},d^3&&(u.get=f?E=>(d^1?O2:SH)(E,i,d^4?s:y.get):E=>E[n]),d>2&&(u.set=f?(E,I)=>P2(E,i,I,d^4?s:y.set):(E,I)=>E[n]=I)),a=(0,r[x])(d?d<4?f?s:y[g]:d>4?void 0:{get:y.get,set:y.set}:i,c),l._=1,d^4||a===void 0?Cd(a)&&(d>4?b.unshift(a):d?f?s=a:y[g]=a:i=a):typeof a!="object"||a===null?Ec("Object expected"):(Cd(o=a.get)&&(y.get=o),Cd(o=a.set)&&(y.set=o),Cd(o=a.init)&&b.unshift(o));return d||kH(t,i),y&&i1(i,n,y),f?d^4?s:y:i},s1=(t,e,n)=>e.has(t)||Ec("Cannot "+n),TH=(t,e)=>Object(e)!==e?Ec('Cannot use the "in" operator on this value'):t.has(e),O2=(t,e,n)=>(s1(t,e,"read from private field"),n?n.call(t):e.get(t)),tl=(t,e,n)=>e.has(t)?Ec("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),P2=(t,e,n,r)=>(s1(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),SH=(t,e,n)=>(s1(t,e,"access private method"),n),L2,R2,B2,F2,U2,$2,H2,z2,o1,W2,It,a1,l1,c1,u1,d1,h1,f1;W2=[jS({store:fc.instanceOf(N0),std:fc.object,widgets:fc.recordOf(fc.object)})];class Zi extends(o1=Ub(jb(kd)),z2=[l2({context:I2})],H2=lH,$2=[Sp({context:oH}),Kb()],U2=[Kb()],F2=[Sp({context:aH}),Kb()],B2=[l2({context:A2})],R2=[yc({attribute:!1})],L2=[yc({attribute:!1,hasChanged(e,n){return!e||!n?e!==n:!Object.keys(e).length&&!Object.keys(n).length?!1:e!==n}})],o1){constructor(){super(...arguments),tl(this,a1,ar(It,8,this)),ar(It,11,this),this.selected$=Os(()=>{const e=this.std.selection.value.find(n=>{var r;return n.blockId===((r=this.model)==null?void 0:r.id)});return e?e.is(Bb):!1}),this[H2]=!0,this.handleEvent=(e,n,r)=>{var i;this._disposables.add(this.std.event.add(e,n,{flavour:r!=null&&r.global?void 0:r!=null&&r.flavour?(i=this.model)==null?void 0:i.flavour:void 0,blockId:r!=null&&r.global||r!=null&&r.flavour?void 0:this.blockId}))},tl(this,l1,ar(It,12,this,null)),ar(It,15,this),tl(this,c1,ar(It,16,this,[this.renderBlock,this._renderMismatchBlock,this._renderViewType])),ar(It,19,this),tl(this,u1,ar(It,20,this,null)),ar(It,23,this),tl(this,d1,ar(It,24,this)),ar(It,27,this),tl(this,h1,ar(It,28,this,"display")),ar(It,31,this),tl(this,f1,ar(It,32,this)),ar(It,35,this)}get blockId(){return this.dataset.blockId}get childBlocks(){return this.model.children.map(n=>this.std.view.getBlock(n.id)).filter(n=>!!n)}get flavour(){return this.model.flavour}get host(){return this.std.host}get isVersionMismatch(){const e=this.store.schema.flavourSchemaMap.get(this.model.flavour);if(!e)return console.warn(`Schema not found for block ${this.model.id}, flavour ${this.model.flavour}`),!0;const n=e.version,r=this.model.version;return n!==r?(console.warn(`Version mismatch for block ${this.model.id}, expected ${n}, actual ${r}`),!0):!1}get model(){if(this._model)return this._model;const e=this.store.getModelById(this.blockId);if(!e)throw new V(re.MissingViewModelError,`Cannot find block model for id ${this.blockId}`);return this._model=e,e}get parentComponent(){const e=this.model.parent;return e?this.std.view.getBlock(e.id):null}get renderChildren(){return this.host.renderChildren.bind(this)}get rootComponent(){var e;const n=(e=this.store.root)==null?void 0:e.id;if(!n)return null;const r=this.std.view.getBlock(n);return r??null}get selection(){return this.std.selection}get service(){if(this._service)return this._service;const e=this.std.getOptional(j0(this.model.flavour));return this._service=e,e}get topContenteditableElement(){return this.rootComponent}get widgetComponents(){return Object.keys(this.widgets).reduce((e,n)=>({...e,[n]:this.std.view.getWidget(n,this.blockId)}),{})}_renderMismatchBlock(e){return p2(this.isVersionMismatch,()=>{var n;const r=this.model.version,i=this.store.schema.flavourSchemaMap.get(this.model.flavour),s=(n=i==null?void 0:i.version)!=null?n:-1;return this.renderVersionMismatch(s,r)},()=>e)}_renderViewType(e){return rH(this.viewType,[["display",()=>e],["hidden",()=>St],["bypass",()=>this.renderChildren(this.model)]])}addRenderer(e){this._renderers.push(e)}bindHotKey(e,n){const r=this.std.event.bindHotkey(e,{flavour:n!=null&&n.global?void 0:n!=null&&n.flavour?this.model.flavour:void 0,blockId:n!=null&&n.global||n!=null&&n.flavour?void 0:this.blockId});return this._disposables.add(r),r}connectedCallback(){super.connectedCallback(),this.std.view.setBlock(this);const e=this.std.store.slots.blockUpdated.subscribe(({type:n,id:r})=>{r===this.model.id&&n==="delete"&&(this.std.view.deleteBlock(this),e.unsubscribe())});this._disposables.add(e),this._disposables.add(this.model.propsUpdated.subscribe(()=>{this.requestUpdate()}))}async getUpdateComplete(){const e=await super.getUpdateComplete();return await Promise.all(this.childBlocks.map(n=>n.updateComplete)),e}render(){return this._renderers.reduce((e,n)=>n.call(this,e),St)}renderBlock(){return St}renderVersionMismatch(e,n){return _c`
      <dl class="version-mismatch-warning" contenteditable="false">
        <dt>
          <h4>Block Version Mismatched</h4>
        </dt>
        <dd>
          <p>
            We can not render this <var>${this.model.flavour}</var> block
            because the version is mismatched.
          </p>
          <p>Editor version: <var>${e}</var></p>
          <p>Data version: <var>${n}</var></p>
        </dd>
      </dl>
    `}}It=vH(o1),a1=new WeakMap,l1=new WeakMap,c1=new WeakMap,u1=new WeakMap,d1=new WeakMap,h1=new WeakMap,f1=new WeakMap,Bo(It,4,"std",z2,Zi,a1),Bo(It,4,"_model",$2,Zi,l1),Bo(It,4,"_renderers",U2,Zi,c1),Bo(It,4,"_service",F2,Zi,u1),Bo(It,4,"store",B2,Zi,d1),Bo(It,4,"viewType",R2,Zi,h1),Bo(It,4,"widgets",L2,Zi,f1),Zi=Bo(It,0,"BlockComponent",W2,Zi),ar(It,1,Zi);function CH(t){return(t==null?void 0:t[AH])===!0}const AH=Symbol("GfxElement");function IH(t){if(Array.isArray(t))return t}function MH(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],l=!0,c=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(l=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return a}}function p1(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function j2(t,e){if(t){if(typeof t=="string")return p1(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p1(t,e):void 0}}function DH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Y2(t,e){return IH(t)||MH(t,e)||j2(t,e)||DH()}var m1={},Ad={},G2;function V2(){if(G2)return Ad;G2=1,Object.defineProperty(Ad,"__esModule",{value:!0}),Ad.bind=void 0;function t(e,n){var r=n.type,i=n.listener,s=n.options;return e.addEventListener(r,i,s),function(){e.removeEventListener(r,i,s)}}return Ad.bind=t,Ad}var nl={},q2;function NH(){if(q2)return nl;q2=1;var t=nl&&nl.__assign||function(){return t=Object.assign||function(s){for(var o,a=1,l=arguments.length;a<l;a++){o=arguments[a];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(s[c]=o[c])}return s},t.apply(this,arguments)};Object.defineProperty(nl,"__esModule",{value:!0}),nl.bindAll=void 0;var e=V2();function n(s){if(!(typeof s>"u"))return typeof s=="boolean"?{capture:s}:s}function r(s,o){if(o==null)return s;var a=t(t({},s),{options:t(t({},n(o)),n(s.options))});return a}function i(s,o,a){var l=o.map(function(c){var u=r(c,a);return(0,e.bind)(s,u)});return function(){l.forEach(function(u){return u()})}}return nl.bindAll=i,nl}var X2;function OH(){return X2||(X2=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=t.bind=void 0;var e=V2();Object.defineProperty(t,"bind",{enumerable:!0,get:function(){return e.bind}});var n=NH();Object.defineProperty(t,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}(m1)),m1}var vc=OH(),K2="data-pdnd-honey-pot";function Q2(t){return t instanceof Element&&t.hasAttribute(K2)}function g1(t){var e=document.elementsFromPoint(t.x,t.y),n=Y2(e,2),r=n[0],i=n[1];return r?Q2(r)?i??null:r:null}function Id(t){"@babel/helpers - typeof";return Id=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Id(t)}function PH(t,e){if(Id(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Id(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function LH(t){var e=PH(t,"string");return Id(e)=="symbol"?e:e+""}function yi(t,e,n){return(e=LH(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Z2=2147483647;function J2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function eC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J2(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J2(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Md=2,tC=Md/2;function RH(t){return{x:Math.floor(t.x),y:Math.floor(t.y)}}function BH(t){return{x:t.x-tC,y:t.y-tC}}function FH(t){return{x:Math.max(t.x,0),y:Math.max(t.y,0)}}function UH(t){return{x:Math.min(t.x,window.innerWidth-Md),y:Math.min(t.y,window.innerHeight-Md)}}function nC(t){var e=t.client,n=UH(FH(BH(RH(e))));return DOMRect.fromRect({x:n.x,y:n.y,width:Md,height:Md})}function rC(t){var e=t.clientRect;return{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),width:"".concat(e.width,"px"),height:"".concat(e.height,"px")}}function $H(t){var e=t.client,n=t.clientRect;return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height}function HH(t){var e=t.initial,n=document.createElement("div");n.setAttribute(K2,"true");var r=nC({client:e});Object.assign(n.style,eC(eC({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},rC({clientRect:r})),{},{pointerEvents:"auto",zIndex:Z2})),document.body.appendChild(n);var i=vc.bind(window,{type:"pointermove",listener:function(o){var a={x:o.clientX,y:o.clientY};r=nC({client:a}),Object.assign(n.style,rC({clientRect:r}))},options:{capture:!0}});return function(o){var a=o.current;if(i(),$H({client:a,clientRect:r})){n.remove();return}function l(){c(),n.remove()}var c=vc.bindAll(window,[{type:"pointerdown",listener:l},{type:"pointermove",listener:l},{type:"focusin",listener:l},{type:"focusout",listener:l},{type:"dragstart",listener:l},{type:"dragenter",listener:l},{type:"dragover",listener:l}],{capture:!0})}}function zH(){var t=null;function e(){return t=null,vc.bind(window,{type:"pointermove",listener:function(i){t={x:i.clientX,y:i.clientY}},options:{capture:!0}})}function n(){var r=null;return function(s){var o=s.eventName,a=s.payload;if(o==="onDragStart"){var l=a.location.initial.input,c=t??{x:l.clientX,y:l.clientY};r=HH({initial:c})}if(o==="onDrop"){var u,d=a.location.current.input;(u=r)===null||u===void 0||u({current:{x:d.clientX,y:d.clientY}}),r=null,t=null}}}return{bindEvents:e,getOnPostDispatch:n}}function WH(t){if(Array.isArray(t))return p1(t)}function jH(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function YH(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iC(t){return WH(t)||jH(t)||j2(t)||YH()}function qs(t){var e=null;return function(){if(!e){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];var o=t.apply(this,i);e={result:o}}return e.result}}var GH=qs(function(){return navigator.userAgent.includes("Firefox")}),Dd=qs(function(){var e=navigator,n=e.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),b1={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function VH(t){var e=t.dragLeave;return Dd()?e.hasOwnProperty(b1.isLeavingWindow):!1}(function(){if(typeof window>"u"||!Dd())return;function e(){return{enterCount:0,isOverWindow:!1}}var n=e();function r(){n=e()}vc.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:r},{type:"dragend",listener:r},{type:"dragenter",listener:function(s){!n.isOverWindow&&n.enterCount===0&&(s[b1.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(s){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(s[b1.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function qH(t){return"nodeName"in t}function XH(t){return qH(t)&&t.ownerDocument!==document}function KH(t){var e=t.dragLeave,n=e.type,r=e.relatedTarget;return n!=="dragleave"?!1:Dd()?VH({dragLeave:e}):r==null?!0:GH()?XH(r):r instanceof HTMLIFrameElement}function QH(t){var e=t.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}e()}}()},{type:"pointerdown",listener:e}]}function Nd(t){return{altKey:t.altKey,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}}var ZH=function(e){var n=[],r=null,i=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];n=a,!r&&(r=requestAnimationFrame(function(){r=null,e.apply(void 0,n)}))};return i.cancel=function(){r&&(cancelAnimationFrame(r),r=null)},i},y1=ZH(function(t){return t()}),Mp=function(){var t=null;function e(r){var i=requestAnimationFrame(function(){t=null,r()});t={frameId:i,fn:r}}function n(){t&&(cancelAnimationFrame(t.frameId),t.fn(),t=null)}return{schedule:e,flush:n}}();function JH(t){var e=t.source,n=t.initial,r=t.dispatchEvent,i={dropTargets:[]};function s(a){r(a),i={dropTargets:a.payload.location.current.dropTargets}}var o={start:function(l){var c=l.nativeSetDragImage,u={current:n,previous:i,initial:n};s({eventName:"onGenerateDragPreview",payload:{source:e,location:u,nativeSetDragImage:c}}),Mp.schedule(function(){s({eventName:"onDragStart",payload:{source:e,location:u}})})},dragUpdate:function(l){var c=l.current;Mp.flush(),y1.cancel(),s({eventName:"onDropTargetChange",payload:{source:e,location:{initial:n,previous:i,current:c}}})},drag:function(l){var c=l.current;y1(function(){Mp.flush();var u={initial:n,previous:i,current:c};s({eventName:"onDrag",payload:{source:e,location:u}})})},drop:function(l){var c=l.current,u=l.updatedSourcePayload;Mp.flush(),y1.cancel(),s({eventName:"onDrop",payload:{source:u??e,location:{current:c,previous:i,initial:n}}})}};return o}var _1={isActive:!1};function sC(){return!_1.isActive}function ez(t){return t.dataTransfer?t.dataTransfer.setDragImage.bind(t.dataTransfer):null}function tz(t){var e=t.current,n=t.next;if(e.length!==n.length)return!0;for(var r=0;r<e.length;r++)if(e[r].element!==n[r].element)return!0;return!1}function nz(t){var e=t.event,n=t.dragType,r=t.getDropTargetsOver,i=t.dispatchEvent;if(!sC())return;var s=rz({event:e,dragType:n,getDropTargetsOver:r});_1.isActive=!0;var o={current:s};x1({event:e,current:s.dropTargets});var a=JH({source:n.payload,dispatchEvent:i,initial:s});function l(f){var p=tz({current:o.current.dropTargets,next:f.dropTargets});o.current=f,p&&a.dragUpdate({current:o.current})}function c(f){var p=Nd(f),g=Q2(f.target)?g1({x:p.clientX,y:p.clientY}):f.target,b=r({target:g,input:p,source:n.payload,current:o.current.dropTargets});b.length&&(f.preventDefault(),x1({event:f,current:b})),l({dropTargets:b,input:p})}function u(){o.current.dropTargets.length&&l({dropTargets:[],input:o.current.input}),a.drop({current:o.current,updatedSourcePayload:null}),d()}function d(){_1.isActive=!1,h()}var h=vc.bindAll(window,[{type:"dragover",listener:function(p){c(p),a.drag({current:o.current})}},{type:"dragenter",listener:c},{type:"dragleave",listener:function(p){KH({dragLeave:p})&&(l({input:o.current.input,dropTargets:[]}),n.startedFrom==="external"&&u())}},{type:"drop",listener:function(p){if(o.current={dropTargets:o.current.dropTargets,input:Nd(p)},!o.current.dropTargets.length){u();return}p.preventDefault(),x1({event:p,current:o.current.dropTargets}),a.drop({current:o.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(p):null}),d()}},{type:"dragend",listener:function(p){o.current={dropTargets:o.current.dropTargets,input:Nd(p)},u()}}].concat(iC(QH({onDragEnd:u}))),{capture:!0});a.start({nativeSetDragImage:ez(e)})}function x1(t){var e,n=t.event,r=t.current,i=(e=r[0])===null||e===void 0?void 0:e.dropEffect;i!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=i)}function rz(t){var e=t.event,n=t.dragType,r=t.getDropTargetsOver,i=Nd(e);if(n.startedFrom==="external")return{input:i,dropTargets:[]};var s=r({input:i,source:n.payload,target:e.target,current:[]});return{input:i,dropTargets:s}}var oC={canStart:sC,start:nz},E1=new Map;function iz(t){var e=t.typeKey,n=t.mount,r=E1.get(e);if(r)return r.usageCount++,r;var i={typeKey:e,unmount:n(),usageCount:1};return E1.set(e,i),i}function sz(t){var e=iz(t);return function(){e.usageCount--,!(e.usageCount>0)&&(e.unmount(),E1.delete(t.typeKey))}}function Dp(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){e.forEach(function(i){return i()})}}function aC(t,e){var n=e.attribute,r=e.value;return t.setAttribute(n,r),function(){return t.removeAttribute(n)}}function lC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Fo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lC(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lC(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function v1(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=oz(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}function oz(t,e){if(t){if(typeof t=="string")return cC(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?cC(t,e):void 0}}function cC(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function w1(t){return t.slice(0).reverse()}function az(t){var e=t.typeKey,n=t.defaultDropEffect,r=new WeakMap,i="data-drop-target-for-".concat(e),s="[".concat(i,"]");function o(f){return r.set(f.element,f),function(){return r.delete(f.element)}}function a(f){var p=Dp(aC(f.element,{attribute:i,value:"true"}),o(f));return qs(p)}function l(f){var p,g,b,_,y=f.source,x=f.target,E=f.input,I=f.result,v=I===void 0?[]:I;if(x==null)return v;if(!(x instanceof Element))return x instanceof Node?l({source:y,target:x.parentElement,input:E,result:v}):v;var N=x.closest(s);if(N==null)return v;var L=r.get(N);if(L==null)return v;var z={input:E,source:y,element:L.element};if(L.canDrop&&!L.canDrop(z))return l({source:y,target:L.element.parentElement,input:E,result:v});var M=(p=(g=L.getData)===null||g===void 0?void 0:g.call(L,z))!==null&&p!==void 0?p:{},B=(b=(_=L.getDropEffect)===null||_===void 0?void 0:_.call(L,z))!==null&&b!==void 0?b:n,$={data:M,element:L.element,dropEffect:B,isActiveDueToStickiness:!1};return l({source:y,target:L.element.parentElement,input:E,result:[].concat(iC(v),[$])})}function c(f){var p=f.eventName,g=f.payload,b=v1(g.location.current.dropTargets),_;try{for(b.s();!(_=b.n()).done;){var y,x=_.value,E=r.get(x.element),I=Fo(Fo({},g),{},{self:x});E==null||(y=E[p])===null||y===void 0||y.call(E,I)}}catch(v){b.e(v)}finally{b.f()}}var u={onGenerateDragPreview:c,onDrag:c,onDragStart:c,onDrop:c,onDropTargetChange:function(p){var g=p.payload,b=new Set(g.location.current.dropTargets.map(function(de){return de.element})),_=new Set,y=v1(g.location.previous.dropTargets),x;try{for(y.s();!(x=y.n()).done;){var E,I=x.value;_.add(I.element);var v=r.get(I.element),N=b.has(I.element),L=Fo(Fo({},g),{},{self:I});if(v==null||(E=v.onDropTargetChange)===null||E===void 0||E.call(v,L),!N){var z;v==null||(z=v.onDragLeave)===null||z===void 0||z.call(v,L)}}}catch(de){y.e(de)}finally{y.f()}var M=v1(g.location.current.dropTargets),B;try{for(M.s();!(B=M.n()).done;){var $,se,be=B.value;if(!_.has(be.element)){var _e=Fo(Fo({},g),{},{self:be}),we=r.get(be.element);we==null||($=we.onDropTargetChange)===null||$===void 0||$.call(we,_e),we==null||(se=we.onDragEnter)===null||se===void 0||se.call(we,_e)}}}catch(de){M.e(de)}finally{M.f()}}};function d(f){u[f.eventName](f)}function h(f){var p=f.source,g=f.target,b=f.input,_=f.current,y=l({source:p,target:g,input:b});if(y.length>=_.length)return y;for(var x=w1(_),E=w1(y),I=[],v=0;v<x.length;v++){var N,L=x[v],z=E[v];if(z!=null){I.push(z);continue}var M=I[v-1],B=x[v-1];if((M==null?void 0:M.element)!==(B==null?void 0:B.element))break;var $=r.get(L.element);if(!$)break;var se={input:b,source:p,element:$.element};if($.canDrop&&!$.canDrop(se)||!((N=$.getIsSticky)!==null&&N!==void 0&&N.call($,se)))break;I.push(Fo(Fo({},L),{},{isActiveDueToStickiness:!0}))}return w1(I)}return{dropTargetForConsumers:a,getIsOver:h,dispatchEvent:d}}function lz(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=cz(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}function cz(t,e){if(t){if(typeof t=="string")return uC(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uC(t,e):void 0}}function uC(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function dC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function uz(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dC(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dC(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function dz(){var t=new Set,e=null;function n(s){e&&(!s.canMonitor||s.canMonitor(e.canMonitorArgs))&&e.active.add(s)}function r(s){var o=uz({},s);t.add(o),n(o);function a(){t.delete(o),e&&e.active.delete(o)}return qs(a)}function i(s){var o=s.eventName,a=s.payload;if(o==="onGenerateDragPreview"){e={canMonitorArgs:{initial:a.location.initial,source:a.source},active:new Set};var l=lz(t),c;try{for(l.s();!(c=l.n()).done;){var u=c.value;n(u)}}catch(b){l.e(b)}finally{l.f()}}if(e){for(var d=Array.from(e.active),h=0,f=d;h<f.length;h++){var p=f[h];if(e.active.has(p)){var g;(g=p[o])===null||g===void 0||g.call(p,a)}}o==="onDrop"&&(e.active.clear(),e=null)}}return{dispatchEvent:i,monitorForConsumers:r}}function hz(t){var e=t.typeKey,n=t.mount,r=t.dispatchEventToSource,i=t.onPostDispatch,s=t.defaultDropEffect,o=dz(),a=az({typeKey:e,defaultDropEffect:s});function l(d){r==null||r(d),a.dispatchEvent(d),o.dispatchEvent(d),i==null||i(d)}function c(d){var h=d.event,f=d.dragType;oC.start({event:h,dragType:f,getDropTargetsOver:a.getIsOver,dispatchEvent:l})}function u(){function d(){var h={canStart:oC.canStart,start:c};return n(h)}return sz({typeKey:e,mount:d})}return{registerUsage:u,dropTarget:a.dropTargetForConsumers,monitor:o.monitorForConsumers}}var fz=qs(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),pz="pdnd:android-fallback",hC="text/plain",mz="text/uri-list",gz="application/vnd.pdnd",Np=new WeakMap;function bz(t){return Np.set(t.element,t),function(){Np.delete(t.element)}}var fC=zH(),k1=hz({typeKey:"element",defaultDropEffect:"move",mount:function(e){return Dp(fC.bindEvents(),vc.bind(document,{type:"dragstart",listener:function(r){var i,s,o,a,l,c;if(e.canStart(r)&&!r.defaultPrevented&&r.dataTransfer){var u=r.target;if(!(u instanceof HTMLElement))return null;var d=Np.get(u);if(!d)return null;var h=Nd(r),f={element:d.element,dragHandle:(i=d.dragHandle)!==null&&i!==void 0?i:null,input:h};if(d.canDrag&&!d.canDrag(f))return r.preventDefault(),null;if(d.dragHandle){var p=g1({x:h.clientX,y:h.clientY});if(!d.dragHandle.contains(p))return r.preventDefault(),null}var g=(s=(o=d.getInitialDataForExternal)===null||o===void 0?void 0:o.call(d,f))!==null&&s!==void 0?s:null;if(g)for(var b=0,_=Object.entries(g);b<_.length;b++){var y=Y2(_[b],2),x=y[0],E=y[1];r.dataTransfer.setData(x,E??"")}fz()&&!r.dataTransfer.types.includes(hC)&&!r.dataTransfer.types.includes(mz)&&r.dataTransfer.setData(hC,pz),r.dataTransfer.setData(gz,"");var I={element:d.element,dragHandle:(a=d.dragHandle)!==null&&a!==void 0?a:null,data:(l=(c=d.getInitialData)===null||c===void 0?void 0:c.call(d,f))!==null&&l!==void 0?l:{}},v={type:"element",payload:I,startedFrom:"internal"};e.start({event:r,dragType:v})}}}))},dispatchEventToSource:function(e){var n,r,i=e.eventName,s=e.payload;(n=Np.get(s.source.element))===null||n===void 0||(r=n[i])===null||r===void 0||r.call(n,s)},onPostDispatch:fC.getOnPostDispatch()}),yz=k1.dropTarget,T1=k1.monitor;function _z(t){var e=Dp(k1.registerUsage(),bz(t),aC(t.element,{attribute:"draggable",value:"true"}));return qs(e)}var xz=function(e){var n=e.container,r=n.getBoundingClientRect();return{x:r.width/2,y:r.height/2}},pC=function(){if(typeof window>"u")return null;var t=new Image;return t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",t}();function Ez(t){var e=t.nativeSetDragImage;e&&pC&&e(pC,0,0)}var vz=qs(function(){return Dd()&&"ontouchend"in document});function wz(t){return function(e){var n=e.container;vz()||Object.assign(n.style,{borderInlineStart:"".concat(t.x," solid transparent"),borderTop:"".concat(t.y," solid transparent")});var r=window.getComputedStyle(n);if(r.direction==="rtl"){var i=n.getBoundingClientRect();return{x:i.width,y:0}}return{x:0,y:0}}}function kz(t){var e=t.element,n=t.input;return function(r){var i=r.container,s=e.getBoundingClientRect(),o=i.getBoundingClientRect(),a=Math.min(n.clientX-s.x,o.width),l=Math.min(n.clientY-s.y,o.height);return{x:a,y:l}}}function Tz(){return{x:0,y:0}}function Sz(t){var e=t.render,n=t.nativeSetDragImage,r=t.getOffset,i=r===void 0?Tz:r,s=document.createElement("div");Object.assign(s.style,{position:"fixed",top:0,left:0,zIndex:Z2,pointerEvents:"none"}),document.body.append(s);var o=e({container:s});queueMicrotask(function(){var c=i({container:s});if(Dd()){var u=s.getBoundingClientRect();if(u.width===0)return;s.style.left="-".concat(u.width-1e-4,"px")}n==null||n(s,c.x,c.y)});function a(){l(),o==null||o(),document.body.removeChild(s)}var l=T1({onDragStart:a,onDrop:a})}var Od=new Map,Op=new Set;function mC(t){Cz(t);var e=Od.get(t);if(e)return e;var n={timeOfEngagementStart:Date.now()};return Od.set(t,n),n}function Cz(t){Op.add(t)}function Az(t){Op.clear(),t(),Od.forEach(function(e,n){Op.has(n)||Od.delete(n)}),Op.clear()}function Iz(){Od.clear()}var gC=new Map;function Mz(t){var e=gC.get(t);if(e)return e;var n=Dz(t);return gC.set(t,n),n}function Dz(t){var e={type:"idle"},n=[];function r(l){if(e.type==="running"){var c=l-e.timeLastFrameFinished,u=e,d=u.latestArgs,h=g1({x:d.location.current.input.clientX,y:d.location.current.input.clientY});Az(function(){n.forEach(function(f){return f({underUsersPointer:h,latestArgs:d,timeSinceLastFrame:c})})}),e.timeLastFrameFinished=l,e.frameId=requestAnimationFrame(r)}}function i(){e.type!=="idle"&&(cancelAnimationFrame(e.frameId),Iz(),e={type:"idle"})}function s(l){e.type==="idle"&&(e={type:"initializing",latestArgs:l,frameId:requestAnimationFrame(function(c){e.type==="initializing"&&(e={type:"running",timeLastFrameFinished:c,latestArgs:e.latestArgs,frameId:requestAnimationFrame(r)})})})}function o(l){if(e.type==="idle"){s(l);return}e.latestArgs=l}t({onDragStart:s,onDropTargetChange:o,onDrag:o,onDrop:i});var a={onFrame:function(c){n.push(c)}};return a}var S1="data-auto-scrollable",Nz="[".concat(S1,'="true"]');function Oz(t){return t.setAttribute(S1,"true"),function(){return t.removeAttribute(S1)}}function bC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function yC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bC(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bC(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Pz={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:400,maxMainAxisHitboxSize:180},Lz={standard:15*60,fast:25*60};function _C(t){var e;return yC(yC({},Pz),{},{maxPixelScrollPerSecond:Lz[(e=t==null?void 0:t.maxScrollSpeed)!==null&&e!==void 0?e:"standard"]})}var Rz={top:function(e){return e.scrollTop>0},right:function(e){return Math.ceil(e.scrollLeft)+e.clientWidth<e.scrollWidth},bottom:function(e){return Math.ceil(e.scrollTop)+e.clientHeight<e.scrollHeight},left:function(e){return e.scrollLeft>0}},Bz=["top","right","bottom","left"],Fz={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},xC={start:"top",end:"bottom",point:"y",size:"height"},EC={start:"left",end:"right",point:"x",size:"width"},vC={vertical:{mainAxis:xC,crossAxis:EC},horizontal:{mainAxis:EC,crossAxis:xC}},C1={top:"start",right:"end",bottom:"end",left:"start"};function Pp(t){var e=t.edge,n=t.axis;return function(i){var s=i.clientRect,o=i.config,a=vC[n],l=a.mainAxis,c=a.crossAxis,u=C1[e],d=Math.min(o.startHitboxAtPercentageRemainingOfElement[e]*s[l.size],o.maxMainAxisHitboxSize);return DOMRect.fromRect(yi(yi(yi(yi({},l.point,u==="start"?s[l.point]:s[l.point]+s[l.size]-d),c.point,s[c.point]),l.size,d),c.size,s[c.size]))}}var Uz={top:Pp({axis:"vertical",edge:"top"}),right:Pp({axis:"horizontal",edge:"right"}),bottom:Pp({axis:"vertical",edge:"bottom"}),left:Pp({axis:"horizontal",edge:"left"})};function A1(t){var e=t.startOfRange,n=t.endOfRange,r=t.value,i=e<n;if(!i||r<e)return 0;if(r>n)return 1;var s=n-e;return(r-e)/s}function $z(t){var e=t.timeSinceLastFrame,n=t.config,r=n.maxPixelScrollPerSecond/1e3,i=Math.ceil(r*e),s=n.maxPixelScrollPerSecond/60;return Math.min(i,s)}function Hz(t){var e=t.client,n=t.axis,r=t.edge,i=t.hitbox,s=t.config,o=vC[n].mainAxis,a=C1[r],l=i[o.size]*s.maxScrollAtPercentageRemainingOfHitbox[r];if(a==="end")return A1({startOfRange:i[o.start],endOfRange:i[o.end]-l,value:e[o.point]});var c=A1({startOfRange:i[o.start]+l,endOfRange:i[o.end],value:e[o.point]});return 1-c}function Lp(t){var e=t.client,n=t.timeSinceLastFrame,r=t.engagement,i=t.axis,s=t.hitbox,o=t.edge,a=t.isDistanceDampeningEnabled,l=t.config,c=$z({timeSinceLastFrame:n,config:l}),u=a?Hz({client:e,edge:o,hitbox:s,axis:i,config:l}):1,d=A1({startOfRange:r.timeOfEngagementStart,endOfRange:r.timeOfEngagementStart+l.timeDampeningDurationMs,value:Date.now()}),h=u*d,f=Math.max(c*h,1),p=C1[o];return p==="end"?f:-1*f}function zz(t,e){return e==="all"||t===e}function Wz(t){var e=t.client,n=t.clientRect;return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height}function jz(t){return t.getBoundingClientRect()}function wC(t){var e=t.element,n=t.input,r=t.timeSinceLastFrame,i=t.engagement,s=t.config,o=t.allowedAxis,a=t.getRect,l=a===void 0?jz:a,c={x:n.clientX,y:n.clientY},u=l(e),d=Bz.reduce(function(p,g){var b=Uz[g]({clientRect:u,config:s}),_=Fz[g];return!zz(_,o)||!Wz({client:c,clientRect:b})||!Rz[g](e)||p.set(g,{edge:g,hitbox:b}),p},new Map),h=function(){var p="horizontal",g=d.get("left");if(g)return Lp({client:c,edge:g.edge,hitbox:g.hitbox,axis:p,timeSinceLastFrame:r,engagement:i,isDistanceDampeningEnabled:!0,config:s});var b=d.get("right");return b?Lp({client:c,edge:b.edge,hitbox:b.hitbox,axis:p,timeSinceLastFrame:r,engagement:i,isDistanceDampeningEnabled:!0,config:s}):0}(),f=function(){var p="vertical",g=d.get("bottom");if(g)return Lp({client:c,edge:g.edge,hitbox:g.hitbox,axis:p,timeSinceLastFrame:r,engagement:i,isDistanceDampeningEnabled:!0,config:s});var b=d.get("top");return b?Lp({client:c,edge:b.edge,hitbox:b.hitbox,axis:p,timeSinceLastFrame:r,engagement:i,isDistanceDampeningEnabled:!0,config:s}):0}();return{left:h,top:f}}function Yz(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Gz(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}function Gz(t,e){if(t){if(typeof t=="string")return kC(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kC(t,e):void 0}}function kC(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function TC(t){return!!(t.top||t.left)}function SC(t){var e,n,r,i=t.target,s=t.input,o=t.source,a=t.findEntry,l=t.timeSinceLastFrame,c=t.available,u=c===void 0?{top:!0,left:!0}:c;if(!TC(u)||!i)return u;var d=i.closest(Nz);if(!d)return u;var h=a(d);if(!h)return u;function f(){var E;return SC({target:(E=d==null?void 0:d.parentElement)!==null&&E!==void 0?E:null,findEntry:a,source:o,timeSinceLastFrame:l,input:s,available:u})}var p={input:s,source:o,element:d};if(h.canScroll&&!h.canScroll(p))return f();var g=mC(d),b=_C((e=h.getConfiguration)===null||e===void 0?void 0:e.call(h,p)),_=(n=(r=h.getAllowedAxis)===null||r===void 0?void 0:r.call(h,p))!==null&&n!==void 0?n:"all",y=wC({element:d,engagement:g,input:s,timeSinceLastFrame:l,allowedAxis:_,config:b}),x={top:0,left:0};return u.top&&y.top!==0&&(x.top=y.top,u.top=!1),u.left&&y.left!==0&&(x.left=y.left,u.left=!1),(x.top!==0||x.left!==0)&&d.scrollBy(x),f()}function Vz(t){var e=t.input,n=t.timeSinceLastFrame,r=t.available,i=t.source,s=t.entries,o=document.documentElement,a={input:e,source:i,element:o},l=Yz(s),c;try{for(l.s();!(c=l.n()).done;){var u,d,h,f=c.value;if(!(f.canScroll&&!f.canScroll(a))){var p=mC(o),g=_C((u=f.getConfiguration)===null||u===void 0?void 0:u.call(f,a)),b=(d=(h=f.getAllowedAxis)===null||h===void 0?void 0:h.call(f,a))!==null&&d!==void 0?d:"all",_=wC({element:o,engagement:p,input:e,config:g,allowedAxis:b,getRect:function(E){return DOMRect.fromRect({y:0,x:0,width:E.clientWidth,height:E.clientHeight})},timeSinceLastFrame:n}),y={top:r.top?_.top:0,left:r.left?_.left:0};(y.top!==0||y.left!==0)&&o.scrollBy(y);break}}}catch(x){l.e(x)}finally{l.f()}}function qz(t){var e=t.input,n=t.findEntry,r=t.timeSinceLastFrame,i=t.source,s=t.getWindowScrollEntries,o=t.underUsersPointer,a=SC({target:o,timeSinceLastFrame:r,input:e,source:i,findEntry:n});TC(a)&&Vz({input:e,source:i,entries:s(),timeSinceLastFrame:r,available:a})}function CC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Xz(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CC(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CC(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Kz(t){var e=t.monitor,n=new Map,r=new Set;function i(c){n.set(c.element,c);var u=Dp(Oz(c.element),function(){return n.delete(c.element)});return qs(u)}function s(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=Xz({},c);r.add(u);function d(){r.delete(u)}return qs(d)}function o(c){var u;return(u=n.get(c))!==null&&u!==void 0?u:null}function a(){return Array.from(r)}function l(c){var u=c.latestArgs,d=c.underUsersPointer,h=c.timeSinceLastFrame;qz({input:u.location.current.input,source:u.source,findEntry:o,underUsersPointer:d,timeSinceLastFrame:h,getWindowScrollEntries:a})}return Mz(e).onFrame(l),{autoScroll:i,autoScrollWindow:s}}var Qz=Kz({monitor:T1}),Zz=Qz.autoScroll;function AC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function IC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?AC(Object(n),!0).forEach(function(r){yi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AC(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Jz={top:function(e,n){return Math.abs(n.y-e.top)},right:function(e,n){return Math.abs(e.right-n.x)},bottom:function(e,n){return Math.abs(e.bottom-n.y)},left:function(e,n){return Math.abs(n.x-e.left)}},MC=Symbol("closestEdge");function eW(t,e){var n,r,i=e.element,s=e.input,o=e.allowedEdges,a={x:s.clientX,y:s.clientY},l=i.getBoundingClientRect(),c=o.map(function(d){return{edge:d,value:Jz[d](l,a)}}),u=(n=(r=c.sort(function(d,h){return d.value-h.value})[0])===null||r===void 0?void 0:r.edge)!==null&&n!==void 0?n:null;return IC(IC({},t),{},yi({},MC,u))}function tW(t){var e;return(e=t[MC])!==null&&e!==void 0?e:null}lp("DndController");class I1 extends Xi{draggable(e){const{setDragData:n,setExternalDragData:r,setDragPreview:i,element:s,dragHandle:o,...a}=e;return _z({...a,element:s,dragHandle:o,onGenerateDragPreview:l=>{if(i){let c;const u=d=>{d==="center"?c=xz:d==="preserve"?c=kz({element:l.source.element,input:l.location.current.input}):typeof d=="object"&&((d.x<0||d.y<0||typeof d.x=="string"||typeof d.y=="string")&&(c=wz({x:typeof d.x=="number"?`${Math.abs(d.x)}px`:d.x,y:typeof d.y=="number"?`${Math.abs(d.y)}px`:d.y})),c=d)};Sz({getOffset:(...d)=>(c||u("center"),typeof c=="function"?c(...d):c),render:d=>{i({setOffset:u,...l,...d})},nativeSetDragImage:l.nativeSetDragImage})}else i===!1&&Ez({nativeSetDragImage:l.nativeSetDragImage})},getInitialData:l=>{var c;return{bsEntity:(c=n==null?void 0:n(l))!=null?c:{},from:{at:"blocksuite-editor",docId:this.std.store.doc.id}}},getInitialDataForExternal:r?l=>r==null?void 0:r(l):void 0})}dropTarget(e){const{element:n,setDropData:r,allowDropPosition:i=["bottom","left","top","right"],...s}=e;return yz({element:n,getData:o=>{var a;const l=(a=r==null?void 0:r(o))!=null?a:{},c=tW(eW(l,{element:o.element,input:o.input,allowedEdges:i}));return c?{...l,edge:c}:l},...s})}monitor(e){return T1(e)}autoScroll(e){return Zz(e)}}I1.key="DndController";class DC extends Xi{constructor(e){super(e),this.std=e,this.disposables=new hn,this.slots={created:new Ie,mounted:new Ie,rendered:new Ie,unmounted:new Ie},this.disposables.add(this.slots.created),this.disposables.add(this.slots.mounted),this.disposables.add(this.slots.rendered),this.disposables.add(this.slots.unmounted)}created(){super.created(),this.slots.created.next()}mounted(){super.mounted(),this.slots.mounted.next()}rendered(){super.rendered(),this.slots.rendered.next()}unmounted(){super.unmounted(),this.slots.unmounted.next(),this.disposables.dispose()}}DC.key="editor-life-cycle";class NC extends Xi{mounted(){super.mounted(),this.std.provider.getAll(j0).forEach(e=>{e.mounted()})}unmounted(){super.unmounted(),this.std.provider.getAll(j0).forEach(e=>{e.unmounted()})}}NC.key="serviceManager";class M1 extends Xi{constructor(){super(...arguments),this._blockMap=new Map,this.viewUpdated=new Ie,this._fromId=e=>{var n,r;const i=e??((n=this.std.store.root)==null?void 0:n.id);return i&&(r=this._blockMap.get(i))!=null?r:null},this._widgetMap=new Map,this.deleteBlock=e=>{this._blockMap.delete(e.model.id),this.viewUpdated.next({id:e.model.id,method:"delete",type:"block",view:e})},this.deleteWidget=e=>{const n=e.dataset.widgetId,r=`${e.model.id}|${n}`;this._widgetMap.delete(r),this.viewUpdated.next({id:e.model.id,method:"delete",type:"widget",view:e})},this.getBlock=e=>{var n;return(n=this._blockMap.get(e))!=null?n:null},this.getWidget=(e,n)=>{var r;const i=`${n}|${e}`;return(r=this._widgetMap.get(i))!=null?r:null},this.setBlock=e=>{this._blockMap.has(e.model.id)&&this.deleteBlock(e),this._blockMap.set(e.model.id,e),this.viewUpdated.next({id:e.model.id,method:"add",type:"block",view:e})},this.setWidget=e=>{const n=e.dataset.widgetId,r=`${e.model.id}|${n}`;this._widgetMap.set(r,e),this.viewUpdated.next({id:e.model.id,method:"add",type:"widget",view:e})},this.walkThrough=(e,n)=>{const r=this._fromId(n);if(!r)return;const i=s=>(o,a)=>{if(e(o,a,s)===!0)return;const c=o.model.children;c.forEach(u=>{const d=this._blockMap.get(u.id);d&&i(o)(d,c.indexOf(u))})};r.model.children.forEach(s=>{const o=this._blockMap.get(s.id);o&&i(o)(o,r.model.children.indexOf(s))})}}get views(){return Array.from(this._blockMap.values())}unmounted(){this._blockMap.clear(),this._widgetMap.clear(),this.viewUpdated.complete()}}M1.key="viewStore";class OC extends gp{constructor(e){super(e),this._disposable=new hn,this._viewCtorMap=new Map,this._viewMap=new Map}static extendGfx(e){Object.defineProperty(e,"view",{get(){return this.std.get(fd("viewManager"))}})}get(e){if(e=typeof e=="string"?e:e.id,this._viewMap.has(e))return this._viewMap.get(e);const n=this.std.view.getBlock(e);return n&&CH(n)?n:null}mounted(){this.std.provider.getAll(WS).forEach(n=>{this._viewCtorMap.set(n.type,n)});const e=n=>{const r=i=>{var s;const o=(s=this._viewCtorMap.get(i.type))!=null?s:C$,a=new o(i,this.gfx);this._viewMap.set(i.id,a),a.onCreated()};this._disposable.add(n.elementAdded.subscribe(i=>{const s=n.getElementById(i.id);r(s)})),this._disposable.add(n.elementRemoved.subscribe(i=>{const s=this._viewMap.get(i.id);this._viewMap.delete(i.id),s==null||s.onDestroyed()})),this._disposable.add(n.localElementAdded.subscribe(i=>{r(i)})),this._disposable.add(n.localElementDeleted.subscribe(i=>{const s=this._viewMap.get(i.id);this._viewMap.delete(i.id),s==null||s.onDestroyed()})),n.localElementModels.forEach(i=>{r(i)}),n.elementModels.forEach(i=>{r(i)})};this.gfx.surface?e(this.gfx.surface):this._disposable.add(kb(this.std.store,n=>{n&&e(n)}))}unmounted(){this._disposable.dispose(),this._viewMap.forEach(e=>e.onDestroyed()),this._viewMap.clear()}}OC.key="viewManager";class nW extends sp{async fromSnapshot(e){const n=await super.fromSnapshot(e),r=n.props.sourceId;return!e.assets.isEmpty()&&r&&await e.assets.writeToBlob(r),n}toSnapshot(e){const n=super.toSnapshot(e),r=e.model.props.sourceId;return r&&e.assets.getPathBlobIdMap().set(e.model.id,r),n}}const rW={name:"",size:0,type:"application/octet-stream",sourceId:void 0,caption:void 0,embed:!1,style:["cubeThick","horizontalThin","pdf","citation"][1],index:"a0",xywh:"[0,0,0,0]",lockedBySelf:!1,rotate:0,"meta:createdAt":void 0,"meta:updatedAt":void 0,"meta:createdBy":void 0,"meta:updatedBy":void 0,footnoteIdentifier:null,comments:void 0},rl=Zt({flavour:"affine:attachment",props:()=>rW,metadata:{version:1,role:"content",parent:["affine:note","affine:surface","affine:edgeless-text","affine:paragraph","affine:list"],children:["@attachment-viewer"]},transformer:t=>new nW(t),toModel:()=>new sW}),iW=bt(rl);class sW extends $s(Qe){}const oW={style:["vertical","horizontal","list","cube","citation"][1],url:"",caption:null,description:null,icon:null,image:null,title:null,index:"a0",xywh:"[0,0,0,0]",lockedBySelf:!1,rotate:0,"meta:createdAt":void 0,"meta:updatedAt":void 0,"meta:createdBy":void 0,"meta:updatedBy":void 0,footnoteIdentifier:null,comments:void 0},Uo=Zt({flavour:"affine:bookmark",props:()=>oW,metadata:{version:1,role:"content",parent:["affine:note","affine:surface","affine:edgeless-text","affine:paragraph","affine:list"]},toModel:()=>new lW}),aW=bt(Uo);class lW extends $s(Qe){}const Pd=Zt({flavour:"affine:callout",props:t=>({emoji:"",text:t.Text(),"meta:createdAt":void 0,"meta:updatedAt":void 0,"meta:createdBy":void 0,"meta:updatedBy":void 0}),metadata:{version:1,role:"hub",parent:["affine:note","affine:database","affine:paragraph","affine:list","affine:edgeless-text","affine:transcription"],children:["affine:paragraph","affine:list"]},toModel:()=>new cW});class cW extends Qe{}const uW=bt(Pd),$o=Zt({flavour:"affine:code",props:t=>({text:t.Text(),language:null,wrap:!1,caption:"",preview:void 0,lineNumber:void 0,comments:void 0,"meta:createdAt":void 0,"meta:createdBy":void 0,"meta:updatedAt":void 0,"meta:updatedBy":void 0}),metadata:{version:1,role:"content",parent:["affine:note","affine:paragraph","affine:list","affine:edgeless-text"],children:[]},toModel:()=>new hW}),dW=bt($o);class hW extends Qe{}class fW extends Qe{}const Ji=Zt({flavour:"affine:database",props:t=>({views:[],title:t.Text(),cells:Object.create(null),columns:[],comments:void 0}),metadata:{role:"hub",version:3,parent:["affine:note"],children:["affine:paragraph","affine:list"]},toModel:()=>new fW}),pW=bt(Ji),es=Zt({flavour:"affine:divider",metadata:{version:1,role:"content",children:[]},toModel:()=>new mW});class mW extends Qe{}const gW=bt(es);function Ho(t){return Object.entries(t).reduce((e,[n,r])=>(e[r]=n,e),{})}var PC=(t=>(t.Arrow="Arrow",t.Circle="Circle",t.Diamond="Diamond",t.None="None",t.Triangle="Triangle",t))(PC||{});Ho(PC);const bW=280;var LC=(t=>(t.Bottom="bottom",t.Center="center",t.Top="top",t))(LC||{}),en=(t=>(t[t.Straight=0]="Straight",t[t.Orthogonal=1]="Orthogonal",t[t.Curve=2]="Curve",t))(en||{});const yW=2,_W=["edgeless","page"],xW=["doc","attachment","url"],EW=$e({title:pe(),description:pe()}).partial(),vW=Ra(t=>{if(typeof t!="string")return!1;const e=t.match(/^\[(\d+),(\d+),(\d+),(\d+)\]$/);return e?e.slice(1).every(n=>!isNaN(Number(n))):!1},"Invalid XYWH format. Expected [number,number,number,number]"),RC=$e({mode:zf(_W),blockIds:pe().array(),elementIds:pe().array(),databaseId:pe().optional(),databaseRowId:pe().optional(),xywh:vW.optional(),commentId:pe().optional()}).partial();$e({pageId:pe(),params:RC.optional()}).merge(EW);const Xs=$e({type:zf(xW),docId:pe().optional(),blobId:pe().optional(),fileName:pe().optional(),fileType:pe().optional(),url:pe().optional(),favicon:pe().optional(),title:pe().optional(),description:pe().optional()});$e({label:pe(),reference:Xs});const wW=22;var D1=(t=>(t.Black="--affine-palette-line-black",t.Blue="--affine-palette-line-blue",t.Green="--affine-palette-line-green",t.Grey="--affine-palette-line-grey",t.Magenta="--affine-palette-line-magenta",t.Orange="--affine-palette-line-orange",t.Purple="--affine-palette-line-purple",t.Red="--affine-palette-line-red",t.Teal="--affine-palette-line-teal",t.White="--affine-palette-line-white",t.Yellow="--affine-palette-line-yellow",t))(D1||{});Ho(D1),qr(D1);var _i=(t=>(t[t.BALANCE=2]="BALANCE",t[t.LEFT=1]="LEFT",t[t.RIGHT=0]="RIGHT",t))(_i||{}),wc=(t=>(t[t.FOUR=4]="FOUR",t[t.ONE=1]="ONE",t[t.THREE=3]="THREE",t[t.TWO=2]="TWO",t))(wc||{});const kW=92,TW=450+24*2,SW=kW;var N1=(t=>(t.Box="--affine-note-shadow-box",t.Film="--affine-note-shadow-film",t.Float="--affine-note-shadow-float",t.None="",t.Paper="--affine-note-shadow-paper",t.Sticker="--affine-note-shadow-sticker",t))(N1||{});Ho(N1);const BC="--affine-note-shadow-box",CW=qr(N1);var ft=(t=>(t.DocAndEdgeless="both",t.DocOnly="doc",t.EdgelessOnly="edgeless",t))(ft||{}),xi=(t=>(t.Dash="dash",t.None="none",t.Solid="solid",t))(xi||{});const AW=qr(xi),IW=qr(ft),FC="none";Ho(xi);var O1=(t=>(t[t.Huge=32]="Huge",t[t.Large=24]="Large",t[t.Medium=16]="Medium",t[t.None=0]="None",t[t.Small=8]="Small",t))(O1||{});Ho(O1);const UC=8;qr(O1);const $C=4,Ld=1.4,Rd=.3;var HC=(t=>(t[t.LARGE=28]="LARGE",t[t.MEDIUM=20]="MEDIUM",t[t.SMALL=12]="SMALL",t[t.XLARGE=36]="XLARGE",t))(HC||{}),P1=(t=>(t.Rect="rect",t.Ellipse="ellipse",t.Diamond="diamond",t.Triangle="triangle",t))(P1||{}),L1=(t=>(t.General="General",t.Scribbled="Scribbled",t))(L1||{}),Ks=(t=>(t.Center="center",t.Left="left",t.Right="right",t))(Ks||{});Ho(Ks);var R1=(t=>(t.Bottom="bottom",t.Center="center",t.Top="top",t))(R1||{}),tn=(t=>(t.Bold="700",t.Light="300",t.Medium="500",t.Regular="400",t.SemiBold="600",t))(tn||{});Ho(tn);var zo=(t=>(t.Italic="italic",t.Normal="normal",t))(zo||{}),fn=(t=>(t.BebasNeue="blocksuite:surface:BebasNeue",t.Inter="blocksuite:surface:Inter",t.Kalam="blocksuite:surface:Kalam",t.Lora="blocksuite:surface:Lora",t.OrelegaOne="blocksuite:surface:OrelegaOne",t.Poppins="blocksuite:surface:Poppins",t.Satoshi="blocksuite:surface:Satoshi",t))(fn||{});const MW=Ho(fn);Object.entries(MW);var ts=(t=>(t[t.AUTO_WIDTH_AND_HEIGHT=0]="AUTO_WIDTH_AND_HEIGHT",t[t.AUTO_HEIGHT=1]="AUTO_HEIGHT",t))(ts||{});const DW=qr(fn),NW=qr(tn),OW=qr(zo),PW=qr(Ks),LW=$e({normal:pe()}),RW=$e({dark:pe(),light:pe()}),B1=ko([pe(),LW,RW]);function BW(t){return Object.keys(t)}const Bd={"aI/errorBackground":"#fff4f5","aI/errorDetailBackground":"#ffffff99","aI/errorText":"#ed3f3f","aI/thinkingOutputBackground":"#f9f9f9","aI/thinkingOutputText":"#000000a6","aI/userTextBackground":"#f3f3f3","adjustmentHandle/background":"#00000085","adjustmentHandle/border":"#ffffff","backlinks/blockBackgroundColor":"#9292920d","backlinks/blockBorder":"#9292921a","backlinks/blockHover":"#0000000d","badge/believer":"#002742","badge/free":"#29a3fa","badge/pro":"#29a3fa","block/callout/background/blue":"#f0f9ff","block/callout/background/green":"#fbfef1","block/callout/background/grey":"#f9f9f9","block/callout/background/magenta":"#fefaff","block/callout/background/orange":"#fff7ee","block/callout/background/purple":"#f9f7ff","block/callout/background/red":"#fff4f5","block/callout/background/teal":"#eefffd","block/callout/background/yellow":"#fdfcf4","block/callout/icon/blue":"#53b2ef","block/callout/icon/green":"#22bf07","block/callout/icon/grey":"#cdcdcd","block/callout/icon/magenta":"#cc4187","block/callout/icon/orange":"#ffae63","block/callout/icon/purple":"#7c3aed","block/callout/icon/red":"#c83030","block/callout/icon/teal":"#448e86","block/callout/icon/yellow":"#fde047","block/code/lineNum":"#b3b3b3","block/comment/hanelActive":"#1e96eb05","block/comment/highlightActive":"#1e96eb4d","block/comment/highlightDefault":"#1e96eb14","block/comment/highlightUnderline":"#1e96ebb2","block/divider/divider":"#92929238","block/footnote/numberBg":"#e6e6e6","block/footnote/numberBgHover":"#1e96eb","block/list/header":"#0077cb","block/notSupportedBlock/background":"#ffffff","block/notSupportedBlock/inlineBg/default":"#f3f3f3","block/notSupportedBlock/inlineBg/hover":"#e6e6e6","block/recordBlock/buttonBg":"#f3f3f3","block/recordBlock/primary":"#f45353","block/recordBlock/secordary":"#ff9a9a","block/recordBlock/timelineIndeicator":"#ed3f3f","button/actionActive":"#1e96eb14","button/badgesColor":"#ed3f3f","button/buttonOverHover":"#ffffff","button/checkBox":"#1e96eb","button/disable":"#b3b3b3","button/emptyIconBackground":"#0000000d","button/error":"#ed3f3f","button/iconButtonSolid":"#ffffff","button/innerBlackBorder":"#0000001a","button/primary":"#1e96eb","button/pureWhiteText":"#ffffff","button/secondary":"#ffffff","button/success":"#44b931","button/templateLabelBackground":"#1e96eb0a","button/grabber/select":"#00000038","button/grabber/default":"#0000001a","button/mobile/aIActionBackground":"#252525","button/mobile/deletedAction":"#ed3f3f","button/sidebarButton/background":"#ffffff08","button/siderbarPrimary/background":"#ffffffab","button/signinbutton/background":"#ffffff","calendar/blue":"#4ab1fa","calendar/green":"#44b931","calendar/grey":"#b3b3b3","calendar/magenta":"#f37fba","calendar/orange":"#ffae63","calendar/purple":"#9681ef","calendar/red":"#f43f48","calendar/teal":"#8be7dc","calendar/yellow":"#fde047","centerPeek/background":"#ffffff","centerPeek/buttonBackground":"#ffffff","centerPeek/icon":"#7a7a7a","centerPeek/overlay":"#0000002b","chatBlock/chatBlockBg":"#ffffff","chatBlock/chatBlockBoder":"#e6e6e6","chatBlock/chatBlockIcon":"#7a7a7a","chatBlock/chatBlockText":"#141414","chip/label/blue":"#e6f5ff","chip/label/green":"#dcfdd7","chip/label/grey":"#e6e6e6","chip/label/magenta":"#ffecf6","chip/label/orange":"#ffebd5","chip/label/purple":"#ede9ff","chip/label/red":"#fce5e6","chip/label/teal":"#d7fbf6","chip/label/text":"#00000085","chip/label/white":"#f5f5f5","chip/label/yellow":"#fef3c7","chip/tag/blue":"#84cfff","chip/tag/green":"#69b87d","chip/tag/grey":"#b3b3b3","chip/tag/orange":"#ff8c38","chip/tag/purple":"#7c3aed","chip/tag/red":"#ed3f3f","chip/tag/teal":"#8be7dc","chip/tag/yellow":"#facc15","database/border":"#0000001a","database/buttonBackground":"#ffffff","database/cardHover":"#00000008","database/filterHeaderFadeIn":"#ffffff","database/filterHeaderFadeOut":"#ffffff08","database/focusBackground":"#1e96eb0a","database/textSecondary":"#00000085","database/attachment/fileSolidBackground":"#e6e6e6","dialog/background/primary":"#ffffff","edgeless/alignment/edgeGuides":"#cc4187","edgeless/alignment/guides":"#8b5cf6","edgeless/frame/background/black":"#cdcdcd","edgeless/frame/background/blue":"#e6f5ff","edgeless/frame/background/green":"#f1fdf4","edgeless/frame/background/grey":"#f3f3f3","edgeless/frame/background/magenta":"#ffecf6","edgeless/frame/background/orange":"#ffebd5","edgeless/frame/background/purple":"#ede9ff","edgeless/frame/background/red":"#fce5e6","edgeless/frame/background/teal":"#e2fdf9","edgeless/frame/background/white":"#ffffff","edgeless/frame/background/yellow":"#fffbd5","edgeless/frame/border/active":"#1e96eb","edgeless/frame/border/default":"#0000002b","edgeless/frame/fontColor/font":"#000000f2","edgeless/group/background/background":"#ffffff","edgeless/group/border/active":"#1e96eb","edgeless/group/border/borderHint":"#8fd1ff","edgeless/group/border/hover":"#1e96eb","edgeless/group/fontColor/active":"#1e96eb","edgeless/group/fontColor/default":"#00000085","edgeless/group/fontColor/hover":"#1e96eb","edgeless/group/fontColor/rename":"#000000","edgeless/line/black":"#000000","edgeless/line/blue":"#29a3fa","edgeless/line/green":"#3cbc36","edgeless/line/grey":"#929292","edgeless/line/magenta":"#e660a4","edgeless/line/orange":"#ff8c38","edgeless/line/purple":"#6e52df","edgeless/line/red":"#e11e41","edgeless/line/teal":"#5cc7ba","edgeless/line/white":"#ffffff","edgeless/line/yellow":"#facc15","edgeless/lock/locked":"#92929285","edgeless/mindMap/line":"#000000","edgeless/note/black":"#b3b3b3","edgeless/note/blue":"#ceecff","edgeless/note/green":"#c9f8c1","edgeless/note/grey":"#e6e6e6","edgeless/note/magenta":"#ffdaed","edgeless/note/orange":"#ffc58f","edgeless/note/purple":"#ddd6fe","edgeless/note/red":"#fbb7b7","edgeless/note/teal":"#c7f8f2","edgeless/note/white":"#ffffff","edgeless/note/yellow":"#fde68a","edgeless/palette/black":"#000000","edgeless/palette/white":"#ffffff","edgeless/palette/heavy/blue":"#1c70a5","edgeless/palette/heavy/green":"#447756","edgeless/palette/heavy/magenta":"#941555","edgeless/palette/heavy/orange":"#b55309","edgeless/palette/heavy/purple":"#5a21b6","edgeless/palette/heavy/red":"#761717","edgeless/palette/heavy/yellow":"#ac7400","edgeless/palette/light/blueLight":"#e6f5ff","edgeless/palette/light/greenLight":"#f1fdf4","edgeless/palette/light/greyLight":"#e6e6e6","edgeless/palette/light/magentaLight":"#ffecf6","edgeless/palette/light/orangeLight":"#ffebd5","edgeless/palette/light/purpleLight":"#ede9ff","edgeless/palette/light/redLight":"#fce5e6","edgeless/palette/light/yellowLight":"#fffbd5","edgeless/palette/medium/blueMedium":"#84cfff","edgeless/palette/medium/greenMedium":"#3cbc36","edgeless/palette/medium/greyMedium":"#929292","edgeless/palette/medium/magentaMedium":"#e96cab","edgeless/palette/medium/orangeMedium":"#ff8c38","edgeless/palette/medium/purpleMedium":"#6e52df","edgeless/palette/medium/redMedium":"#fb7081","edgeless/palette/medium/yellowMedium":"#fcd34d","edgeless/selection/selectionMarqueeBackground":"#1e96eb14","edgeless/selection/selectionMarqueeBorder":"#1e96eb","edgeless/shape/black":"#000000","edgeless/shape/blue":"#9fd9ff","edgeless/shape/green":"#9bda91","edgeless/shape/grey":"#cdcdcd","edgeless/shape/magenta":"#ffc0e0","edgeless/shape/orange":"#ffae63","edgeless/shape/purple":"#d7cdff","edgeless/shape/red":"#fecdd1","edgeless/shape/teal":"#8be7dc","edgeless/shape/white":"#ffffff","edgeless/shape/yellow":"#fde047","edgelessToolbar/highlightPen/body":"#fafafa","edgelessToolbar/highlightPen/body1Linear1-1":"#00000000","edgelessToolbar/highlightPen/body1Linear1-2":"#00000000","edgelessToolbar/highlightPen/body1Linear1-3":"#000000","edgelessToolbar/highlightPen/body1Linear2-1":"#ffffff00","edgelessToolbar/highlightPen/body1Linear2-2":"#ffffff00","edgelessToolbar/highlightPen/body1Linear2-3":"#ffffff00","edgelessToolbar/highlightPen/body1Linear2-4":"#ffffff00","edgelessToolbar/highlightPen/body2":"#f3f3f3","edgelessToolbar/highlightPen/body2Linear1-1":"#00000000","edgelessToolbar/highlightPen/body2Linear1-2":"#00000000","edgelessToolbar/highlightPen/body2Linear1-3":"#000000","edgelessToolbar/highlightPen/body2Linear2-1":"#00000000","edgelessToolbar/highlightPen/body2Linear2-2":"#00000000","edgelessToolbar/highlightPen/body2Linear2-3":"#00000000","edgelessToolbar/highlightPen/body2Linear2-4":"#00000000","edgelessToolbar/highlightPen/body2Linear2-5":"#00000000","edgelessToolbar/highlightPen/bodyColorLinear-1":"#00000000","edgelessToolbar/highlightPen/bodyColorLinear-2":"#000000fc","edgelessToolbar/highlightPen/bodyColorLinear-3":"#000000c4","edgelessToolbar/media/whiteVector":"#ffffff8f","edgelessToolbar/note/background":"#ffffff","edgelessToolbar/note/textColor":"#0000001a","edgelessToolbar/others/background":"#ffffff1f","edgelessToolbar/others/highlightLinearEnd":"#ffffff","edgelessToolbar/others/highlightLinearStart":"#ffffff00","edgelessToolbar/others/linearCenter":"#000000c4","edgelessToolbar/others/linearEnd":"#0000001f","edgelessToolbar/others/linearStart":"#ffffff1f","edgelessToolbar/penEraser/eraserBlue-1":"#173654","edgelessToolbar/penEraser/eraserBlue-2":"#effaff","edgelessToolbar/penEraser/eraserBlue-3":"#1e96eb","edgelessToolbar/penEraser/eraserBodyFill":"#f1f1f1","edgelessToolbar/penEraser/eraserBodyHighlight":"#ffffff8f","edgelessToolbar/penEraser/eraserBodyShade2":"#00000033","edgelessToolbar/penEraser/eraserBodyShade3":"#ffffff","edgelessToolbar/penEraser/eraserBorder":"#e7e7e7","edgelessToolbar/penEraser/eraserBorder2":"#e3e2e4","edgelessToolbar/penEraser/eraserClothHighlight":"#ffffff1c","edgelessToolbar/penEraser/eraserClothShade2":"#0f0f0f","edgelessToolbar/penEraser/eraserClothShade3":"#ffffff17","edgelessToolbar/penEraser/eraserShadow":"#00000040","edgelessToolbar/penEraser/penBackground":"#fafafa","edgelessToolbar/penEraser/penBodyShade-1":"#00000033","edgelessToolbar/penEraser/penBodyShade-2":"#0000001a","edgelessToolbar/penEraser/penBodyShade-3":"#00000003","edgelessToolbar/penEraser/penBodyShade-4":"#ffffff14","edgelessToolbar/penEraser/penInlineShadow":"#ffffff00","icon/activated":"#1e96eb","icon/disable":"#b3b3b3","icon/fileIconBorder":"#cdcdcd","icon/monotone":"#7a7a7a","icon/primary":"#7a7a7a","icon/secondary":"#b3b3b3","icon/tertiary":"#cdcdcd","icon/transparentBlack":"#00000085","icon/fileIconColors/blue":"#0077cb","icon/fileIconColors/green":"#1d9c07","icon/fileIconColors/grey":"#1e1b4b","icon/fileIconColors/magenta":"#e660a4","icon/fileIconColors/purple":"#6e52df","icon/fileIconColors/red":"#ed3f3f","icon/fileIconColors/yellow":"#facc15","input/background":"#ffffff","input/scrollBar/handle":"#0000001a","input/border/active":"#1e96eb","input/border/default":"#0000001a","input/border/error":"#ed3f3f","integrations/background/iconSolid":"#ffffff","layer/black":"#000000","layer/pureBlack":"#000000","layer/pureWhite":"#ffffff","layer/white":"#ffffff","layer/insideBorder/blackBorder":"#0000001a","layer/insideBorder/border":"#e6e6e6","layer/insideBorder/primaryBorder":"#1e96eb","layer/insideBorder/splitviewActived":"#0000002b","layer/insideBorder/whiteBorder":"#ffffff8f","layer/background/codeBlock":"#f5f5f5","layer/background/edgelessGrid":"#e6e6e6","layer/background/error":"#fff1f1","layer/background/hoverOverlay":"#0000000d","layer/background/linkedDocOnEdgeless":"#ffffff","layer/background/modal":"#000000b2","layer/background/modalWhite":"#ffffff2b","layer/background/overlayPanel":"#ffffff","layer/background/primary":"#ffffff","layer/background/processing":"#eef2ff","layer/background/secondary":"#f5f5f5","layer/background/success":"#f1fdf4","layer/background/tertiary":"#f3f3f3","layer/background/translucentUI":"#ffffffb8","layer/background/warning":"#fff7ee","layer/background/mobile/iOSControl":"#000000","layer/background/mobile/modal":"#0000002b","layer/background/mobile/primary":"#f5f5f5","layer/background/mobile/secondary":"#ffffff","layer/background/mobile/tertiary":"#e6e6e6","loading/background":"#0000001a","loading/backgroundLayer":"#92929238","loading/foreground":"#1e96eb","loading/imageLoadingBackground":"#92929238","loading/imageLoadingLayer":"#ffffff8f","others/warnLabel/black":"#000000","others/warnLabel/yellow":"#facc15","pagelist/hoverBorder":"#e6e6e6","portrait/localPortrait":"#00000038","portrait/localPortraitBackground":"#0000001a","radio/disable":"#cdcdcd","radio/active/chekced":"#1e96eb","radio/active/default":"#7a7a7a","readwise/quoteBackground":"#f9f9f9","readwise/quoteDivider":"#1e96eb","segment/background":"#0000000d","segment/button":"#ffffff","selfhost/portrait/localPortraitBackground":"#0000000d","selfhost/button/disable":"#7a7a7a","selfhost/button/primary":"#141414","selfhost/button/secondary":"#ffffff","selfhost/button/sidebarButton/bg/hover":"#0000000d","selfhost/button/sidebarButton/bg/select":"#0000000d","selfhost/icon/buttonIcon":"#ffffff","selfhost/icon/buttonIconError":"#ffffff","selfhost/icon/disable":"#b3b3b3","selfhost/icon/primary":"#141414","selfhost/icon/secondary":"#7a7a7a","selfhost/icon/tertiary":"#b3b3b3","selfhost/layer/background/hoverOverlay":"#ffffff3b","selfhost/layer/background/primary":"#ffffff","selfhost/layer/background/secondary":"#f9f9f9","selfhost/layer/background/sidebarBg/sidebarBg":"#f9f9f9","selfhost/layer/border/border":"#141414","selfhost/progress/error":"#ed3f3f","selfhost/progress/primary":"#141414","selfhost/text/placeholder":"#b3b3b3","selfhost/text/button/error":"#ffffff","selfhost/text/button/primary":"#ffffff","selfhost/text/sidebar/primary":"#141414","selfhost/text/sidebar/secondary":"#252525","selfhost/toggle/backgroundDisable":"#e6e6e6","selfhost/toggle/backgroundOff":"#cdcdcd","selfhost/toggle/backgroundOn":"#141414","selfhost/toggle/foreground":"#ffffff","selfhost/toggle/foregroundDisable":"#f9f9f9","skeleton/skeleton":"#e6e6e6","slashMenu/background":"#ffffff","status/error":"#ed3f3f","status/success":"#44b931","switch/buttonBackground/active":"#ffffff","switch/buttonBackground/hover":"#0000000d","switch/fontColor/primary":"#141414","switch/fontColor/secondary":"#7a7a7a","switch/fontColor/tertiary":"#929292","switch/iconColor/active":"#565656","switch/iconColor/default":"#929292","switch/switchBackground/background":"#f3f3f3","tab/divider/divider":"#00000012","tab/divider/indicator":"#1e96eb","tab/fontColor/active":"#141414","tab/fontColor/default":"#b3b3b3","tab/fontColor/hover":"#141414","tab/iconColor/active":"#565656","tab/iconColor/default":"#b3b3b3","tab/iconColor/hover":"#565656","tab/tabBackground/active":"#ffffff","tab/tabBackground/default":"#f3f3f3","tab/tabBackground/hover":"#f3f3f3","table/border":"#0000001a","table/focusBackground":"#1e96eb0a","table/focusBorder":"#1e96eb","table/textSecondary":"#00000085","table/headerBackground/blue":"#f0f9ff","table/headerBackground/default":"#ffffff","table/headerBackground/green":"#efffec","table/headerBackground/grey":"#f5f5f5","table/headerBackground/headerColor":"#f3f3f3","table/headerBackground/orange":"#fff7ee","table/headerBackground/purple":"#f7f5ff","table/headerBackground/red":"#fff4f5","table/headerBackground/teal":"#eefffd","table/headerBackground/yellow":"#fffded","table/indicator/activated":"#1e96eb","table/indicator/border":"#e6e6e6","table/indicator/drag":"#0000002b","table/indicator/hover":"#0000000d","table/indicator/pointerActive":"#ffffff","table/indicator/pointerDefault":"#b3b3b3","text/disable":"#7a7a7a","text/emphasis":"#1e96eb","text/link":"#035f9f","text/listDotAndNumber":"#0077cb","text/placeholder":"#929292","text/primary":"#141414","text/pureWhite":"#ffffff","text/secondary":"#7a7a7a","text/tertiary":"#929292","text/highlight/border":"#00000038","text/highlight/bg/blue":"#daf0ff","text/highlight/bg/green":"#f0fccb","text/highlight/bg/grey":"#e6e6e6","text/highlight/bg/magenta":"#ffecf6","text/highlight/bg/orange":"#ffebd5","text/highlight/bg/purple":"#ede9ff","text/highlight/bg/red":"#fce5e6","text/highlight/bg/teal":"#c7f8f2","text/highlight/bg/yellow":"#fff9b6","text/highlight/fg/blue":"#003c67","text/highlight/fg/green":"#225c18","text/highlight/fg/grey":"#7a7a7a","text/highlight/fg/magenta":"#941555","text/highlight/fg/orange":"#db7123","text/highlight/fg/purple":"#7c3aed","text/highlight/fg/red":"#c83030","text/highlight/fg/teal":"#0e4841","text/highlight/fg/yellow":"#ac7400","toast/cardLayer/second":"#f9f9f9","toast/cardLayer/third":"#f5f5f5","toast/iconState/error":"#ed3f3f","toast/iconState/regular":"#0077cb","toast/iconState/success":"#44b931","toast/overlay/secondary":"#00000008","toast/overlay/tertiary":"#0000000d","toggle/background":"#1e96eb","toggle/backgroundDisable":"#b3b3b3","toggle/backgroundOff":"#929292","toggle/foreground":"#ffffff","toggle/foregroundDisable":"#e6e6e6","tooltips/background":"#000000","tooltips/foreground":"#ffffff","tooltips/secondaryBackground":"#ffffff2b","workspacePicker/border":"#e6e6e6","workspacePicker/secondaryBackground":"#9292921a","tableOfContent/background":"#ffffff"},zC={"aI/errorBackground":"#ed3f3f2e","aI/errorDetailBackground":"#00000054","aI/errorText":"#fff4f5","aI/thinkingOutputBackground":"#000000","aI/thinkingOutputText":"#ffffff8f","aI/userTextBackground":"#252525","adjustmentHandle/background":"#00000085","adjustmentHandle/border":"#ffffff","backlinks/blockBackgroundColor":"#9292921a","backlinks/blockBorder":"#9292922b","backlinks/blockHover":"#9292922b","badge/believer":"#002742","badge/free":"#29a3fa","badge/pro":"#29a3fa","block/callout/background/blue":"#002742","block/callout/background/green":"#192e06","block/callout/background/grey":"#414141","block/callout/background/magenta":"#5f0a35","block/callout/background/orange":"#451a02","block/callout/background/purple":"#1e1b4b","block/callout/background/red":"#460606","block/callout/background/teal":"#0e4841","block/callout/background/yellow":"#321a04","block/callout/icon/blue":"#2f94d5","block/callout/icon/green":"#22bf07","block/callout/icon/grey":"#cdcdcd","block/callout/icon/magenta":"#cc4187","block/callout/icon/orange":"#d97705","block/callout/icon/purple":"#7c3aed","block/callout/icon/red":"#c83030","block/callout/icon/teal":"#5cc7ba","block/callout/icon/yellow":"#e0aa00","block/code/lineNum":"#7a7a7a","block/comment/hanelActive":"#ffffff0d","block/comment/highlightActive":"#1e96eb4d","block/comment/highlightDefault":"#1e96eb14","block/comment/highlightUnderline":"#1e96ebb2","block/divider/divider":"#9292922b","block/footnote/numberBg":"#565656","block/footnote/numberBgHover":"#1e96eb","block/list/header":"#4ab1fa","block/notSupportedBlock/background":"#000000","block/notSupportedBlock/inlineBg/default":"#252525","block/notSupportedBlock/inlineBg/hover":"#414141","block/recordBlock/buttonBg":"#761717","block/recordBlock/primary":"#f45353","block/recordBlock/secordary":"#c83030","block/recordBlock/timelineIndeicator":"#ed3f3f","button/actionActive":"#ffffff0d","button/badgesColor":"#c83030","button/buttonOverHover":"#414141","button/checkBox":"#1e96eb","button/disable":"#7a7a7a","button/emptyIconBackground":"#ffffff0d","button/error":"#c83030","button/iconButtonSolid":"#ffffff17","button/innerBlackBorder":"#ffffff0d","button/primary":"#1e96eb","button/pureWhiteText":"#ffffff","button/secondary":"#ffffff17","button/success":"#1d9c07","button/templateLabelBackground":"#1e96eb14","button/grabber/select":"#ffffff21","button/grabber/default":"#ffffff17","button/mobile/aIActionBackground":"#252525","button/mobile/deletedAction":"#c83030","button/sidebarButton/background":"#ffffff08","button/siderbarPrimary/background":"#0000002b","button/signinbutton/background":"#414141","calendar/blue":"#29a3fa","calendar/green":"#3cbc36","calendar/grey":"#929292","calendar/magenta":"#e660a4","calendar/orange":"#ff8c38","calendar/purple":"#6e52df","calendar/red":"#ed3f3f","calendar/teal":"#5cc7ba","calendar/yellow":"#facc15","centerPeek/background":"#000000","centerPeek/buttonBackground":"#252525","centerPeek/icon":"#cdcdcd","centerPeek/overlay":"#00000085","chatBlock/chatBlockBg":"#252525","chatBlock/chatBlockBoder":"#414141","chatBlock/chatBlockIcon":"#cdcdcd","chatBlock/chatBlockText":"#e6e6e6","chip/label/blue":"#004b7b","chip/label/green":"#225c18","chip/label/grey":"#414141","chip/label/magenta":"#5f0a35","chip/label/orange":"#843b06","chip/label/purple":"#25136d","chip/label/red":"#460606","chip/label/teal":"#1c6b63","chip/label/text":"#ffffffab","chip/label/white":"#252525","chip/label/yellow":"#ac7400","chip/tag/blue":"#84cfff","chip/tag/green":"#69b87d","chip/tag/grey":"#b3b3b3","chip/tag/orange":"#ff8c38","chip/tag/purple":"#7c3aed","chip/tag/red":"#ed3f3f","chip/tag/teal":"#8be7dc","chip/tag/yellow":"#facc15","database/border":"#ffffff21","database/buttonBackground":"#414141","database/cardHover":"#ffffff08","database/filterHeaderFadeIn":"#000000","database/filterHeaderFadeOut":"#00000008","database/focusBackground":"#1e96eb0a","database/textSecondary":"#ffffff8f","database/attachment/fileSolidBackground":"#414141","dialog/background/primary":"#252525","edgeless/alignment/edgeGuides":"#e660a4","edgeless/alignment/guides":"#8b5cf6","edgeless/frame/background/black":"#cdcdcd","edgeless/frame/background/blue":"#e6f5ff","edgeless/frame/background/green":"#f1fdf4","edgeless/frame/background/grey":"#f3f3f3","edgeless/frame/background/magenta":"#ffecf6","edgeless/frame/background/orange":"#ffebd5","edgeless/frame/background/purple":"#ede9ff","edgeless/frame/background/red":"#fce5e6","edgeless/frame/background/teal":"#e2fdf9","edgeless/frame/background/white":"#ffffff","edgeless/frame/background/yellow":"#fffbd5","edgeless/frame/border/active":"#1e96eb","edgeless/frame/border/default":"#ffffff2b","edgeless/frame/fontColor/font":"#000000f2","edgeless/group/background/background":"#ffffff","edgeless/group/border/active":"#1e96eb","edgeless/group/border/borderHint":"#8fd1ff","edgeless/group/border/hover":"#1e96eb","edgeless/group/fontColor/active":"#1e96eb","edgeless/group/fontColor/default":"#ffffff8f","edgeless/group/fontColor/hover":"#1e96eb","edgeless/group/fontColor/rename":"#000000","edgeless/line/black":"#000000","edgeless/line/blue":"#29a3fa","edgeless/line/green":"#3cbc36","edgeless/line/grey":"#929292","edgeless/line/magenta":"#e660a4","edgeless/line/orange":"#ff8c38","edgeless/line/purple":"#6e52df","edgeless/line/red":"#ed3f3f","edgeless/line/teal":"#5cc7ba","edgeless/line/white":"#ffffff","edgeless/line/yellow":"#facc15","edgeless/lock/locked":"#92929285","edgeless/mindMap/line":"#ffffff","edgeless/note/black":"#252525","edgeless/note/blue":"#004b7b","edgeless/note/green":"#3b5315","edgeless/note/grey":"#565656","edgeless/note/magenta":"#5f0a35","edgeless/note/orange":"#843b06","edgeless/note/purple":"#312e81","edgeless/note/red":"#460606","edgeless/note/teal":"#0e4841","edgeless/note/white":"#252525","edgeless/note/yellow":"#704200","edgeless/palette/black":"#ffffff","edgeless/palette/white":"#000000","edgeless/palette/heavy/blue":"#1c70a5","edgeless/palette/heavy/green":"#447756","edgeless/palette/heavy/magenta":"#941555","edgeless/palette/heavy/orange":"#b55309","edgeless/palette/heavy/purple":"#5a21b6","edgeless/palette/heavy/red":"#761717","edgeless/palette/heavy/yellow":"#ac7400","edgeless/palette/light/blueLight":"#e6f5ff","edgeless/palette/light/greenLight":"#f1fdf4","edgeless/palette/light/greyLight":"#e6e6e6","edgeless/palette/light/magentaLight":"#ffecf6","edgeless/palette/light/orangeLight":"#ffebd5","edgeless/palette/light/purpleLight":"#d7cdff","edgeless/palette/light/redLight":"#fce5e6","edgeless/palette/light/yellowLight":"#fffbd5","edgeless/palette/medium/blueMedium":"#84cfff","edgeless/palette/medium/greenMedium":"#3cbc36","edgeless/palette/medium/greyMedium":"#929292","edgeless/palette/medium/magentaMedium":"#e96cab","edgeless/palette/medium/orangeMedium":"#ff8c38","edgeless/palette/medium/purpleMedium":"#6e52df","edgeless/palette/medium/redMedium":"#fb7081","edgeless/palette/medium/yellowMedium":"#fcd34d","edgeless/selection/selectionMarqueeBackground":"#1e96eb14","edgeless/selection/selectionMarqueeBorder":"#1e96eb","edgeless/shape/black":"#000000","edgeless/shape/blue":"#9fd9ff","edgeless/shape/green":"#9bda91","edgeless/shape/grey":"#cdcdcd","edgeless/shape/magenta":"#ffc0e0","edgeless/shape/orange":"#ffae63","edgeless/shape/purple":"#d7cdff","edgeless/shape/red":"#fbb7b7","edgeless/shape/teal":"#8be7dc","edgeless/shape/white":"#ffffff","edgeless/shape/yellow":"#fde047","edgelessToolbar/highlightPen/body":"#3d3d3d","edgelessToolbar/highlightPen/body1Linear1-1":"#00000000","edgelessToolbar/highlightPen/body1Linear1-2":"#00000000","edgelessToolbar/highlightPen/body1Linear1-3":"#000000","edgelessToolbar/highlightPen/body1Linear2-1":"#00000000","edgelessToolbar/highlightPen/body1Linear2-2":"#00000080","edgelessToolbar/highlightPen/body1Linear2-3":"#000000","edgelessToolbar/highlightPen/body1Linear2-4":"#ffffff","edgelessToolbar/highlightPen/body2":"#303030","edgelessToolbar/highlightPen/body2Linear1-1":"#00000000","edgelessToolbar/highlightPen/body2Linear1-2":"#00000000","edgelessToolbar/highlightPen/body2Linear1-3":"#00000000","edgelessToolbar/highlightPen/body2Linear2-1":"#00000000","edgelessToolbar/highlightPen/body2Linear2-2":"#00000000","edgelessToolbar/highlightPen/body2Linear2-3":"#00000000","edgelessToolbar/highlightPen/body2Linear2-4":"#000000","edgelessToolbar/highlightPen/body2Linear2-5":"#797979","edgelessToolbar/highlightPen/bodyColorLinear-1":"#00000000","edgelessToolbar/highlightPen/bodyColorLinear-2":"#000000","edgelessToolbar/highlightPen/bodyColorLinear-3":"#000000c4","edgelessToolbar/media/whiteVector":"#00000038","edgelessToolbar/note/background":"#414141","edgelessToolbar/note/textColor":"#ffffff21","edgelessToolbar/others/background":"#4a4a4ab2","edgelessToolbar/others/highlightLinearEnd":"#ffffff1f","edgelessToolbar/others/highlightLinearStart":"#ffffff0f","edgelessToolbar/others/linearCenter":"#000000a8","edgelessToolbar/others/linearEnd":"#00000000","edgelessToolbar/others/linearStart":"#00000000","edgelessToolbar/penEraser/eraserBlue-1":"#1c3d5d","edgelessToolbar/penEraser/eraserBlue-2":"#a1c5d3","edgelessToolbar/penEraser/eraserBlue-3":"#1a7cc1","edgelessToolbar/penEraser/eraserBodyFill":"#3d3d3d","edgelessToolbar/penEraser/eraserBodyHighlight":"#ffffff17","edgelessToolbar/penEraser/eraserBodyShade2":"#000000cc","edgelessToolbar/penEraser/eraserBodyShade3":"#ffffff66","edgelessToolbar/penEraser/eraserBorder":"#7f7f7f","edgelessToolbar/penEraser/eraserBorder2":"#9b9b9b","edgelessToolbar/penEraser/eraserClothHighlight":"#ffffff1c","edgelessToolbar/penEraser/eraserClothShade2":"#0f0f0f","edgelessToolbar/penEraser/eraserClothShade3":"#ffffff17","edgelessToolbar/penEraser/eraserShadow":"#000000c4","edgelessToolbar/penEraser/penBackground":"#3d3d3d","edgelessToolbar/penEraser/penBodyShade-1":"#00000099","edgelessToolbar/penEraser/penBodyShade-2":"#00000066","edgelessToolbar/penEraser/penBodyShade-3":"#00000033","edgelessToolbar/penEraser/penBodyShade-4":"#0000001a","edgelessToolbar/penEraser/penInlineShadow":"#00000040","icon/activated":"#1e96eb","icon/disable":"#414141","icon/fileIconBorder":"#565656","icon/monotone":"#7a7a7a","icon/primary":"#f3f3f3","icon/secondary":"#cdcdcd","icon/tertiary":"#565656","icon/transparentBlack":"#ffffffb8","icon/fileIconColors/blue":"#0077cb","icon/fileIconColors/green":"#1d9c07","icon/fileIconColors/grey":"#312e81","icon/fileIconColors/magenta":"#e660a4","icon/fileIconColors/purple":"#6e52df","icon/fileIconColors/red":"#ed3f3f","icon/fileIconColors/yellow":"#facc15","input/background":"#ffffff17","input/scrollBar/handle":"#ffffff2b","input/border/active":"#1e96eb","input/border/default":"#ffffff0d","input/border/error":"#ed3f3f","integrations/background/iconSolid":"#ffffff","layer/black":"#ffffff","layer/pureBlack":"#000000","layer/pureWhite":"#ffffff","layer/white":"#000000","layer/insideBorder/blackBorder":"#ffffff0d","layer/insideBorder/border":"#414141","layer/insideBorder/primaryBorder":"#1e96eb","layer/insideBorder/splitviewActived":"#ffffffab","layer/insideBorder/whiteBorder":"#ffffff0d","layer/background/codeBlock":"#252525","layer/background/edgelessGrid":"#565656","layer/background/error":"#460606","layer/background/hoverOverlay":"#ffffff17","layer/background/linkedDocOnEdgeless":"#252525","layer/background/modal":"#00000085","layer/background/modalWhite":"#ffffff2b","layer/background/overlayPanel":"#252525","layer/background/primary":"#141414","layer/background/processing":"#002742","layer/background/secondary":"#252525","layer/background/success":"#1c3027","layer/background/tertiary":"#565656","layer/background/translucentUI":"#000000a6","layer/background/warning":"#321a04","layer/background/mobile/iOSControl":"#ffffff","layer/background/mobile/modal":"#00000085","layer/background/mobile/primary":"#000000","layer/background/mobile/secondary":"#252525","layer/background/mobile/tertiary":"#414141","loading/background":"#ffffff2b","loading/backgroundLayer":"#929292f2","loading/foreground":"#0077cb","loading/imageLoadingBackground":"#92929238","loading/imageLoadingLayer":"#ffffff8f","others/warnLabel/black":"#000000","others/warnLabel/yellow":"#facc15","pagelist/hoverBorder":"#7a7a7a","portrait/localPortrait":"#ffffff3b","portrait/localPortraitBackground":"#ffffff2b","radio/disable":"#7a7a7a","radio/active/chekced":"#1e96eb","radio/active/default":"#b3b3b3","readwise/quoteBackground":"#252525","readwise/quoteDivider":"#1e96eb","segment/background":"#ffffff0d","segment/button":"#ffffff17","selfhost/portrait/localPortraitBackground":"#ffffff21","selfhost/button/disable":"#252525","selfhost/button/primary":"#f3f3f3","selfhost/button/secondary":"#ffffff17","selfhost/button/sidebarButton/bg/hover":"#ffffff17","selfhost/button/sidebarButton/bg/select":"#ffffff17","selfhost/icon/buttonIcon":"#141414","selfhost/icon/buttonIconError":"#ffffff","selfhost/icon/disable":"#565656","selfhost/icon/primary":"#f3f3f3","selfhost/icon/secondary":"#cdcdcd","selfhost/icon/tertiary":"#565656","selfhost/layer/background/hoverOverlay":"#fffffffa","selfhost/layer/background/primary":"#141414","selfhost/layer/background/secondary":"#252525","selfhost/layer/background/sidebarBg/sidebarBg":"#252525","selfhost/layer/border/border":"#e6e6e6","selfhost/progress/error":"#c83030","selfhost/progress/primary":"#e6e6e6","selfhost/text/placeholder":"#7a7a7a","selfhost/text/button/error":"#ffffff","selfhost/text/button/primary":"#141414","selfhost/text/sidebar/primary":"#e6e6e6","selfhost/text/sidebar/secondary":"#cdcdcd","selfhost/toggle/backgroundDisable":"#414141","selfhost/toggle/backgroundOff":"#565656","selfhost/toggle/backgroundOn":"#b3b3b3","selfhost/toggle/foreground":"#fffffffa","selfhost/toggle/foregroundDisable":"#565656","skeleton/skeleton":"#252525","slashMenu/background":"#252525","status/error":"#c83030","status/success":"#1d9c07","switch/buttonBackground/active":"#414141","switch/buttonBackground/hover":"#ffffff0d","switch/fontColor/primary":"#e6e6e6","switch/fontColor/secondary":"#929292","switch/fontColor/tertiary":"#7a7a7a","switch/iconColor/active":"#cdcdcd","switch/iconColor/default":"#7a7a7a","switch/switchBackground/background":"#252525","tab/divider/divider":"#ffffff21","tab/divider/indicator":"#1e96eb","tab/fontColor/active":"#e6e6e6","tab/fontColor/default":"#565656","tab/fontColor/hover":"#e6e6e6","tab/iconColor/active":"#cdcdcd","tab/iconColor/default":"#7a7a7a","tab/iconColor/hover":"#cdcdcd","tab/tabBackground/active":"#414141","tab/tabBackground/default":"#252525","tab/tabBackground/hover":"#252525","table/border":"#ffffff21","table/focusBackground":"#1e96eb0a","table/focusBorder":"#1e96eb","table/textSecondary":"#ffffff8f","table/headerBackground/blue":"#004b7b","table/headerBackground/default":"#252525","table/headerBackground/green":"#10340a","table/headerBackground/grey":"#565656","table/headerBackground/headerColor":"#252525","table/headerBackground/orange":"#843b06","table/headerBackground/purple":"#25136d","table/headerBackground/red":"#460606","table/headerBackground/teal":"#0e4841","table/headerBackground/yellow":"#704200","table/indicator/activated":"#1e96eb","table/indicator/border":"#414141","table/indicator/drag":"#ffffff21","table/indicator/hover":"#ffffff17","table/indicator/pointerActive":"#ffffff","table/indicator/pointerDefault":"#cdcdcd","text/disable":"#565656","text/emphasis":"#29a3fa","text/link":"#7ac8ff","text/listDotAndNumber":"#4ab1fa","text/placeholder":"#7a7a7a","text/primary":"#e6e6e6","text/pureWhite":"#ffffff","text/secondary":"#929292","text/tertiary":"#7a7a7a","text/highlight/border":"#ffffff3b","text/highlight/bg/blue":"#002742","text/highlight/bg/green":"#192e06","text/highlight/bg/grey":"#414141","text/highlight/bg/magenta":"#5f0a35","text/highlight/bg/orange":"#843b06","text/highlight/bg/purple":"#2e1065","text/highlight/bg/red":"#460606","text/highlight/bg/teal":"#0e4841","text/highlight/bg/yellow":"#321a04","text/highlight/fg/blue":"#2f94d5","text/highlight/fg/green":"#9bda91","text/highlight/fg/grey":"#565656","text/highlight/fg/magenta":"#f37fba","text/highlight/fg/orange":"#ffae63","text/highlight/fg/purple":"#9681ef","text/highlight/fg/red":"#fc7979","text/highlight/fg/teal":"#448e86","text/highlight/fg/yellow":"#facc15","toast/cardLayer/second":"#252525","toast/cardLayer/third":"#252525","toast/iconState/error":"#c83030","toast/iconState/regular":"#035f9f","toast/iconState/success":"#1d9c07","toast/overlay/secondary":"#0000000d","toast/overlay/tertiary":"#00000008","toggle/background":"#0077cb","toggle/backgroundDisable":"#414141","toggle/backgroundOff":"#565656","toggle/foreground":"#fffffffa","toggle/foregroundDisable":"#929292","tooltips/background":"#414141","tooltips/foreground":"#ffffff","tooltips/secondaryBackground":"#ffffff2b","workspacePicker/border":"#414141","workspacePicker/secondaryBackground":"#9292922b","tableOfContent/background":"#252525"};function WC(t){return`--affine-v2-${t.split("/").join("-")}`}function jC(t){const e={};return BW(t).forEach(n=>{e[WC(n)]=t[n]}),e}jC(Bd),jC(zC);function Rp(t,e){return`var(${WC(t)}${e?`, ${e}`:""})`}function YC(t=""){return new Proxy(Rp,{get(e,n){const r=t?`${t}/${String(n)}`:String(n);return typeof Bd[r]!="string"?YC(r):Rp(r)},apply(e,n,[r,i]){return t?Rp(t,r):Rp(r,i)}})}const ns=YC();function rs(t,e=""){return Object.entries(t).map(([n,r])=>({key:`${e}${n}`,value:r}))}function et(t){const e=zC[t],n=Bd[t];return e===n?e:{dark:e,light:n}}const Bp=Bd["edgeless/palette/black"],F1=Bd["edgeless/palette/white"],Fd="transparent",Fp=et("edgeless/palette/white"),Ud=et("edgeless/palette/black"),GC={Red:et("edgeless/palette/light/redLight"),Orange:et("edgeless/palette/light/orangeLight"),Yellow:et("edgeless/palette/light/yellowLight"),Green:et("edgeless/palette/light/greenLight"),Blue:et("edgeless/palette/light/blueLight"),Purple:et("edgeless/palette/light/purpleLight"),Magenta:et("edgeless/palette/light/magentaLight"),Grey:et("edgeless/palette/light/greyLight")},Wo={Red:et("edgeless/palette/medium/redMedium"),Orange:et("edgeless/palette/medium/orangeMedium"),Yellow:et("edgeless/palette/medium/yellowMedium"),Green:et("edgeless/palette/medium/greenMedium"),Blue:et("edgeless/palette/medium/blueMedium"),Purple:et("edgeless/palette/medium/purpleMedium"),Magenta:et("edgeless/palette/medium/magentaMedium"),Grey:et("edgeless/palette/medium/greyMedium")},VC={Red:et("edgeless/palette/heavy/red"),Orange:et("edgeless/palette/heavy/orange"),Yellow:et("edgeless/palette/heavy/yellow"),Green:et("edgeless/palette/heavy/green"),Blue:et("edgeless/palette/heavy/blue"),Purple:et("edgeless/palette/heavy/purple"),Magenta:et("edgeless/palette/heavy/magenta")},qC={Red:et("edgeless/note/red"),Orange:et("edgeless/note/orange"),Yellow:et("edgeless/note/yellow"),Green:et("edgeless/note/green"),Blue:et("edgeless/note/blue"),Purple:et("edgeless/note/purple"),Magenta:et("edgeless/note/magenta"),White:et("edgeless/note/white"),Transparent:Fd};[...rs(GC,"Light"),...rs(Wo,"Medium"),...rs(VC,"Heavy")],[...rs(qC)];const XC={...Wo,Black:Ud,White:Fp};[...rs(XC)];const FW={...Wo,Black:Ud,White:Fp,Transparent:Fd};[...rs(FW)];const UW={...Wo,Black:Bp,White:F1};[...rs({...UW})],[...rs(GC,"Light"),...rs(Wo,"Medium"),...rs(VC,"Heavy")];const ae={pureBlack:Bp,pureWhite:F1,black:Ud,white:Fp,transparent:Fd,textColor:Ud,shapeTextColor:Bp,shapeStrokeColor:Wo.Yellow,shapeFillColor:Wo.Yellow,connectorColor:Wo.Grey,noteBackgrounColor:qC.White,hightlighterColor:"#84cfff4d",StrokeColorShortMap:XC},$W=$e({color:B1,fontFamily:DW,fontStyle:OW,fontWeight:NW,textAlign:PW}).default({color:ae.textColor,fontFamily:fn.Inter,fontStyle:zo.Normal,fontWeight:tn.Regular,textAlign:Ks.Left}),KC=Zt({flavour:"affine:edgeless-text",props:()=>({xywh:"[0,0,16,16]",index:"a0",lockedBySelf:!1,scale:1,rotate:0,hasMaxWidth:!1,comments:void 0,...$W.parse(void 0)}),metadata:{version:1,role:"hub",parent:["affine:surface"],children:["affine:paragraph","affine:list","affine:code","affine:image","affine:bookmark","affine:attachment","affine:embed-!(synced-doc)","affine:latex"]},toModel:()=>new zW}),HW=bt(KC);class zW extends $s(Qe){get color(){return this.props.color}set color(e){this.props.color=e}}function il(t){return $s(t)}function sl({name:t,version:e,toModel:n,props:r,transformer:i}){return Zt({flavour:`affine:embed-${t}`,props:s=>({index:"a0",xywh:"[0,0,0,0]",lockedBySelf:!1,rotate:0,comments:void 0,"meta:createdAt":void 0,"meta:updatedAt":void 0,"meta:createdBy":void 0,"meta:updatedBy":void 0,...r==null?void 0:r(s)}),metadata:{version:e,role:"content"},toModel:n,transformer:i})}const WW=["figma"];class jW extends il(Qe){}const YW={style:WW[0],url:"",caption:null,title:null,description:null},kc=sl({name:"figma",version:1,toModel:()=>new jW,props:()=>YW}),GW=bt(kc),VW=["vertical","horizontal","list","cube"];class qW extends il(Qe){}const XW={style:VW[1],owner:"",repo:"",githubType:"issue",githubId:"",url:"",caption:null,image:null,status:null,statusReason:null,title:null,description:null,createdAt:null,assignees:null},Tc=sl({name:"github",version:1,toModel:()=>new qW,props:()=>XW}),KW=bt(Tc),QW=["html"];class ZW extends il(Qe){}const JW={style:QW[0],caption:null,html:void 0,design:void 0},QC=sl({name:"html",version:1,toModel:()=>new ZW,props:()=>JW}),ej=bt(QC),tj={url:"",iframeUrl:"",width:void 0,height:void 0,caption:null,title:null,description:null,xywh:"[0,0,0,0]",index:"a0",lockedBySelf:!1,scale:1};class nj extends $s(Qe){}const Up=Zt({flavour:"affine:embed-iframe",props:()=>tj,metadata:{version:1,role:"content"},toModel:()=>new nj}),rj=bt(Up),ij=["vertical","horizontal","list","cube","horizontalThin","citation"];class sj extends il(Qe){}const oj={pageId:"",style:ij[1],caption:null,title:void 0,description:void 0,footnoteIdentifier:null},Qs=sl({name:"linked-doc",version:1,toModel:()=>new sj,props:()=>oj}),ZC=bt(Qs),aj=["video"];class lj extends il(Qe){}const cj={style:aj[0],url:"",caption:null,image:null,title:null,description:null,videoId:null},Sc=sl({name:"loom",version:1,toModel:()=>new lj,props:()=>cj}),uj=bt(Sc),dj=["syncedDoc"];class hj extends il(Qe){get isFolded(){return!!this.props.preFoldHeight$.value}}const fj={pageId:"",style:dj[0],caption:void 0,scale:void 0,preFoldHeight:void 0,title:void 0,description:void 0,index:"a0",xywh:"[0,0,800,100]",lockedBySelf:void 0},jo=sl({name:"synced-doc",version:1,toModel:()=>new hj,props:()=>fj}),JC=bt(jo),pj=["video"];class mj extends il(Qe){}const gj={style:pj[0],url:"",caption:null,image:null,title:null,description:null,creator:null,creatorUrl:null,creatorImage:null,videoId:null},Cc=sl({name:"youtube",version:1,toModel:()=>new mj,props:()=>gj}),bj=bt(Cc);var eA,tA;$e({background:B1}).default({background:ae.transparent});const nA=Zt({flavour:"affine:frame",props:t=>({title:t.Text(),background:"transparent",xywh:"[0,0,100,100]",index:"a0",childElementIds:Object.create(null),presentationIndex:A6(null),lockedBySelf:!1,comments:void 0}),metadata:{version:1,role:"content",parent:["affine:surface"],children:[]},toModel:()=>new _j}),yj=bt(nA);class _j extends(tA=$s(Qe),eA=Qh,tA){constructor(){super(...arguments),this[eA]=!0}get childElements(){if(!this.surface)return[];const e=[];for(const n of this.childIds){const r=this.surface.getElementById(n)||this.surface.store.getModelById(n);r&&e.push(r)}return e}get childIds(){return this.props.childElementIds?Object.keys(this.props.childElementIds):[]}get descendantElements(){return dT(this)}addChild(e){O0(this,e)&&this.store.transact(()=>{this.props.childElementIds={...this.props.childElementIds,[e.id]:!0}})}addChildren(e){e=[...new Set(e)].filter(r=>O0(this,r));const n={};for(const r of e){const i=typeof r=="string"?r:r.id;n[i]=!0}this.store.transact(()=>{this.props.childElementIds={...this.props.childElementIds,...n}})}containsBound(e){return this.elementBound.contains(e)}hasChild(e){return this.props.childElementIds?e.id in this.props.childElementIds:!1}hasDescendant(e){return hT(this,e)}includesPoint(e,n,r){return X.deserialize(this.xywh).isPointInBound([e,n])}intersectsBound(e){const n=X.deserialize(this.xywh);return n.isIntersectWithBound(e)||e.contains(n)}removeChild(e){this.store.transact(()=>{this.props.childElementIds&&delete this.props.childElementIds[e.id]})}}class xj extends sp{async fromSnapshot(e){const n=await super.fromSnapshot(e),r=n.props.sourceId;return!e.assets.isEmpty()&&r&&!r.startsWith("/")&&await e.assets.writeToBlob(r),n}toSnapshot(e){const n=super.toSnapshot(e),r=e.model.props.sourceId;return r&&e.assets.getPathBlobIdMap().set(e.model.id,r),n}}const Ej={caption:"",sourceId:"",width:0,height:0,index:"a0",xywh:"[0,0,0,0]",lockedBySelf:!1,rotate:0,size:-1,comments:void 0,"meta:createdAt":void 0,"meta:createdBy":void 0,"meta:updatedAt":void 0,"meta:updatedBy":void 0},Yo=Zt({flavour:"affine:image",props:()=>Ej,metadata:{version:1,role:"content"},transformer:t=>new xj(t),toModel:()=>new wj}),vj=bt(Yo);class wj extends $s(Qe){}const Go=Zt({flavour:"affine:latex",props:()=>({xywh:"[0,0,16,16]",index:"a0",lockedBySelf:!1,scale:1,rotate:0,latex:"",comments:void 0}),metadata:{version:1,role:"content",parent:["affine:note","affine:edgeless-text","affine:paragraph","affine:list"]},toModel:()=>new Tj}),kj=bt(Go);class Tj extends $s(Qe){}const Zs=Zt({flavour:"affine:list",props:t=>({type:"bulleted",text:t.Text(),checked:!1,collapsed:!1,order:null,comments:void 0,"meta:createdAt":void 0,"meta:createdBy":void 0,"meta:updatedAt":void 0,"meta:updatedBy":void 0}),metadata:{version:1,role:"content",parent:["affine:note","affine:database","affine:list","affine:paragraph","affine:edgeless-text","affine:callout"]},toModel:()=>new Cj}),Sj=bt(Zs);class Cj extends Qe{}$e({background:B1,displayMode:IW,edgeless:$e({style:$e({borderRadius:dn(),borderSize:dn(),borderStyle:AW,shadowType:CW})})}).default({background:ae.noteBackgrounColor,displayMode:ft.EdgelessOnly,edgeless:{style:{borderRadius:UC,borderSize:$C,borderStyle:FC,shadowType:BC}}});const Vo=Zt({flavour:"affine:note",props:()=>({xywh:`[0,0,${TW},${SW}]`,background:ae.noteBackgrounColor,index:"a0",lockedBySelf:!1,hidden:!1,displayMode:ft.DocAndEdgeless,edgeless:{style:{borderRadius:UC,borderSize:$C,borderStyle:FC,shadowType:BC}},comments:void 0}),metadata:{version:1,role:"hub",parent:["@root"],children:["@content","affine:database","affine:data-view","affine:callout"]},toModel:()=>new U1}),Aj=bt(Vo);class U1 extends $s(Qe){_isSelectable(){return this.props.displayMode!==ft.DocOnly}containsBound(e){return this._isSelectable()?super.containsBound(e):!1}includesPoint(e,n){return this._isSelectable()?X.deserialize(this.xywh).isPointInBound([e,n],0):!1}intersectsBound(e){return this._isSelectable()?super.intersectsBound(e):!1}isEmpty(){if(this.children.length===0)return!0;if(this.children.length===1){const e=this.children[0];if(e.flavour==="affine:paragraph")return e.isEmpty()}return!1}isPageBlock(){var e;return((e=this.parent)==null?void 0:e.children.find(n=>n instanceof U1&&n.props.displayMode!==ft.EdgelessOnly))===this}}const Js=Zt({flavour:"affine:paragraph",props:t=>({type:"text",text:t.Text(),collapsed:!1,comments:void 0,"meta:createdAt":void 0,"meta:createdBy":void 0,"meta:updatedAt":void 0,"meta:updatedBy":void 0}),metadata:{version:1,role:"content",parent:["affine:note","affine:database","affine:paragraph","affine:list","affine:edgeless-text","affine:callout","affine:transcription"]},toModel:()=>new Mj}),Ij=bt(Js);class Mj extends Qe{isEmpty(){return this.props.text$.value.length===0&&this.children.length===0}}class $1 extends Qe{constructor(){super();const e=this.created.subscribe(()=>{e.unsubscribe(),this.store.slots.rootAdded.subscribe(n=>{const r=this.store.getModelById(n);if(r instanceof $1){const i=this.store.workspace.meta.getDocMeta(r.store.id);(!i||i.title!==r.props.title.toString())&&this.store.workspace.meta.setDocMeta(r.store.id,{title:r.props.title.toString()})}})})}isEmpty(){let e=0,n=!0;for(const r of this.children)if(n=n&&r.isEmpty(),r.flavour==="affine:note"&&e++,e>1)return!1;return n}}const ol=Zt({flavour:"affine:page",props:t=>({title:t.Text()}),metadata:{version:2,role:"root"},toModel:()=>new $1}),Dj=bt(ol),rA=Zt({flavour:"affine:surface-ref",props:()=>({reference:"",caption:"",refFlavour:"",comments:void 0}),metadata:{version:1,role:"content",parent:["affine:note","affine:paragraph","affine:list"]},toModel:()=>new Oj}),Nj=bt(rA);class Oj extends Qe{}class Pj extends Qe{}const $p="affine:table",eo=Zt({flavour:$p,props:()=>({rows:{},columns:{},cells:{},comments:void 0,"meta:createdAt":void 0,"meta:createdBy":void 0,"meta:updatedAt":void 0,"meta:updatedBy":void 0}),metadata:{isFlatData:!0,role:"content",version:1,parent:["affine:note"],children:[]},toModel:()=>new Pj}),Lj=bt(eo);var Rj=Object.create,iA=Object.defineProperty,Bj=Object.getOwnPropertyDescriptor,sA=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),$d=t=>{throw TypeError(t)},Fj=(t,e,n)=>e in t?iA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Uj=t=>{var e;return[,,,Rj((e=t==null?void 0:t[sA("metadata")])!=null?e:null)]},oA=["class","method","getter","setter","accessor","field","value","get","set"],Hd=t=>t!==void 0&&typeof t!="function"?$d("Function expected"):t,$j=(t,e,n,r,i)=>({kind:oA[t],name:e,metadata:r,addInitializer:s=>n._?$d("Already initialized"):i.push(Hd(s||null))}),Hj=(t,e)=>Fj(e,sA("metadata"),t[3]),is=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},zd=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=oA[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,Bj({get[n](){return zj(this,s)},set[n](E){return Wj(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=$j(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Hd(a)&&(y[g]=a):typeof a!="object"||a===null?$d("Object expected"):(Hd(o=a.get)&&(y.get=o),Hd(o=a.set)&&(y.set=o),Hd(o=a.init)&&b.unshift(o));return y&&iA(i,n,y),i},aA=(t,e,n)=>e.has(t)||$d("Cannot "+n),zj=(t,e,n)=>(aA(t,e,"read from private field"),e.get(t)),Wd=(t,e,n)=>e.has(t)?$d("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Wj=(t,e,n,r)=>(aA(t,e,"write to private field"),e.set(t,n),n),lA,cA,uA,dA,hA,H1,Bn,z1,W1,j1,Y1,G1;class al extends(H1=Lt,hA=[ue()],dA=[Ya((e,n)=>{n._local.delete("commands")}),ja((e,n)=>{const r=X.fromXYWH(n.deserializedXYWH);if(e===n.lineWidth||r.w===0||r.h===0)return{};const i=n.points,s=rf(i.map(([o,a])=>({x:o,y:a})),r,n.lineWidth/2,Dl(r,e-n.lineWidth),e/2);return{points:s.points.map((o,a)=>[o.x,o.y,...i[a][2]!==void 0?[i[a][2]]:[]]),xywh:s.bound.serialize()}}),ue()],uA=[Ya((e,n)=>{n._local.delete("commands")}),ja((e,n)=>{const r=n.lineWidth,i=du(e);return{xywh:Dl(i,r).serialize()}}),G0((e,n)=>{const r=n.lineWidth,i=du(e),s=Dl(i,r);return e.map(([a,l,c])=>[a-s.x,l-s.y,...c!==void 0?[c]:[]])}),ue()],cA=[ue(0)],lA=[ja((e,n)=>{const r=X.deserialize(e);if(r.w===n.w&&r.h===n.h)return{};const{lineWidth:i}=n;return{points:rf(n.points.map(([o,a])=>({x:o,y:a})),n,n.lineWidth/2,r,i/2).points.map((o,a)=>[o.x,o.y,...n.points[a][2]!==void 0?[n.points[a][2]]:[]])}}),ue()],H1){constructor(){super(...arguments),Wd(this,z1,is(Bn,8,this,ae.black)),is(Bn,11,this),Wd(this,W1,is(Bn,12,this,4)),is(Bn,15,this),Wd(this,j1,is(Bn,16,this,[])),is(Bn,19,this),Wd(this,Y1,is(Bn,20,this,0)),is(Bn,23,this),Wd(this,G1,is(Bn,24,this,"[0,0,0,0]")),is(Bn,27,this)}get commands(){var e;if(!this._local.has("commands")){const n=_v((e=this.points)!=null?e:[],this.lineWidth),r=uv(n);this._local.set("commands",r)}return this._local.get("commands")}get connectable(){return!1}get type(){return"brush"}containsBound(e){return Ke(this).some(r=>e.containsPoint(r))}getLineIntersections(e,n){const r=[this.x,this.y],i=Ke(this,o=>this.points.map(a=>R.add(a,r))),s=X.fromDOMRect(sg(this));if(s.w<8&&s.h<8)return R.distanceToLineSegment(e,n,s.center)<5?[]:null;if(s.intersectLine(e,n,!0)){const o=i.length;for(let a=1;a<o;a++){const l=Wr(e,n,i[a-1],i[a]);if(l)return[new wt(l,R.normalize(R.sub(i[a],i[a-1])))]}}return null}getNearestPoint(e){const{x:n,y:r}=this;return Jm(this.points.map(i=>R.add(i,[n,r])),e)}getRelativePointLocation(e){const n=X.deserialize(this.xywh).getRelativePoint(e);return new wt(n)}includesPoint(e,n,r){var i,s;return lv(X.deserialize(this.xywh),this.points,this.rotate,[e,n],((i=r==null?void 0:r.hitThreshold)!=null?i:10)/Math.min((s=r==null?void 0:r.zoom)!=null?s:1,1))}}Bn=Uj(H1),z1=new WeakMap,W1=new WeakMap,j1=new WeakMap,Y1=new WeakMap,G1=new WeakMap,zd(Bn,4,"color",hA,al,z1),zd(Bn,4,"lineWidth",dA,al,W1),zd(Bn,4,"points",uA,al,j1),zd(Bn,4,"rotate",cA,al,Y1),zd(Bn,4,"xywh",lA,al,G1),Hj(Bn,al);var jj=Object.create,fA=Object.defineProperty,Yj=Object.getOwnPropertyDescriptor,pA=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),jd=t=>{throw TypeError(t)},Gj=(t,e,n)=>e in t?fA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Vj=t=>{var e;return[,,,jj((e=t==null?void 0:t[pA("metadata")])!=null?e:null)]},mA=["class","method","getter","setter","accessor","field","value","get","set"],Yd=t=>t!==void 0&&typeof t!="function"?jd("Function expected"):t,qj=(t,e,n,r,i)=>({kind:mA[t],name:e,metadata:r,addInitializer:s=>n._?jd("Already initialized"):i.push(Yd(s||null))}),Xj=(t,e)=>Gj(e,pA("metadata"),t[3]),Le=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},zt=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=mA[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,Yj({get[n](){return Kj(this,s)},set[n](E){return Qj(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=qj(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Yd(a)&&(y[g]=a):typeof a!="object"||a===null?jd("Object expected"):(Yd(o=a.get)&&(y.get=o),Yd(o=a.set)&&(y.set=o),Yd(o=a.init)&&b.unshift(o));return y&&fA(i,n,y),i},gA=(t,e,n)=>e.has(t)||jd("Cannot "+n),Kj=(t,e,n)=>(gA(t,e,"read from private field"),e.get(t)),Wt=(t,e,n)=>e.has(t)?jd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Qj=(t,e,n,r)=>(gA(t,e,"write to private field"),e.set(t,n),n),bA,yA,_A,xA,EA,vA,wA,kA,TA,SA,CA,AA,IA,MA,DA,NA,OA,PA,LA,RA,BA,V1,fe,q1,X1,K1,Q1,Z1,J1,ey,ty,ny,ry,iy,sy,oy,ay,ly,cy,uy,dy,hy,fy,py;class Mt extends(V1=Lt,BA=[gi()],RA=[ue("None")],LA=[ue({hasMaxWidth:!0,maxWidth:bW})],PA=[ue(!0)],OA=[ue({distance:.5,anchor:LC.Center})],NA=[ue({color:ae.black,fontFamily:fn.Inter,fontSize:16,fontStyle:zo.Normal,fontWeight:tn.Regular,textAlign:Ks.Center})],DA=[ue()],MA=[gi()],IA=[ue()],AA=[ja((e,n)=>{const{x:r,y:i}=n;return{absolutePath:e.map(s=>s.clone().setVec(R.add(s,[r,i])))}}),gi()],CA=[ue("Arrow")],SA=[gi()],TA=[ue()],kA=[ue()],wA=[ue()],vA=[ue()],EA=[ue()],xA=[ue()],_A=[ue()],yA=[ue()],bA=[gi()],V1){constructor(){super(...arguments),this.updatingPath=!1,this.forceFullRender=!0,Wt(this,q1,Le(fe,8,this,[])),Le(fe,11,this),Wt(this,X1,Le(fe,12,this)),Le(fe,15,this),Wt(this,K1,Le(fe,16,this)),Le(fe,19,this),Wt(this,Q1,Le(fe,20,this)),Le(fe,23,this),Wt(this,Z1,Le(fe,24,this)),Le(fe,27,this),Wt(this,J1,Le(fe,28,this)),Le(fe,31,this),Wt(this,ey,Le(fe,32,this)),Le(fe,35,this),Wt(this,ty,Le(fe,36,this,!1)),Le(fe,39,this),Wt(this,ny,Le(fe,40,this,yW)),Le(fe,43,this),Wt(this,ry,Le(fe,44,this,[])),Le(fe,47,this),Wt(this,iy,Le(fe,48,this)),Le(fe,51,this),Wt(this,sy,Le(fe,52,this,0)),Le(fe,55,this),Wt(this,oy,Le(fe,56,this)),Le(fe,59,this),Wt(this,ay,Le(fe,60,this,Ld)),Le(fe,63,this),Wt(this,ly,Le(fe,64,this,{position:[0,0]})),Le(fe,67,this),Wt(this,cy,Le(fe,68,this,ae.connectorColor)),Le(fe,71,this),Wt(this,uy,Le(fe,72,this,xi.Solid)),Le(fe,75,this),Wt(this,dy,Le(fe,76,this,4)),Le(fe,79,this),Wt(this,hy,Le(fe,80,this,{position:[0,0]})),Le(fe,83,this),Wt(this,fy,Le(fe,84,this)),Le(fe,87,this),Wt(this,py,Le(fe,88,this,"[0,0,0,0]")),Le(fe,91,this)}get connectable(){return!1}get connected(){return!!(this.source.id||this.target.id)}get elementBound(){let e=super.elementBound;return this.hasLabel()&&(e=e.unite(X.fromXYWH(this.labelXYWH))),e}get type(){return"connector"}static propsToY(e){return typeof e.text=="string"&&(e.text=new gt(e.text)),e}containsBound(e){return this.absolutePath.some(n=>e.containsPoint(n))||this.hasLabel()&&X.fromXYWH(this.labelXYWH).points.some(n=>e.containsPoint(n))}getLineIntersections(e,n){const{mode:r,absolutePath:i}=this;let s=null;return r===en.Curve&&i.length>1?s=G6(i,[e,n]):s=av(e,n,i),!s&&this.hasLabel()&&(s=av(e,n,X.fromXYWH(this.labelXYWH).points)),s}getNearestPoint(e){const{mode:n,absolutePath:r}=this;if(n===en.Straight){const c=r[0],u=r[r.length-1];return R.nearestPointOnLineSegment(c,u,e,!0)}if(n===en.Orthogonal){const c=r.map(u=>[u[0],u[1]]);return go.nearestPoint(c,e)}const i=Nl(r),s=ag(i,e),o=hu(i,s);if(o)return o;const{x:a,y:l}=this;return[a,l]}getOffsetDistanceByPoint(e,n){const{mode:r,absolutePath:i}=this;let{x:s,y:o,w:a,h:l}=this;if(n&&(s=n.x,o=n.y,a=n.w,l=n.h),e[0]=R.clamp(e[0],s,s+a),e[1]=R.clamp(e[1],o,o+l),r===en.Straight){const u=i[0],d=i[i.length-1],h=R.dist(u,e),f=R.dist(u,d);return h/f}if(r===en.Orthogonal){const u=i.map(p=>[p[0],p[1]]),d=go.nearestPoint(u,e),h=go.lenAtPoint(u,d),f=go.len(u);return h/f}const c=Nl(i);return ag(c,e)}getPointByOffsetDistance(e=.5,n){const{mode:r,absolutePath:i}=this;if(r===en.Straight){const d=i[0],h=i[i.length-1];return R.lrp(d,h,e)}let{x:s,y:o,w:a,h:l}=this;if(n&&(s=n.x,o=n.y,a=n.w,l=n.h),r===en.Orthogonal){const d=i.map(f=>[f[0],f[1]]),h=go.pointAt(d,e);return h||[s+a/2,o+l/2]}const c=Nl(i),u=hu(c,e);return u||[s+a/2,o+l/2]}getRelativePointLocation(e){return new wt(X.deserialize(this.xywh).getRelativePoint(e))}hasLabel(){return!!(!this.labelEditing&&this.labelDisplay&&this.labelXYWH&&this.text&&this.text.length)}includesPoint(e,n,r){const i=[e,n];if(this.labelIncludesPoint(i))return!0;const{mode:s,strokeWidth:o,absolutePath:a}=this,l=s===en.Curve?z6(Nl(a),i):Jm(a,i);return l?R.dist(l,i)<(r!=null&&r.hitThreshold?o/2:0)+8:!1}labelIncludesPoint(e){return this.hasLabel()&&X.fromXYWH(this.labelXYWH).isPointInBound(e)}moveTo(e){const n=X.deserialize(this.xywh),r=R.sub([e.x,e.y],[n.x,n.y]),{source:i,target:s}=this;if(!i.id&&i.position&&(this.source={position:R.add(i.position,r)}),!s.id&&s.position&&(this.target={position:R.add(s.position,r)}),this.hasLabel()){const[o,a,l,c]=this.labelXYWH;this.labelXYWH=[o+r[0],a+r[1],l,c]}}resize(e,n){this.updatingPath=!1;const r=this.resizePath(e,n),i={};return this.source.id||(i.source={...this.source,position:r[0].toVec()}),this.target.id||(i.target={...this.target,position:r[r.length-1].toVec()}),i}resizePath(e,n){return this.mode===en.Curve?e.map(r=>{const[i,s,o,a]=[r,r.tangent,r.absIn,r.absOut].map(u=>new DOMPoint(...u).matrixTransform(n)).map(u=>[u.x,u.y]),l=R.sub(o,i),c=R.sub(a,i);return new wt(i,s,l,c)}):e.map(r=>{const{x:i,y:s}=new DOMPoint(...r).matrixTransform(n),o=[i,s];return wt.fromVec(o)})}serialize(){const e=super.serialize();return e.xywh=this.xywh,e.source=structuredClone(this.source),e.target=structuredClone(this.target),e}}fe=Vj(V1),q1=new WeakMap,X1=new WeakMap,K1=new WeakMap,Q1=new WeakMap,Z1=new WeakMap,J1=new WeakMap,ey=new WeakMap,ty=new WeakMap,ny=new WeakMap,ry=new WeakMap,iy=new WeakMap,sy=new WeakMap,oy=new WeakMap,ay=new WeakMap,ly=new WeakMap,cy=new WeakMap,uy=new WeakMap,dy=new WeakMap,hy=new WeakMap,fy=new WeakMap,py=new WeakMap,zt(fe,4,"absolutePath",BA,Mt,q1),zt(fe,4,"frontEndpointStyle",RA,Mt,X1),zt(fe,4,"labelConstraints",LA,Mt,K1),zt(fe,4,"labelDisplay",PA,Mt,Q1),zt(fe,4,"labelOffset",OA,Mt,Z1),zt(fe,4,"labelStyle",NA,Mt,J1),zt(fe,4,"labelXYWH",DA,Mt,ey),zt(fe,4,"labelEditing",MA,Mt,ty),zt(fe,4,"mode",IA,Mt,ny),zt(fe,4,"path",AA,Mt,ry),zt(fe,4,"rearEndpointStyle",CA,Mt,iy),zt(fe,4,"rotate",SA,Mt,sy),zt(fe,4,"rough",TA,Mt,oy),zt(fe,4,"roughness",kA,Mt,ay),zt(fe,4,"source",wA,Mt,ly),zt(fe,4,"stroke",vA,Mt,cy),zt(fe,4,"strokeStyle",EA,Mt,uy),zt(fe,4,"strokeWidth",xA,Mt,dy),zt(fe,4,"target",_A,Mt,hy),zt(fe,4,"text",yA,Mt,fy),zt(fe,4,"xywh",bA,Mt,py),Xj(fe,Mt);class FA extends Ht{constructor(){super(...arguments),this._path=[],this.absolutePath=[],this.mode=en.Orthogonal,this.roughness=Ld,this.source={position:[0,0]},this.stroke=ae.connectorColor,this.strokeStyle=xi.Solid,this.strokeWidth=4,this.target={position:[0,0]},this.updatingPath=!1}get path(){return this._path}set path(e){const{x:n,y:r}=this;this._path=e,this.absolutePath=e.map(i=>i.clone().setVec([i[0]+n,i[1]+r]))}get type(){return"connector"}}var Zj=Object.create,UA=Object.defineProperty,Jj=Object.getOwnPropertyDescriptor,$A=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Gd=t=>{throw TypeError(t)},eY=(t,e,n)=>e in t?UA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tY=t=>{var e;return[,,,Zj((e=t==null?void 0:t[$A("metadata")])!=null?e:null)]},HA=["class","method","getter","setter","accessor","field","value","get","set"],Vd=t=>t!==void 0&&typeof t!="function"?Gd("Function expected"):t,nY=(t,e,n,r,i)=>({kind:HA[t],name:e,metadata:r,addInitializer:s=>n._?Gd("Already initialized"):i.push(Vd(s||null))}),rY=(t,e)=>eY(e,$A("metadata"),t[3]),Ac=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},my=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=HA[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,Jj({get[n](){return iY(this,s)},set[n](E){return sY(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=nY(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Vd(a)&&(y[g]=a):typeof a!="object"||a===null?Gd("Object expected"):(Vd(o=a.get)&&(y.get=o),Vd(o=a.set)&&(y.set=o),Vd(o=a.init)&&b.unshift(o));return y&&UA(i,n,y),i},zA=(t,e,n)=>e.has(t)||Gd("Cannot "+n),iY=(t,e,n)=>(zA(t,e,"read from private field"),e.get(t)),gy=(t,e,n)=>e.has(t)?Gd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),sY=(t,e,n,r)=>(zA(t,e,"write to private field"),e.set(t,n),n),WA,jA,YA,by,Ei,yy,_y,xy;class Ic extends(by=dc,YA=[PT((e,n,r)=>{var i;n.children.doc&&n.setChildIds(Array.from(n.children.keys()),(i=r==null?void 0:r.local)!=null?i:!1)}),ue()],jA=[gi()],WA=[ue()],by){constructor(){super(...arguments),gy(this,yy,Ac(Ei,8,this,new at)),Ac(Ei,11,this),gy(this,_y,Ac(Ei,12,this,!0)),Ac(Ei,15,this),gy(this,xy,Ac(Ei,16,this,new gt)),Ac(Ei,19,this)}get rotate(){return 0}set rotate(e){}get type(){return"group"}static propsToY(e){if(typeof e.title=="string"&&(e.title=new gt(e.title)),e.children&&!(e.children instanceof at)){const n=new at;Object.keys(e.children).forEach(r=>{n.set(r,!0)}),e.children=n}return e}addChild(e){O0(this,e)&&this.surface.store.transact(()=>{this.children.set(e.id,!0)})}containsBound(e){return e.contains(X.deserialize(this.xywh))}getLineIntersections(e,n){const r=X.deserialize(this.xywh);return Ri(e,n,r.points)}removeChild(e){this.children&&this.surface.store.transact(()=>{this.children.delete(e.id)})}serialize(){return super.serialize()}lock(){super.lock(),this.showTitle=!1}unlock(){super.unlock(),this.showTitle=!0}}Ei=tY(by),yy=new WeakMap,_y=new WeakMap,xy=new WeakMap,my(Ei,4,"children",YA,Ic,yy),my(Ei,4,"showTitle",jA,Ic,_y),my(Ei,4,"title",WA,Ic,xy),rY(Ei,Ic);var oY=Object.create,GA=Object.defineProperty,aY=Object.getOwnPropertyDescriptor,VA=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),qd=t=>{throw TypeError(t)},lY=(t,e,n)=>e in t?GA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,cY=t=>{var e;return[,,,oY((e=t==null?void 0:t[VA("metadata")])!=null?e:null)]},qA=["class","method","getter","setter","accessor","field","value","get","set"],Xd=t=>t!==void 0&&typeof t!="function"?qd("Function expected"):t,uY=(t,e,n,r,i)=>({kind:qA[t],name:e,metadata:r,addInitializer:s=>n._?qd("Already initialized"):i.push(Xd(s||null))}),dY=(t,e)=>lY(e,VA("metadata"),t[3]),ss=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Kd=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=qA[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,aY({get[n](){return hY(this,s)},set[n](E){return fY(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=uY(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Xd(a)&&(y[g]=a):typeof a!="object"||a===null?qd("Object expected"):(Xd(o=a.get)&&(y.get=o),Xd(o=a.set)&&(y.set=o),Xd(o=a.init)&&b.unshift(o));return y&&GA(i,n,y),i},XA=(t,e,n)=>e.has(t)||qd("Cannot "+n),hY=(t,e,n)=>(XA(t,e,"read from private field"),e.get(t)),Qd=(t,e,n)=>e.has(t)?qd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),fY=(t,e,n,r)=>(XA(t,e,"write to private field"),e.set(t,n),n),KA,QA,ZA,JA,eI,Ey,Fn,vy,wy,ky,Ty,Sy;class ll extends(Ey=Lt,eI=[ue()],JA=[Ya((e,n)=>{n._local.delete("commands")}),ja((e,n)=>{const r=n.elementBound;if(e===n.lineWidth||r.w===0||r.h===0)return{};const i=n.points,s=rf(i.map(([o,a])=>({x:o,y:a})),r,n.lineWidth/2,Dl(r,e-n.lineWidth),e/2);return{points:s.points.map((o,a)=>[o.x,o.y,...i[a][2]!==void 0?[i[a][2]]:[]]),xywh:s.bound.serialize()}}),ue()],ZA=[Ya((e,n)=>{n._local.delete("commands")}),ja((e,n)=>{const r=n.lineWidth,i=du(e);return{xywh:Dl(i,r).serialize()}}),G0((e,n)=>{const r=n.lineWidth,i=du(e),s=Dl(i,r);return e.map(([a,l,c])=>[a-s.x,l-s.y,...c!==void 0?[c]:[]])}),ue()],QA=[ue(0)],KA=[ja((e,n)=>{const r=X.deserialize(e);if(r.w===n.w&&r.h===n.h)return{};const{lineWidth:i}=n;return{points:rf(n.points.map(([o,a])=>({x:o,y:a})),n,n.lineWidth/2,r,i/2).points.map((o,a)=>[o.x,o.y,...n.points[a][2]!==void 0?[n.points[a][2]]:[]])}}),ue()],Ey){constructor(){super(...arguments),Qd(this,vy,ss(Fn,8,this,ae.hightlighterColor)),ss(Fn,11,this),Qd(this,wy,ss(Fn,12,this,wW)),ss(Fn,15,this),Qd(this,ky,ss(Fn,16,this,[])),ss(Fn,19,this),Qd(this,Ty,ss(Fn,20,this,0)),ss(Fn,23,this),Qd(this,Sy,ss(Fn,24,this,"[0,0,0,0]")),ss(Fn,27,this)}get commands(){var e;if(!this._local.has("commands")){const n=_v((e=this.points)!=null?e:[],this.lineWidth),r=uv(n);this._local.set("commands",r)}return this._local.get("commands")}get connectable(){return!1}get type(){return"highlighter"}containsBound(e){return Ke(this).some(r=>e.containsPoint(r))}getLineIntersections(e,n){const r=[this.x,this.y],i=Ke(this,o=>this.points.map(a=>R.add(a,r))),s=X.fromDOMRect(sg(this));if(s.w<8&&s.h<8)return R.distanceToLineSegment(e,n,s.center)<5?[]:null;if(s.intersectLine(e,n,!0)){const o=i.length;for(let a=1;a<o;a++){const l=Wr(e,n,i[a-1],i[a]);if(l)return[new wt(l,R.normalize(R.sub(i[a],i[a-1])))]}}return null}getNearestPoint(e){const{x:n,y:r}=this;return Jm(this.points.map(i=>R.add(i,[n,r])),e)}getRelativePointLocation(e){const n=X.deserialize(this.xywh).getRelativePoint(e);return new wt(n)}includesPoint(e,n,r){var i,s;return lv(X.deserialize(this.xywh),this.points,this.rotate,[e,n],((i=r==null?void 0:r.hitThreshold)!=null?i:10)/Math.min((s=r==null?void 0:r.zoom)!=null?s:1,1))}}Fn=cY(Ey),vy=new WeakMap,wy=new WeakMap,ky=new WeakMap,Ty=new WeakMap,Sy=new WeakMap,Kd(Fn,4,"color",eI,ll,vy),Kd(Fn,4,"lineWidth",JA,ll,wy),Kd(Fn,4,"points",ZA,ll,ky),Kd(Fn,4,"rotate",QA,ll,Ty),Kd(Fn,4,"xywh",KA,ll,Sy),dY(Fn,ll);var pY=Object.prototype,mY=pY.hasOwnProperty;function gY(t,e,n){var r=t[e];(!(mY.call(t,e)&&tb(r,n))||n===void 0&&!(e in t))&&DS(t,e,n)}function bY(t,e,n,r){if(!Ws(t))return t;e=_p(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var l=md(e[i]),c=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(i!=o){var u=a[l];c=void 0,c===void 0&&(c=Ws(u)?u:ob(e[i+1])?[]:{})}gY(a,l,c),a=a[l]}return t}function yY(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=Lb(t,o);n(a,o)&&bY(s,_p(o,t),a)}return s}function _Y(t,e){return yY(t,e,function(n,r){return BS(t,r)})}var tI=Qi?Qi.isConcatSpreadable:void 0;function xY(t){return bi(t)||ib(t)||!!(tI&&t&&t[tI])}function EY(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=xY),i||(i=[]);++s<o;){var a=t[s];n(a)?jT(i,a):i[i.length]=a}return i}function vY(t){var e=t==null?0:t.length;return e?EY(t):[]}function wY(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var nI=Math.max;function kY(t,e,n){return e=nI(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=nI(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),wY(t,this,a)}}function TY(t){return function(){return t}}var SY=yp?function(t,e){return yp(t,"toString",{configurable:!0,enumerable:!1,value:TY(e),writable:!0})}:FS,CY=800,AY=16,IY=Date.now;function MY(t){var e=0,n=0;return function(){var r=IY(),i=AY-(r-n);if(n=r,i>0){if(++e>=CY)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var DY=MY(SY);function NY(t){return DY(kY(t,void 0,vY),t+"")}var OY=NY(function(t,e){return t==null?{}:_Y(t,e)});class Hp{}class PY extends Hp{constructor(){super(...arguments),this._colorOrders=[ae.StrokeColorShortMap.Purple,ae.StrokeColorShortMap.Magenta,ae.StrokeColorShortMap.Orange,ae.StrokeColorShortMap.Yellow,ae.StrokeColorShortMap.Green,"#7ae2d5"],this.root={radius:8,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:4,strokeColor:"#53b2ef",fontFamily:fn.Poppins,fontSize:20,fontWeight:tn.SemiBold,color:ae.pureBlack,filled:!0,fillColor:ae.pureWhite,padding:[11,22],shadow:{offsetX:0,offsetY:6,blur:12,color:"rgba(0, 0, 0, 0.14)"}}}_getColor(e){return this._colorOrders[e%this._colorOrders.length]}getNodeStyle(e,n){var r;const i=this._getColor((r=n[1])!=null?r:0);return{connector:{strokeStyle:xi.Solid,stroke:i,strokeWidth:3,mode:en.Curve},collapseButton:{width:16,height:16,radius:.5,filled:!0,fillColor:ae.pureWhite,strokeColor:i,strokeWidth:3},expandButton:{width:24,height:24,radius:8,filled:!0,fillColor:i,strokeColor:i,strokeWidth:0,padding:[4,0],color:ae.pureWhite,fontFamily:fn.Inter,fontWeight:tn.Bold,fontSize:15},node:{radius:8,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:3,strokeColor:i,fontFamily:fn.Poppins,fontSize:16,fontWeight:tn.Medium,color:ae.pureBlack,filled:!0,fillColor:ae.pureWhite,padding:[6,22],shadow:{offsetX:0,offsetY:6,blur:12,color:"rgba(0, 0, 0, 0.14)"}}}}}const LY=new PY;class RY extends Hp{constructor(){super(...arguments),this._colorOrders=[ae.StrokeColorShortMap.Blue,"#7ae2d5",ae.StrokeColorShortMap.Yellow],this.root={radius:3,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:3,strokeColor:ae.black,fontFamily:fn.Poppins,fontSize:18,fontWeight:tn.SemiBold,color:ae.pureBlack,filled:!0,fillColor:ae.StrokeColorShortMap.Yellow,padding:[11,22],shadow:{blur:0,offsetX:3,offsetY:3,color:ae.black}}}_getColor(e){return e>=this._colorOrders.length?Jt(this._colorOrders):this._colorOrders[e]}getNodeStyle(e,n){const r=this._getColor(n.length-2);return{connector:{strokeStyle:xi.Solid,stroke:ae.black,strokeWidth:3,mode:en.Orthogonal},collapseButton:{width:16,height:16,radius:.5,filled:!0,fillColor:ae.white,strokeColor:ae.black,strokeWidth:3},expandButton:{width:24,height:24,radius:2,filled:!0,fillColor:ae.black,padding:[4,0],strokeColor:ae.black,strokeWidth:0,color:ae.white,fontFamily:fn.Inter,fontWeight:tn.Bold,fontSize:15},node:{radius:3,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:3,strokeColor:ae.black,fontFamily:fn.Poppins,fontSize:16,fontWeight:tn.SemiBold,color:ae.pureBlack,filled:!0,fillColor:r,padding:[6,22],shadow:{blur:0,offsetX:3,offsetY:3,color:ae.black}}}}}const BY=new RY;class FY extends Hp{constructor(){super(...arguments),this._strokeColor=[ae.StrokeColorShortMap.Yellow,ae.StrokeColorShortMap.Green,"#5cc7ba"],this.root={radius:10,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:0,strokeColor:"transparent",fontFamily:fn.Poppins,fontSize:16,fontWeight:tn.Medium,color:ae.pureBlack,filled:!0,fillColor:ae.StrokeColorShortMap.Yellow,padding:[10,22],shadow:{blur:12,offsetX:0,offsetY:0,color:"rgba(66, 65, 73, 0.18)"}}}_getColor(e){return this._strokeColor[e%this._strokeColor.length]}getNodeStyle(e,n){const r=this._getColor(n.length-2),i=this._getColor(n.length-1);return{node:{radius:10,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:2,strokeColor:r,fontFamily:fn.Poppins,fontSize:16,fontWeight:tn.Medium,color:ae.pureBlack,filled:!0,fillColor:ae.pureWhite,padding:[6,22],shadow:{blur:12,offsetX:0,offsetY:0,color:"rgba(66, 65, 73, 0.18)"}},collapseButton:{width:16,height:16,radius:.5,filled:!0,fillColor:ae.pureWhite,strokeColor:i,strokeWidth:3},expandButton:{width:24,height:24,radius:8,filled:!0,fillColor:i,padding:[4,0],strokeColor:i,strokeWidth:0,color:ae.pureWhite,fontFamily:fn.Inter,fontWeight:tn.Bold,fontSize:15},connector:{strokeStyle:xi.Solid,stroke:r,strokeWidth:2,mode:en.Curve}}}}const UY=new FY;class $Y extends Hp{constructor(){super(...arguments),this._colors=[ae.StrokeColorShortMap.Purple,ae.StrokeColorShortMap.Magenta,ae.StrokeColorShortMap.Orange,ae.StrokeColorShortMap.Yellow,ae.StrokeColorShortMap.Green,ae.StrokeColorShortMap.Blue],this.root={radius:0,textResizing:ts.AUTO_WIDTH_AND_HEIGHT,strokeWidth:0,strokeColor:"transparent",fontFamily:fn.Kalam,fontSize:22,fontWeight:tn.Bold,color:ae.black,filled:!0,fillColor:"transparent",padding:[0,10]}}_getColor(e){return this._colors[e%this._colors.length]}getNodeStyle(e,n){var r;const i=this._getColor((r=n[1])!=null?r:0);return{connector:{strokeStyle:xi.Solid,stroke:i,strokeWidth:3,mode:en.Curve},collapseButton:{width:16,height:16,radius:.5,filled:!0,fillColor:ae.pureWhite,strokeColor:i,strokeWidth:3},expandButton:{width:24,height:24,radius:8,filled:!0,fillColor:i,padding:[4,0],strokeColor:i,strokeWidth:0,color:ae.pureWhite,fontFamily:fn.Inter,fontWeight:tn.Bold,fontSize:15},node:{...this.root,fontSize:18,padding:[1.5,10]}}}}const HY=new $Y,zY={[wc.ONE]:LY,[wc.TWO]:BY,[wc.THREE]:UY,[wc.FOUR]:HY};function WY(t,e){const n=new Set,r=[],i=(s,o=[],a=!1)=>{if(n.has(s.id)){r.push({detached:a,chain:o});return}n.add(s.id),o.push(s),s.children.forEach(l=>i(l,o.slice(),a))};return i(t),e.forEach(s=>{n.has(s.id)||i(s,[],!0)}),r}var jY=Object.create,rI=Object.defineProperty,YY=Object.getOwnPropertyDescriptor,iI=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Zd=t=>{throw TypeError(t)},GY=(t,e,n)=>e in t?rI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,VY=t=>{var e;return[,,,jY((e=t==null?void 0:t[iI("metadata")])!=null?e:null)]},sI=["class","method","getter","setter","accessor","field","value","get","set"],Jd=t=>t!==void 0&&typeof t!="function"?Zd("Function expected"):t,qY=(t,e,n,r,i)=>({kind:sI[t],name:e,metadata:r,addInitializer:s=>n._?Zd("Already initialized"):i.push(Jd(s||null))}),XY=(t,e)=>GY(e,iI("metadata"),t[3]),Mc=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Cy=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=sI[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,YY({get[n](){return KY(this,s)},set[n](E){return QY(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=qY(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Jd(a)&&(y[g]=a):typeof a!="object"||a===null?Zd("Object expected"):(Jd(o=a.get)&&(y.get=o),Jd(o=a.set)&&(y.set=o),Jd(o=a.init)&&b.unshift(o));return y&&rI(i,n,y),i},oI=(t,e,n)=>e.has(t)||Zd("Cannot "+n),KY=(t,e,n)=>(oI(t,e,"read from private field"),e.get(t)),Ay=(t,e,n)=>e.has(t)?Zd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),QY=(t,e,n,r)=>(oI(t,e,"write to private field"),e.set(t,n),n),aI,lI,cI,Iy,vi,My,Dy,Ny;const uI=$e({text:pe(),xywh:mk(pe())}).extend({children:a0(()=>uI.array()).optional()});function ZY(t){return typeof t.text=="string"&&Array.isArray(t.children)}function JY(t,e,n){var r;e.children.doc&&(e.setChildIds(Array.from(e.children.keys()),(r=n==null?void 0:n.local)!=null?r:!0),e.buildTree(),e.connectors.clear())}function eG(t,e,n){n&&(e.surface.store.transact(()=>{var r;(r=e._tree)==null||r.children.forEach(i=>{e.children.has(i.id)&&e.children.set(i.id,{index:i.detail.index,parent:i.detail.parent})})}),e.buildTree())}function tG(t,e,n){n&&e.layout()}class eh extends(Iy=dc,cI=[G0((e,n)=>{if(e instanceof at)return n.requestBuildTree(),n.requestLayout(),e;{uI.parse(e);const r=new at,i=n.surface,s=i.store,o=(a,l=null,c="a0")=>{var u;const d=i.addElement({type:"shape",text:a.text,xywh:a.xywh?a.xywh:"[0, 0, 100, 30]"});r.set(d,{index:c,parent:l??void 0});let h="a0";(u=a.children)==null||u.forEach(f=>{o(f,d,h),h=jn(h,null)})};return s.transact(()=>{o(e)}),n.requestBuildTree(),n.requestLayout(),r}}),PT(JY),ue()],lI=[Ya(eG),ue()],aI=[Ya(tG),ue()],Iy){constructor(){super(...arguments),this._layout=null,this._nodeMap=new Map,this._queueBuildTree=!1,this._queuedLayout=!1,this._stashedNode=new Set,this._tree=void 0,this.connectors=new Map,Ay(this,My,Mc(vi,8,this,new at)),Mc(vi,11,this),Ay(this,Dy,Mc(vi,12,this,_i.RIGHT)),Mc(vi,15,this),Ay(this,Ny,Mc(vi,16,this,wc.ONE)),Mc(vi,19,this)}get nodeMap(){return this._nodeMap}get rotate(){return 0}set rotate(e){}get styleGetter(){return zY[this.style]}get tree(){return this._tree}get type(){return"mindmap"}static propsToY(e){if(e.children&&!ZY(e.children)&&!(e.children instanceof at)){const n=new at;Object.entries(e.children).forEach(([r,i])=>{const s=OY(i,["index","parent"]);n.set(r,s)}),e.children=n}return e}_cfgBalanceLayoutDir(){if(this.layoutType!==_i.BALANCE)return;const e=this._tree,n=Math.ceil(e.children.length/2);e.right.push(...e.children.slice(0,n)),e.left.push(...e.children.slice(n)),e.left.reverse()}_isConnectorOutdated(e,n=!0){var r;const i="to"in e,{connector:s,from:o,layout:a}=e;if(!(o!=null&&o.element))return{outdated:!0,cacheKey:""};if(i&&!((r=e.to)!=null&&r.element))return{outdated:!0,cacheKey:""};const l=i?`${o.element.xywh}-${e.to.element.xywh}-${a}-${this.style}`:`${o.element.xywh}-collapsed-${a}-${this.style}`;return s.cache.get("MINDMAP_CONNECTOR")===l?!1:(n&&s.cache.set("MINDMAP_CONNECTOR",l),!0)}_getXYWH(){return super._getXYWH()}addChild(e){}addNode(e,n,r="after",i={}){var s,o;if(e&&typeof e!="string"&&(e=e.id),e&&!this._nodeMap.has(e))throw new Error(`Parent node ${e} not found`);i.text=new gt((s=i.text)!=null?s:"New node");const a=(o=i.type)!=null?o:"shape";let l;return this.surface.store.transact(()=>{var c,u,d,h,f;const p=e?this._nodeMap.get(e):null;if(p){let g=Jt(p.children)?jn(Jt(p.children).detail.index,null):"a0";n=n??((c=Jt(p.children))==null?void 0:c.id);const b=typeof n=="number"?p.children[n]:n?this._nodeMap.get(n):void 0,_=b?this.getPath(b):this.getPath(p).concat([0]),y=this.styleGetter.getNodeStyle(b??p,_);if(l=this.surface.addElement({type:a,xywh:"[0,0,100,30]",maxWidth:!1,...i,...y.node}),b){const E=p.children.findIndex(I=>I.id===n);g=r==="after"?jn(b.detail.index,(d=(u=p.children[E+1])==null?void 0:u.detail.index)!=null?d:null):jn((f=(h=p.children[E-1])==null?void 0:h.detail.index)!=null?f:null,b.detail.index)}const x={index:g,parent:e};this.children.set(l,x)}else{const g=this.styleGetter.root;l=this.surface.addElement({type:a,xywh:"[0,0,113,41]",maxWidth:!1,...i,...g}),this.children.clear(),this.children.set(l,{index:"a0"})}}),this.layout(),l}buildTree(){const e=new Map,n=this.children;if(!n||n.size===0){this._nodeMap=e,this._tree=null;return}let r;if(n.forEach((s,o)=>{e.has(o)||e.set(o,{id:o,index:s.index,detail:s,element:this.surface.getElementById(o),children:[],parent:null});const a=e.get(o);if(a.detail||(a.detail=s),!s.parent)r=a,r.left=[],r.right=[];else{e.has(s.parent)||e.set(s.parent,{id:s.parent,detail:n.get(s.parent),parent:null,children:[],element:this.surface.getElementById(s.parent)});const l=e.get(s.parent);l.children.push(a),a.parent=l}}),e.forEach(s=>{s.children.sort((o,a)=>o.detail.index===a.detail.index?0:o.detail.index>a.detail.index?1:-1)}),!r)return;const i=WY(r,e);if(i.length){this.surface.store.withoutTransact(()=>{i.forEach(s=>{if(s.detached)s.chain.forEach(o=>{this.children.delete(o.id)});else{const o=Jt(s.chain);o&&this.children.set(o.id,{index:o.detail.index})}})});return}this._nodeMap=e,this._tree=r,this.layoutType===_i.BALANCE?this._cfgBalanceLayoutDir():this._tree[this.layoutType===_i.RIGHT?"right":"left"]=this._tree.children}getChildNodes(e,n){const r=this._nodeMap.get(e);return r?n&&e===this._tree.id?this._tree[n]:r.children:[]}getConnectors(e){var n;if(!this._nodeMap.has(e.id))return null;if(e.detail.collapsed){const r=`#${e.id}-collapsed`,i=this.getLayoutDir(e),s=(n=this.connectors.get(r))!=null?n:new FA(this.surface),o=this.connectors.has(r),a=this.styleGetter.getNodeStyle(e,this.getPath(e).concat([0])).connector,l=this._isConnectorOutdated({connector:s,from:e,collapsed:!0,layout:i});if(o||(s.id=r,this.connectors.set(r,s)),l){const c=e.element.elementBound;s.id=r,s.source={id:e.id,position:i===_i.LEFT?[0,.5]:[1,.5]},s.target={position:i===_i.LEFT?[c.x-6,c.y+c.h/2]:[c.x+c.w+6,c.y+c.h/2]},Object.entries(a).forEach(([u,d])=>{s[u]=d}),s.mode=en.Straight}return[{outdated:l,connector:s}]}else{const r=e;return r.children.map(i=>{var s;const o=this.getLayoutDir(i),a=`#${r.id}-${i.id}`,l=this.connectors.has(a),c=this.styleGetter.getNodeStyle(i,this.getPath(i)).connector,u=(s=this.connectors.get(a))!=null?s:new FA(this.surface),d=this._isConnectorOutdated({connector:u,from:r,to:i,layout:o});return l||(u.id=a,this.connectors.set(a,u)),d&&(u.source={id:r.id,position:o===_i.RIGHT?[1,.5]:[0,.5]},u.target={id:i.id,position:o===_i.RIGHT?[0,.5]:[1,.5]},Object.entries(c).forEach(([h,f])=>{u[h]=f})),{outdated:d,connector:u}})}}getLayoutDir(e){var n,r;e=typeof e=="string"?this._nodeMap.get(e):e;let i=e;const s=this._tree;for(;i;){if(i.overriddenDir!==void 0)return i.overriddenDir;const o=i.detail.parent&&(n=this._nodeMap.get(i.detail.parent))!=null?n:null;if(o===s)return(r=o.overriddenDir)!=null?r:s.left.includes(i)?_i.LEFT:s.right.includes(i)?_i.RIGHT:this.layoutType;i=o}return this.layoutType}getNode(e){var n;return(n=this._nodeMap.get(e))!=null?n:null}getNodeByPath(e){let n=this._tree;for(let r=1;r<e.length;r++)if(n=n==null?void 0:n.children[e[r]],!n)return null;return n}getParentNode(e){var n;const r=this.children.get(e);return r!=null&&r.parent&&(n=this._nodeMap.get(r.parent))!=null?n:null}getPath(e){let n=this._nodeMap.get(typeof e=="string"?e:e.id);if(!n)throw new Error("Node not found");const r=[];for(;n&&n!==this._tree;){const i=this._nodeMap.get(n.detail.parent);r.unshift(i.children.indexOf(n)),n=i}return r.unshift(0),r}getSiblingNode(e,n="next",r){var i;const s=this._nodeMap.get(e);if(!s)return null;const o=this._nodeMap.get(s.detail.parent);if(!o)return null;const a=r&&o.id===this._tree.id?this._tree[r]:o.children,l=a.indexOf(s);if(l===-1)return null;const c=n==="next"?l+1:l-1;return(i=a[c])!=null?i:null}includesPoint(e,n,r){var i,s,o,a,l,c,u,d;const h=this.elementBound;return h.x-=(s=(i=r.responsePadding)==null?void 0:i[0])!=null?s:0,h.w+=((a=(o=r.responsePadding)==null?void 0:o[0])!=null?a:0)*2,h.y-=(c=(l=r.responsePadding)==null?void 0:l[1])!=null?c:0,h.h+=((d=(u=r.responsePadding)==null?void 0:u[1])!=null?d:0)*2,h.containsPoint([e,n])}layout(e=this.tree,n={applyStyle:!0,calculateTreeBound:!0,stashed:!0}){this._layout&&this._layout(e,n)}moveTo(e){const{x:n,y:r}=this,i=typeof e=="string"?Ml(e):e,s=i[0]-n,o=i[1]-r;this.surface.store.transact(()=>{this.childElements.forEach(a=>{const l=Ml(a.xywh);a.xywh=`[${l[0]+s},${l[1]+o},${l[2]},${l[3]}]`})})}onCreated(){this.buildTree()}removeChild(e){if(!this._nodeMap.has(e.id))return;const n=this.surface,r=[],i=s=>{var o,a;(o=s.children)==null||o.forEach(l=>{i(l)}),(a=this.children)==null||a.delete(s.id),r.push(s.id)};n.store.transact(()=>{i(this._nodeMap.get(e.id))}),queueMicrotask(()=>{r.forEach(s=>n.deleteElement(s))}),this.buildTree(),this.requestLayout()}requestBuildTree(){this._queueBuildTree||(this._queueBuildTree=!0,queueMicrotask(()=>{this.buildTree(),this._queueBuildTree=!1}))}requestLayout(){this._queuedLayout||(this._queuedLayout=!0,queueMicrotask(()=>{this.layout(),this._queuedLayout=!1}))}serialize(){return super.serialize()}setLayoutMethod(e){this._layout=e}stashTree(e){const n=typeof e=="string"?this.getNode(e):e;if(!n||this._stashedNode.has(n.id))return;const r=new Set,i=s=>{s.element.stash("xywh"),r.add(s.element),s.children.length&&s.children.forEach(o=>i(o))};return i(n),()=>{this._stashedNode.delete(n.id),r.forEach(s=>{s.pop("xywh")})}}toggleCollapse(e,n={}){if(!this._nodeMap.has(e.id))return;const{layout:r=!1}=n;if(e&&e.children.length>0){const i=!e.detail.collapsed,s=!i,o=a=>{a.element.hidden=i,!(s&&a.detail.collapsed)&&a.children.forEach(l=>{o(l)})};e.children.forEach(o),this.surface.store.transact(()=>{this.children.set(e.id,{...e.detail,collapsed:i})})}r&&this.requestLayout()}traverse(e,n=this._tree,r={}){const{stopOnCollapse:i=!1}=r,s=(o,a)=>{e(o,a),!(i&&o.detail.collapsed)&&(o==null||o.children.forEach(l=>{s(l,o)}))};n&&s(n,null)}}vi=VY(Iy),My=new WeakMap,Dy=new WeakMap,Ny=new WeakMap,Cy(vi,4,"children",cI,eh,My),Cy(vi,4,"layoutType",lI,eh,Dy),Cy(vi,4,"style",aI,eh,Ny),XY(vi,eh);function nG(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="mindmap"&&"children"in t&&typeof t.children=="object"&&"json"in t.children}function dI(t){return nG(t)?t.children.json:null}function Oy(t){const e=new Map,n=dI(t);if(!n)return e;for(const[r,i]of Object.entries(n))e.set(r,{id:r,index:i.index,children:[]});return e}function hI(t){let e=null;const n=Oy(t),r=dI(t);if(!r)return e;for(const[i,s]of Object.entries(r)){const o=n.get(i);if(s.parent){const a=n.get(s.parent);a&&a.children.push(o)}else e=o}return e}const cl={points({x:t,y:e,w:n,h:r}){return[[t,e+r/2],[t+n/2,e],[t+n,e+r/2],[t+n/2,e+r]]},draw(t,{x:e,y:n,w:r,h:i,rotate:s=0}){const o=e+r/2,a=n+i/2;t.save(),t.translate(o,a),t.rotate(s*Math.PI/180),t.translate(-o,-a),t.beginPath(),t.moveTo(e,n+i/2),t.lineTo(e+r/2,n),t.lineTo(e+r,n+i/2),t.lineTo(e+r/2,n+i),t.closePath(),t.restore()},includesPoint(t,e,n){var r,i;const s=[t,e],o=Ke(this,cl.points);let a=tg(s,o,((r=n==null?void 0:n.hitThreshold)!=null?r:1)/((i=n.zoom)!=null?i:1));if(!a)if(!n.ignoreTransparent||this.filled)a=ci([t,e],o);else{const l=this.text;if(!l||!l.length){const c=rg(this,Rd),u=Ke(c,cl.points);a=ci(s,u)}else this.textBound&&(a=ci(s,Ke(this,()=>X.from(this.textBound).points)))}return a},containsBound(t,e){return Ke(e,cl.points).some(r=>t.containsPoint(r))},getNearestPoint(t,e){const n=Ke(e,cl.points);return fo(n,t)},getLineIntersections(t,e,n){const r=Ke(n,cl.points);return Ri(t,e,r)},getRelativePointLocation(t,e){const n=X.deserialize(e.xywh),r=n.getRelativePoint(t);let i=cl.points(n);i.push(r),i=Or(i,n.center,e.rotate);const s=i.pop(),o=Cl(i,s);return new wt(s,o)}},fI={points({x:t,y:e,w:n,h:r}){return[[t,e+r/2],[t+n/2,e],[t+n,e+r/2],[t+n/2,e+r]]},draw(t,{x:e,y:n,w:r,h:i,rotate:s=0}){const o=e+r/2,a=n+i/2;t.save(),t.translate(o,a),t.rotate(s*Math.PI/180),t.translate(-o,-a),t.beginPath(),t.ellipse(o,a,r/2,i/2,0,0,2*Math.PI),t.restore()},includesPoint(t,e,n){var r,i;const s=[t,e],o=((r=n==null?void 0:n.hitThreshold)!=null?r:1)/((i=n==null?void 0:n.zoom)!=null?i:1),a=this.w/2,l=this.h/2,c=[this.x+a,this.y+l],u=this.rotate*Math.PI/180;let d=ef(s,c,a+o,l+o,u)&&!ef(s,c,a-o,l-o,u);if(!d)if(!n.ignoreTransparent||this.filled)d=ef(s,c,a,l,u);else{const h=this.text;if(!h||!h.length){const f=a*Rd,p=l*Rd;d=ef(s,c,f,p,u)}else this.textBound&&(d=ci(s,Ke(this,()=>X.from(this.textBound).points)))}return d},containsBound(t,e){return Ke(e,fI.points).some(r=>t.containsPoint(r))},getNearestPoint(t,{rotate:e,xywh:n}){const{center:r,w:i,h:s}=X.deserialize(n),o=po(e),a=i/2,l=s/2,[c,u]=R.rot(R.sub(t,r),-o),d=Math.abs(c),h=Math.abs(u);let f=Math.SQRT1_2,p=Math.SQRT1_2,g=0;for(;g<3;g++){const b=a*f,_=l*p,y=(a*a-l*l)*f**3/a,x=(l*l-a*a)*p**3/l,E=b-y,I=_-x,v=d-y,N=h-x,L=Math.hypot(I,E),z=Math.hypot(N,v);f=Il((v*L/z+y)/a,0,1),p=Il((N*L/z+x)/l,0,1);const M=Math.hypot(p,f);f/=M,p/=M}return R.add(R.rot([a*f*Math.sign(c),l*p*Math.sign(u)],o),r)},getLineIntersections(t,e,{rotate:n,xywh:r}){const i=po(n),s=X.deserialize(r);return F6(t,e,s.center,s.w/2,s.h/2,i)},getRelativePointLocation(t,{rotate:e,xywh:n}){const r=X.deserialize(n),i=r.getRelativePoint(t),{x:s,y:o,w:a,h:l,center:c}=r,u=Or([[s,o],[s+a/2,o],[s+a,o],[s+a,o+l/2],[s+a,o+l],[s+a/2,o+l],[s,o+l],[s,o+l/2],i],c,e),d=u.pop(),h=u.length;let f=[0,.5],p=0;for(;p<h;p++){const g=u[p],b=u[(p+1)%h];if(X.fromPoints([g,b,c]).containsPoint(d)){f=R.normalize(R.sub(b,g));break}}return new wt(d,f)}},rG={points({x:t,y:e,w:n,h:r}){return[[t,e],[t+n,e],[t+n,e+r],[t,e+r]]},draw(t,{x:e,y:n,w:r,h:i,rotate:s=0}){t.save(),t.translate(e+r/2,n+i/2),t.rotate(s*Math.PI/180),t.translate(-e-r/2,-n-i/2),t.rect(e,n,r,i),t.restore()},includesPoint(t,e,n){var r,i;const s=[t,e],o=Ke(this,void 0,n.responsePadding);let a=tg(s,o,((r=n==null?void 0:n.hitThreshold)!=null?r:1)/((i=n.zoom)!=null?i:1));if(!a)if(!n.ignoreTransparent||this.filled)a=ci([t,e],o);else{const l=this.text;if(!l||!l.length){const c=rg(this,Rd),u=Ke(c);a=ci([t,e],u)}else this.textBound&&(a=ci(s,Ke(this,()=>X.from(this.textBound).points)))}return a},containsBound(t,e){return Ke(e).some(r=>t.containsPoint(r))},getNearestPoint(t,e){const n=Ke(e);return fo(n,t)},getLineIntersections(t,e,n){const r=Ke(n);return Ri(t,e,r)},getRelativePointLocation(t,e){var n,r;const i=X.deserialize(e.xywh),s=i.getRelativePoint(t),o=Or([s],i.center,(n=e.rotate)!=null?n:0)[0],a=Or(i.points,i.center,(r=e.rotate)!=null?r:0),l=Cl(a,o);return new wt(o,l)}},ul={points({x:t,y:e,w:n,h:r}){return[[t,e+r],[t+n/2,e],[t+n,e+r]]},draw(t,{x:e,y:n,w:r,h:i,rotate:s=0}){const o=e+r/2,a=n+i/2;t.save(),t.translate(o,a),t.rotate(s*Math.PI/180),t.translate(-o,-a),t.beginPath(),t.moveTo(e,n+i),t.lineTo(e+r/2,n),t.lineTo(e+r,n+i),t.closePath(),t.restore()},includesPoint(t,e,n){var r,i;const s=[t,e],o=Ke(this,ul.points);let a=tg(s,o,((r=n==null?void 0:n.hitThreshold)!=null?r:1)/((i=n==null?void 0:n.zoom)!=null?i:1));if(!a)if(!n.ignoreTransparent||this.filled)a=ci([t,e],o);else{const l=this.text;if(!l||!l.length){const c=rg(this,Rd),u=Ke(c,ul.points);a=ci([t,e],u)}else this.textBound&&(a=ci(s,Ke(this,()=>X.from(this.textBound).points)))}return a},containsBound(t,e){return Ke(e,ul.points).some(r=>t.containsPoint(r))},getNearestPoint(t,e){const n=Ke(e,ul.points);return fo(n,t)},getLineIntersections(t,e,n){const r=Ke(n,ul.points);return Ri(t,e,r)},getRelativePointLocation(t,e){const n=X.deserialize(e.xywh),r=n.getRelativePoint(t);let i=ul.points(n);i.push(r),i=Or(i,n.center,e.rotate);const s=i.pop(),o=Cl(i,s);return new wt(s,o)}},th={rect:rG,triangle:ul,ellipse:fI,diamond:cl};var iG=Object.create,pI=Object.defineProperty,sG=Object.getOwnPropertyDescriptor,mI=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),nh=t=>{throw TypeError(t)},oG=(t,e,n)=>e in t?pI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,gI=t=>{var e;return[,,,iG((e=t==null?void 0:t[mI("metadata")])!=null?e:null)]},bI=["class","method","getter","setter","accessor","field","value","get","set"],rh=t=>t!==void 0&&typeof t!="function"?nh("Function expected"):t,aG=(t,e,n,r,i)=>({kind:bI[t],name:e,metadata:r,addInitializer:s=>n._?nh("Already initialized"):i.push(rh(s||null))}),yI=(t,e)=>oG(e,mI("metadata"),t[3]),ee=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},De=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=bI[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,sG({get[n](){return lG(this,s)},set[n](E){return cG(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=aG(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?rh(a)&&(y[g]=a):typeof a!="object"||a===null?nh("Object expected"):(rh(o=a.get)&&(y.get=o),rh(o=a.set)&&(y.set=o),rh(o=a.init)&&b.unshift(o));return y&&pI(i,n,y),i},_I=(t,e,n)=>e.has(t)||nh("Cannot "+n),lG=(t,e,n)=>(_I(t,e,"read from private field"),e.get(t)),Ne=(t,e,n)=>e.has(t)?nh("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),cG=(t,e,n,r)=>(_I(t,e,"write to private field"),e.set(t,n),n),xI,EI,vI,wI,kI,TI,SI,CI,AI,II,MI,DI,NI,OI,PI,LI,RI,BI,FI,UI,$I,HI,zI,WI,jI,Py,ie,Ly,Ry,By,Fy,Uy,$y,Hy,zy,Wy,jy,Yy,Gy,Vy,qy,Xy,Ky,Qy,Zy,Jy,e_,t_,n_,r_,i_,s_,YI,GI,VI,qI,XI,KI,QI,ZI,JI,e3,t3,n3,r3,i3,s3,o3,a3,l3,o_,ve,a_,l_,c_,u_,d_,h_,f_,p_,m_,g_,b_,y_,__,x_,E_,v_,w_,k_;const T_=20,S_=10;class pt extends(Py=Lt,jI=[ue(ae.shapeTextColor)],WI=[ue()],zI=[ue()],HI=[ue(fn.Inter)],$I=[ue(HC.MEDIUM)],UI=[ue(zo.Normal)],FI=[ue(tn.Regular)],BI=[ue(!1)],RI=[ue([S_,T_])],LI=[ue()],PI=[ue(0)],OI=[ue(Ld)],NI=[ue()],DI=[ue()],MI=[ue()],II=[ue()],AI=[ue()],CI=[ue()],SI=[ue()],TI=[ue(Ks.Center)],kI=[gi()],wI=[ue(Ks.Center)],vI=[ue(ts.AUTO_HEIGHT)],EI=[ue(R1.Center)],xI=[ue()],Py){constructor(){super(...arguments),this.textBound=null,Ne(this,Ly,ee(ie,8,this)),ee(ie,11,this),Ne(this,Ry,ee(ie,12,this,ae.shapeFillColor)),ee(ie,15,this),Ne(this,By,ee(ie,16,this,!1)),ee(ie,19,this),Ne(this,Fy,ee(ie,20,this)),ee(ie,23,this),Ne(this,Uy,ee(ie,24,this)),ee(ie,27,this),Ne(this,$y,ee(ie,28,this)),ee(ie,31,this),Ne(this,Hy,ee(ie,32,this)),ee(ie,35,this),Ne(this,zy,ee(ie,36,this,!1)),ee(ie,39,this),Ne(this,Wy,ee(ie,40,this,[S_,T_])),ee(ie,43,this),Ne(this,jy,ee(ie,44,this,0)),ee(ie,47,this),Ne(this,Yy,ee(ie,48,this,0)),ee(ie,51,this),Ne(this,Gy,ee(ie,52,this,Ld)),ee(ie,55,this),Ne(this,Vy,ee(ie,56,this,null)),ee(ie,59,this),Ne(this,qy,ee(ie,60,this,L1.General)),ee(ie,63,this),Ne(this,Xy,ee(ie,64,this,P1.Rect)),ee(ie,67,this),Ne(this,Ky,ee(ie,68,this,ae.shapeStrokeColor)),ee(ie,71,this),Ne(this,Qy,ee(ie,72,this,xi.Solid)),ee(ie,75,this),Ne(this,Zy,ee(ie,76,this,4)),ee(ie,79,this),Ne(this,Jy,ee(ie,80,this)),ee(ie,83,this),Ne(this,e_,ee(ie,84,this)),ee(ie,87,this),Ne(this,t_,ee(ie,88,this,!0)),ee(ie,91,this),Ne(this,n_,ee(ie,92,this)),ee(ie,95,this),Ne(this,r_,ee(ie,96,this,ts.AUTO_HEIGHT)),ee(ie,99,this),Ne(this,i_,ee(ie,100,this)),ee(ie,103,this),Ne(this,s_,ee(ie,104,this,"[0,0,100,100]")),ee(ie,107,this)}get type(){return"shape"}static propsToY(e){return typeof e.text=="string"&&(e.text=new gt(e.text)),e}containsBound(e){return th[this.shapeType].containsBound(e,this)}getLineIntersections(e,n){return th[this.shapeType].getLineIntersections(e,n,this)}getNearestPoint(e){return th[this.shapeType].getNearestPoint(e,this)}getRelativePointLocation(e){return th[this.shapeType].getRelativePointLocation(e,this)}includesPoint(e,n,r){var i;return th[this.shapeType].includesPoint.call(this,e,n,{...r,ignoreTransparent:(i=r.ignoreTransparent)!=null?i:!0})}}ie=gI(Py),Ly=new WeakMap,Ry=new WeakMap,By=new WeakMap,Fy=new WeakMap,Uy=new WeakMap,$y=new WeakMap,Hy=new WeakMap,zy=new WeakMap,Wy=new WeakMap,jy=new WeakMap,Yy=new WeakMap,Gy=new WeakMap,Vy=new WeakMap,qy=new WeakMap,Xy=new WeakMap,Ky=new WeakMap,Qy=new WeakMap,Zy=new WeakMap,Jy=new WeakMap,e_=new WeakMap,t_=new WeakMap,n_=new WeakMap,r_=new WeakMap,i_=new WeakMap,s_=new WeakMap,De(ie,4,"color",jI,pt,Ly),De(ie,4,"fillColor",WI,pt,Ry),De(ie,4,"filled",zI,pt,By),De(ie,4,"fontFamily",HI,pt,Fy),De(ie,4,"fontSize",$I,pt,Uy),De(ie,4,"fontStyle",UI,pt,$y),De(ie,4,"fontWeight",FI,pt,Hy),De(ie,4,"maxWidth",BI,pt,zy),De(ie,4,"padding",RI,pt,Wy),De(ie,4,"radius",LI,pt,jy),De(ie,4,"rotate",PI,pt,Yy),De(ie,4,"roughness",OI,pt,Gy),De(ie,4,"shadow",NI,pt,Vy),De(ie,4,"shapeStyle",DI,pt,qy),De(ie,4,"shapeType",MI,pt,Xy),De(ie,4,"strokeColor",II,pt,Ky),De(ie,4,"strokeStyle",AI,pt,Qy),De(ie,4,"strokeWidth",CI,pt,Zy),De(ie,4,"text",SI,pt,Jy),De(ie,4,"textAlign",TI,pt,e_),De(ie,4,"textDisplay",kI,pt,t_),De(ie,4,"textHorizontalAlign",wI,pt,n_),De(ie,4,"textResizing",vI,pt,r_),De(ie,4,"textVerticalAlign",EI,pt,i_),De(ie,4,"xywh",xI,pt,s_),yI(ie,pt);class pn extends(o_=Ht,l3=[_t()],a3=[_t()],o3=[_t()],s3=[_t()],i3=[_t()],r3=[_t()],n3=[_t()],t3=[_t()],e3=[_t()],JI=[_t()],ZI=[_t()],QI=[_t()],KI=[_t()],XI=[_t()],qI=[_t()],VI=[_t()],GI=[_t()],YI=[_t()],o_){constructor(){super(...arguments),this.roughness=Ld,this.textBound=null,this.textDisplay=!0,Ne(this,a_,ee(ve,8,this,ae.shapeTextColor)),ee(ve,11,this),Ne(this,l_,ee(ve,12,this,ae.shapeFillColor)),ee(ve,15,this),Ne(this,c_,ee(ve,16,this,!1)),ee(ve,19,this),Ne(this,u_,ee(ve,20,this,fn.Inter)),ee(ve,23,this),Ne(this,d_,ee(ve,24,this,16)),ee(ve,27,this),Ne(this,h_,ee(ve,28,this,zo.Normal)),ee(ve,31,this),Ne(this,f_,ee(ve,32,this,tn.Regular)),ee(ve,35,this),Ne(this,p_,ee(ve,36,this,[S_,T_])),ee(ve,39,this),Ne(this,m_,ee(ve,40,this,0)),ee(ve,43,this),Ne(this,g_,ee(ve,44,this,null)),ee(ve,47,this),Ne(this,b_,ee(ve,48,this,L1.General)),ee(ve,51,this),Ne(this,y_,ee(ve,52,this,P1.Rect)),ee(ve,55,this),Ne(this,__,ee(ve,56,this,ae.shapeStrokeColor)),ee(ve,59,this),Ne(this,x_,ee(ve,60,this,xi.Solid)),ee(ve,63,this),Ne(this,E_,ee(ve,64,this,4)),ee(ve,67,this),Ne(this,v_,ee(ve,68,this,"")),ee(ve,71,this),Ne(this,w_,ee(ve,72,this,Ks.Center)),ee(ve,75,this),Ne(this,k_,ee(ve,76,this,R1.Center)),ee(ve,79,this)}get type(){return"shape"}}ve=gI(o_),a_=new WeakMap,l_=new WeakMap,c_=new WeakMap,u_=new WeakMap,d_=new WeakMap,h_=new WeakMap,f_=new WeakMap,p_=new WeakMap,m_=new WeakMap,g_=new WeakMap,b_=new WeakMap,y_=new WeakMap,__=new WeakMap,x_=new WeakMap,E_=new WeakMap,v_=new WeakMap,w_=new WeakMap,k_=new WeakMap,De(ve,4,"color",l3,pn,a_),De(ve,4,"fillColor",a3,pn,l_),De(ve,4,"filled",o3,pn,c_),De(ve,4,"fontFamily",s3,pn,u_),De(ve,4,"fontSize",i3,pn,d_),De(ve,4,"fontStyle",r3,pn,h_),De(ve,4,"fontWeight",n3,pn,f_),De(ve,4,"padding",t3,pn,p_),De(ve,4,"radius",e3,pn,m_),De(ve,4,"shadow",JI,pn,g_),De(ve,4,"shapeStyle",ZI,pn,b_),De(ve,4,"shapeType",QI,pn,y_),De(ve,4,"strokeColor",KI,pn,__),De(ve,4,"strokeStyle",XI,pn,x_),De(ve,4,"strokeWidth",qI,pn,E_),De(ve,4,"text",VI,pn,v_),De(ve,4,"textAlign",GI,pn,w_),De(ve,4,"textVerticalAlign",YI,pn,k_),yI(ve,pn);var uG=Object.create,c3=Object.defineProperty,dG=Object.getOwnPropertyDescriptor,u3=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),ih=t=>{throw TypeError(t)},hG=(t,e,n)=>e in t?c3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fG=t=>{var e;return[,,,uG((e=t==null?void 0:t[u3("metadata")])!=null?e:null)]},d3=["class","method","getter","setter","accessor","field","value","get","set"],sh=t=>t!==void 0&&typeof t!="function"?ih("Function expected"):t,pG=(t,e,n,r,i)=>({kind:d3[t],name:e,metadata:r,addInitializer:s=>n._?ih("Already initialized"):i.push(sh(s||null))}),mG=(t,e)=>hG(e,u3("metadata"),t[3]),nn=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},os=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=d3[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,dG({get[n](){return gG(this,s)},set[n](E){return bG(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=pG(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?sh(a)&&(y[g]=a):typeof a!="object"||a===null?ih("Object expected"):(sh(o=a.get)&&(y.get=o),sh(o=a.set)&&(y.set=o),sh(o=a.init)&&b.unshift(o));return y&&c3(i,n,y),i},h3=(t,e,n)=>e.has(t)||ih("Cannot "+n),gG=(t,e,n)=>(h3(t,e,"read from private field"),e.get(t)),as=(t,e,n)=>e.has(t)?ih("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),bG=(t,e,n,r)=>(h3(t,e,"write to private field"),e.set(t,n),n),f3,p3,m3,g3,b3,y3,_3,x3,E3,v3,C_,rt,A_,I_,M_,D_,N_,O_,P_,L_,R_,B_;class ei extends(C_=Lt,v3=[ue()],E3=[ue()],x3=[ue()],_3=[ue(zo.Normal)],y3=[ue(tn.Regular)],b3=[ue(!1)],g3=[ue(0)],m3=[ue()],p3=[ue()],f3=[ue()],C_){constructor(){super(...arguments),as(this,A_,nn(rt,8,this,ae.black)),nn(rt,11,this),as(this,I_,nn(rt,12,this,fn.Inter)),nn(rt,15,this),as(this,M_,nn(rt,16,this,16)),nn(rt,19,this),as(this,D_,nn(rt,20,this,zo.Normal)),nn(rt,23,this),as(this,N_,nn(rt,24,this,tn.Regular)),nn(rt,27,this),as(this,O_,nn(rt,28,this,!1)),nn(rt,31,this),as(this,P_,nn(rt,32,this,0)),nn(rt,35,this),as(this,L_,nn(rt,36,this,new gt)),nn(rt,39,this),as(this,R_,nn(rt,40,this,Ks.Center)),nn(rt,43,this),as(this,B_,nn(rt,44,this,"[0,0,16,16]")),nn(rt,47,this)}get type(){return"text"}static propsToY(e){return typeof e.text=="string"&&(e.text=new gt(e.text)),e}containsBound(e){return Ke(this).some(r=>e.containsPoint(r))}getLineIntersections(e,n){const r=Ke(this);return Ri(e,n,r)}getNearestPoint(e){return fo(X.deserialize(this.xywh).points,e)}includesPoint(e,n){const r=Ke(this);return ci([e,n],r)}}rt=fG(C_),A_=new WeakMap,I_=new WeakMap,M_=new WeakMap,D_=new WeakMap,N_=new WeakMap,O_=new WeakMap,P_=new WeakMap,L_=new WeakMap,R_=new WeakMap,B_=new WeakMap,os(rt,4,"color",v3,ei,A_),os(rt,4,"fontFamily",E3,ei,I_),os(rt,4,"fontSize",x3,ei,M_),os(rt,4,"fontStyle",_3,ei,D_),os(rt,4,"fontWeight",y3,ei,N_),os(rt,4,"hasMaxWidth",b3,ei,O_),os(rt,4,"rotate",g3,ei,P_),os(rt,4,"text",m3,ei,L_),os(rt,4,"textAlign",p3,ei,R_),os(rt,4,"xywh",f3,ei,B_),mG(rt,ei);const Dc=Me("AdapterFactory");/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:w3,setPrototypeOf:k3,isFrozen:yG,getPrototypeOf:_G,getOwnPropertyDescriptor:xG}=Object;let{freeze:lr,seal:ti,create:T3}=Object,{apply:F_,construct:U_}=typeof Reflect<"u"&&Reflect;lr||(lr=function(e){return e}),ti||(ti=function(e){return e}),F_||(F_=function(e,n,r){return e.apply(n,r)}),U_||(U_=function(e,n){return new e(...n)});const zp=ur(Array.prototype.forEach),EG=ur(Array.prototype.lastIndexOf),S3=ur(Array.prototype.pop),oh=ur(Array.prototype.push),vG=ur(Array.prototype.splice),Wp=ur(String.prototype.toLowerCase),$_=ur(String.prototype.toString),C3=ur(String.prototype.match),ah=ur(String.prototype.replace),wG=ur(String.prototype.indexOf),kG=ur(String.prototype.trim),wi=ur(Object.prototype.hasOwnProperty),cr=ur(RegExp.prototype.test),lh=TG(TypeError);function ur(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return F_(t,e,r)}}function TG(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return U_(t,n)}}function Ye(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wp;k3&&k3(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=n(i);s!==i&&(yG(e)||(e[r]=s),i=s)}t[i]=!0}return t}function SG(t){for(let e=0;e<t.length;e++)wi(t,e)||(t[e]=null);return t}function to(t){const e=T3(null);for(const[n,r]of w3(t))wi(t,n)&&(Array.isArray(r)?e[n]=SG(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=to(r):e[n]=r);return e}function ch(t,e){for(;t!==null;){const r=xG(t,e);if(r){if(r.get)return ur(r.get);if(typeof r.value=="function")return ur(r.value)}t=_G(t)}function n(){return null}return n}const A3=lr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),H_=lr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),z_=lr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),CG=lr(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),W_=lr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),AG=lr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),I3=lr(["#text"]),M3=lr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),j_=lr(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),D3=lr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),jp=lr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),IG=ti(/\{\{[\w\W]*|[\w\W]*\}\}/gm),MG=ti(/<%[\w\W]*|[\w\W]*%>/gm),DG=ti(/\$\{[\w\W]*/gm),NG=ti(/^data-[\-\w.\u00B7-\uFFFF]+$/),OG=ti(/^aria-[\-\w]+$/),N3=ti(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),PG=ti(/^(?:\w+script|data):/i),LG=ti(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),O3=ti(/^html$/i),RG=ti(/^[a-z][.\w]*(-[.\w]+)+$/i);var P3=Object.freeze({__proto__:null,ARIA_ATTR:OG,ATTR_WHITESPACE:LG,CUSTOM_ELEMENT:RG,DATA_ATTR:NG,DOCTYPE_NAME:O3,ERB_EXPR:MG,IS_ALLOWED_URI:N3,IS_SCRIPT_OR_DATA:PG,MUSTACHE_EXPR:IG,TMPLIT_EXPR:DG});const uh={element:1,text:3,progressingInstruction:7,comment:8,document:9},BG=function(){return typeof window>"u"?null:window},FG=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},L3=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function R3(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:BG();const e=Ee=>R3(Ee);if(e.version="3.2.6",e.removed=[],!t||!t.document||t.document.nodeType!==uh.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:f}=t,p=l.prototype,g=ch(p,"cloneNode"),b=ch(p,"remove"),_=ch(p,"nextSibling"),y=ch(p,"childNodes"),x=ch(p,"parentNode");if(typeof o=="function"){const Ee=n.createElement("template");Ee.content&&Ee.content.ownerDocument&&(n=Ee.content.ownerDocument)}let E,I="";const{implementation:v,createNodeIterator:N,createDocumentFragment:L,getElementsByTagName:z}=n,{importNode:M}=r;let B=L3();e.isSupported=typeof w3=="function"&&typeof x=="function"&&v&&v.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:$,ERB_EXPR:se,TMPLIT_EXPR:be,DATA_ATTR:_e,ARIA_ATTR:we,IS_SCRIPT_OR_DATA:de,ATTR_WHITESPACE:Ue,CUSTOM_ELEMENT:Se}=P3;let{IS_ALLOWED_URI:C}=P3,he=null;const qe=Ye({},[...A3,...H_,...z_,...W_,...I3]);let A=null;const ot=Ye({},[...M3,...j_,...D3,...jp]);let Ce=Object.seal(T3(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Xe=null,Zn=null,xn=!0,En=!0,$n=!1,Gt=!0,Hn=!1,Jn=!0,Di=!1,xs=!1,ma=!1,Ni=!1,ga=!1,co=!1,El=!0,uo=!1;const vl="user-content-";let ba=!0,Es=!1,On={},U=null;const te=Ye({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const Be=Ye({},["audio","video","img","source","image","track"]);let nt=null;const er=Ye({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Cr="http://www.w3.org/1998/Math/MathML",Pn="http://www.w3.org/2000/svg",Vt="http://www.w3.org/1999/xhtml";let tr=Vt,qt=!1,Ar=null;const zn=Ye({},[Cr,Pn,Vt],$_);let nu=Ye({},["mi","mo","mn","ms","mtext"]),ru=Ye({},["annotation-xml"]);const HE=Ye({},["title","style","font","a","script"]);let wl=null;const zE=["application/xhtml+xml","text/html"],Rm="text/html";let $t=null,Ir=null;const WE=n.createElement("form"),Bm=function(D){return D instanceof RegExp||D instanceof Function},qh=function(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ir&&Ir===D)){if((!D||typeof D!="object")&&(D={}),D=to(D),wl=zE.indexOf(D.PARSER_MEDIA_TYPE)===-1?Rm:D.PARSER_MEDIA_TYPE,$t=wl==="application/xhtml+xml"?$_:Wp,he=wi(D,"ALLOWED_TAGS")?Ye({},D.ALLOWED_TAGS,$t):qe,A=wi(D,"ALLOWED_ATTR")?Ye({},D.ALLOWED_ATTR,$t):ot,Ar=wi(D,"ALLOWED_NAMESPACES")?Ye({},D.ALLOWED_NAMESPACES,$_):zn,nt=wi(D,"ADD_URI_SAFE_ATTR")?Ye(to(er),D.ADD_URI_SAFE_ATTR,$t):er,Ae=wi(D,"ADD_DATA_URI_TAGS")?Ye(to(Be),D.ADD_DATA_URI_TAGS,$t):Be,U=wi(D,"FORBID_CONTENTS")?Ye({},D.FORBID_CONTENTS,$t):te,Xe=wi(D,"FORBID_TAGS")?Ye({},D.FORBID_TAGS,$t):to({}),Zn=wi(D,"FORBID_ATTR")?Ye({},D.FORBID_ATTR,$t):to({}),On=wi(D,"USE_PROFILES")?D.USE_PROFILES:!1,xn=D.ALLOW_ARIA_ATTR!==!1,En=D.ALLOW_DATA_ATTR!==!1,$n=D.ALLOW_UNKNOWN_PROTOCOLS||!1,Gt=D.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Hn=D.SAFE_FOR_TEMPLATES||!1,Jn=D.SAFE_FOR_XML!==!1,Di=D.WHOLE_DOCUMENT||!1,Ni=D.RETURN_DOM||!1,ga=D.RETURN_DOM_FRAGMENT||!1,co=D.RETURN_TRUSTED_TYPE||!1,ma=D.FORCE_BODY||!1,El=D.SANITIZE_DOM!==!1,uo=D.SANITIZE_NAMED_PROPS||!1,ba=D.KEEP_CONTENT!==!1,Es=D.IN_PLACE||!1,C=D.ALLOWED_URI_REGEXP||N3,tr=D.NAMESPACE||Vt,nu=D.MATHML_TEXT_INTEGRATION_POINTS||nu,ru=D.HTML_INTEGRATION_POINTS||ru,Ce=D.CUSTOM_ELEMENT_HANDLING||{},D.CUSTOM_ELEMENT_HANDLING&&Bm(D.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ce.tagNameCheck=D.CUSTOM_ELEMENT_HANDLING.tagNameCheck),D.CUSTOM_ELEMENT_HANDLING&&Bm(D.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ce.attributeNameCheck=D.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),D.CUSTOM_ELEMENT_HANDLING&&typeof D.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Ce.allowCustomizedBuiltInElements=D.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Hn&&(En=!1),ga&&(Ni=!0),On&&(he=Ye({},I3),A=[],On.html===!0&&(Ye(he,A3),Ye(A,M3)),On.svg===!0&&(Ye(he,H_),Ye(A,j_),Ye(A,jp)),On.svgFilters===!0&&(Ye(he,z_),Ye(A,j_),Ye(A,jp)),On.mathMl===!0&&(Ye(he,W_),Ye(A,D3),Ye(A,jp))),D.ADD_TAGS&&(he===qe&&(he=to(he)),Ye(he,D.ADD_TAGS,$t)),D.ADD_ATTR&&(A===ot&&(A=to(A)),Ye(A,D.ADD_ATTR,$t)),D.ADD_URI_SAFE_ATTR&&Ye(nt,D.ADD_URI_SAFE_ATTR,$t),D.FORBID_CONTENTS&&(U===te&&(U=to(U)),Ye(U,D.FORBID_CONTENTS,$t)),ba&&(he["#text"]=!0),Di&&Ye(he,["html","head","body"]),he.table&&(Ye(he,["tbody"]),delete Xe.tbody),D.TRUSTED_TYPES_POLICY){if(typeof D.TRUSTED_TYPES_POLICY.createHTML!="function")throw lh('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof D.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw lh('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=D.TRUSTED_TYPES_POLICY,I=E.createHTML("")}else E===void 0&&(E=FG(f,i)),E!==null&&typeof I=="string"&&(I=E.createHTML(""));lr&&lr(D),Ir=D}},Fm=Ye({},[...H_,...z_,...CG]),Um=Ye({},[...W_,...AG]),Oi=function(D){let Y=x(D);(!Y||!Y.tagName)&&(Y={namespaceURI:tr,tagName:"template"});const me=Wp(D.tagName),vt=Wp(Y.tagName);return Ar[D.namespaceURI]?D.namespaceURI===Pn?Y.namespaceURI===Vt?me==="svg":Y.namespaceURI===Cr?me==="svg"&&(vt==="annotation-xml"||nu[vt]):!!Fm[me]:D.namespaceURI===Cr?Y.namespaceURI===Vt?me==="math":Y.namespaceURI===Pn?me==="math"&&ru[vt]:!!Um[me]:D.namespaceURI===Vt?Y.namespaceURI===Pn&&!ru[vt]||Y.namespaceURI===Cr&&!nu[vt]?!1:!Um[me]&&(HE[me]||!Fm[me]):!!(wl==="application/xhtml+xml"&&Ar[D.namespaceURI]):!1},oi=function(D){oh(e.removed,{element:D});try{x(D).removeChild(D)}catch{b(D)}},ya=function(D,Y){try{oh(e.removed,{attribute:Y.getAttributeNode(D),from:Y})}catch{oh(e.removed,{attribute:null,from:Y})}if(Y.removeAttribute(D),D==="is")if(Ni||ga)try{oi(Y)}catch{}else try{Y.setAttribute(D,"")}catch{}},$m=function(D){let Y=null,me=null;if(ma)D="<remove></remove>"+D;else{const Xt=C3(D,/^[\r\n\t ]+/);me=Xt&&Xt[0]}wl==="application/xhtml+xml"&&tr===Vt&&(D='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+D+"</body></html>");const vt=E?E.createHTML(D):D;if(tr===Vt)try{Y=new h().parseFromString(vt,wl)}catch{}if(!Y||!Y.documentElement){Y=v.createDocument(tr,"template",null);try{Y.documentElement.innerHTML=qt?I:vt}catch{}}const Ln=Y.body||Y.documentElement;return D&&me&&Ln.insertBefore(n.createTextNode(me),Ln.childNodes[0]||null),tr===Vt?z.call(Y,Di?"html":"body")[0]:Di?Y.documentElement:Ln},Hm=function(D){return N.call(D.ownerDocument||D,D,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Xh=function(D){return D instanceof d&&(typeof D.nodeName!="string"||typeof D.textContent!="string"||typeof D.removeChild!="function"||!(D.attributes instanceof u)||typeof D.removeAttribute!="function"||typeof D.setAttribute!="function"||typeof D.namespaceURI!="string"||typeof D.insertBefore!="function"||typeof D.hasChildNodes!="function")},vs=function(D){return typeof a=="function"&&D instanceof a};function Pi(Ee,D,Y){zp(Ee,me=>{me.call(e,D,Y,Ir)})}const zm=function(D){let Y=null;if(Pi(B.beforeSanitizeElements,D,null),Xh(D))return oi(D),!0;const me=$t(D.nodeName);if(Pi(B.uponSanitizeElement,D,{tagName:me,allowedTags:he}),Jn&&D.hasChildNodes()&&!vs(D.firstElementChild)&&cr(/<[/\w!]/g,D.innerHTML)&&cr(/<[/\w!]/g,D.textContent)||D.nodeType===uh.progressingInstruction||Jn&&D.nodeType===uh.comment&&cr(/<[/\w]/g,D.data))return oi(D),!0;if(!he[me]||Xe[me]){if(!Xe[me]&&jm(me)&&(Ce.tagNameCheck instanceof RegExp&&cr(Ce.tagNameCheck,me)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(me)))return!1;if(ba&&!U[me]){const vt=x(D)||D.parentNode,Ln=y(D)||D.childNodes;if(Ln&&vt){const Xt=Ln.length;for(let nr=Xt-1;nr>=0;--nr){const Li=g(Ln[nr],!0);Li.__removalCount=(D.__removalCount||0)+1,vt.insertBefore(Li,_(D))}}}return oi(D),!0}return D instanceof l&&!Oi(D)||(me==="noscript"||me==="noembed"||me==="noframes")&&cr(/<\/no(script|embed|frames)/i,D.innerHTML)?(oi(D),!0):(Hn&&D.nodeType===uh.text&&(Y=D.textContent,zp([$,se,be],vt=>{Y=ah(Y,vt," ")}),D.textContent!==Y&&(oh(e.removed,{element:D.cloneNode()}),D.textContent=Y)),Pi(B.afterSanitizeElements,D,null),!1)},Wm=function(D,Y,me){if(El&&(Y==="id"||Y==="name")&&(me in n||me in WE))return!1;if(!(En&&!Zn[Y]&&cr(_e,Y))){if(!(xn&&cr(we,Y))){if(!A[Y]||Zn[Y]){if(!(jm(D)&&(Ce.tagNameCheck instanceof RegExp&&cr(Ce.tagNameCheck,D)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(D))&&(Ce.attributeNameCheck instanceof RegExp&&cr(Ce.attributeNameCheck,Y)||Ce.attributeNameCheck instanceof Function&&Ce.attributeNameCheck(Y))||Y==="is"&&Ce.allowCustomizedBuiltInElements&&(Ce.tagNameCheck instanceof RegExp&&cr(Ce.tagNameCheck,me)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(me))))return!1}else if(!nt[Y]){if(!cr(C,ah(me,Ue,""))){if(!((Y==="src"||Y==="xlink:href"||Y==="href")&&D!=="script"&&wG(me,"data:")===0&&Ae[D])){if(!($n&&!cr(de,ah(me,Ue,"")))){if(me)return!1}}}}}}return!0},jm=function(D){return D!=="annotation-xml"&&C3(D,Se)},Ym=function(D){Pi(B.beforeSanitizeAttributes,D,null);const{attributes:Y}=D;if(!Y||Xh(D))return;const me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:A,forceKeepAttr:void 0};let vt=Y.length;for(;vt--;){const Ln=Y[vt],{name:Xt,namespaceURI:nr,value:Li}=Ln,ws=$t(Xt),Kh=Li;let vn=Xt==="value"?Kh:kG(Kh);if(me.attrName=ws,me.attrValue=vn,me.keepAttr=!0,me.forceKeepAttr=void 0,Pi(B.uponSanitizeAttribute,D,me),vn=me.attrValue,uo&&(ws==="id"||ws==="name")&&(ya(Xt,D),vn=vl+vn),Jn&&cr(/((--!?|])>)|<\/(style|title)/i,vn)){ya(Xt,D);continue}if(me.forceKeepAttr)continue;if(!me.keepAttr){ya(Xt,D);continue}if(!Gt&&cr(/\/>/i,vn)){ya(Xt,D);continue}Hn&&zp([$,se,be],Vm=>{vn=ah(vn,Vm," ")});const Gm=$t(D.nodeName);if(!Wm(Gm,ws,vn)){ya(Xt,D);continue}if(E&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!nr)switch(f.getAttributeType(Gm,ws)){case"TrustedHTML":{vn=E.createHTML(vn);break}case"TrustedScriptURL":{vn=E.createScriptURL(vn);break}}if(vn!==Kh)try{nr?D.setAttributeNS(nr,Xt,vn):D.setAttribute(Xt,vn),Xh(D)?oi(D):S3(e.removed)}catch{ya(Xt,D)}}Pi(B.afterSanitizeAttributes,D,null)},iu=function Ee(D){let Y=null;const me=Hm(D);for(Pi(B.beforeSanitizeShadowDOM,D,null);Y=me.nextNode();)Pi(B.uponSanitizeShadowNode,Y,null),zm(Y),Ym(Y),Y.content instanceof s&&Ee(Y.content);Pi(B.afterSanitizeShadowDOM,D,null)};return e.sanitize=function(Ee){let D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Y=null,me=null,vt=null,Ln=null;if(qt=!Ee,qt&&(Ee="<!-->"),typeof Ee!="string"&&!vs(Ee))if(typeof Ee.toString=="function"){if(Ee=Ee.toString(),typeof Ee!="string")throw lh("dirty is not a string, aborting")}else throw lh("toString is not a function");if(!e.isSupported)return Ee;if(xs||qh(D),e.removed=[],typeof Ee=="string"&&(Es=!1),Es){if(Ee.nodeName){const Li=$t(Ee.nodeName);if(!he[Li]||Xe[Li])throw lh("root node is forbidden and cannot be sanitized in-place")}}else if(Ee instanceof a)Y=$m("<!---->"),me=Y.ownerDocument.importNode(Ee,!0),me.nodeType===uh.element&&me.nodeName==="BODY"||me.nodeName==="HTML"?Y=me:Y.appendChild(me);else{if(!Ni&&!Hn&&!Di&&Ee.indexOf("<")===-1)return E&&co?E.createHTML(Ee):Ee;if(Y=$m(Ee),!Y)return Ni?null:co?I:""}Y&&ma&&oi(Y.firstChild);const Xt=Hm(Es?Ee:Y);for(;vt=Xt.nextNode();)zm(vt),Ym(vt),vt.content instanceof s&&iu(vt.content);if(Es)return Ee;if(Ni){if(ga)for(Ln=L.call(Y.ownerDocument);Y.firstChild;)Ln.appendChild(Y.firstChild);else Ln=Y;return(A.shadowroot||A.shadowrootmode)&&(Ln=M.call(r,Ln,!0)),Ln}let nr=Di?Y.outerHTML:Y.innerHTML;return Di&&he["!doctype"]&&Y.ownerDocument&&Y.ownerDocument.doctype&&Y.ownerDocument.doctype.name&&cr(O3,Y.ownerDocument.doctype.name)&&(nr="<!DOCTYPE "+Y.ownerDocument.doctype.name+`>
`+nr),Hn&&zp([$,se,be],Li=>{nr=ah(nr,Li," ")}),E&&co?E.createHTML(nr):nr},e.setConfig=function(){let Ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};qh(Ee),xs=!0},e.clearConfig=function(){Ir=null,xs=!1},e.isValidAttribute=function(Ee,D,Y){Ir||qh({});const me=$t(Ee),vt=$t(D);return Wm(me,vt,Y)},e.addHook=function(Ee,D){typeof D=="function"&&oh(B[Ee],D)},e.removeHook=function(Ee,D){if(D!==void 0){const Y=EG(B[Ee],D);return Y===-1?void 0:vG(B[Ee],Y,1)[0]}return S3(B[Ee])},e.removeHooks=function(Ee){B[Ee]=[]},e.removeAllHooks=function(){B=L3()},e}var UG=R3(),Y_={exports:{}},B3;function $G(){return B3||(B3=1,function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(l,c){if(!s[l]){s[l]={};for(var u=0;u<l.length;u++)s[l][l.charAt(u)]=u}return s[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return o(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var f=c.charCodeAt(d);u[d*2]=f>>>8,u[d*2+1]=f%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(f){h.push(n(f))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return o(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return n(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,f={},p={},g="",b="",_="",y=2,x=3,E=2,I=[],v=0,N=0,L;for(L=0;L<l.length;L+=1)if(g=l.charAt(L),Object.prototype.hasOwnProperty.call(f,g)||(f[g]=x++,p[g]=!0),b=_+g,Object.prototype.hasOwnProperty.call(f,b))_=b;else{if(Object.prototype.hasOwnProperty.call(p,_)){if(_.charCodeAt(0)<256){for(d=0;d<E;d++)v=v<<1,N==c-1?(N=0,I.push(u(v)),v=0):N++;for(h=_.charCodeAt(0),d=0;d<8;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1}else{for(h=1,d=0;d<E;d++)v=v<<1|h,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=0;for(h=_.charCodeAt(0),d=0;d<16;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1}y--,y==0&&(y=Math.pow(2,E),E++),delete p[_]}else for(h=f[_],d=0;d<E;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1;y--,y==0&&(y=Math.pow(2,E),E++),f[b]=x++,_=String(g)}if(_!==""){if(Object.prototype.hasOwnProperty.call(p,_)){if(_.charCodeAt(0)<256){for(d=0;d<E;d++)v=v<<1,N==c-1?(N=0,I.push(u(v)),v=0):N++;for(h=_.charCodeAt(0),d=0;d<8;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1}else{for(h=1,d=0;d<E;d++)v=v<<1|h,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=0;for(h=_.charCodeAt(0),d=0;d<16;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1}y--,y==0&&(y=Math.pow(2,E),E++),delete p[_]}else for(h=f[_],d=0;d<E;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1;y--,y==0&&(y=Math.pow(2,E),E++)}for(h=2,d=0;d<E;d++)v=v<<1|h&1,N==c-1?(N=0,I.push(u(v)),v=0):N++,h=h>>1;for(;;)if(v=v<<1,N==c-1){I.push(u(v));break}else N++;return I.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,f=4,p=3,g="",b=[],_,y,x,E,I,v,N,L={val:u(0),position:c,index:1};for(_=0;_<3;_+=1)d[_]=_;for(x=0,I=Math.pow(2,2),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;switch(x){case 0:for(x=0,I=Math.pow(2,8),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;N=n(x);break;case 1:for(x=0,I=Math.pow(2,16),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;N=n(x);break;case 2:return""}for(d[3]=N,y=N,b.push(N);;){if(L.index>l)return"";for(x=0,I=Math.pow(2,p),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;switch(N=x){case 0:for(x=0,I=Math.pow(2,8),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;d[f++]=n(x),N=f-1,h--;break;case 1:for(x=0,I=Math.pow(2,16),v=1;v!=I;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=c,L.val=u(L.index++)),x|=(E>0?1:0)*v,v<<=1;d[f++]=n(x),N=f-1,h--;break;case 2:return b.join("")}if(h==0&&(h=Math.pow(2,p),p++),d[N])g=d[N];else if(N===f)g=y+y.charAt(0);else return null;b.push(g),d[f++]=y+g.charAt(0),h--,y=g,h==0&&(h=Math.pow(2,p),p++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(Y_)),Y_.exports}var F3=$G();function Hge(){}class dh{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}dh.prototype.normal={},dh.prototype.property={},dh.prototype.space=void 0;function U3(t,e){const n={},r={};for(const i of t)Object.assign(n,i.property),Object.assign(r,i.normal);return new dh(n,r,e)}function hh(t){return t.toLowerCase()}class xr{constructor(e,n){this.attribute=n,this.property=e}}xr.prototype.attribute="",xr.prototype.booleanish=!1,xr.prototype.boolean=!1,xr.prototype.commaOrSpaceSeparated=!1,xr.prototype.commaSeparated=!1,xr.prototype.defined=!1,xr.prototype.mustUseProperty=!1,xr.prototype.number=!1,xr.prototype.overloadedBoolean=!1,xr.prototype.property="",xr.prototype.spaceSeparated=!1,xr.prototype.space=void 0;let HG=0;const Re=dl(),rn=dl(),G_=dl(),Q=dl(),Et=dl(),Nc=dl(),Fr=dl();function dl(){return 2**++HG}const V_=Object.freeze(Object.defineProperty({__proto__:null,boolean:Re,booleanish:rn,commaOrSpaceSeparated:Fr,commaSeparated:Nc,number:Q,overloadedBoolean:G_,spaceSeparated:Et},Symbol.toStringTag,{value:"Module"})),q_=Object.keys(V_);class X_ extends xr{constructor(e,n,r,i){let s=-1;if(super(e,n),$3(this,"space",i),typeof r=="number")for(;++s<q_.length;){const o=q_[s];$3(this,q_[s],(r&V_[o])===V_[o])}}}X_.prototype.defined=!0;function $3(t,e,n){n&&(t[e]=n)}function Oc(t){const e={},n={};for(const[r,i]of Object.entries(t.properties)){const s=new X_(r,t.transform(t.attributes||{},r),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,n[hh(r)]=r,n[hh(s.attribute)]=r}return new dh(e,n,t.space)}const H3=Oc({properties:{ariaActiveDescendant:null,ariaAtomic:rn,ariaAutoComplete:null,ariaBusy:rn,ariaChecked:rn,ariaColCount:Q,ariaColIndex:Q,ariaColSpan:Q,ariaControls:Et,ariaCurrent:null,ariaDescribedBy:Et,ariaDetails:null,ariaDisabled:rn,ariaDropEffect:Et,ariaErrorMessage:null,ariaExpanded:rn,ariaFlowTo:Et,ariaGrabbed:rn,ariaHasPopup:null,ariaHidden:rn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Et,ariaLevel:Q,ariaLive:null,ariaModal:rn,ariaMultiLine:rn,ariaMultiSelectable:rn,ariaOrientation:null,ariaOwns:Et,ariaPlaceholder:null,ariaPosInSet:Q,ariaPressed:rn,ariaReadOnly:rn,ariaRelevant:null,ariaRequired:rn,ariaRoleDescription:Et,ariaRowCount:Q,ariaRowIndex:Q,ariaRowSpan:Q,ariaSelected:rn,ariaSetSize:Q,ariaSort:null,ariaValueMax:Q,ariaValueMin:Q,ariaValueNow:Q,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function z3(t,e){return e in t?t[e]:e}function W3(t,e){return z3(t,e.toLowerCase())}const zG=Oc({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Nc,acceptCharset:Et,accessKey:Et,action:null,allow:null,allowFullScreen:Re,allowPaymentRequest:Re,allowUserMedia:Re,alt:null,as:null,async:Re,autoCapitalize:null,autoComplete:Et,autoFocus:Re,autoPlay:Re,blocking:Et,capture:null,charSet:null,checked:Re,cite:null,className:Et,cols:Q,colSpan:null,content:null,contentEditable:rn,controls:Re,controlsList:Et,coords:Q|Nc,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Re,defer:Re,dir:null,dirName:null,disabled:Re,download:G_,draggable:rn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Re,formTarget:null,headers:Et,height:Q,hidden:G_,high:Q,href:null,hrefLang:null,htmlFor:Et,httpEquiv:Et,id:null,imageSizes:null,imageSrcSet:null,inert:Re,inputMode:null,integrity:null,is:null,isMap:Re,itemId:null,itemProp:Et,itemRef:Et,itemScope:Re,itemType:Et,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Re,low:Q,manifest:null,max:null,maxLength:Q,media:null,method:null,min:null,minLength:Q,multiple:Re,muted:Re,name:null,nonce:null,noModule:Re,noValidate:Re,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Re,optimum:Q,pattern:null,ping:Et,placeholder:null,playsInline:Re,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Re,referrerPolicy:null,rel:Et,required:Re,reversed:Re,rows:Q,rowSpan:Q,sandbox:Et,scope:null,scoped:Re,seamless:Re,selected:Re,shadowRootClonable:Re,shadowRootDelegatesFocus:Re,shadowRootMode:null,shape:null,size:Q,sizes:null,slot:null,span:Q,spellCheck:rn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Q,step:null,style:null,tabIndex:Q,target:null,title:null,translate:null,type:null,typeMustMatch:Re,useMap:null,value:rn,width:Q,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Et,axis:null,background:null,bgColor:null,border:Q,borderColor:null,bottomMargin:Q,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Re,declare:Re,event:null,face:null,frame:null,frameBorder:null,hSpace:Q,leftMargin:Q,link:null,longDesc:null,lowSrc:null,marginHeight:Q,marginWidth:Q,noResize:Re,noHref:Re,noShade:Re,noWrap:Re,object:null,profile:null,prompt:null,rev:null,rightMargin:Q,rules:null,scheme:null,scrolling:rn,standby:null,summary:null,text:null,topMargin:Q,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Q,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Re,disableRemotePlayback:Re,prefix:null,property:null,results:Q,security:null,unselectable:null},space:"html",transform:W3}),WG=Oc({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Fr,accentHeight:Q,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Q,amplitude:Q,arabicForm:null,ascent:Q,attributeName:null,attributeType:null,azimuth:Q,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Q,by:null,calcMode:null,capHeight:Q,className:Et,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Q,diffuseConstant:Q,direction:null,display:null,dur:null,divisor:Q,dominantBaseline:null,download:Re,dx:null,dy:null,edgeMode:null,editable:null,elevation:Q,enableBackground:null,end:null,event:null,exponent:Q,externalResourcesRequired:null,fill:null,fillOpacity:Q,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Nc,g2:Nc,glyphName:Nc,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Q,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Q,horizOriginX:Q,horizOriginY:Q,id:null,ideographic:Q,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Q,k:Q,k1:Q,k2:Q,k3:Q,k4:Q,kernelMatrix:Fr,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Q,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Q,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Q,overlineThickness:Q,paintOrder:null,panose1:null,path:null,pathLength:Q,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Et,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Q,pointsAtY:Q,pointsAtZ:Q,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Fr,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Fr,rev:Fr,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Fr,requiredFeatures:Fr,requiredFonts:Fr,requiredFormats:Fr,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Q,specularExponent:Q,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Q,strikethroughThickness:Q,string:null,stroke:null,strokeDashArray:Fr,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Q,strokeOpacity:Q,strokeWidth:null,style:null,surfaceScale:Q,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Fr,tabIndex:Q,tableValues:null,target:null,targetX:Q,targetY:Q,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Fr,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Q,underlineThickness:Q,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Q,values:null,vAlphabetic:Q,vMathematical:Q,vectorEffect:null,vHanging:Q,vIdeographic:Q,version:null,vertAdvY:Q,vertOriginX:Q,vertOriginY:Q,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Q,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:z3}),j3=Oc({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),Y3=Oc({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:W3}),G3=Oc({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),jG=/[A-Z]/g,V3=/-[a-z]/g,YG=/^data[-\w.:]+$/i;function K_(t,e){const n=hh(e);let r=e,i=xr;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&YG.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(V3,VG);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!V3.test(s)){let o=s.replace(jG,GG);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}i=X_}return new i(r,e)}function GG(t){return"-"+t.toLowerCase()}function VG(t){return t.charAt(1).toUpperCase()}const Yp=U3([H3,zG,j3,Y3,G3],"html"),fh=U3([H3,WG,j3,Y3,G3],"svg");function q3(t){const e=[],n=String(t||"");let r=n.indexOf(","),i=0,s=!1;for(;!s;){r===-1&&(r=n.length,s=!0);const o=n.slice(i,r).trim();(o||!s)&&e.push(o),i=r+1,r=n.indexOf(",",i)}return e}function qG(t,e){const n=e||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const X3=/[#.]/g;function XG(t,e){const n=t||"",r={};let i=0,s,o;for(;i<n.length;){X3.lastIndex=i;const a=X3.exec(n),l=n.slice(i,a?a.index:n.length);l&&(s?s==="#"?r.id=l:Array.isArray(r.className)?r.className.push(l):r.className=[l]:o=l,i+=l.length),a&&(s=a[0],i++)}return{type:"element",tagName:o||e||"div",properties:r,children:[]}}function K3(t){const e=String(t||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function KG(t){return t.join(" ").trim()}function Q3(t,e,n){const r=n?eV(n):void 0;function i(s,o,...a){let l;if(s==null){l={type:"root",children:[]};const c=o;a.unshift(c)}else{l=XG(s,e);const c=l.tagName.toLowerCase(),u=r?r.get(c):void 0;if(l.tagName=u||c,QG(o))a.unshift(o);else for(const[d,h]of Object.entries(o))ZG(t,l.properties,d,h)}for(const c of a)Q_(l.children,c);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return i}function QG(t){if(t===null||typeof t!="object"||Array.isArray(t))return!0;if(typeof t.type!="string")return!1;const e=t,n=Object.keys(t);for(const r of n){const i=e[r];if(i&&typeof i=="object"){if(!Array.isArray(i))return!0;const s=i;for(const o of s)if(typeof o!="number"&&typeof o!="string")return!0}}return!!("children"in t&&Array.isArray(t.children))}function ZG(t,e,n,r){const i=K_(t,n);let s;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;s=r}else typeof r=="boolean"?s=r:typeof r=="string"?i.spaceSeparated?s=K3(r):i.commaSeparated?s=q3(r):i.commaOrSpaceSeparated?s=K3(q3(r).join(" ")):s=Z3(i,i.property,r):Array.isArray(r)?s=[...r]:s=i.property==="style"?JG(r):String(r);if(Array.isArray(s)){const o=[];for(const a of s)o.push(Z3(i,i.property,a));s=o}i.property==="className"&&Array.isArray(e.className)&&(s=e.className.concat(s)),e[i.property]=s}}function Q_(t,e){if(e!=null)if(typeof e=="number"||typeof e=="string")t.push({type:"text",value:String(e)});else if(Array.isArray(e))for(const n of e)Q_(t,n);else if(typeof e=="object"&&"type"in e)e.type==="root"?Q_(t,e.children):t.push(e);else throw new Error("Expected node, nodes, or string, got `"+e+"`")}function Z3(t,e,n){if(typeof n=="string"){if(t.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((t.boolean||t.overloadedBoolean)&&(n===""||hh(n)===hh(e)))return!0}return n}function JG(t){const e=[];for(const[n,r]of Object.entries(t))e.push([n,r].join(": "));return e.join("; ")}function eV(t){const e=new Map;for(const n of t)e.set(n.toLowerCase(),n);return e}const tV=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],nV=Q3(Yp,"div"),rV=Q3(fh,"g",tV);function iV(t){const e=String(t),n=[];return{toOffset:i,toPoint:r};function r(s){if(typeof s=="number"&&s>-1&&s<=e.length){let o=0;for(;;){let a=n[o];if(a===void 0){const l=J3(e,n[o-1]);a=l===-1?e.length+1:l+1,n[o]=a}if(a>s)return{line:o+1,column:s-(o>0?n[o-1]:0)+1,offset:s};o++}}}function i(s){if(s&&typeof s.line=="number"&&typeof s.column=="number"&&!Number.isNaN(s.line)&&!Number.isNaN(s.column)){for(;n.length<s.line;){const a=n[n.length-1],l=J3(e,a),c=l===-1?e.length+1:l+1;if(a===c)break;n.push(c)}const o=(s.line>1?n[s.line-2]:0)+s.column-1;if(o<n[s.line-1])return o}}}function J3(t,e){const n=t.indexOf("\r",e),r=t.indexOf(`
`,e);return r===-1?n:n===-1||n+1===r?r:n<r?n:r}const sV={svg:"http://www.w3.org/2000/svg"},eM={}.hasOwnProperty,oV=Object.prototype;function aV(t,e){const n=e||{};return Z_({file:n.file||void 0,location:!1,schema:n.space==="svg"?fh:Yp,verbose:n.verbose||!1},t)}function Z_(t,e){let n;switch(e.nodeName){case"#comment":{const r=e;return n={type:"comment",value:r.data},Gp(t,r,n),n}case"#document":case"#document-fragment":{const r=e,i="mode"in r?r.mode==="quirks"||r.mode==="limited-quirks":!1;if(n={type:"root",children:tM(t,e.childNodes),data:{quirksMode:i}},t.file&&t.location){const s=String(t.file),o=iV(s),a=o.toPoint(0),l=o.toPoint(s.length);n.position={start:a,end:l}}return n}case"#documentType":{const r=e;return n={type:"doctype"},Gp(t,r,n),n}case"#text":{const r=e;return n={type:"text",value:r.value},Gp(t,r,n),n}default:return n=lV(t,e),n}}function tM(t,e){let n=-1;const r=[];for(;++n<e.length;){const i=Z_(t,e[n]);r.push(i)}return r}function lV(t,e){const n=t.schema;t.schema=e.namespaceURI===sV.svg?fh:Yp;let r=-1;const i={};for(;++r<e.attrs.length;){const a=e.attrs[r],l=(a.prefix?a.prefix+":":"")+a.name;eM.call(oV,l)||(i[l]=a.value)}const o=(t.schema.space==="svg"?rV:nV)(e.tagName,i,tM(t,e.childNodes));if(Gp(t,e,o),o.tagName==="template"){const a=e,l=a.sourceCodeLocation,c=l&&l.startTag&&Pc(l.startTag),u=l&&l.endTag&&Pc(l.endTag),d=Z_(t,a.content);c&&u&&t.file&&(d.position={start:c.end,end:u.start}),o.content=d}return t.schema=n,o}function Gp(t,e,n){if("sourceCodeLocation"in e&&e.sourceCodeLocation&&t.file){const r=cV(t,n,e.sourceCodeLocation);r&&(t.location=!0,n.position=r)}}function cV(t,e,n){const r=Pc(n);if(e.type==="element"){const i=e.children[e.children.length-1];if(r&&!n.endTag&&i&&i.position&&i.position.end&&(r.end=Object.assign({},i.position.end)),t.verbose){const s={};let o;if(n.attrs)for(o in n.attrs)eM.call(n.attrs,o)&&(s[K_(t.schema,o).property]=Pc(n.attrs[o]));n.startTag;const a=Pc(n.startTag),l=n.endTag?Pc(n.endTag):void 0,c={opening:a};l&&(c.closing=l),c.properties=s,e.data={position:c}}}return r}function Pc(t){const e=nM({line:t.startLine,column:t.startCol,offset:t.startOffset}),n=nM({line:t.endLine,column:t.endCol,offset:t.endOffset});return e||n?{start:e,end:n}:void 0}function nM(t){return t.line&&t.column?t:void 0}const uV=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Dt="";var w;(function(t){t[t.EOF=-1]="EOF",t[t.NULL=0]="NULL",t[t.TABULATION=9]="TABULATION",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.LINE_FEED=10]="LINE_FEED",t[t.FORM_FEED=12]="FORM_FEED",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_9=57]="DIGIT_9",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",t[t.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_A=97]="LATIN_SMALL_A",t[t.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(w||(w={}));const Er={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function rM(t){return t>=55296&&t<=57343}function dV(t){return t>=56320&&t<=57343}function hV(t,e){return(t-55296)*1024+9216+e}function iM(t){return t!==32&&t!==10&&t!==13&&t!==9&&t!==12&&t>=1&&t<=31||t>=127&&t<=159}function sM(t){return t>=64976&&t<=65007||uV.has(t)}var F;(function(t){t.controlCharacterInInputStream="control-character-in-input-stream",t.noncharacterInInputStream="noncharacter-in-input-stream",t.surrogateInInputStream="surrogate-in-input-stream",t.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",t.endTagWithAttributes="end-tag-with-attributes",t.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",t.unexpectedSolidusInTag="unexpected-solidus-in-tag",t.unexpectedNullCharacter="unexpected-null-character",t.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",t.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",t.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",t.missingEndTagName="missing-end-tag-name",t.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",t.unknownNamedCharacterReference="unknown-named-character-reference",t.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",t.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",t.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",t.eofBeforeTagName="eof-before-tag-name",t.eofInTag="eof-in-tag",t.missingAttributeValue="missing-attribute-value",t.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",t.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",t.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",t.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",t.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",t.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",t.missingDoctypePublicIdentifier="missing-doctype-public-identifier",t.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",t.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",t.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",t.cdataInHtmlContent="cdata-in-html-content",t.incorrectlyOpenedComment="incorrectly-opened-comment",t.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",t.eofInDoctype="eof-in-doctype",t.nestedComment="nested-comment",t.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",t.eofInComment="eof-in-comment",t.incorrectlyClosedComment="incorrectly-closed-comment",t.eofInCdata="eof-in-cdata",t.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",t.nullCharacterReference="null-character-reference",t.surrogateCharacterReference="surrogate-character-reference",t.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",t.controlCharacterReference="control-character-reference",t.noncharacterCharacterReference="noncharacter-character-reference",t.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",t.missingDoctypeName="missing-doctype-name",t.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",t.duplicateAttribute="duplicate-attribute",t.nonConformingDoctype="non-conforming-doctype",t.missingDoctype="missing-doctype",t.misplacedDoctype="misplaced-doctype",t.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",t.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",t.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",t.openElementsLeftAfterEof="open-elements-left-after-eof",t.abandonedHeadElementChild="abandoned-head-element-child",t.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",t.nestedNoscriptInHead="nested-noscript-in-head",t.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(F||(F={}));const fV=65536;class pV{constructor(e){this.handler=e,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=fV,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(e,n){const{line:r,col:i,offset:s}=this,o=i+n,a=s+n;return{code:e,startLine:r,endLine:r,startCol:o,endCol:o,startOffset:a,endOffset:a}}_err(e){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(e,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(e){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(dV(n))return this.pos++,this._addGap(),hV(e,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,w.EOF;return this._err(F.surrogateInInputStream),e}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(e,n){this.html.length>0?this.html+=e:this.html=e,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(e){this.html=this.html.substring(0,this.pos+1)+e+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(e,n){if(this.pos+e.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(e,this.pos);for(let r=0;r<e.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==e.charCodeAt(r))return!1;return!0}peek(e){const n=this.pos+e;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,w.EOF;const r=this.html.charCodeAt(n);return r===w.CARRIAGE_RETURN?w.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,w.EOF;let e=this.html.charCodeAt(this.pos);return e===w.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,w.LINE_FEED):e===w.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,rM(e)&&(e=this._processSurrogate(e)),this.handler.onParseError===null||e>31&&e<127||e===w.LINE_FEED||e===w.CARRIAGE_RETURN||e>159&&e<64976||this._checkForProblematicCharacters(e),e)}_checkForProblematicCharacters(e){iM(e)?this._err(F.controlCharacterInInputStream):sM(e)&&this._err(F.noncharacterInInputStream)}retreat(e){for(this.pos-=e;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var tt;(function(t){t[t.CHARACTER=0]="CHARACTER",t[t.NULL_CHARACTER=1]="NULL_CHARACTER",t[t.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",t[t.START_TAG=3]="START_TAG",t[t.END_TAG=4]="END_TAG",t[t.COMMENT=5]="COMMENT",t[t.DOCTYPE=6]="DOCTYPE",t[t.EOF=7]="EOF",t[t.HIBERNATION=8]="HIBERNATION"})(tt||(tt={}));function oM(t,e){for(let n=t.attrs.length-1;n>=0;n--)if(t.attrs[n].name===e)return t.attrs[n].value;return null}const mV=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(t=>t.charCodeAt(0))),gV=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function bV(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=gV.get(t))!==null&&e!==void 0?e:t}var Cn;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(Cn||(Cn={}));const yV=32;var qo;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(qo||(qo={}));function J_(t){return t>=Cn.ZERO&&t<=Cn.NINE}function _V(t){return t>=Cn.UPPER_A&&t<=Cn.UPPER_F||t>=Cn.LOWER_A&&t<=Cn.LOWER_F}function xV(t){return t>=Cn.UPPER_A&&t<=Cn.UPPER_Z||t>=Cn.LOWER_A&&t<=Cn.LOWER_Z||J_(t)}function EV(t){return t===Cn.EQUALS||xV(t)}var An;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})(An||(An={}));var no;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(no||(no={}));class vV{constructor(e,n,r){this.decodeTree=e,this.emitCodePoint=n,this.errors=r,this.state=An.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=no.Strict}startEntity(e){this.decodeMode=e,this.state=An.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,n){switch(this.state){case An.EntityStart:return e.charCodeAt(n)===Cn.NUM?(this.state=An.NumericStart,this.consumed+=1,this.stateNumericStart(e,n+1)):(this.state=An.NamedEntity,this.stateNamedEntity(e,n));case An.NumericStart:return this.stateNumericStart(e,n);case An.NumericDecimal:return this.stateNumericDecimal(e,n);case An.NumericHex:return this.stateNumericHex(e,n);case An.NamedEntity:return this.stateNamedEntity(e,n)}}stateNumericStart(e,n){return n>=e.length?-1:(e.charCodeAt(n)|yV)===Cn.LOWER_X?(this.state=An.NumericHex,this.consumed+=1,this.stateNumericHex(e,n+1)):(this.state=An.NumericDecimal,this.stateNumericDecimal(e,n))}addToNumericResult(e,n,r,i){if(n!==r){const s=r-n;this.result=this.result*Math.pow(i,s)+Number.parseInt(e.substr(n,s),i),this.consumed+=s}}stateNumericHex(e,n){const r=n;for(;n<e.length;){const i=e.charCodeAt(n);if(J_(i)||_V(i))n+=1;else return this.addToNumericResult(e,r,n,16),this.emitNumericEntity(i,3)}return this.addToNumericResult(e,r,n,16),-1}stateNumericDecimal(e,n){const r=n;for(;n<e.length;){const i=e.charCodeAt(n);if(J_(i))n+=1;else return this.addToNumericResult(e,r,n,10),this.emitNumericEntity(i,2)}return this.addToNumericResult(e,r,n,10),-1}emitNumericEntity(e,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===Cn.SEMI)this.consumed+=1;else if(this.decodeMode===no.Strict)return 0;return this.emitCodePoint(bV(this.result),this.consumed),this.errors&&(e!==Cn.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,n){const{decodeTree:r}=this;let i=r[this.treeIndex],s=(i&qo.VALUE_LENGTH)>>14;for(;n<e.length;n++,this.excess++){const o=e.charCodeAt(n);if(this.treeIndex=wV(r,i,this.treeIndex+Math.max(1,s),o),this.treeIndex<0)return this.result===0||this.decodeMode===no.Attribute&&(s===0||EV(o))?0:this.emitNotTerminatedNamedEntity();if(i=r[this.treeIndex],s=(i&qo.VALUE_LENGTH)>>14,s!==0){if(o===Cn.SEMI)return this.emitNamedEntityData(this.treeIndex,s,this.consumed+this.excess);this.decodeMode!==no.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;const{result:n,decodeTree:r}=this,i=(r[n]&qo.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,i,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,n,r){const{decodeTree:i}=this;return this.emitCodePoint(n===1?i[e]&~qo.VALUE_LENGTH:i[e+1],r),n===3&&this.emitCodePoint(i[e+2],r),r}end(){var e;switch(this.state){case An.NamedEntity:return this.result!==0&&(this.decodeMode!==no.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case An.NumericDecimal:return this.emitNumericEntity(0,2);case An.NumericHex:return this.emitNumericEntity(0,3);case An.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case An.EntityStart:return 0}}}function wV(t,e,n,r){const i=(e&qo.BRANCH_LENGTH)>>7,s=e&qo.JUMP_TABLE;if(i===0)return s!==0&&r===s?n:-1;if(s){const l=r-s;return l<0||l>=i?-1:t[n+l]-1}let o=n,a=o+i-1;for(;o<=a;){const l=o+a>>>1,c=t[l];if(c<r)o=l+1;else if(c>r)a=l-1;else return t[l+i]}return-1}var j;(function(t){t.HTML="http://www.w3.org/1999/xhtml",t.MATHML="http://www.w3.org/1998/Math/MathML",t.SVG="http://www.w3.org/2000/svg",t.XLINK="http://www.w3.org/1999/xlink",t.XML="http://www.w3.org/XML/1998/namespace",t.XMLNS="http://www.w3.org/2000/xmlns/"})(j||(j={}));var hl;(function(t){t.TYPE="type",t.ACTION="action",t.ENCODING="encoding",t.PROMPT="prompt",t.NAME="name",t.COLOR="color",t.FACE="face",t.SIZE="size"})(hl||(hl={}));var ni;(function(t){t.NO_QUIRKS="no-quirks",t.QUIRKS="quirks",t.LIMITED_QUIRKS="limited-quirks"})(ni||(ni={}));var P;(function(t){t.A="a",t.ADDRESS="address",t.ANNOTATION_XML="annotation-xml",t.APPLET="applet",t.AREA="area",t.ARTICLE="article",t.ASIDE="aside",t.B="b",t.BASE="base",t.BASEFONT="basefont",t.BGSOUND="bgsound",t.BIG="big",t.BLOCKQUOTE="blockquote",t.BODY="body",t.BR="br",t.BUTTON="button",t.CAPTION="caption",t.CENTER="center",t.CODE="code",t.COL="col",t.COLGROUP="colgroup",t.DD="dd",t.DESC="desc",t.DETAILS="details",t.DIALOG="dialog",t.DIR="dir",t.DIV="div",t.DL="dl",t.DT="dt",t.EM="em",t.EMBED="embed",t.FIELDSET="fieldset",t.FIGCAPTION="figcaption",t.FIGURE="figure",t.FONT="font",t.FOOTER="footer",t.FOREIGN_OBJECT="foreignObject",t.FORM="form",t.FRAME="frame",t.FRAMESET="frameset",t.H1="h1",t.H2="h2",t.H3="h3",t.H4="h4",t.H5="h5",t.H6="h6",t.HEAD="head",t.HEADER="header",t.HGROUP="hgroup",t.HR="hr",t.HTML="html",t.I="i",t.IMG="img",t.IMAGE="image",t.INPUT="input",t.IFRAME="iframe",t.KEYGEN="keygen",t.LABEL="label",t.LI="li",t.LINK="link",t.LISTING="listing",t.MAIN="main",t.MALIGNMARK="malignmark",t.MARQUEE="marquee",t.MATH="math",t.MENU="menu",t.META="meta",t.MGLYPH="mglyph",t.MI="mi",t.MO="mo",t.MN="mn",t.MS="ms",t.MTEXT="mtext",t.NAV="nav",t.NOBR="nobr",t.NOFRAMES="noframes",t.NOEMBED="noembed",t.NOSCRIPT="noscript",t.OBJECT="object",t.OL="ol",t.OPTGROUP="optgroup",t.OPTION="option",t.P="p",t.PARAM="param",t.PLAINTEXT="plaintext",t.PRE="pre",t.RB="rb",t.RP="rp",t.RT="rt",t.RTC="rtc",t.RUBY="ruby",t.S="s",t.SCRIPT="script",t.SEARCH="search",t.SECTION="section",t.SELECT="select",t.SOURCE="source",t.SMALL="small",t.SPAN="span",t.STRIKE="strike",t.STRONG="strong",t.STYLE="style",t.SUB="sub",t.SUMMARY="summary",t.SUP="sup",t.TABLE="table",t.TBODY="tbody",t.TEMPLATE="template",t.TEXTAREA="textarea",t.TFOOT="tfoot",t.TD="td",t.TH="th",t.THEAD="thead",t.TITLE="title",t.TR="tr",t.TRACK="track",t.TT="tt",t.U="u",t.UL="ul",t.SVG="svg",t.VAR="var",t.WBR="wbr",t.XMP="xmp"})(P||(P={}));var m;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A=1]="A",t[t.ADDRESS=2]="ADDRESS",t[t.ANNOTATION_XML=3]="ANNOTATION_XML",t[t.APPLET=4]="APPLET",t[t.AREA=5]="AREA",t[t.ARTICLE=6]="ARTICLE",t[t.ASIDE=7]="ASIDE",t[t.B=8]="B",t[t.BASE=9]="BASE",t[t.BASEFONT=10]="BASEFONT",t[t.BGSOUND=11]="BGSOUND",t[t.BIG=12]="BIG",t[t.BLOCKQUOTE=13]="BLOCKQUOTE",t[t.BODY=14]="BODY",t[t.BR=15]="BR",t[t.BUTTON=16]="BUTTON",t[t.CAPTION=17]="CAPTION",t[t.CENTER=18]="CENTER",t[t.CODE=19]="CODE",t[t.COL=20]="COL",t[t.COLGROUP=21]="COLGROUP",t[t.DD=22]="DD",t[t.DESC=23]="DESC",t[t.DETAILS=24]="DETAILS",t[t.DIALOG=25]="DIALOG",t[t.DIR=26]="DIR",t[t.DIV=27]="DIV",t[t.DL=28]="DL",t[t.DT=29]="DT",t[t.EM=30]="EM",t[t.EMBED=31]="EMBED",t[t.FIELDSET=32]="FIELDSET",t[t.FIGCAPTION=33]="FIGCAPTION",t[t.FIGURE=34]="FIGURE",t[t.FONT=35]="FONT",t[t.FOOTER=36]="FOOTER",t[t.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",t[t.FORM=38]="FORM",t[t.FRAME=39]="FRAME",t[t.FRAMESET=40]="FRAMESET",t[t.H1=41]="H1",t[t.H2=42]="H2",t[t.H3=43]="H3",t[t.H4=44]="H4",t[t.H5=45]="H5",t[t.H6=46]="H6",t[t.HEAD=47]="HEAD",t[t.HEADER=48]="HEADER",t[t.HGROUP=49]="HGROUP",t[t.HR=50]="HR",t[t.HTML=51]="HTML",t[t.I=52]="I",t[t.IMG=53]="IMG",t[t.IMAGE=54]="IMAGE",t[t.INPUT=55]="INPUT",t[t.IFRAME=56]="IFRAME",t[t.KEYGEN=57]="KEYGEN",t[t.LABEL=58]="LABEL",t[t.LI=59]="LI",t[t.LINK=60]="LINK",t[t.LISTING=61]="LISTING",t[t.MAIN=62]="MAIN",t[t.MALIGNMARK=63]="MALIGNMARK",t[t.MARQUEE=64]="MARQUEE",t[t.MATH=65]="MATH",t[t.MENU=66]="MENU",t[t.META=67]="META",t[t.MGLYPH=68]="MGLYPH",t[t.MI=69]="MI",t[t.MO=70]="MO",t[t.MN=71]="MN",t[t.MS=72]="MS",t[t.MTEXT=73]="MTEXT",t[t.NAV=74]="NAV",t[t.NOBR=75]="NOBR",t[t.NOFRAMES=76]="NOFRAMES",t[t.NOEMBED=77]="NOEMBED",t[t.NOSCRIPT=78]="NOSCRIPT",t[t.OBJECT=79]="OBJECT",t[t.OL=80]="OL",t[t.OPTGROUP=81]="OPTGROUP",t[t.OPTION=82]="OPTION",t[t.P=83]="P",t[t.PARAM=84]="PARAM",t[t.PLAINTEXT=85]="PLAINTEXT",t[t.PRE=86]="PRE",t[t.RB=87]="RB",t[t.RP=88]="RP",t[t.RT=89]="RT",t[t.RTC=90]="RTC",t[t.RUBY=91]="RUBY",t[t.S=92]="S",t[t.SCRIPT=93]="SCRIPT",t[t.SEARCH=94]="SEARCH",t[t.SECTION=95]="SECTION",t[t.SELECT=96]="SELECT",t[t.SOURCE=97]="SOURCE",t[t.SMALL=98]="SMALL",t[t.SPAN=99]="SPAN",t[t.STRIKE=100]="STRIKE",t[t.STRONG=101]="STRONG",t[t.STYLE=102]="STYLE",t[t.SUB=103]="SUB",t[t.SUMMARY=104]="SUMMARY",t[t.SUP=105]="SUP",t[t.TABLE=106]="TABLE",t[t.TBODY=107]="TBODY",t[t.TEMPLATE=108]="TEMPLATE",t[t.TEXTAREA=109]="TEXTAREA",t[t.TFOOT=110]="TFOOT",t[t.TD=111]="TD",t[t.TH=112]="TH",t[t.THEAD=113]="THEAD",t[t.TITLE=114]="TITLE",t[t.TR=115]="TR",t[t.TRACK=116]="TRACK",t[t.TT=117]="TT",t[t.U=118]="U",t[t.UL=119]="UL",t[t.SVG=120]="SVG",t[t.VAR=121]="VAR",t[t.WBR=122]="WBR",t[t.XMP=123]="XMP"})(m||(m={}));const kV=new Map([[P.A,m.A],[P.ADDRESS,m.ADDRESS],[P.ANNOTATION_XML,m.ANNOTATION_XML],[P.APPLET,m.APPLET],[P.AREA,m.AREA],[P.ARTICLE,m.ARTICLE],[P.ASIDE,m.ASIDE],[P.B,m.B],[P.BASE,m.BASE],[P.BASEFONT,m.BASEFONT],[P.BGSOUND,m.BGSOUND],[P.BIG,m.BIG],[P.BLOCKQUOTE,m.BLOCKQUOTE],[P.BODY,m.BODY],[P.BR,m.BR],[P.BUTTON,m.BUTTON],[P.CAPTION,m.CAPTION],[P.CENTER,m.CENTER],[P.CODE,m.CODE],[P.COL,m.COL],[P.COLGROUP,m.COLGROUP],[P.DD,m.DD],[P.DESC,m.DESC],[P.DETAILS,m.DETAILS],[P.DIALOG,m.DIALOG],[P.DIR,m.DIR],[P.DIV,m.DIV],[P.DL,m.DL],[P.DT,m.DT],[P.EM,m.EM],[P.EMBED,m.EMBED],[P.FIELDSET,m.FIELDSET],[P.FIGCAPTION,m.FIGCAPTION],[P.FIGURE,m.FIGURE],[P.FONT,m.FONT],[P.FOOTER,m.FOOTER],[P.FOREIGN_OBJECT,m.FOREIGN_OBJECT],[P.FORM,m.FORM],[P.FRAME,m.FRAME],[P.FRAMESET,m.FRAMESET],[P.H1,m.H1],[P.H2,m.H2],[P.H3,m.H3],[P.H4,m.H4],[P.H5,m.H5],[P.H6,m.H6],[P.HEAD,m.HEAD],[P.HEADER,m.HEADER],[P.HGROUP,m.HGROUP],[P.HR,m.HR],[P.HTML,m.HTML],[P.I,m.I],[P.IMG,m.IMG],[P.IMAGE,m.IMAGE],[P.INPUT,m.INPUT],[P.IFRAME,m.IFRAME],[P.KEYGEN,m.KEYGEN],[P.LABEL,m.LABEL],[P.LI,m.LI],[P.LINK,m.LINK],[P.LISTING,m.LISTING],[P.MAIN,m.MAIN],[P.MALIGNMARK,m.MALIGNMARK],[P.MARQUEE,m.MARQUEE],[P.MATH,m.MATH],[P.MENU,m.MENU],[P.META,m.META],[P.MGLYPH,m.MGLYPH],[P.MI,m.MI],[P.MO,m.MO],[P.MN,m.MN],[P.MS,m.MS],[P.MTEXT,m.MTEXT],[P.NAV,m.NAV],[P.NOBR,m.NOBR],[P.NOFRAMES,m.NOFRAMES],[P.NOEMBED,m.NOEMBED],[P.NOSCRIPT,m.NOSCRIPT],[P.OBJECT,m.OBJECT],[P.OL,m.OL],[P.OPTGROUP,m.OPTGROUP],[P.OPTION,m.OPTION],[P.P,m.P],[P.PARAM,m.PARAM],[P.PLAINTEXT,m.PLAINTEXT],[P.PRE,m.PRE],[P.RB,m.RB],[P.RP,m.RP],[P.RT,m.RT],[P.RTC,m.RTC],[P.RUBY,m.RUBY],[P.S,m.S],[P.SCRIPT,m.SCRIPT],[P.SEARCH,m.SEARCH],[P.SECTION,m.SECTION],[P.SELECT,m.SELECT],[P.SOURCE,m.SOURCE],[P.SMALL,m.SMALL],[P.SPAN,m.SPAN],[P.STRIKE,m.STRIKE],[P.STRONG,m.STRONG],[P.STYLE,m.STYLE],[P.SUB,m.SUB],[P.SUMMARY,m.SUMMARY],[P.SUP,m.SUP],[P.TABLE,m.TABLE],[P.TBODY,m.TBODY],[P.TEMPLATE,m.TEMPLATE],[P.TEXTAREA,m.TEXTAREA],[P.TFOOT,m.TFOOT],[P.TD,m.TD],[P.TH,m.TH],[P.THEAD,m.THEAD],[P.TITLE,m.TITLE],[P.TR,m.TR],[P.TRACK,m.TRACK],[P.TT,m.TT],[P.U,m.U],[P.UL,m.UL],[P.SVG,m.SVG],[P.VAR,m.VAR],[P.WBR,m.WBR],[P.XMP,m.XMP]]);function Vp(t){var e;return(e=kV.get(t))!==null&&e!==void 0?e:m.UNKNOWN}const G=m,TV={[j.HTML]:new Set([G.ADDRESS,G.APPLET,G.AREA,G.ARTICLE,G.ASIDE,G.BASE,G.BASEFONT,G.BGSOUND,G.BLOCKQUOTE,G.BODY,G.BR,G.BUTTON,G.CAPTION,G.CENTER,G.COL,G.COLGROUP,G.DD,G.DETAILS,G.DIR,G.DIV,G.DL,G.DT,G.EMBED,G.FIELDSET,G.FIGCAPTION,G.FIGURE,G.FOOTER,G.FORM,G.FRAME,G.FRAMESET,G.H1,G.H2,G.H3,G.H4,G.H5,G.H6,G.HEAD,G.HEADER,G.HGROUP,G.HR,G.HTML,G.IFRAME,G.IMG,G.INPUT,G.LI,G.LINK,G.LISTING,G.MAIN,G.MARQUEE,G.MENU,G.META,G.NAV,G.NOEMBED,G.NOFRAMES,G.NOSCRIPT,G.OBJECT,G.OL,G.P,G.PARAM,G.PLAINTEXT,G.PRE,G.SCRIPT,G.SECTION,G.SELECT,G.SOURCE,G.STYLE,G.SUMMARY,G.TABLE,G.TBODY,G.TD,G.TEMPLATE,G.TEXTAREA,G.TFOOT,G.TH,G.THEAD,G.TITLE,G.TR,G.TRACK,G.UL,G.WBR,G.XMP]),[j.MATHML]:new Set([G.MI,G.MO,G.MN,G.MS,G.MTEXT,G.ANNOTATION_XML]),[j.SVG]:new Set([G.TITLE,G.FOREIGN_OBJECT,G.DESC]),[j.XLINK]:new Set,[j.XML]:new Set,[j.XMLNS]:new Set},ex=new Set([G.H1,G.H2,G.H3,G.H4,G.H5,G.H6]);P.STYLE,P.SCRIPT,P.XMP,P.IFRAME,P.NOEMBED,P.NOFRAMES,P.PLAINTEXT;var k;(function(t){t[t.DATA=0]="DATA",t[t.RCDATA=1]="RCDATA",t[t.RAWTEXT=2]="RAWTEXT",t[t.SCRIPT_DATA=3]="SCRIPT_DATA",t[t.PLAINTEXT=4]="PLAINTEXT",t[t.TAG_OPEN=5]="TAG_OPEN",t[t.END_TAG_OPEN=6]="END_TAG_OPEN",t[t.TAG_NAME=7]="TAG_NAME",t[t.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",t[t.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",t[t.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",t[t.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",t[t.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",t[t.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",t[t.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",t[t.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",t[t.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",t[t.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",t[t.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",t[t.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",t[t.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",t[t.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",t[t.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",t[t.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",t[t.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",t[t.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",t[t.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",t[t.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",t[t.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",t[t.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",t[t.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",t[t.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",t[t.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",t[t.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",t[t.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",t[t.BOGUS_COMMENT=40]="BOGUS_COMMENT",t[t.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",t[t.COMMENT_START=42]="COMMENT_START",t[t.COMMENT_START_DASH=43]="COMMENT_START_DASH",t[t.COMMENT=44]="COMMENT",t[t.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",t[t.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",t[t.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",t[t.COMMENT_END_DASH=49]="COMMENT_END_DASH",t[t.COMMENT_END=50]="COMMENT_END",t[t.COMMENT_END_BANG=51]="COMMENT_END_BANG",t[t.DOCTYPE=52]="DOCTYPE",t[t.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",t[t.DOCTYPE_NAME=54]="DOCTYPE_NAME",t[t.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",t[t.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",t[t.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",t[t.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",t[t.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",t[t.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",t[t.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",t[t.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",t[t.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",t[t.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",t[t.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",t[t.CDATA_SECTION=68]="CDATA_SECTION",t[t.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",t[t.CDATA_SECTION_END=70]="CDATA_SECTION_END",t[t.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",t[t.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(k||(k={}));const vr={DATA:k.DATA,RCDATA:k.RCDATA,RAWTEXT:k.RAWTEXT,SCRIPT_DATA:k.SCRIPT_DATA,PLAINTEXT:k.PLAINTEXT,CDATA_SECTION:k.CDATA_SECTION};function SV(t){return t>=w.DIGIT_0&&t<=w.DIGIT_9}function ph(t){return t>=w.LATIN_CAPITAL_A&&t<=w.LATIN_CAPITAL_Z}function CV(t){return t>=w.LATIN_SMALL_A&&t<=w.LATIN_SMALL_Z}function Xo(t){return CV(t)||ph(t)}function aM(t){return Xo(t)||SV(t)}function qp(t){return t+32}function lM(t){return t===w.SPACE||t===w.LINE_FEED||t===w.TABULATION||t===w.FORM_FEED}function cM(t){return lM(t)||t===w.SOLIDUS||t===w.GREATER_THAN_SIGN}function AV(t){return t===w.NULL?F.nullCharacterReference:t>1114111?F.characterReferenceOutsideUnicodeRange:rM(t)?F.surrogateCharacterReference:sM(t)?F.noncharacterCharacterReference:iM(t)||t===w.CARRIAGE_RETURN?F.controlCharacterReference:null}class IV{constructor(e,n){this.options=e,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=k.DATA,this.returnState=k.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new pV(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new vV(mV,(r,i)=>{this.preprocessor.pos=this.entityStartPos+i-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(F.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err(F.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const i=AV(r);i&&this._err(i,1)}}:void 0)}_err(e,n=0){var r,i;(i=(r=this.handler).onParseError)===null||i===void 0||i.call(r,this.preprocessor.getError(e,n))}getCurrentLocation(e){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-e,startOffset:this.preprocessor.offset-e,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const e=this._consume();this._ensureHibernation()||this._callState(e)}this.inLoop=!1}}pause(){this.paused=!0}resume(e){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||e==null||e())}write(e,n,r){this.active=!0,this.preprocessor.write(e,n),this._runParsingLoop(),this.paused||r==null||r()}insertHtmlAtCurrentPos(e){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(e),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(e){this.consumedAfterSnapshot+=e;for(let n=0;n<e;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(e,n){return this.preprocessor.startsWith(e,n)?(this._advanceBy(e.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:tt.START_TAG,tagName:"",tagID:m.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:tt.END_TAG,tagName:"",tagID:m.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(e){this.currentToken={type:tt.COMMENT,data:"",location:this.getCurrentLocation(e)}}_createDoctypeToken(e){this.currentToken={type:tt.DOCTYPE,name:e,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(e,n){this.currentCharacterToken={type:e,chars:n,location:this.currentLocation}}_createAttr(e){this.currentAttr={name:e,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var e,n;const r=this.currentToken;if(oM(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const i=(e=(n=r.location).attrs)!==null&&e!==void 0?e:n.attrs=Object.create(null);i[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(F.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(e){this._emitCurrentCharacterToken(e.location),this.currentToken=null,e.location&&(e.location.endLine=this.preprocessor.line,e.location.endCol=this.preprocessor.col+1,e.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const e=this.currentToken;this.prepareToken(e),e.tagID=Vp(e.tagName),e.type===tt.START_TAG?(this.lastStartTagName=e.tagName,this.handler.onStartTag(e)):(e.attrs.length>0&&this._err(F.endTagWithAttributes),e.selfClosing&&this._err(F.endTagWithTrailingSolidus),this.handler.onEndTag(e)),this.preprocessor.dropParsedChunk()}emitCurrentComment(e){this.prepareToken(e),this.handler.onComment(e),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(e){this.prepareToken(e),this.handler.onDoctype(e),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(e){if(this.currentCharacterToken){switch(e&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=e.startLine,this.currentCharacterToken.location.endCol=e.startCol,this.currentCharacterToken.location.endOffset=e.startOffset),this.currentCharacterToken.type){case tt.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case tt.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case tt.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const e=this.getCurrentLocation(0);e&&(e.endLine=e.startLine,e.endCol=e.startCol,e.endOffset=e.startOffset),this._emitCurrentCharacterToken(e),this.handler.onEof({type:tt.EOF,location:e}),this.active=!1}_appendCharToCurrentCharacterToken(e,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===e){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(e,n)}_emitCodePoint(e){const n=lM(e)?tt.WHITESPACE_CHARACTER:e===w.NULL?tt.NULL_CHARACTER:tt.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(e))}_emitChars(e){this._appendCharToCurrentCharacterToken(tt.CHARACTER,e)}_startCharacterReference(){this.returnState=this.state,this.state=k.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?no.Attribute:no.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===k.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===k.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===k.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(e){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(e):this._emitCodePoint(e)}_callState(e){switch(this.state){case k.DATA:{this._stateData(e);break}case k.RCDATA:{this._stateRcdata(e);break}case k.RAWTEXT:{this._stateRawtext(e);break}case k.SCRIPT_DATA:{this._stateScriptData(e);break}case k.PLAINTEXT:{this._statePlaintext(e);break}case k.TAG_OPEN:{this._stateTagOpen(e);break}case k.END_TAG_OPEN:{this._stateEndTagOpen(e);break}case k.TAG_NAME:{this._stateTagName(e);break}case k.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(e);break}case k.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(e);break}case k.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(e);break}case k.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(e);break}case k.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(e);break}case k.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(e);break}case k.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(e);break}case k.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(e);break}case k.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(e);break}case k.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(e);break}case k.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(e);break}case k.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(e);break}case k.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(e);break}case k.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(e);break}case k.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(e);break}case k.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(e);break}case k.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(e);break}case k.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(e);break}case k.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(e);break}case k.ATTRIBUTE_NAME:{this._stateAttributeName(e);break}case k.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(e);break}case k.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(e);break}case k.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(e);break}case k.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(e);break}case k.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(e);break}case k.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(e);break}case k.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(e);break}case k.BOGUS_COMMENT:{this._stateBogusComment(e);break}case k.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(e);break}case k.COMMENT_START:{this._stateCommentStart(e);break}case k.COMMENT_START_DASH:{this._stateCommentStartDash(e);break}case k.COMMENT:{this._stateComment(e);break}case k.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(e);break}case k.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(e);break}case k.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(e);break}case k.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(e);break}case k.COMMENT_END_DASH:{this._stateCommentEndDash(e);break}case k.COMMENT_END:{this._stateCommentEnd(e);break}case k.COMMENT_END_BANG:{this._stateCommentEndBang(e);break}case k.DOCTYPE:{this._stateDoctype(e);break}case k.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(e);break}case k.DOCTYPE_NAME:{this._stateDoctypeName(e);break}case k.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(e);break}case k.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(e);break}case k.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(e);break}case k.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(e);break}case k.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(e);break}case k.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(e);break}case k.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(e);break}case k.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(e);break}case k.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(e);break}case k.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(e);break}case k.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(e);break}case k.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(e);break}case k.BOGUS_DOCTYPE:{this._stateBogusDoctype(e);break}case k.CDATA_SECTION:{this._stateCdataSection(e);break}case k.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(e);break}case k.CDATA_SECTION_END:{this._stateCdataSectionEnd(e);break}case k.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case k.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(e);break}default:throw new Error("Unknown state")}}_stateData(e){switch(e){case w.LESS_THAN_SIGN:{this.state=k.TAG_OPEN;break}case w.AMPERSAND:{this._startCharacterReference();break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitCodePoint(e);break}case w.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRcdata(e){switch(e){case w.AMPERSAND:{this._startCharacterReference();break}case w.LESS_THAN_SIGN:{this.state=k.RCDATA_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateRawtext(e){switch(e){case w.LESS_THAN_SIGN:{this.state=k.RAWTEXT_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptData(e){switch(e){case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_statePlaintext(e){switch(e){case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateTagOpen(e){if(Xo(e))this._createStartTagToken(),this.state=k.TAG_NAME,this._stateTagName(e);else switch(e){case w.EXCLAMATION_MARK:{this.state=k.MARKUP_DECLARATION_OPEN;break}case w.SOLIDUS:{this.state=k.END_TAG_OPEN;break}case w.QUESTION_MARK:{this._err(F.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=k.BOGUS_COMMENT,this._stateBogusComment(e);break}case w.EOF:{this._err(F.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(F.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=k.DATA,this._stateData(e)}}_stateEndTagOpen(e){if(Xo(e))this._createEndTagToken(),this.state=k.TAG_NAME,this._stateTagName(e);else switch(e){case w.GREATER_THAN_SIGN:{this._err(F.missingEndTagName),this.state=k.DATA;break}case w.EOF:{this._err(F.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(F.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=k.BOGUS_COMMENT,this._stateBogusComment(e)}}_stateTagName(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.BEFORE_ATTRIBUTE_NAME;break}case w.SOLIDUS:{this.state=k.SELF_CLOSING_START_TAG;break}case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentTagToken();break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.tagName+=Dt;break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(ph(e)?qp(e):e)}}_stateRcdataLessThanSign(e){e===w.SOLIDUS?this.state=k.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=k.RCDATA,this._stateRcdata(e))}_stateRcdataEndTagOpen(e){Xo(e)?(this.state=k.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(e)):(this._emitChars("</"),this.state=k.RCDATA,this._stateRcdata(e))}handleSpecialEndTag(e){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=k.BEFORE_ATTRIBUTE_NAME,!1;case w.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=k.SELF_CLOSING_START_TAG,!1;case w.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=k.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=k.RCDATA,this._stateRcdata(e))}_stateRawtextLessThanSign(e){e===w.SOLIDUS?this.state=k.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=k.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagOpen(e){Xo(e)?(this.state=k.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(e)):(this._emitChars("</"),this.state=k.RAWTEXT,this._stateRawtext(e))}_stateRawtextEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=k.RAWTEXT,this._stateRawtext(e))}_stateScriptDataLessThanSign(e){switch(e){case w.SOLIDUS:{this.state=k.SCRIPT_DATA_END_TAG_OPEN;break}case w.EXCLAMATION_MARK:{this.state=k.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=k.SCRIPT_DATA,this._stateScriptData(e)}}_stateScriptDataEndTagOpen(e){Xo(e)?(this.state=k.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(e)):(this._emitChars("</"),this.state=k.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=k.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStart(e){e===w.HYPHEN_MINUS?(this.state=k.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=k.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscapeStartDash(e){e===w.HYPHEN_MINUS?(this.state=k.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=k.SCRIPT_DATA,this._stateScriptData(e))}_stateScriptDataEscaped(e){switch(e){case w.HYPHEN_MINUS:{this.state=k.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataEscapedDash(e){switch(e){case w.HYPHEN_MINUS:{this.state=k.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.state=k.SCRIPT_DATA_ESCAPED,this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=k.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedDashDash(e){switch(e){case w.HYPHEN_MINUS:{this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case w.GREATER_THAN_SIGN:{this.state=k.SCRIPT_DATA,this._emitChars(">");break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.state=k.SCRIPT_DATA_ESCAPED,this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=k.SCRIPT_DATA_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataEscapedLessThanSign(e){e===w.SOLIDUS?this.state=k.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Xo(e)?(this._emitChars("<"),this.state=k.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(e)):(this._emitChars("<"),this.state=k.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagOpen(e){Xo(e)?(this.state=k.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(e)):(this._emitChars("</"),this.state=k.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataEscapedEndTagName(e){this.handleSpecialEndTag(e)&&(this._emitChars("</"),this.state=k.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscapeStart(e){if(this.preprocessor.startsWith(Er.SCRIPT,!1)&&cM(this.preprocessor.peek(Er.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Er.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=k.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(e))}_stateScriptDataDoubleEscaped(e){switch(e){case w.HYPHEN_MINUS:{this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case w.NULL:{this._err(F.unexpectedNullCharacter),this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDash(e){switch(e){case w.HYPHEN_MINUS:{this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedDashDash(e){switch(e){case w.HYPHEN_MINUS:{this._emitChars("-");break}case w.LESS_THAN_SIGN:{this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case w.GREATER_THAN_SIGN:{this.state=k.SCRIPT_DATA,this._emitChars(">");break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Dt);break}case w.EOF:{this._err(F.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(e)}}_stateScriptDataDoubleEscapedLessThanSign(e){e===w.SOLIDUS?(this.state=k.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateScriptDataDoubleEscapeEnd(e){if(this.preprocessor.startsWith(Er.SCRIPT,!1)&&cM(this.preprocessor.peek(Er.SCRIPT.length))){this._emitCodePoint(e);for(let n=0;n<Er.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=k.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=k.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(e))}_stateBeforeAttributeName(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.SOLIDUS:case w.GREATER_THAN_SIGN:case w.EOF:{this.state=k.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case w.EQUALS_SIGN:{this._err(F.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=k.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=k.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateAttributeName(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:case w.SOLIDUS:case w.GREATER_THAN_SIGN:case w.EOF:{this._leaveAttrName(),this.state=k.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(e);break}case w.EQUALS_SIGN:{this._leaveAttrName(),this.state=k.BEFORE_ATTRIBUTE_VALUE;break}case w.QUOTATION_MARK:case w.APOSTROPHE:case w.LESS_THAN_SIGN:{this._err(F.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(e);break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.currentAttr.name+=Dt;break}default:this.currentAttr.name+=String.fromCodePoint(ph(e)?qp(e):e)}}_stateAfterAttributeName(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.SOLIDUS:{this.state=k.SELF_CLOSING_START_TAG;break}case w.EQUALS_SIGN:{this.state=k.BEFORE_ATTRIBUTE_VALUE;break}case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentTagToken();break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=k.ATTRIBUTE_NAME,this._stateAttributeName(e)}}_stateBeforeAttributeValue(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.QUOTATION_MARK:{this.state=k.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case w.APOSTROPHE:{this.state=k.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case w.GREATER_THAN_SIGN:{this._err(F.missingAttributeValue),this.state=k.DATA,this.emitCurrentTagToken();break}default:this.state=k.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(e)}}_stateAttributeValueDoubleQuoted(e){switch(e){case w.QUOTATION_MARK:{this.state=k.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case w.AMPERSAND:{this._startCharacterReference();break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.currentAttr.value+=Dt;break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueSingleQuoted(e){switch(e){case w.APOSTROPHE:{this.state=k.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case w.AMPERSAND:{this._startCharacterReference();break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.currentAttr.value+=Dt;break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAttributeValueUnquoted(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this._leaveAttrValue(),this.state=k.BEFORE_ATTRIBUTE_NAME;break}case w.AMPERSAND:{this._startCharacterReference();break}case w.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=k.DATA,this.emitCurrentTagToken();break}case w.NULL:{this._err(F.unexpectedNullCharacter),this.currentAttr.value+=Dt;break}case w.QUOTATION_MARK:case w.APOSTROPHE:case w.LESS_THAN_SIGN:case w.EQUALS_SIGN:case w.GRAVE_ACCENT:{this._err(F.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(e);break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(e)}}_stateAfterAttributeValueQuoted(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this._leaveAttrValue(),this.state=k.BEFORE_ATTRIBUTE_NAME;break}case w.SOLIDUS:{this._leaveAttrValue(),this.state=k.SELF_CLOSING_START_TAG;break}case w.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=k.DATA,this.emitCurrentTagToken();break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this._err(F.missingWhitespaceBetweenAttributes),this.state=k.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateSelfClosingStartTag(e){switch(e){case w.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=k.DATA,this.emitCurrentTagToken();break}case w.EOF:{this._err(F.eofInTag),this._emitEOFToken();break}default:this._err(F.unexpectedSolidusInTag),this.state=k.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(e)}}_stateBogusComment(e){const n=this.currentToken;switch(e){case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentComment(n);break}case w.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.data+=Dt;break}default:n.data+=String.fromCodePoint(e)}}_stateMarkupDeclarationOpen(e){this._consumeSequenceIfMatch(Er.DASH_DASH,!0)?(this._createCommentToken(Er.DASH_DASH.length+1),this.state=k.COMMENT_START):this._consumeSequenceIfMatch(Er.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Er.DOCTYPE.length+1),this.state=k.DOCTYPE):this._consumeSequenceIfMatch(Er.CDATA_START,!0)?this.inForeignNode?this.state=k.CDATA_SECTION:(this._err(F.cdataInHtmlContent),this._createCommentToken(Er.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=k.BOGUS_COMMENT):this._ensureHibernation()||(this._err(F.incorrectlyOpenedComment),this._createCommentToken(2),this.state=k.BOGUS_COMMENT,this._stateBogusComment(e))}_stateCommentStart(e){switch(e){case w.HYPHEN_MINUS:{this.state=k.COMMENT_START_DASH;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptClosingOfEmptyComment),this.state=k.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=k.COMMENT,this._stateComment(e)}}_stateCommentStartDash(e){const n=this.currentToken;switch(e){case w.HYPHEN_MINUS:{this.state=k.COMMENT_END;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptClosingOfEmptyComment),this.state=k.DATA,this.emitCurrentComment(n);break}case w.EOF:{this._err(F.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=k.COMMENT,this._stateComment(e)}}_stateComment(e){const n=this.currentToken;switch(e){case w.HYPHEN_MINUS:{this.state=k.COMMENT_END_DASH;break}case w.LESS_THAN_SIGN:{n.data+="<",this.state=k.COMMENT_LESS_THAN_SIGN;break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.data+=Dt;break}case w.EOF:{this._err(F.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(e)}}_stateCommentLessThanSign(e){const n=this.currentToken;switch(e){case w.EXCLAMATION_MARK:{n.data+="!",this.state=k.COMMENT_LESS_THAN_SIGN_BANG;break}case w.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=k.COMMENT,this._stateComment(e)}}_stateCommentLessThanSignBang(e){e===w.HYPHEN_MINUS?this.state=k.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=k.COMMENT,this._stateComment(e))}_stateCommentLessThanSignBangDash(e){e===w.HYPHEN_MINUS?this.state=k.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=k.COMMENT_END_DASH,this._stateCommentEndDash(e))}_stateCommentLessThanSignBangDashDash(e){e!==w.GREATER_THAN_SIGN&&e!==w.EOF&&this._err(F.nestedComment),this.state=k.COMMENT_END,this._stateCommentEnd(e)}_stateCommentEndDash(e){const n=this.currentToken;switch(e){case w.HYPHEN_MINUS:{this.state=k.COMMENT_END;break}case w.EOF:{this._err(F.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=k.COMMENT,this._stateComment(e)}}_stateCommentEnd(e){const n=this.currentToken;switch(e){case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentComment(n);break}case w.EXCLAMATION_MARK:{this.state=k.COMMENT_END_BANG;break}case w.HYPHEN_MINUS:{n.data+="-";break}case w.EOF:{this._err(F.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=k.COMMENT,this._stateComment(e)}}_stateCommentEndBang(e){const n=this.currentToken;switch(e){case w.HYPHEN_MINUS:{n.data+="--!",this.state=k.COMMENT_END_DASH;break}case w.GREATER_THAN_SIGN:{this._err(F.incorrectlyClosedComment),this.state=k.DATA,this.emitCurrentComment(n);break}case w.EOF:{this._err(F.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=k.COMMENT,this._stateComment(e)}}_stateDoctype(e){switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.BEFORE_DOCTYPE_NAME;break}case w.GREATER_THAN_SIGN:{this.state=k.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e);break}case w.EOF:{this._err(F.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingWhitespaceBeforeDoctypeName),this.state=k.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(e)}}_stateBeforeDoctypeName(e){if(ph(e))this._createDoctypeToken(String.fromCharCode(qp(e))),this.state=k.DOCTYPE_NAME;else switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.NULL:{this._err(F.unexpectedNullCharacter),this._createDoctypeToken(Dt),this.state=k.DOCTYPE_NAME;break}case w.GREATER_THAN_SIGN:{this._err(F.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(e)),this.state=k.DOCTYPE_NAME}}_stateDoctypeName(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.AFTER_DOCTYPE_NAME;break}case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.name+=Dt;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(ph(e)?qp(e):e)}}_stateAfterDoctypeName(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Er.PUBLIC,!1)?this.state=k.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Er.SYSTEM,!1)?this.state=k.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(F.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e))}}_stateAfterDoctypePublicKeyword(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case w.QUOTATION_MARK:{this._err(F.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=k.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{this._err(F.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=k.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case w.GREATER_THAN_SIGN:{this._err(F.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.QUOTATION_MARK:{n.publicId="",this.state=k.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{n.publicId="",this.state=k.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case w.GREATER_THAN_SIGN:{this._err(F.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypePublicIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case w.QUOTATION_MARK:{this.state=k.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.publicId+=Dt;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateDoctypePublicIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case w.APOSTROPHE:{this.state=k.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.publicId+=Dt;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(e)}}_stateAfterDoctypePublicIdentifier(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case w.GREATER_THAN_SIGN:{this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.QUOTATION_MARK:{this._err(F.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{this._err(F.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBetweenDoctypePublicAndSystemIdentifiers(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.QUOTATION_MARK:{n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateAfterDoctypeSystemKeyword(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:{this.state=k.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case w.QUOTATION_MARK:{this._err(F.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{this._err(F.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case w.GREATER_THAN_SIGN:{this._err(F.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBeforeDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.QUOTATION_MARK:{n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case w.APOSTROPHE:{n.systemId="",this.state=k.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case w.GREATER_THAN_SIGN:{this._err(F.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.DATA,this.emitCurrentDoctype(n);break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateDoctypeSystemIdentifierDoubleQuoted(e){const n=this.currentToken;switch(e){case w.QUOTATION_MARK:{this.state=k.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.systemId+=Dt;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateDoctypeSystemIdentifierSingleQuoted(e){const n=this.currentToken;switch(e){case w.APOSTROPHE:{this.state=k.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case w.NULL:{this._err(F.unexpectedNullCharacter),n.systemId+=Dt;break}case w.GREATER_THAN_SIGN:{this._err(F.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(e)}}_stateAfterDoctypeSystemIdentifier(e){const n=this.currentToken;switch(e){case w.SPACE:case w.LINE_FEED:case w.TABULATION:case w.FORM_FEED:break;case w.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.EOF:{this._err(F.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(F.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=k.BOGUS_DOCTYPE,this._stateBogusDoctype(e)}}_stateBogusDoctype(e){const n=this.currentToken;switch(e){case w.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=k.DATA;break}case w.NULL:{this._err(F.unexpectedNullCharacter);break}case w.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(e){switch(e){case w.RIGHT_SQUARE_BRACKET:{this.state=k.CDATA_SECTION_BRACKET;break}case w.EOF:{this._err(F.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(e)}}_stateCdataSectionBracket(e){e===w.RIGHT_SQUARE_BRACKET?this.state=k.CDATA_SECTION_END:(this._emitChars("]"),this.state=k.CDATA_SECTION,this._stateCdataSection(e))}_stateCdataSectionEnd(e){switch(e){case w.GREATER_THAN_SIGN:{this.state=k.DATA;break}case w.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=k.CDATA_SECTION,this._stateCdataSection(e)}}_stateCharacterReference(){let e=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(e<0)if(this.preprocessor.lastChunkWritten)e=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}e===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(w.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&aM(this.preprocessor.peek(1))?k.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(e){aM(e)?this._flushCodePointConsumedAsCharacterReference(e):(e===w.SEMICOLON&&this._err(F.unknownNamedCharacterReference),this.state=this.returnState,this._callState(e))}}const uM=new Set([m.DD,m.DT,m.LI,m.OPTGROUP,m.OPTION,m.P,m.RB,m.RP,m.RT,m.RTC]),dM=new Set([...uM,m.CAPTION,m.COLGROUP,m.TBODY,m.TD,m.TFOOT,m.TH,m.THEAD,m.TR]),Xp=new Set([m.APPLET,m.CAPTION,m.HTML,m.MARQUEE,m.OBJECT,m.TABLE,m.TD,m.TEMPLATE,m.TH]),MV=new Set([...Xp,m.OL,m.UL]),DV=new Set([...Xp,m.BUTTON]),hM=new Set([m.ANNOTATION_XML,m.MI,m.MN,m.MO,m.MS,m.MTEXT]),fM=new Set([m.DESC,m.FOREIGN_OBJECT,m.TITLE]),NV=new Set([m.TR,m.TEMPLATE,m.HTML]),OV=new Set([m.TBODY,m.TFOOT,m.THEAD,m.TEMPLATE,m.HTML]),PV=new Set([m.TABLE,m.TEMPLATE,m.HTML]),LV=new Set([m.TD,m.TH]);class RV{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(e,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=m.UNKNOWN,this.current=e}_indexOf(e){return this.items.lastIndexOf(e,this.stackTop)}_isInTemplate(){return this.currentTagId===m.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===j.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(e,n){this.stackTop++,this.items[this.stackTop]=e,this.current=e,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(e,n,!0)}pop(){const e=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!0)}replace(e,n){const r=this._indexOf(e);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(e,n,r){const i=this._indexOf(e)+1;this.items.splice(i,0,n),this.tagIDs.splice(i,0,r),this.stackTop++,i===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,i===this.stackTop)}popUntilTagNamePopped(e){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(e,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==j.HTML);this.shortenToLength(Math.max(n,0))}shortenToLength(e){for(;this.stackTop>=e;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<e)}}popUntilElementPopped(e){const n=this._indexOf(e);this.shortenToLength(Math.max(n,0))}popUntilPopped(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(Math.max(r,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(ex,j.HTML)}popUntilTableCellPopped(){this.popUntilPopped(LV,j.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(e,n){for(let r=this.stackTop;r>=0;r--)if(e.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(e,n){const r=this._indexOfTagNames(e,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo(PV,j.HTML)}clearBackToTableBodyContext(){this.clearBackTo(OV,j.HTML)}clearBackToTableRowContext(){this.clearBackTo(NV,j.HTML)}remove(e){const n=this._indexOf(e);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(e,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===m.BODY?this.items[1]:null}contains(e){return this._indexOf(e)>-1}getCommonAncestor(e){const n=this._indexOf(e)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===m.HTML}hasInDynamicScope(e,n){for(let r=this.stackTop;r>=0;r--){const i=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case j.HTML:{if(i===e)return!0;if(n.has(i))return!1;break}case j.SVG:{if(fM.has(i))return!1;break}case j.MATHML:{if(hM.has(i))return!1;break}}}return!0}hasInScope(e){return this.hasInDynamicScope(e,Xp)}hasInListItemScope(e){return this.hasInDynamicScope(e,MV)}hasInButtonScope(e){return this.hasInDynamicScope(e,DV)}hasNumberedHeaderInScope(){for(let e=this.stackTop;e>=0;e--){const n=this.tagIDs[e];switch(this.treeAdapter.getNamespaceURI(this.items[e])){case j.HTML:{if(ex.has(n))return!0;if(Xp.has(n))return!1;break}case j.SVG:{if(fM.has(n))return!1;break}case j.MATHML:{if(hM.has(n))return!1;break}}}return!0}hasInTableScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===j.HTML)switch(this.tagIDs[n]){case e:return!0;case m.TABLE:case m.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let e=this.stackTop;e>=0;e--)if(this.treeAdapter.getNamespaceURI(this.items[e])===j.HTML)switch(this.tagIDs[e]){case m.TBODY:case m.THEAD:case m.TFOOT:return!0;case m.TABLE:case m.HTML:return!1}return!0}hasInSelectScope(e){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===j.HTML)switch(this.tagIDs[n]){case e:return!0;case m.OPTION:case m.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&uM.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&dM.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(e){for(;this.currentTagId!==void 0&&this.currentTagId!==e&&dM.has(this.currentTagId);)this.pop()}}const tx=3;var ls;(function(t){t[t.Marker=0]="Marker",t[t.Element=1]="Element"})(ls||(ls={}));const pM={type:ls.Marker};class BV{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,n){const r=[],i=n.length,s=this.treeAdapter.getTagName(e),o=this.treeAdapter.getNamespaceURI(e);for(let a=0;a<this.entries.length;a++){const l=this.entries[a];if(l.type===ls.Marker)break;const{element:c}=l;if(this.treeAdapter.getTagName(c)===s&&this.treeAdapter.getNamespaceURI(c)===o){const u=this.treeAdapter.getAttrList(c);u.length===i&&r.push({idx:a,attrs:u})}}return r}_ensureNoahArkCondition(e){if(this.entries.length<tx)return;const n=this.treeAdapter.getAttrList(e),r=this._getNoahArkConditionCandidates(e,n);if(r.length<tx)return;const i=new Map(n.map(o=>[o.name,o.value]));let s=0;for(let o=0;o<r.length;o++){const a=r[o];a.attrs.every(l=>i.get(l.name)===l.value)&&(s+=1,s>=tx&&this.entries.splice(a.idx,1))}}insertMarker(){this.entries.unshift(pM)}pushElement(e,n){this._ensureNoahArkCondition(e),this.entries.unshift({type:ls.Element,element:e,token:n})}insertElementAfterBookmark(e,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:ls.Element,element:e,token:n})}removeEntry(e){const n=this.entries.indexOf(e);n!==-1&&this.entries.splice(n,1)}clearToLastMarker(){const e=this.entries.indexOf(pM);e===-1?this.entries.length=0:this.entries.splice(0,e+1)}getElementEntryInScopeWithTagName(e){const n=this.entries.find(r=>r.type===ls.Marker||this.treeAdapter.getTagName(r.element)===e);return n&&n.type===ls.Element?n:null}getElementEntry(e){return this.entries.find(n=>n.type===ls.Element&&n.element===e)}}const Ko={createDocument(){return{nodeName:"#document",mode:ni.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(t,e,n){return{nodeName:t,tagName:t,attrs:n,namespaceURI:e,childNodes:[],parentNode:null}},createCommentNode(t){return{nodeName:"#comment",data:t,parentNode:null}},createTextNode(t){return{nodeName:"#text",value:t,parentNode:null}},appendChild(t,e){t.childNodes.push(e),e.parentNode=t},insertBefore(t,e,n){const r=t.childNodes.indexOf(n);t.childNodes.splice(r,0,e),e.parentNode=t},setTemplateContent(t,e){t.content=e},getTemplateContent(t){return t.content},setDocumentType(t,e,n,r){const i=t.childNodes.find(s=>s.nodeName==="#documentType");if(i)i.name=e,i.publicId=n,i.systemId=r;else{const s={nodeName:"#documentType",name:e,publicId:n,systemId:r,parentNode:null};Ko.appendChild(t,s)}},setDocumentMode(t,e){t.mode=e},getDocumentMode(t){return t.mode},detachNode(t){if(t.parentNode){const e=t.parentNode.childNodes.indexOf(t);t.parentNode.childNodes.splice(e,1),t.parentNode=null}},insertText(t,e){if(t.childNodes.length>0){const n=t.childNodes[t.childNodes.length-1];if(Ko.isTextNode(n)){n.value+=e;return}}Ko.appendChild(t,Ko.createTextNode(e))},insertTextBefore(t,e,n){const r=t.childNodes[t.childNodes.indexOf(n)-1];r&&Ko.isTextNode(r)?r.value+=e:Ko.insertBefore(t,Ko.createTextNode(e),n)},adoptAttributes(t,e){const n=new Set(t.attrs.map(r=>r.name));for(let r=0;r<e.length;r++)n.has(e[r].name)||t.attrs.push(e[r])},getFirstChild(t){return t.childNodes[0]},getChildNodes(t){return t.childNodes},getParentNode(t){return t.parentNode},getAttrList(t){return t.attrs},getTagName(t){return t.tagName},getNamespaceURI(t){return t.namespaceURI},getTextNodeContent(t){return t.value},getCommentNodeContent(t){return t.data},getDocumentTypeNodeName(t){return t.name},getDocumentTypeNodePublicId(t){return t.publicId},getDocumentTypeNodeSystemId(t){return t.systemId},isTextNode(t){return t.nodeName==="#text"},isCommentNode(t){return t.nodeName==="#comment"},isDocumentTypeNode(t){return t.nodeName==="#documentType"},isElementNode(t){return Object.prototype.hasOwnProperty.call(t,"tagName")},setNodeSourceCodeLocation(t,e){t.sourceCodeLocation=e},getNodeSourceCodeLocation(t){return t.sourceCodeLocation},updateNodeSourceCodeLocation(t,e){t.sourceCodeLocation={...t.sourceCodeLocation,...e}}},mM="html",FV="about:legacy-compat",UV="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",gM=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],$V=[...gM,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],HV=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),bM=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],zV=[...bM,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function yM(t,e){return e.some(n=>t.startsWith(n))}function WV(t){return t.name===mM&&t.publicId===null&&(t.systemId===null||t.systemId===FV)}function jV(t){if(t.name!==mM)return ni.QUIRKS;const{systemId:e}=t;if(e&&e.toLowerCase()===UV)return ni.QUIRKS;let{publicId:n}=t;if(n!==null){if(n=n.toLowerCase(),HV.has(n))return ni.QUIRKS;let r=e===null?$V:gM;if(yM(n,r))return ni.QUIRKS;if(r=e===null?bM:zV,yM(n,r))return ni.LIMITED_QUIRKS}return ni.NO_QUIRKS}const _M={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},YV="definitionurl",GV="definitionURL",VV=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(t=>[t.toLowerCase(),t])),qV=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:j.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:j.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:j.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:j.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:j.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:j.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:j.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:j.XML}],["xml:space",{prefix:"xml",name:"space",namespace:j.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:j.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:j.XMLNS}]]),XV=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(t=>[t.toLowerCase(),t])),KV=new Set([m.B,m.BIG,m.BLOCKQUOTE,m.BODY,m.BR,m.CENTER,m.CODE,m.DD,m.DIV,m.DL,m.DT,m.EM,m.EMBED,m.H1,m.H2,m.H3,m.H4,m.H5,m.H6,m.HEAD,m.HR,m.I,m.IMG,m.LI,m.LISTING,m.MENU,m.META,m.NOBR,m.OL,m.P,m.PRE,m.RUBY,m.S,m.SMALL,m.SPAN,m.STRONG,m.STRIKE,m.SUB,m.SUP,m.TABLE,m.TT,m.U,m.UL,m.VAR]);function QV(t){const e=t.tagID;return e===m.FONT&&t.attrs.some(({name:r})=>r===hl.COLOR||r===hl.SIZE||r===hl.FACE)||KV.has(e)}function xM(t){for(let e=0;e<t.attrs.length;e++)if(t.attrs[e].name===YV){t.attrs[e].name=GV;break}}function EM(t){for(let e=0;e<t.attrs.length;e++){const n=VV.get(t.attrs[e].name);n!=null&&(t.attrs[e].name=n)}}function nx(t){for(let e=0;e<t.attrs.length;e++){const n=qV.get(t.attrs[e].name);n&&(t.attrs[e].prefix=n.prefix,t.attrs[e].name=n.name,t.attrs[e].namespace=n.namespace)}}function ZV(t){const e=XV.get(t.tagName);e!=null&&(t.tagName=e,t.tagID=Vp(t.tagName))}function JV(t,e){return e===j.MATHML&&(t===m.MI||t===m.MO||t===m.MN||t===m.MS||t===m.MTEXT)}function eq(t,e,n){if(e===j.MATHML&&t===m.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===hl.ENCODING){const i=n[r].value.toLowerCase();return i===_M.TEXT_HTML||i===_M.APPLICATION_XML}}return e===j.SVG&&(t===m.FOREIGN_OBJECT||t===m.DESC||t===m.TITLE)}function tq(t,e,n,r){return(!r||r===j.HTML)&&eq(t,e,n)||(!r||r===j.MATHML)&&JV(t,e)}const nq="hidden",rq=8,iq=3;var S;(function(t){t[t.INITIAL=0]="INITIAL",t[t.BEFORE_HTML=1]="BEFORE_HTML",t[t.BEFORE_HEAD=2]="BEFORE_HEAD",t[t.IN_HEAD=3]="IN_HEAD",t[t.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",t[t.AFTER_HEAD=5]="AFTER_HEAD",t[t.IN_BODY=6]="IN_BODY",t[t.TEXT=7]="TEXT",t[t.IN_TABLE=8]="IN_TABLE",t[t.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",t[t.IN_CAPTION=10]="IN_CAPTION",t[t.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",t[t.IN_TABLE_BODY=12]="IN_TABLE_BODY",t[t.IN_ROW=13]="IN_ROW",t[t.IN_CELL=14]="IN_CELL",t[t.IN_SELECT=15]="IN_SELECT",t[t.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",t[t.IN_TEMPLATE=17]="IN_TEMPLATE",t[t.AFTER_BODY=18]="AFTER_BODY",t[t.IN_FRAMESET=19]="IN_FRAMESET",t[t.AFTER_FRAMESET=20]="AFTER_FRAMESET",t[t.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",t[t.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(S||(S={}));const sq={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},vM=new Set([m.TABLE,m.TBODY,m.TFOOT,m.THEAD,m.TR]),wM={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Ko,onParseError:null};let kM=class{constructor(e,n,r=null,i=null){this.fragmentContext=r,this.scriptHandler=i,this.currentToken=null,this.stopped=!1,this.insertionMode=S.INITIAL,this.originalInsertionMode=S.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...wM,...e},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new IV(this.options,this),this.activeFormattingElements=new BV(this.treeAdapter),this.fragmentContextID=r?Vp(this.treeAdapter.getTagName(r)):m.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new RV(this.document,this.treeAdapter,this)}static parse(e,n){const r=new this(n);return r.tokenizer.write(e,!0),r.document}static getFragmentParser(e,n){const r={...wM,...n};e??(e=r.treeAdapter.createElement(P.TEMPLATE,j.HTML,[]));const i=r.treeAdapter.createElement("documentmock",j.HTML,[]),s=new this(r,i,e);return s.fragmentContextID===m.TEMPLATE&&s.tmplInsertionModeStack.unshift(S.IN_TEMPLATE),s._initTokenizerForFragmentParsing(),s._insertFakeRootElement(),s._resetInsertionMode(),s._findFormInFragmentContext(),s}getFragment(){const e=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(e,n),n}_err(e,n,r){var i;if(!this.onParseError)return;const s=(i=e.location)!==null&&i!==void 0?i:sq,o={code:n,startLine:s.startLine,startCol:s.startCol,startOffset:s.startOffset,endLine:r?s.startLine:s.endLine,endCol:r?s.startCol:s.endCol,endOffset:r?s.startOffset:s.endOffset};this.onParseError(o)}onItemPush(e,n,r){var i,s;(s=(i=this.treeAdapter).onItemPush)===null||s===void 0||s.call(i,e),r&&this.openElements.stackTop>0&&this._setContextModes(e,n)}onItemPop(e,n){var r,i;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(e,this.currentToken),(i=(r=this.treeAdapter).onItemPop)===null||i===void 0||i.call(r,e,this.openElements.current),n){let s,o;this.openElements.stackTop===0&&this.fragmentContext?(s=this.fragmentContext,o=this.fragmentContextID):{current:s,currentTagId:o}=this.openElements,this._setContextModes(s,o)}}_setContextModes(e,n){const r=e===this.document||e&&this.treeAdapter.getNamespaceURI(e)===j.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&e!==void 0&&n!==void 0&&!this._isIntegrationPoint(n,e)}_switchToTextParsing(e,n){this._insertElement(e,j.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=S.TEXT}switchToPlaintextParsing(){this.insertionMode=S.TEXT,this.originalInsertionMode=S.IN_BODY,this.tokenizer.state=vr.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let e=this.fragmentContext;for(;e;){if(this.treeAdapter.getTagName(e)===P.FORM){this.formElement=e;break}e=this.treeAdapter.getParentNode(e)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==j.HTML))switch(this.fragmentContextID){case m.TITLE:case m.TEXTAREA:{this.tokenizer.state=vr.RCDATA;break}case m.STYLE:case m.XMP:case m.IFRAME:case m.NOEMBED:case m.NOFRAMES:case m.NOSCRIPT:{this.tokenizer.state=vr.RAWTEXT;break}case m.SCRIPT:{this.tokenizer.state=vr.SCRIPT_DATA;break}case m.PLAINTEXT:{this.tokenizer.state=vr.PLAINTEXT;break}}}_setDocumentType(e){const n=e.name||"",r=e.publicId||"",i=e.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,i),e.location){const o=this.treeAdapter.getChildNodes(this.document).find(a=>this.treeAdapter.isDocumentTypeNode(a));o&&this.treeAdapter.setNodeSourceCodeLocation(o,e.location)}}_attachElementToTree(e,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(e,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(e);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r??this.document,e)}}_appendElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location)}_insertElement(e,n){const r=this.treeAdapter.createElement(e.tagName,n,e.attrs);this._attachElementToTree(r,e.location),this.openElements.push(r,e.tagID)}_insertFakeElement(e,n){const r=this.treeAdapter.createElement(e,j.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(e){const n=this.treeAdapter.createElement(e.tagName,j.HTML,e.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,e.location),this.openElements.push(n,e.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const e=this.treeAdapter.createElement(P.HTML,j.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(e,null),this.treeAdapter.appendChild(this.openElements.current,e),this.openElements.push(e,m.HTML)}_appendCommentNode(e,n){const r=this.treeAdapter.createCommentNode(e.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,e.location)}_insertCharacters(e){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,e.chars,r):this.treeAdapter.insertText(n,e.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,e.chars)),!e.location)return;const i=this.treeAdapter.getChildNodes(n),s=r?i.lastIndexOf(r):i.length,o=i[s-1];if(this.treeAdapter.getNodeSourceCodeLocation(o)){const{endLine:l,endCol:c,endOffset:u}=e.location;this.treeAdapter.updateNodeSourceCodeLocation(o,{endLine:l,endCol:c,endOffset:u})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(o,e.location)}_adoptNodes(e,n){for(let r=this.treeAdapter.getFirstChild(e);r;r=this.treeAdapter.getFirstChild(e))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(e,n){if(this.treeAdapter.getNodeSourceCodeLocation(e)&&n.location){const r=n.location,i=this.treeAdapter.getTagName(e),s=n.type===tt.END_TAG&&i===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(e,s)}}shouldProcessStartTagTokenInForeignContent(e){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,e.tagID===m.SVG&&this.treeAdapter.getTagName(n)===P.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===j.MATHML?!1:this.tokenizer.inForeignNode||(e.tagID===m.MGLYPH||e.tagID===m.MALIGNMARK)&&r!==void 0&&!this._isIntegrationPoint(r,n,j.HTML)}_processToken(e){switch(e.type){case tt.CHARACTER:{this.onCharacter(e);break}case tt.NULL_CHARACTER:{this.onNullCharacter(e);break}case tt.COMMENT:{this.onComment(e);break}case tt.DOCTYPE:{this.onDoctype(e);break}case tt.START_TAG:{this._processStartTag(e);break}case tt.END_TAG:{this.onEndTag(e);break}case tt.EOF:{this.onEof(e);break}case tt.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(e);break}}}_isIntegrationPoint(e,n,r){const i=this.treeAdapter.getNamespaceURI(n),s=this.treeAdapter.getAttrList(n);return tq(e,i,s,r)}_reconstructActiveFormattingElements(){const e=this.activeFormattingElements.entries.length;if(e){const n=this.activeFormattingElements.entries.findIndex(i=>i.type===ls.Marker||this.openElements.contains(i.element)),r=n===-1?e-1:n-1;for(let i=r;i>=0;i--){const s=this.activeFormattingElements.entries[i];this._insertElement(s.token,this.treeAdapter.getNamespaceURI(s.element)),s.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=S.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(m.P),this.openElements.popUntilTagNamePopped(m.P)}_resetInsertionMode(){for(let e=this.openElements.stackTop;e>=0;e--)switch(e===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[e]){case m.TR:{this.insertionMode=S.IN_ROW;return}case m.TBODY:case m.THEAD:case m.TFOOT:{this.insertionMode=S.IN_TABLE_BODY;return}case m.CAPTION:{this.insertionMode=S.IN_CAPTION;return}case m.COLGROUP:{this.insertionMode=S.IN_COLUMN_GROUP;return}case m.TABLE:{this.insertionMode=S.IN_TABLE;return}case m.BODY:{this.insertionMode=S.IN_BODY;return}case m.FRAMESET:{this.insertionMode=S.IN_FRAMESET;return}case m.SELECT:{this._resetInsertionModeForSelect(e);return}case m.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case m.HTML:{this.insertionMode=this.headElement?S.AFTER_HEAD:S.BEFORE_HEAD;return}case m.TD:case m.TH:{if(e>0){this.insertionMode=S.IN_CELL;return}break}case m.HEAD:{if(e>0){this.insertionMode=S.IN_HEAD;return}break}}this.insertionMode=S.IN_BODY}_resetInsertionModeForSelect(e){if(e>0)for(let n=e-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===m.TEMPLATE)break;if(r===m.TABLE){this.insertionMode=S.IN_SELECT_IN_TABLE;return}}this.insertionMode=S.IN_SELECT}_isElementCausesFosterParenting(e){return vM.has(e)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let e=this.openElements.stackTop;e>=0;e--){const n=this.openElements.items[e];switch(this.openElements.tagIDs[e]){case m.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===j.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case m.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[e-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(e){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,e,n.beforeElement):this.treeAdapter.appendChild(n.parent,e)}_isSpecialElement(e,n){const r=this.treeAdapter.getNamespaceURI(e);return TV[r].has(n)}onCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){LX(this,e);return}switch(this.insertionMode){case S.INITIAL:{mh(this,e);break}case S.BEFORE_HTML:{gh(this,e);break}case S.BEFORE_HEAD:{bh(this,e);break}case S.IN_HEAD:{yh(this,e);break}case S.IN_HEAD_NO_SCRIPT:{_h(this,e);break}case S.AFTER_HEAD:{xh(this,e);break}case S.IN_BODY:case S.IN_CAPTION:case S.IN_CELL:case S.IN_TEMPLATE:{SM(this,e);break}case S.TEXT:case S.IN_SELECT:case S.IN_SELECT_IN_TABLE:{this._insertCharacters(e);break}case S.IN_TABLE:case S.IN_TABLE_BODY:case S.IN_ROW:{ox(this,e);break}case S.IN_TABLE_TEXT:{PM(this,e);break}case S.IN_COLUMN_GROUP:{Zp(this,e);break}case S.AFTER_BODY:{tm(this,e);break}case S.AFTER_AFTER_BODY:{nm(this,e);break}}}onNullCharacter(e){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){PX(this,e);return}switch(this.insertionMode){case S.INITIAL:{mh(this,e);break}case S.BEFORE_HTML:{gh(this,e);break}case S.BEFORE_HEAD:{bh(this,e);break}case S.IN_HEAD:{yh(this,e);break}case S.IN_HEAD_NO_SCRIPT:{_h(this,e);break}case S.AFTER_HEAD:{xh(this,e);break}case S.TEXT:{this._insertCharacters(e);break}case S.IN_TABLE:case S.IN_TABLE_BODY:case S.IN_ROW:{ox(this,e);break}case S.IN_COLUMN_GROUP:{Zp(this,e);break}case S.AFTER_BODY:{tm(this,e);break}case S.AFTER_AFTER_BODY:{nm(this,e);break}}}onComment(e){if(this.skipNextNewLine=!1,this.currentNotInHTML){ix(this,e);return}switch(this.insertionMode){case S.INITIAL:case S.BEFORE_HTML:case S.BEFORE_HEAD:case S.IN_HEAD:case S.IN_HEAD_NO_SCRIPT:case S.AFTER_HEAD:case S.IN_BODY:case S.IN_TABLE:case S.IN_CAPTION:case S.IN_COLUMN_GROUP:case S.IN_TABLE_BODY:case S.IN_ROW:case S.IN_CELL:case S.IN_SELECT:case S.IN_SELECT_IN_TABLE:case S.IN_TEMPLATE:case S.IN_FRAMESET:case S.AFTER_FRAMESET:{ix(this,e);break}case S.IN_TABLE_TEXT:{wh(this,e);break}case S.AFTER_BODY:{hq(this,e);break}case S.AFTER_AFTER_BODY:case S.AFTER_AFTER_FRAMESET:{fq(this,e);break}}}onDoctype(e){switch(this.skipNextNewLine=!1,this.insertionMode){case S.INITIAL:{pq(this,e);break}case S.BEFORE_HEAD:case S.IN_HEAD:case S.IN_HEAD_NO_SCRIPT:case S.AFTER_HEAD:{this._err(e,F.misplacedDoctype);break}case S.IN_TABLE_TEXT:{wh(this,e);break}}}onStartTag(e){this.skipNextNewLine=!1,this.currentToken=e,this._processStartTag(e),e.selfClosing&&!e.ackSelfClosing&&this._err(e,F.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(e){this.shouldProcessStartTagTokenInForeignContent(e)?RX(this,e):this._startTagOutsideForeignContent(e)}_startTagOutsideForeignContent(e){switch(this.insertionMode){case S.INITIAL:{mh(this,e);break}case S.BEFORE_HTML:{mq(this,e);break}case S.BEFORE_HEAD:{bq(this,e);break}case S.IN_HEAD:{ki(this,e);break}case S.IN_HEAD_NO_SCRIPT:{xq(this,e);break}case S.AFTER_HEAD:{vq(this,e);break}case S.IN_BODY:{Xn(this,e);break}case S.IN_TABLE:{Lc(this,e);break}case S.IN_TABLE_TEXT:{wh(this,e);break}case S.IN_CAPTION:{yX(this,e);break}case S.IN_COLUMN_GROUP:{ax(this,e);break}case S.IN_TABLE_BODY:{Jp(this,e);break}case S.IN_ROW:{em(this,e);break}case S.IN_CELL:{EX(this,e);break}case S.IN_SELECT:{BM(this,e);break}case S.IN_SELECT_IN_TABLE:{wX(this,e);break}case S.IN_TEMPLATE:{TX(this,e);break}case S.AFTER_BODY:{CX(this,e);break}case S.IN_FRAMESET:{AX(this,e);break}case S.AFTER_FRAMESET:{MX(this,e);break}case S.AFTER_AFTER_BODY:{NX(this,e);break}case S.AFTER_AFTER_FRAMESET:{OX(this,e);break}}}onEndTag(e){this.skipNextNewLine=!1,this.currentToken=e,this.currentNotInHTML?BX(this,e):this._endTagOutsideForeignContent(e)}_endTagOutsideForeignContent(e){switch(this.insertionMode){case S.INITIAL:{mh(this,e);break}case S.BEFORE_HTML:{gq(this,e);break}case S.BEFORE_HEAD:{yq(this,e);break}case S.IN_HEAD:{_q(this,e);break}case S.IN_HEAD_NO_SCRIPT:{Eq(this,e);break}case S.AFTER_HEAD:{wq(this,e);break}case S.IN_BODY:{Qp(this,e);break}case S.TEXT:{lX(this,e);break}case S.IN_TABLE:{Eh(this,e);break}case S.IN_TABLE_TEXT:{wh(this,e);break}case S.IN_CAPTION:{_X(this,e);break}case S.IN_COLUMN_GROUP:{xX(this,e);break}case S.IN_TABLE_BODY:{lx(this,e);break}case S.IN_ROW:{RM(this,e);break}case S.IN_CELL:{vX(this,e);break}case S.IN_SELECT:{FM(this,e);break}case S.IN_SELECT_IN_TABLE:{kX(this,e);break}case S.IN_TEMPLATE:{SX(this,e);break}case S.AFTER_BODY:{$M(this,e);break}case S.IN_FRAMESET:{IX(this,e);break}case S.AFTER_FRAMESET:{DX(this,e);break}case S.AFTER_AFTER_BODY:{nm(this,e);break}}}onEof(e){switch(this.insertionMode){case S.INITIAL:{mh(this,e);break}case S.BEFORE_HTML:{gh(this,e);break}case S.BEFORE_HEAD:{bh(this,e);break}case S.IN_HEAD:{yh(this,e);break}case S.IN_HEAD_NO_SCRIPT:{_h(this,e);break}case S.AFTER_HEAD:{xh(this,e);break}case S.IN_BODY:case S.IN_TABLE:case S.IN_CAPTION:case S.IN_COLUMN_GROUP:case S.IN_TABLE_BODY:case S.IN_ROW:case S.IN_CELL:case S.IN_SELECT:case S.IN_SELECT_IN_TABLE:{NM(this,e);break}case S.TEXT:{cX(this,e);break}case S.IN_TABLE_TEXT:{wh(this,e);break}case S.IN_TEMPLATE:{UM(this,e);break}case S.AFTER_BODY:case S.IN_FRAMESET:case S.AFTER_FRAMESET:case S.AFTER_AFTER_BODY:case S.AFTER_AFTER_FRAMESET:{sx(this,e);break}}}onWhitespaceCharacter(e){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,e.chars.charCodeAt(0)===w.LINE_FEED)){if(e.chars.length===1)return;e.chars=e.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(e);return}switch(this.insertionMode){case S.IN_HEAD:case S.IN_HEAD_NO_SCRIPT:case S.AFTER_HEAD:case S.TEXT:case S.IN_COLUMN_GROUP:case S.IN_SELECT:case S.IN_SELECT_IN_TABLE:case S.IN_FRAMESET:case S.AFTER_FRAMESET:{this._insertCharacters(e);break}case S.IN_BODY:case S.IN_CAPTION:case S.IN_CELL:case S.IN_TEMPLATE:case S.AFTER_BODY:case S.AFTER_AFTER_BODY:case S.AFTER_AFTER_FRAMESET:{TM(this,e);break}case S.IN_TABLE:case S.IN_TABLE_BODY:case S.IN_ROW:{ox(this,e);break}case S.IN_TABLE_TEXT:{OM(this,e);break}}}};function oq(t,e){let n=t.activeFormattingElements.getElementEntryInScopeWithTagName(e.tagName);return n?t.openElements.contains(n.element)?t.openElements.hasInScope(e.tagID)||(n=null):(t.activeFormattingElements.removeEntry(n),n=null):DM(t,e),n}function aq(t,e){let n=null,r=t.openElements.stackTop;for(;r>=0;r--){const i=t.openElements.items[r];if(i===e.element)break;t._isSpecialElement(i,t.openElements.tagIDs[r])&&(n=i)}return n||(t.openElements.shortenToLength(Math.max(r,0)),t.activeFormattingElements.removeEntry(e)),n}function lq(t,e,n){let r=e,i=t.openElements.getCommonAncestor(e);for(let s=0,o=i;o!==n;s++,o=i){i=t.openElements.getCommonAncestor(o);const a=t.activeFormattingElements.getElementEntry(o),l=a&&s>=iq;!a||l?(l&&t.activeFormattingElements.removeEntry(a),t.openElements.remove(o)):(o=cq(t,a),r===e&&(t.activeFormattingElements.bookmark=a),t.treeAdapter.detachNode(r),t.treeAdapter.appendChild(o,r),r=o)}return r}function cq(t,e){const n=t.treeAdapter.getNamespaceURI(e.element),r=t.treeAdapter.createElement(e.token.tagName,n,e.token.attrs);return t.openElements.replace(e.element,r),e.element=r,r}function uq(t,e,n){const r=t.treeAdapter.getTagName(e),i=Vp(r);if(t._isElementCausesFosterParenting(i))t._fosterParentElement(n);else{const s=t.treeAdapter.getNamespaceURI(e);i===m.TEMPLATE&&s===j.HTML&&(e=t.treeAdapter.getTemplateContent(e)),t.treeAdapter.appendChild(e,n)}}function dq(t,e,n){const r=t.treeAdapter.getNamespaceURI(n.element),{token:i}=n,s=t.treeAdapter.createElement(i.tagName,r,i.attrs);t._adoptNodes(e,s),t.treeAdapter.appendChild(e,s),t.activeFormattingElements.insertElementAfterBookmark(s,i),t.activeFormattingElements.removeEntry(n),t.openElements.remove(n.element),t.openElements.insertAfter(e,s,i.tagID)}function rx(t,e){for(let n=0;n<rq;n++){const r=oq(t,e);if(!r)break;const i=aq(t,r);if(!i)break;t.activeFormattingElements.bookmark=r;const s=lq(t,i,r.element),o=t.openElements.getCommonAncestor(r.element);t.treeAdapter.detachNode(s),o&&uq(t,o,s),dq(t,i,r)}}function ix(t,e){t._appendCommentNode(e,t.openElements.currentTmplContentOrNode)}function hq(t,e){t._appendCommentNode(e,t.openElements.items[0])}function fq(t,e){t._appendCommentNode(e,t.document)}function sx(t,e){if(t.stopped=!0,e.location){const n=t.fragmentContext?0:2;for(let r=t.openElements.stackTop;r>=n;r--)t._setEndLocation(t.openElements.items[r],e);if(!t.fragmentContext&&t.openElements.stackTop>=0){const r=t.openElements.items[0],i=t.treeAdapter.getNodeSourceCodeLocation(r);if(i&&!i.endTag&&(t._setEndLocation(r,e),t.openElements.stackTop>=1)){const s=t.openElements.items[1],o=t.treeAdapter.getNodeSourceCodeLocation(s);o&&!o.endTag&&t._setEndLocation(s,e)}}}}function pq(t,e){t._setDocumentType(e);const n=e.forceQuirks?ni.QUIRKS:jV(e);WV(e)||t._err(e,F.nonConformingDoctype),t.treeAdapter.setDocumentMode(t.document,n),t.insertionMode=S.BEFORE_HTML}function mh(t,e){t._err(e,F.missingDoctype,!0),t.treeAdapter.setDocumentMode(t.document,ni.QUIRKS),t.insertionMode=S.BEFORE_HTML,t._processToken(e)}function mq(t,e){e.tagID===m.HTML?(t._insertElement(e,j.HTML),t.insertionMode=S.BEFORE_HEAD):gh(t,e)}function gq(t,e){const n=e.tagID;(n===m.HTML||n===m.HEAD||n===m.BODY||n===m.BR)&&gh(t,e)}function gh(t,e){t._insertFakeRootElement(),t.insertionMode=S.BEFORE_HEAD,t._processToken(e)}function bq(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.HEAD:{t._insertElement(e,j.HTML),t.headElement=t.openElements.current,t.insertionMode=S.IN_HEAD;break}default:bh(t,e)}}function yq(t,e){const n=e.tagID;n===m.HEAD||n===m.BODY||n===m.HTML||n===m.BR?bh(t,e):t._err(e,F.endTagWithoutMatchingOpenElement)}function bh(t,e){t._insertFakeElement(P.HEAD,m.HEAD),t.headElement=t.openElements.current,t.insertionMode=S.IN_HEAD,t._processToken(e)}function ki(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.BASE:case m.BASEFONT:case m.BGSOUND:case m.LINK:case m.META:{t._appendElement(e,j.HTML),e.ackSelfClosing=!0;break}case m.TITLE:{t._switchToTextParsing(e,vr.RCDATA);break}case m.NOSCRIPT:{t.options.scriptingEnabled?t._switchToTextParsing(e,vr.RAWTEXT):(t._insertElement(e,j.HTML),t.insertionMode=S.IN_HEAD_NO_SCRIPT);break}case m.NOFRAMES:case m.STYLE:{t._switchToTextParsing(e,vr.RAWTEXT);break}case m.SCRIPT:{t._switchToTextParsing(e,vr.SCRIPT_DATA);break}case m.TEMPLATE:{t._insertTemplate(e),t.activeFormattingElements.insertMarker(),t.framesetOk=!1,t.insertionMode=S.IN_TEMPLATE,t.tmplInsertionModeStack.unshift(S.IN_TEMPLATE);break}case m.HEAD:{t._err(e,F.misplacedStartTagForHeadElement);break}default:yh(t,e)}}function _q(t,e){switch(e.tagID){case m.HEAD:{t.openElements.pop(),t.insertionMode=S.AFTER_HEAD;break}case m.BODY:case m.BR:case m.HTML:{yh(t,e);break}case m.TEMPLATE:{fl(t,e);break}default:t._err(e,F.endTagWithoutMatchingOpenElement)}}function fl(t,e){t.openElements.tmplCount>0?(t.openElements.generateImpliedEndTagsThoroughly(),t.openElements.currentTagId!==m.TEMPLATE&&t._err(e,F.closingOfElementWithOpenChildElements),t.openElements.popUntilTagNamePopped(m.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode()):t._err(e,F.endTagWithoutMatchingOpenElement)}function yh(t,e){t.openElements.pop(),t.insertionMode=S.AFTER_HEAD,t._processToken(e)}function xq(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.BASEFONT:case m.BGSOUND:case m.HEAD:case m.LINK:case m.META:case m.NOFRAMES:case m.STYLE:{ki(t,e);break}case m.NOSCRIPT:{t._err(e,F.nestedNoscriptInHead);break}default:_h(t,e)}}function Eq(t,e){switch(e.tagID){case m.NOSCRIPT:{t.openElements.pop(),t.insertionMode=S.IN_HEAD;break}case m.BR:{_h(t,e);break}default:t._err(e,F.endTagWithoutMatchingOpenElement)}}function _h(t,e){const n=e.type===tt.EOF?F.openElementsLeftAfterEof:F.disallowedContentInNoscriptInHead;t._err(e,n),t.openElements.pop(),t.insertionMode=S.IN_HEAD,t._processToken(e)}function vq(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.BODY:{t._insertElement(e,j.HTML),t.framesetOk=!1,t.insertionMode=S.IN_BODY;break}case m.FRAMESET:{t._insertElement(e,j.HTML),t.insertionMode=S.IN_FRAMESET;break}case m.BASE:case m.BASEFONT:case m.BGSOUND:case m.LINK:case m.META:case m.NOFRAMES:case m.SCRIPT:case m.STYLE:case m.TEMPLATE:case m.TITLE:{t._err(e,F.abandonedHeadElementChild),t.openElements.push(t.headElement,m.HEAD),ki(t,e),t.openElements.remove(t.headElement);break}case m.HEAD:{t._err(e,F.misplacedStartTagForHeadElement);break}default:xh(t,e)}}function wq(t,e){switch(e.tagID){case m.BODY:case m.HTML:case m.BR:{xh(t,e);break}case m.TEMPLATE:{fl(t,e);break}default:t._err(e,F.endTagWithoutMatchingOpenElement)}}function xh(t,e){t._insertFakeElement(P.BODY,m.BODY),t.insertionMode=S.IN_BODY,Kp(t,e)}function Kp(t,e){switch(e.type){case tt.CHARACTER:{SM(t,e);break}case tt.WHITESPACE_CHARACTER:{TM(t,e);break}case tt.COMMENT:{ix(t,e);break}case tt.START_TAG:{Xn(t,e);break}case tt.END_TAG:{Qp(t,e);break}case tt.EOF:{NM(t,e);break}}}function TM(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e)}function SM(t,e){t._reconstructActiveFormattingElements(),t._insertCharacters(e),t.framesetOk=!1}function kq(t,e){t.openElements.tmplCount===0&&t.treeAdapter.adoptAttributes(t.openElements.items[0],e.attrs)}function Tq(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t.openElements.tmplCount===0&&(t.framesetOk=!1,t.treeAdapter.adoptAttributes(n,e.attrs))}function Sq(t,e){const n=t.openElements.tryPeekProperlyNestedBodyElement();t.framesetOk&&n&&(t.treeAdapter.detachNode(n),t.openElements.popAllUpToHtmlElement(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_FRAMESET)}function Cq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML)}function Aq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t.openElements.currentTagId!==void 0&&ex.has(t.openElements.currentTagId)&&t.openElements.pop(),t._insertElement(e,j.HTML)}function Iq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML),t.skipNextNewLine=!0,t.framesetOk=!1}function Mq(t,e){const n=t.openElements.tmplCount>0;(!t.formElement||n)&&(t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML),n||(t.formElement=t.openElements.current))}function Dq(t,e){t.framesetOk=!1;const n=e.tagID;for(let r=t.openElements.stackTop;r>=0;r--){const i=t.openElements.tagIDs[r];if(n===m.LI&&i===m.LI||(n===m.DD||n===m.DT)&&(i===m.DD||i===m.DT)){t.openElements.generateImpliedEndTagsWithExclusion(i),t.openElements.popUntilTagNamePopped(i);break}if(i!==m.ADDRESS&&i!==m.DIV&&i!==m.P&&t._isSpecialElement(t.openElements.items[r],i))break}t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML)}function Nq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML),t.tokenizer.state=vr.PLAINTEXT}function Oq(t,e){t.openElements.hasInScope(m.BUTTON)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(m.BUTTON)),t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML),t.framesetOk=!1}function Pq(t,e){const n=t.activeFormattingElements.getElementEntryInScopeWithTagName(P.A);n&&(rx(t,e),t.openElements.remove(n.element),t.activeFormattingElements.removeEntry(n)),t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function Lq(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function Rq(t,e){t._reconstructActiveFormattingElements(),t.openElements.hasInScope(m.NOBR)&&(rx(t,e),t._reconstructActiveFormattingElements()),t._insertElement(e,j.HTML),t.activeFormattingElements.pushElement(t.openElements.current,e)}function Bq(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML),t.activeFormattingElements.insertMarker(),t.framesetOk=!1}function Fq(t,e){t.treeAdapter.getDocumentMode(t.document)!==ni.QUIRKS&&t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._insertElement(e,j.HTML),t.framesetOk=!1,t.insertionMode=S.IN_TABLE}function CM(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,j.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function AM(t){const e=oM(t,hl.TYPE);return e!=null&&e.toLowerCase()===nq}function Uq(t,e){t._reconstructActiveFormattingElements(),t._appendElement(e,j.HTML),AM(e)||(t.framesetOk=!1),e.ackSelfClosing=!0}function $q(t,e){t._appendElement(e,j.HTML),e.ackSelfClosing=!0}function Hq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._appendElement(e,j.HTML),t.framesetOk=!1,e.ackSelfClosing=!0}function zq(t,e){e.tagName=P.IMG,e.tagID=m.IMG,CM(t,e)}function Wq(t,e){t._insertElement(e,j.HTML),t.skipNextNewLine=!0,t.tokenizer.state=vr.RCDATA,t.originalInsertionMode=t.insertionMode,t.framesetOk=!1,t.insertionMode=S.TEXT}function jq(t,e){t.openElements.hasInButtonScope(m.P)&&t._closePElement(),t._reconstructActiveFormattingElements(),t.framesetOk=!1,t._switchToTextParsing(e,vr.RAWTEXT)}function Yq(t,e){t.framesetOk=!1,t._switchToTextParsing(e,vr.RAWTEXT)}function IM(t,e){t._switchToTextParsing(e,vr.RAWTEXT)}function Gq(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML),t.framesetOk=!1,t.insertionMode=t.insertionMode===S.IN_TABLE||t.insertionMode===S.IN_CAPTION||t.insertionMode===S.IN_TABLE_BODY||t.insertionMode===S.IN_ROW||t.insertionMode===S.IN_CELL?S.IN_SELECT_IN_TABLE:S.IN_SELECT}function Vq(t,e){t.openElements.currentTagId===m.OPTION&&t.openElements.pop(),t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML)}function qq(t,e){t.openElements.hasInScope(m.RUBY)&&t.openElements.generateImpliedEndTags(),t._insertElement(e,j.HTML)}function Xq(t,e){t.openElements.hasInScope(m.RUBY)&&t.openElements.generateImpliedEndTagsWithExclusion(m.RTC),t._insertElement(e,j.HTML)}function Kq(t,e){t._reconstructActiveFormattingElements(),xM(e),nx(e),e.selfClosing?t._appendElement(e,j.MATHML):t._insertElement(e,j.MATHML),e.ackSelfClosing=!0}function Qq(t,e){t._reconstructActiveFormattingElements(),EM(e),nx(e),e.selfClosing?t._appendElement(e,j.SVG):t._insertElement(e,j.SVG),e.ackSelfClosing=!0}function MM(t,e){t._reconstructActiveFormattingElements(),t._insertElement(e,j.HTML)}function Xn(t,e){switch(e.tagID){case m.I:case m.S:case m.B:case m.U:case m.EM:case m.TT:case m.BIG:case m.CODE:case m.FONT:case m.SMALL:case m.STRIKE:case m.STRONG:{Lq(t,e);break}case m.A:{Pq(t,e);break}case m.H1:case m.H2:case m.H3:case m.H4:case m.H5:case m.H6:{Aq(t,e);break}case m.P:case m.DL:case m.OL:case m.UL:case m.DIV:case m.DIR:case m.NAV:case m.MAIN:case m.MENU:case m.ASIDE:case m.CENTER:case m.FIGURE:case m.FOOTER:case m.HEADER:case m.HGROUP:case m.DIALOG:case m.DETAILS:case m.ADDRESS:case m.ARTICLE:case m.SEARCH:case m.SECTION:case m.SUMMARY:case m.FIELDSET:case m.BLOCKQUOTE:case m.FIGCAPTION:{Cq(t,e);break}case m.LI:case m.DD:case m.DT:{Dq(t,e);break}case m.BR:case m.IMG:case m.WBR:case m.AREA:case m.EMBED:case m.KEYGEN:{CM(t,e);break}case m.HR:{Hq(t,e);break}case m.RB:case m.RTC:{qq(t,e);break}case m.RT:case m.RP:{Xq(t,e);break}case m.PRE:case m.LISTING:{Iq(t,e);break}case m.XMP:{jq(t,e);break}case m.SVG:{Qq(t,e);break}case m.HTML:{kq(t,e);break}case m.BASE:case m.LINK:case m.META:case m.STYLE:case m.TITLE:case m.SCRIPT:case m.BGSOUND:case m.BASEFONT:case m.TEMPLATE:{ki(t,e);break}case m.BODY:{Tq(t,e);break}case m.FORM:{Mq(t,e);break}case m.NOBR:{Rq(t,e);break}case m.MATH:{Kq(t,e);break}case m.TABLE:{Fq(t,e);break}case m.INPUT:{Uq(t,e);break}case m.PARAM:case m.TRACK:case m.SOURCE:{$q(t,e);break}case m.IMAGE:{zq(t,e);break}case m.BUTTON:{Oq(t,e);break}case m.APPLET:case m.OBJECT:case m.MARQUEE:{Bq(t,e);break}case m.IFRAME:{Yq(t,e);break}case m.SELECT:{Gq(t,e);break}case m.OPTION:case m.OPTGROUP:{Vq(t,e);break}case m.NOEMBED:case m.NOFRAMES:{IM(t,e);break}case m.FRAMESET:{Sq(t,e);break}case m.TEXTAREA:{Wq(t,e);break}case m.NOSCRIPT:{t.options.scriptingEnabled?IM(t,e):MM(t,e);break}case m.PLAINTEXT:{Nq(t,e);break}case m.COL:case m.TH:case m.TD:case m.TR:case m.HEAD:case m.FRAME:case m.TBODY:case m.TFOOT:case m.THEAD:case m.CAPTION:case m.COLGROUP:break;default:MM(t,e)}}function Zq(t,e){if(t.openElements.hasInScope(m.BODY)&&(t.insertionMode=S.AFTER_BODY,t.options.sourceCodeLocationInfo)){const n=t.openElements.tryPeekProperlyNestedBodyElement();n&&t._setEndLocation(n,e)}}function Jq(t,e){t.openElements.hasInScope(m.BODY)&&(t.insertionMode=S.AFTER_BODY,$M(t,e))}function eX(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n))}function tX(t){const e=t.openElements.tmplCount>0,{formElement:n}=t;e||(t.formElement=null),(n||e)&&t.openElements.hasInScope(m.FORM)&&(t.openElements.generateImpliedEndTags(),e?t.openElements.popUntilTagNamePopped(m.FORM):n&&t.openElements.remove(n))}function nX(t){t.openElements.hasInButtonScope(m.P)||t._insertFakeElement(P.P,m.P),t._closePElement()}function rX(t){t.openElements.hasInListItemScope(m.LI)&&(t.openElements.generateImpliedEndTagsWithExclusion(m.LI),t.openElements.popUntilTagNamePopped(m.LI))}function iX(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTagsWithExclusion(n),t.openElements.popUntilTagNamePopped(n))}function sX(t){t.openElements.hasNumberedHeaderInScope()&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilNumberedHeaderPopped())}function oX(t,e){const n=e.tagID;t.openElements.hasInScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker())}function aX(t){t._reconstructActiveFormattingElements(),t._insertFakeElement(P.BR,m.BR),t.openElements.pop(),t.framesetOk=!1}function DM(t,e){const n=e.tagName,r=e.tagID;for(let i=t.openElements.stackTop;i>0;i--){const s=t.openElements.items[i],o=t.openElements.tagIDs[i];if(r===o&&(r!==m.UNKNOWN||t.treeAdapter.getTagName(s)===n)){t.openElements.generateImpliedEndTagsWithExclusion(r),t.openElements.stackTop>=i&&t.openElements.shortenToLength(i);break}if(t._isSpecialElement(s,o))break}}function Qp(t,e){switch(e.tagID){case m.A:case m.B:case m.I:case m.S:case m.U:case m.EM:case m.TT:case m.BIG:case m.CODE:case m.FONT:case m.NOBR:case m.SMALL:case m.STRIKE:case m.STRONG:{rx(t,e);break}case m.P:{nX(t);break}case m.DL:case m.UL:case m.OL:case m.DIR:case m.DIV:case m.NAV:case m.PRE:case m.MAIN:case m.MENU:case m.ASIDE:case m.BUTTON:case m.CENTER:case m.FIGURE:case m.FOOTER:case m.HEADER:case m.HGROUP:case m.DIALOG:case m.ADDRESS:case m.ARTICLE:case m.DETAILS:case m.SEARCH:case m.SECTION:case m.SUMMARY:case m.LISTING:case m.FIELDSET:case m.BLOCKQUOTE:case m.FIGCAPTION:{eX(t,e);break}case m.LI:{rX(t);break}case m.DD:case m.DT:{iX(t,e);break}case m.H1:case m.H2:case m.H3:case m.H4:case m.H5:case m.H6:{sX(t);break}case m.BR:{aX(t);break}case m.BODY:{Zq(t,e);break}case m.HTML:{Jq(t,e);break}case m.FORM:{tX(t);break}case m.APPLET:case m.OBJECT:case m.MARQUEE:{oX(t,e);break}case m.TEMPLATE:{fl(t,e);break}default:DM(t,e)}}function NM(t,e){t.tmplInsertionModeStack.length>0?UM(t,e):sx(t,e)}function lX(t,e){var n;e.tagID===m.SCRIPT&&((n=t.scriptHandler)===null||n===void 0||n.call(t,t.openElements.current)),t.openElements.pop(),t.insertionMode=t.originalInsertionMode}function cX(t,e){t._err(e,F.eofInElementThatCanContainOnlyText),t.openElements.pop(),t.insertionMode=t.originalInsertionMode,t.onEof(e)}function ox(t,e){if(t.openElements.currentTagId!==void 0&&vM.has(t.openElements.currentTagId))switch(t.pendingCharacterTokens.length=0,t.hasNonWhitespacePendingCharacterToken=!1,t.originalInsertionMode=t.insertionMode,t.insertionMode=S.IN_TABLE_TEXT,e.type){case tt.CHARACTER:{PM(t,e);break}case tt.WHITESPACE_CHARACTER:{OM(t,e);break}}else vh(t,e)}function uX(t,e){t.openElements.clearBackToTableContext(),t.activeFormattingElements.insertMarker(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_CAPTION}function dX(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_COLUMN_GROUP}function hX(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(P.COLGROUP,m.COLGROUP),t.insertionMode=S.IN_COLUMN_GROUP,ax(t,e)}function fX(t,e){t.openElements.clearBackToTableContext(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_TABLE_BODY}function pX(t,e){t.openElements.clearBackToTableContext(),t._insertFakeElement(P.TBODY,m.TBODY),t.insertionMode=S.IN_TABLE_BODY,Jp(t,e)}function mX(t,e){t.openElements.hasInTableScope(m.TABLE)&&(t.openElements.popUntilTagNamePopped(m.TABLE),t._resetInsertionMode(),t._processStartTag(e))}function gX(t,e){AM(e)?t._appendElement(e,j.HTML):vh(t,e),e.ackSelfClosing=!0}function bX(t,e){!t.formElement&&t.openElements.tmplCount===0&&(t._insertElement(e,j.HTML),t.formElement=t.openElements.current,t.openElements.pop())}function Lc(t,e){switch(e.tagID){case m.TD:case m.TH:case m.TR:{pX(t,e);break}case m.STYLE:case m.SCRIPT:case m.TEMPLATE:{ki(t,e);break}case m.COL:{hX(t,e);break}case m.FORM:{bX(t,e);break}case m.TABLE:{mX(t,e);break}case m.TBODY:case m.TFOOT:case m.THEAD:{fX(t,e);break}case m.INPUT:{gX(t,e);break}case m.CAPTION:{uX(t,e);break}case m.COLGROUP:{dX(t,e);break}default:vh(t,e)}}function Eh(t,e){switch(e.tagID){case m.TABLE:{t.openElements.hasInTableScope(m.TABLE)&&(t.openElements.popUntilTagNamePopped(m.TABLE),t._resetInsertionMode());break}case m.TEMPLATE:{fl(t,e);break}case m.BODY:case m.CAPTION:case m.COL:case m.COLGROUP:case m.HTML:case m.TBODY:case m.TD:case m.TFOOT:case m.TH:case m.THEAD:case m.TR:break;default:vh(t,e)}}function vh(t,e){const n=t.fosterParentingEnabled;t.fosterParentingEnabled=!0,Kp(t,e),t.fosterParentingEnabled=n}function OM(t,e){t.pendingCharacterTokens.push(e)}function PM(t,e){t.pendingCharacterTokens.push(e),t.hasNonWhitespacePendingCharacterToken=!0}function wh(t,e){let n=0;if(t.hasNonWhitespacePendingCharacterToken)for(;n<t.pendingCharacterTokens.length;n++)vh(t,t.pendingCharacterTokens[n]);else for(;n<t.pendingCharacterTokens.length;n++)t._insertCharacters(t.pendingCharacterTokens[n]);t.insertionMode=t.originalInsertionMode,t._processToken(e)}const LM=new Set([m.CAPTION,m.COL,m.COLGROUP,m.TBODY,m.TD,m.TFOOT,m.TH,m.THEAD,m.TR]);function yX(t,e){const n=e.tagID;LM.has(n)?t.openElements.hasInTableScope(m.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(m.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=S.IN_TABLE,Lc(t,e)):Xn(t,e)}function _X(t,e){const n=e.tagID;switch(n){case m.CAPTION:case m.TABLE:{t.openElements.hasInTableScope(m.CAPTION)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(m.CAPTION),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=S.IN_TABLE,n===m.TABLE&&Eh(t,e));break}case m.BODY:case m.COL:case m.COLGROUP:case m.HTML:case m.TBODY:case m.TD:case m.TFOOT:case m.TH:case m.THEAD:case m.TR:break;default:Qp(t,e)}}function ax(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.COL:{t._appendElement(e,j.HTML),e.ackSelfClosing=!0;break}case m.TEMPLATE:{ki(t,e);break}default:Zp(t,e)}}function xX(t,e){switch(e.tagID){case m.COLGROUP:{t.openElements.currentTagId===m.COLGROUP&&(t.openElements.pop(),t.insertionMode=S.IN_TABLE);break}case m.TEMPLATE:{fl(t,e);break}case m.COL:break;default:Zp(t,e)}}function Zp(t,e){t.openElements.currentTagId===m.COLGROUP&&(t.openElements.pop(),t.insertionMode=S.IN_TABLE,t._processToken(e))}function Jp(t,e){switch(e.tagID){case m.TR:{t.openElements.clearBackToTableBodyContext(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_ROW;break}case m.TH:case m.TD:{t.openElements.clearBackToTableBodyContext(),t._insertFakeElement(P.TR,m.TR),t.insertionMode=S.IN_ROW,em(t,e);break}case m.CAPTION:case m.COL:case m.COLGROUP:case m.TBODY:case m.TFOOT:case m.THEAD:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE,Lc(t,e));break}default:Lc(t,e)}}function lx(t,e){const n=e.tagID;switch(e.tagID){case m.TBODY:case m.TFOOT:case m.THEAD:{t.openElements.hasInTableScope(n)&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE);break}case m.TABLE:{t.openElements.hasTableBodyContextInTableScope()&&(t.openElements.clearBackToTableBodyContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE,Eh(t,e));break}case m.BODY:case m.CAPTION:case m.COL:case m.COLGROUP:case m.HTML:case m.TD:case m.TH:case m.TR:break;default:Eh(t,e)}}function em(t,e){switch(e.tagID){case m.TH:case m.TD:{t.openElements.clearBackToTableRowContext(),t._insertElement(e,j.HTML),t.insertionMode=S.IN_CELL,t.activeFormattingElements.insertMarker();break}case m.CAPTION:case m.COL:case m.COLGROUP:case m.TBODY:case m.TFOOT:case m.THEAD:case m.TR:{t.openElements.hasInTableScope(m.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE_BODY,Jp(t,e));break}default:Lc(t,e)}}function RM(t,e){switch(e.tagID){case m.TR:{t.openElements.hasInTableScope(m.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE_BODY);break}case m.TABLE:{t.openElements.hasInTableScope(m.TR)&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE_BODY,lx(t,e));break}case m.TBODY:case m.TFOOT:case m.THEAD:{(t.openElements.hasInTableScope(e.tagID)||t.openElements.hasInTableScope(m.TR))&&(t.openElements.clearBackToTableRowContext(),t.openElements.pop(),t.insertionMode=S.IN_TABLE_BODY,lx(t,e));break}case m.BODY:case m.CAPTION:case m.COL:case m.COLGROUP:case m.HTML:case m.TD:case m.TH:break;default:Eh(t,e)}}function EX(t,e){const n=e.tagID;LM.has(n)?(t.openElements.hasInTableScope(m.TD)||t.openElements.hasInTableScope(m.TH))&&(t._closeTableCell(),em(t,e)):Xn(t,e)}function vX(t,e){const n=e.tagID;switch(n){case m.TD:case m.TH:{t.openElements.hasInTableScope(n)&&(t.openElements.generateImpliedEndTags(),t.openElements.popUntilTagNamePopped(n),t.activeFormattingElements.clearToLastMarker(),t.insertionMode=S.IN_ROW);break}case m.TABLE:case m.TBODY:case m.TFOOT:case m.THEAD:case m.TR:{t.openElements.hasInTableScope(n)&&(t._closeTableCell(),RM(t,e));break}case m.BODY:case m.CAPTION:case m.COL:case m.COLGROUP:case m.HTML:break;default:Qp(t,e)}}function BM(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.OPTION:{t.openElements.currentTagId===m.OPTION&&t.openElements.pop(),t._insertElement(e,j.HTML);break}case m.OPTGROUP:{t.openElements.currentTagId===m.OPTION&&t.openElements.pop(),t.openElements.currentTagId===m.OPTGROUP&&t.openElements.pop(),t._insertElement(e,j.HTML);break}case m.HR:{t.openElements.currentTagId===m.OPTION&&t.openElements.pop(),t.openElements.currentTagId===m.OPTGROUP&&t.openElements.pop(),t._appendElement(e,j.HTML),e.ackSelfClosing=!0;break}case m.INPUT:case m.KEYGEN:case m.TEXTAREA:case m.SELECT:{t.openElements.hasInSelectScope(m.SELECT)&&(t.openElements.popUntilTagNamePopped(m.SELECT),t._resetInsertionMode(),e.tagID!==m.SELECT&&t._processStartTag(e));break}case m.SCRIPT:case m.TEMPLATE:{ki(t,e);break}}}function FM(t,e){switch(e.tagID){case m.OPTGROUP:{t.openElements.stackTop>0&&t.openElements.currentTagId===m.OPTION&&t.openElements.tagIDs[t.openElements.stackTop-1]===m.OPTGROUP&&t.openElements.pop(),t.openElements.currentTagId===m.OPTGROUP&&t.openElements.pop();break}case m.OPTION:{t.openElements.currentTagId===m.OPTION&&t.openElements.pop();break}case m.SELECT:{t.openElements.hasInSelectScope(m.SELECT)&&(t.openElements.popUntilTagNamePopped(m.SELECT),t._resetInsertionMode());break}case m.TEMPLATE:{fl(t,e);break}}}function wX(t,e){const n=e.tagID;n===m.CAPTION||n===m.TABLE||n===m.TBODY||n===m.TFOOT||n===m.THEAD||n===m.TR||n===m.TD||n===m.TH?(t.openElements.popUntilTagNamePopped(m.SELECT),t._resetInsertionMode(),t._processStartTag(e)):BM(t,e)}function kX(t,e){const n=e.tagID;n===m.CAPTION||n===m.TABLE||n===m.TBODY||n===m.TFOOT||n===m.THEAD||n===m.TR||n===m.TD||n===m.TH?t.openElements.hasInTableScope(n)&&(t.openElements.popUntilTagNamePopped(m.SELECT),t._resetInsertionMode(),t.onEndTag(e)):FM(t,e)}function TX(t,e){switch(e.tagID){case m.BASE:case m.BASEFONT:case m.BGSOUND:case m.LINK:case m.META:case m.NOFRAMES:case m.SCRIPT:case m.STYLE:case m.TEMPLATE:case m.TITLE:{ki(t,e);break}case m.CAPTION:case m.COLGROUP:case m.TBODY:case m.TFOOT:case m.THEAD:{t.tmplInsertionModeStack[0]=S.IN_TABLE,t.insertionMode=S.IN_TABLE,Lc(t,e);break}case m.COL:{t.tmplInsertionModeStack[0]=S.IN_COLUMN_GROUP,t.insertionMode=S.IN_COLUMN_GROUP,ax(t,e);break}case m.TR:{t.tmplInsertionModeStack[0]=S.IN_TABLE_BODY,t.insertionMode=S.IN_TABLE_BODY,Jp(t,e);break}case m.TD:case m.TH:{t.tmplInsertionModeStack[0]=S.IN_ROW,t.insertionMode=S.IN_ROW,em(t,e);break}default:t.tmplInsertionModeStack[0]=S.IN_BODY,t.insertionMode=S.IN_BODY,Xn(t,e)}}function SX(t,e){e.tagID===m.TEMPLATE&&fl(t,e)}function UM(t,e){t.openElements.tmplCount>0?(t.openElements.popUntilTagNamePopped(m.TEMPLATE),t.activeFormattingElements.clearToLastMarker(),t.tmplInsertionModeStack.shift(),t._resetInsertionMode(),t.onEof(e)):sx(t,e)}function CX(t,e){e.tagID===m.HTML?Xn(t,e):tm(t,e)}function $M(t,e){var n;if(e.tagID===m.HTML){if(t.fragmentContext||(t.insertionMode=S.AFTER_AFTER_BODY),t.options.sourceCodeLocationInfo&&t.openElements.tagIDs[0]===m.HTML){t._setEndLocation(t.openElements.items[0],e);const r=t.openElements.items[1];r&&!(!((n=t.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&t._setEndLocation(r,e)}}else tm(t,e)}function tm(t,e){t.insertionMode=S.IN_BODY,Kp(t,e)}function AX(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.FRAMESET:{t._insertElement(e,j.HTML);break}case m.FRAME:{t._appendElement(e,j.HTML),e.ackSelfClosing=!0;break}case m.NOFRAMES:{ki(t,e);break}}}function IX(t,e){e.tagID===m.FRAMESET&&!t.openElements.isRootHtmlElementCurrent()&&(t.openElements.pop(),!t.fragmentContext&&t.openElements.currentTagId!==m.FRAMESET&&(t.insertionMode=S.AFTER_FRAMESET))}function MX(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.NOFRAMES:{ki(t,e);break}}}function DX(t,e){e.tagID===m.HTML&&(t.insertionMode=S.AFTER_AFTER_FRAMESET)}function NX(t,e){e.tagID===m.HTML?Xn(t,e):nm(t,e)}function nm(t,e){t.insertionMode=S.IN_BODY,Kp(t,e)}function OX(t,e){switch(e.tagID){case m.HTML:{Xn(t,e);break}case m.NOFRAMES:{ki(t,e);break}}}function PX(t,e){e.chars=Dt,t._insertCharacters(e)}function LX(t,e){t._insertCharacters(e),t.framesetOk=!1}function HM(t){for(;t.treeAdapter.getNamespaceURI(t.openElements.current)!==j.HTML&&t.openElements.currentTagId!==void 0&&!t._isIntegrationPoint(t.openElements.currentTagId,t.openElements.current);)t.openElements.pop()}function RX(t,e){if(QV(e))HM(t),t._startTagOutsideForeignContent(e);else{const n=t._getAdjustedCurrentElement(),r=t.treeAdapter.getNamespaceURI(n);r===j.MATHML?xM(e):r===j.SVG&&(ZV(e),EM(e)),nx(e),e.selfClosing?t._appendElement(e,r):t._insertElement(e,r),e.ackSelfClosing=!0}}function BX(t,e){if(e.tagID===m.P||e.tagID===m.BR){HM(t),t._endTagOutsideForeignContent(e);return}for(let n=t.openElements.stackTop;n>0;n--){const r=t.openElements.items[n];if(t.treeAdapter.getNamespaceURI(r)===j.HTML){t._endTagOutsideForeignContent(e);break}const i=t.treeAdapter.getTagName(r);if(i.toLowerCase()===e.tagName){e.tagName=i,t.openElements.shortenToLength(n);break}}}P.AREA,P.BASE,P.BASEFONT,P.BGSOUND,P.BR,P.COL,P.EMBED,P.FRAME,P.HR,P.IMG,P.INPUT,P.KEYGEN,P.LINK,P.META,P.PARAM,P.SOURCE,P.TRACK,P.WBR;function FX(t,e){return kM.parse(t,e)}function UX(t,e,n){typeof t=="string"&&(n=e,e=t,t=null);const r=kM.getFragmentParser(t,n);return r.tokenizer.write(e,!0),r.getFragment()}function kh(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?zM(t.position):"start"in t||"end"in t?zM(t):"line"in t||"column"in t?cx(t):""}function cx(t){return WM(t&&t.line)+":"+WM(t&&t.column)}function zM(t){return cx(t&&t.start)+"-"+cx(t&&t.end)}function WM(t){return t&&typeof t=="number"?t:1}class dr extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let i="",s={},o=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof e=="string"?i=e:!s.cause&&e&&(o=!0,i=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?s.ruleId=r:(s.source=r.slice(0,l),s.ruleId=r.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const a=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=a?a.line:void 0,this.name=kh(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=o&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual,this.expected,this.note,this.url}}dr.prototype.file="",dr.prototype.name="",dr.prototype.reason="",dr.prototype.message="",dr.prototype.stack="",dr.prototype.column=void 0,dr.prototype.line=void 0,dr.prototype.ancestors=void 0,dr.prototype.cause=void 0,dr.prototype.fatal=void 0,dr.prototype.place=void 0,dr.prototype.ruleId=void 0,dr.prototype.source=void 0;const cs={basename:$X,dirname:HX,extname:zX,join:WX,sep:"/"};function $X(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Th(t);let n=0,r=-1,i=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;i--;)if(t.codePointAt(i)===47){if(s){n=i+1;break}}else r<0&&(s=!0,r=i+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let o=-1,a=e.length-1;for(;i--;)if(t.codePointAt(i)===47){if(s){n=i+1;break}}else o<0&&(s=!0,o=i+1),a>-1&&(t.codePointAt(i)===e.codePointAt(a--)?a<0&&(r=i):(a=-1,r=o));return n===r?r=o:r<0&&(r=t.length),t.slice(n,r)}function HX(t){if(Th(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function zX(t){Th(t);let e=t.length,n=-1,r=0,i=-1,s=0,o;for(;e--;){const a=t.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}n<0&&(o=!0,n=e+1),a===46?i<0?i=e:s!==1&&(s=1):i>-1&&(s=-1)}return i<0||n<0||s===0||s===1&&i===n-1&&i===r+1?"":t.slice(i,n)}function WX(...t){let e=-1,n;for(;++e<t.length;)Th(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":jX(n)}function jX(t){Th(t);const e=t.codePointAt(0)===47;let n=YX(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function YX(t,e){let n="",r=0,i=-1,s=0,o=-1,a,l;for(;++o<=t.length;){if(o<t.length)a=t.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(i===o-1||s===1))if(i!==o-1&&s===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=o,s=0;continue}}else if(n.length>0){n="",r=0,i=o,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(i+1,o):n=t.slice(i+1,o),r=o-i-1;i=o,s=0}else a===46&&s>-1?s++:s=-1}return n}function Th(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const GX={cwd:VX};function VX(){return"/"}function ux(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function qX(t){if(typeof t=="string")t=new URL(t);else if(!ux(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return XX(t)}function XX(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const dx=["history","path","basename","stem","extname","dirname"];class hx{constructor(e){let n;e?ux(e)?n={path:e}:typeof e=="string"||KX(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":GX.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<dx.length;){const s=dx[r];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let i;for(i in n)dx.includes(i)||(this[i]=n[i])}get basename(){return typeof this.path=="string"?cs.basename(this.path):void 0}set basename(e){px(e,"basename"),fx(e,"basename"),this.path=cs.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?cs.dirname(this.path):void 0}set dirname(e){jM(this.basename,"dirname"),this.path=cs.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?cs.extname(this.path):void 0}set extname(e){if(fx(e,"extname"),jM(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=cs.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){ux(e)&&(e=qX(e)),px(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?cs.basename(this.path,this.extname):void 0}set stem(e){px(e,"stem"),fx(e,"stem"),this.path=cs.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const i=this.message(e,n,r);throw i.fatal=!0,i}info(e,n,r){const i=this.message(e,n,r);return i.fatal=void 0,i}message(e,n,r){const i=new dr(e,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function fx(t,e){if(t&&t.includes(cs.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+cs.sep+"`")}function px(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function jM(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function KX(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const QX={abandonedHeadElementChild:{reason:"Unexpected metadata element after head",description:"Unexpected element after head. Expected the element before `</head>`",url:!1},abruptClosingOfEmptyComment:{reason:"Unexpected abruptly closed empty comment",description:"Unexpected `>` or `->`. Expected `-->` to close comments"},abruptDoctypePublicIdentifier:{reason:"Unexpected abruptly closed public identifier",description:"Unexpected `>`. Expected a closing `\"` or `'` after the public identifier"},abruptDoctypeSystemIdentifier:{reason:"Unexpected abruptly closed system identifier",description:"Unexpected `>`. Expected a closing `\"` or `'` after the identifier identifier"},absenceOfDigitsInNumericCharacterReference:{reason:"Unexpected non-digit at start of numeric character reference",description:"Unexpected `%c`. Expected `[0-9]` for decimal references or `[0-9a-fA-F]` for hexadecimal references"},cdataInHtmlContent:{reason:"Unexpected CDATA section in HTML",description:"Unexpected `<![CDATA[` in HTML. Remove it, use a comment, or encode special characters instead"},characterReferenceOutsideUnicodeRange:{reason:"Unexpected too big numeric character reference",description:"Unexpectedly high character reference. Expected character references to be at most hexadecimal 10ffff (or decimal 1114111)"},closingOfElementWithOpenChildElements:{reason:"Unexpected closing tag with open child elements",description:"Unexpectedly closing tag. Expected other tags to be closed first",url:!1},controlCharacterInInputStream:{reason:"Unexpected control character",description:"Unexpected control character `%x`. Expected a non-control code point, 0x00, or ASCII whitespace"},controlCharacterReference:{reason:"Unexpected control character reference",description:"Unexpectedly control character in reference. Expected a non-control code point, 0x00, or ASCII whitespace"},disallowedContentInNoscriptInHead:{reason:"Disallowed content inside `<noscript>` in `<head>`",description:"Unexpected text character `%c`. Only use text in `<noscript>`s in `<body>`",url:!1},duplicateAttribute:{reason:"Unexpected duplicate attribute",description:"Unexpectedly double attribute. Expected attributes to occur only once"},endTagWithAttributes:{reason:"Unexpected attribute on closing tag",description:"Unexpected attribute. Expected `>` instead"},endTagWithTrailingSolidus:{reason:"Unexpected slash at end of closing tag",description:"Unexpected `%c-1`. Expected `>` instead"},endTagWithoutMatchingOpenElement:{reason:"Unexpected unopened end tag",description:"Unexpected end tag. Expected no end tag or another end tag",url:!1},eofBeforeTagName:{reason:"Unexpected end of file",description:"Unexpected end of file. Expected tag name instead"},eofInCdata:{reason:"Unexpected end of file in CDATA",description:"Unexpected end of file. Expected `]]>` to close the CDATA"},eofInComment:{reason:"Unexpected end of file in comment",description:"Unexpected end of file. Expected `-->` to close the comment"},eofInDoctype:{reason:"Unexpected end of file in doctype",description:"Unexpected end of file. Expected a valid doctype (such as `<!doctype html>`)"},eofInElementThatCanContainOnlyText:{reason:"Unexpected end of file in element that can only contain text",description:"Unexpected end of file. Expected text or a closing tag",url:!1},eofInScriptHtmlCommentLikeText:{reason:"Unexpected end of file in comment inside script",description:"Unexpected end of file. Expected `-->` to close the comment"},eofInTag:{reason:"Unexpected end of file in tag",description:"Unexpected end of file. Expected `>` to close the tag"},incorrectlyClosedComment:{reason:"Incorrectly closed comment",description:"Unexpected `%c-1`. Expected `-->` to close the comment"},incorrectlyOpenedComment:{reason:"Incorrectly opened comment",description:"Unexpected `%c`. Expected `<!--` to open the comment"},invalidCharacterSequenceAfterDoctypeName:{reason:"Invalid sequence after doctype name",description:"Unexpected sequence at `%c`. Expected `public` or `system`"},invalidFirstCharacterOfTagName:{reason:"Invalid first character in tag name",description:"Unexpected `%c`. Expected an ASCII letter instead"},misplacedDoctype:{reason:"Misplaced doctype",description:"Unexpected doctype. Expected doctype before head",url:!1},misplacedStartTagForHeadElement:{reason:"Misplaced `<head>` start tag",description:"Unexpected start tag `<head>`. Expected `<head>` directly after doctype",url:!1},missingAttributeValue:{reason:"Missing attribute value",description:"Unexpected `%c-1`. Expected an attribute value or no `%c-1` instead"},missingDoctype:{reason:"Missing doctype before other content",description:"Expected a `<!doctype html>` before anything else",url:!1},missingDoctypeName:{reason:"Missing doctype name",description:"Unexpected doctype end at `%c`. Expected `html` instead"},missingDoctypePublicIdentifier:{reason:"Missing public identifier in doctype",description:"Unexpected `%c`. Expected identifier for `public` instead"},missingDoctypeSystemIdentifier:{reason:"Missing system identifier in doctype",description:'Unexpected `%c`. Expected identifier for `system` instead (suggested: `"about:legacy-compat"`)'},missingEndTagName:{reason:"Missing name in end tag",description:"Unexpected `%c`. Expected an ASCII letter instead"},missingQuoteBeforeDoctypePublicIdentifier:{reason:"Missing quote before public identifier in doctype",description:"Unexpected `%c`. Expected `\"` or `'` instead"},missingQuoteBeforeDoctypeSystemIdentifier:{reason:"Missing quote before system identifier in doctype",description:"Unexpected `%c`. Expected `\"` or `'` instead"},missingSemicolonAfterCharacterReference:{reason:"Missing semicolon after character reference",description:"Unexpected `%c`. Expected `;` instead"},missingWhitespaceAfterDoctypePublicKeyword:{reason:"Missing whitespace after public identifier in doctype",description:"Unexpected `%c`. Expected ASCII whitespace instead"},missingWhitespaceAfterDoctypeSystemKeyword:{reason:"Missing whitespace after system identifier in doctype",description:"Unexpected `%c`. Expected ASCII whitespace instead"},missingWhitespaceBeforeDoctypeName:{reason:"Missing whitespace before doctype name",description:"Unexpected `%c`. Expected ASCII whitespace instead"},missingWhitespaceBetweenAttributes:{reason:"Missing whitespace between attributes",description:"Unexpected `%c`. Expected ASCII whitespace instead"},missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers:{reason:"Missing whitespace between public and system identifiers in doctype",description:"Unexpected `%c`. Expected ASCII whitespace instead"},nestedComment:{reason:"Unexpected nested comment",description:"Unexpected `<!--`. Expected `-->`"},nestedNoscriptInHead:{reason:"Unexpected nested `<noscript>` in `<head>`",description:"Unexpected `<noscript>`. Expected a closing tag or a meta element",url:!1},nonConformingDoctype:{reason:"Unexpected non-conforming doctype declaration",description:'Expected `<!doctype html>` or `<!doctype html system "about:legacy-compat">`',url:!1},nonVoidHtmlElementStartTagWithTrailingSolidus:{reason:"Unexpected trailing slash on start tag of non-void element",description:"Unexpected `/`. Expected `>` instead"},noncharacterCharacterReference:{reason:"Unexpected noncharacter code point referenced by character reference",description:"Unexpected code point. Do not use noncharacters in HTML"},noncharacterInInputStream:{reason:"Unexpected noncharacter character",description:"Unexpected code point `%x`. Do not use noncharacters in HTML"},nullCharacterReference:{reason:"Unexpected NULL character referenced by character reference",description:"Unexpected code point. Do not use NULL characters in HTML"},openElementsLeftAfterEof:{reason:"Unexpected end of file",description:"Unexpected end of file. Expected closing tag instead",url:!1},surrogateCharacterReference:{reason:"Unexpected surrogate character referenced by character reference",description:"Unexpected code point. Do not use lone surrogate characters in HTML"},surrogateInInputStream:{reason:"Unexpected surrogate character",description:"Unexpected code point `%x`. Do not use lone surrogate characters in HTML"},unexpectedCharacterAfterDoctypeSystemIdentifier:{reason:"Invalid character after system identifier in doctype",description:"Unexpected character at `%c`. Expected `>`"},unexpectedCharacterInAttributeName:{reason:"Unexpected character in attribute name",description:"Unexpected `%c`. Expected whitespace, `/`, `>`, `=`, or probably an ASCII letter"},unexpectedCharacterInUnquotedAttributeValue:{reason:"Unexpected character in unquoted attribute value",description:"Unexpected `%c`. Quote the attribute value to include it"},unexpectedEqualsSignBeforeAttributeName:{reason:"Unexpected equals sign before attribute name",description:"Unexpected `%c`. Add an attribute name before it"},unexpectedNullCharacter:{reason:"Unexpected NULL character",description:"Unexpected code point `%x`. Do not use NULL characters in HTML"},unexpectedQuestionMarkInsteadOfTagName:{reason:"Unexpected question mark instead of tag name",description:"Unexpected `%c`. Expected an ASCII letter instead"},unexpectedSolidusInTag:{reason:"Unexpected slash in tag",description:"Unexpected `%c-1`. Expected it followed by `>` or in a quoted attribute value"},unknownNamedCharacterReference:{reason:"Unexpected unknown named character reference",description:"Unexpected character reference. Expected known named character references"}},ZX="https://html.spec.whatwg.org/multipage/parsing.html#parse-error-",JX=/-[a-z]/g,eK=/%c(?:([-+])(\d+))?/g,tK=/%x/g,nK={2:!0,1:!1,0:null},rK={};function iK(t,e){const n=e||rK,r=n.onerror,i=t instanceof hx?t:new hx(t),s=n.fragment?UX:FX,o=String(i),a=s(o,{sourceCodeLocationInfo:!0,onParseError:n.onerror?l:null,scriptingEnabled:!1});return aV(a,{file:i,space:n.space,verbose:n.verbose});function l(c){const u=c.code,d=sK(u),h=n[d],f=h??!0,p=typeof f=="number"?f:f?1:0;if(p){const b=QX[d],_=new dr(g(b.reason),{place:{start:{line:c.startLine,column:c.startCol,offset:c.startOffset},end:{line:c.endLine,column:c.endCol,offset:c.endOffset}},ruleId:u,source:"hast-util-from-html"});i.path&&(_.file=i.path,_.name=i.path+":"+_.name),_.fatal=nK[p],_.note=g(b.description),_.url=b.url===!1?void 0:ZX+u,r(_)}function g(b){return b.replace(eK,_).replace(tK,y);function _(x,E,I){const v=(I?Number.parseInt(I,10):0)*(E==="-"?-1:1),N=o.charAt(c.startOffset+v);return aK(N)}function y(){return lK(o.charCodeAt(c.startOffset))}}}}function sK(t){return t.replace(JX,oK)}function oK(t){return t.charAt(1).toUpperCase()}function aK(t){return t==="`"?"` ` `":t}function lK(t){return"0x"+t.toString(16).toUpperCase()}function mx(t){const e=this,{emitParseErrors:n,...r}={...e.data("settings"),...t};e.parser=i;function i(s,o){return iK(s,{...r,onerror:n?function(a){o.path&&(a.name=o.path+":"+a.name,a.file=o.path),o.messages.push(a)}:void 0})}}function YM(t){if(t)throw t}var gx,GM;function cK(){if(GM)return gx;GM=1;var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},s=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var u=t.call(c,"constructor"),d=c.constructor&&c.constructor.prototype&&t.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!u&&!d)return!1;var h;for(h in c);return typeof h>"u"||t.call(c,h)},o=function(c,u){n&&u.name==="__proto__"?n(c,u.name,{enumerable:!0,configurable:!0,value:u.newValue,writable:!0}):c[u.name]=u.newValue},a=function(c,u){if(u==="__proto__")if(t.call(c,u)){if(r)return r(c,u).value}else return;return c[u]};return gx=function l(){var c,u,d,h,f,p,g=arguments[0],b=1,_=arguments.length,y=!1;for(typeof g=="boolean"&&(y=g,g=arguments[1]||{},b=2),(g==null||typeof g!="object"&&typeof g!="function")&&(g={});b<_;++b)if(c=arguments[b],c!=null)for(u in c)d=a(g,u),h=a(c,u),g!==h&&(y&&h&&(s(h)||(f=i(h)))?(f?(f=!1,p=d&&i(d)?d:[]):p=d&&s(d)?d:{},o(g,{name:u,newValue:l(y,p,h)})):typeof h<"u"&&o(g,{name:u,newValue:h}));return g},gx}var uK=cK();const bx=ep(uK);function yx(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function dK(){const t=[],e={run:n,use:r};return e;function n(...i){let s=-1;const o=i.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...i);function a(l,...c){const u=t[++s];let d=-1;if(l){o(l);return}for(;++d<i.length;)(c[d]===null||c[d]===void 0)&&(c[d]=i[d]);i=c,u?hK(u,a)(...c):o(null,...c)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return t.push(i),e}}function hK(t,e){let n;return r;function r(...o){const a=t.length>o.length;let l;a&&o.push(i);try{l=t.apply(this,o)}catch(c){const u=c;if(a&&n)throw u;return i(u)}a||(l&&l.then&&typeof l.then=="function"?l.then(s,i):l instanceof Error?i(l):s(l))}function i(o,...a){n||(n=!0,e(o,...a))}function s(o){i(null,o)}}const fK=function(t){const r=this.constructor.prototype,i=r[t],s=function(){return i.apply(s,arguments)};return Object.setPrototypeOf(s,r),s},pK={}.hasOwnProperty;class _x extends fK{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=dK()}copy(){const e=new _x;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(bx(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(vx("data",this.frozen),this.namespace[e]=n,this):pK.call(this.namespace,e)&&this.namespace[e]||void 0:e?(vx("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=n.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=rm(e),r=this.parser||this.Parser;return xx("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),xx("process",this.parser||this.Parser),Ex("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(s,o){const a=rm(e),l=r.parse(a);r.run(l,a,function(u,d,h){if(u||!d||!h)return c(u);const f=d,p=r.stringify(f,h);gK(p)?h.value=p:h.result=p,c(u,h)});function c(u,d){u||!d?o(u):s?s(d):n(void 0,d)}}}processSync(e){let n=!1,r;return this.freeze(),xx("processSync",this.parser||this.Parser),Ex("processSync",this.compiler||this.Compiler),this.process(e,i),qM("processSync","process",n),r;function i(s,o){n=!0,YM(s),r=o}}run(e,n,r){VM(e),this.freeze();const i=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?s(void 0,r):new Promise(s);function s(o,a){const l=rm(n);i.run(e,l,c);function c(u,d,h){const f=d||e;u?a(u):o?o(f):r(void 0,f,h)}}}runSync(e,n){let r=!1,i;return this.run(e,n,s),qM("runSync","run",r),i;function s(o,a){YM(o),i=a,r=!0}}stringify(e,n){this.freeze();const r=rm(n),i=this.compiler||this.Compiler;return Ex("stringify",i),VM(e),i(e,r)}use(e,...n){const r=this.attachers,i=this.namespace;if(vx("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[u,...d]=c;l(u,d)}else o(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function o(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(i.settings=bx(!0,i.settings,c.settings))}function a(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){const d=c[u];s(d)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,u){let d=-1,h=-1;for(;++d<r.length;)if(r[d][0]===c){h=d;break}if(h===-1)r.push([c,...u]);else if(u.length>0){let[f,...p]=u;const g=r[h][1];yx(g)&&yx(f)&&(f=bx(!0,g,f)),r[h]=[c,f,...p]}}}}const Rc=new _x().freeze();function xx(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Ex(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function vx(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function VM(t){if(!yx(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function qM(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function rm(t){return mK(t)?t:new hx(t)}function mK(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function gK(t){return typeof t=="string"||bK(t)}function bK(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const XM=Me("clipboard-adapter-config");function KM(t){if(t.type==="element")switch(t.tagName){case"html":case"body":return t.children.map(KM).reduce((e,n)=>e==="no"||n==="no"?"no":e==="maybe"&&n==="maybe"?"maybe":"yes","maybe");case"img":return"yes";case"head":return"maybe";default:return"no"}return"maybe"}class wx extends Xi{constructor(){super(...arguments),this._getDataByType=e=>{const n=new Map;for(const r of e.types)r==="Files"?n.set(r,Array.from(e.files)):n.set(r,e.getData(r));return n.get("Files")&&n.get("text/html")&&Rc().use(mx).parse(n.get("text/html")).children.map(KM).reduce((s,o)=>s==="no"||o==="no"?"no":s==="maybe"&&o==="maybe"?"maybe":"yes","maybe")==="yes"&&n.delete("text/html"),r=>{var i;const s=n.get(r);if(s)return s;const o=(i=n.get("Files"))!=null?i:[];return o.length>0?o:""}},this._getSnapshotByPriority=async(e,n,r,i)=>{const s=Array.from(this._adapters).sort((o,a)=>a.priority-o.priority);for(const{adapter:o,mimeType:a}of s){const l=e(a);if(!(Array.isArray(l)&&(l.length===0||!l.map(c=>c.type===a||a==="*/*").reduce((c,u)=>c&&u,!0)))&&l){const c=this._getJob(),u=new o(c,this.std.store.provider),d={file:l,assets:c.assetsManager,workspaceId:n.workspace.id,pageId:n.id},h=await u.toSlice(d,n,r,i);if(h)return h}}return null},this._jobMiddlewares=[],this.copy=async e=>this.copySlice(e),this.copySlice=async e=>{const n=this._adapters.map(r=>r.mimeType);await this.writeToClipboard(async r=>{const i=(await Promise.all(n.map(async s=>{const o=await this._getClipboardItem(e,s);return typeof o=="string"?[s,o]:null}))).filter(s=>!!s);return{...r,...Object.fromEntries(i)}})},this.duplicateSlice=async(e,n,r,i,s="BLOCKSUITE/SNAPSHOT")=>{const o={[s]:await this._getClipboardItem(e,s)};await this._getSnapshotByPriority(a=>{var l;return(l=o[a])!=null?l:""},n,r,i)},this.paste=async(e,n,r,i)=>{const s=e.clipboardData;if(s)try{const o=this.readFromClipboard(s),a=await this._getSnapshotByPriority(l=>o[l],n,r,i);if(!a)throw new V(re.TransformerError,"No snapshot found");return a}catch{const a=this._getDataByType(s);return await this._getSnapshotByPriority(c=>a(c),n,r,i)}},this.pasteBlockSnapshot=async(e,n,r,i)=>this._getJob().snapshotToBlock(e,n,r,i),this.unuse=e=>{this._jobMiddlewares=this._jobMiddlewares.filter(n=>n!==e)},this.use=e=>{this._jobMiddlewares.push(e)}}get _adapters(){const e=this.std.provider.getAll(XM);return Array.from(e.values())}get configs(){return this._getJob().adapterConfigs}async _getClipboardItem(e,n){const r=this._getJob(),i=this.std.getOptional(XM(n));if(!i)return;const{adapter:s}=i,a=await new s(r,this.std.store.provider).fromSlice(e);if(a)return a.file}_getJob(){return this.std.store.getTransformer(this._jobMiddlewares)}readFromClipboard(e){const n=e.getData("text/html"),r=UG.sanitize(n),o=new DOMParser().parseFromString(r,"text/html").querySelector("[data-blocksuite-snapshot]");if(!o)throw new V(re.TransformerError,"No snapshot found");return JSON.parse(F3.decompressFromEncodedURIComponent(o.dataset.blocksuiteSnapshot))}sliceToSnapshot(e){return this._getJob().sliceToSnapshot(e)}async writeToClipboard(e){var n,r;const i=await e({"text/plain":"","text/html":"","image/png":""}),s=(n=i["text/plain"])!=null?n:"",o=(r=i["text/html"])!=null?r:"",a=i["image/png"];delete i["text/plain"],delete i["text/html"];const l={};if(a){const d="image/png";delete i[d],typeof a=="string"?l[d]=new Blob([a],{type:d}):a instanceof Blob&&(l[d]=a)}if(s.length>0){const d="text/plain";l[d]=new Blob([s],{type:d})}const c=!!o.length,u=Object.keys(l).length===0;if(c||u){const d="text/html",f=`<div data-blocksuite-snapshot='${F3.compressToEncodedURIComponent(JSON.stringify(i))}'>${o}</div>`;l[d]=new Blob([f],{type:d})}await navigator.clipboard.write([new ClipboardItem(l)])}}wx.key="clipboard";const us=Symbol("cmds");class kx extends Xi{constructor(){super(...arguments),this._createChain=e=>{const n=this._getCommandCtx,r=this._createChain,i=this.chain;return{[us]:e,run:function(){let s=n(),o=!1;try{const a=this[us];s=QM(s,[...a,(l,c)=>{o=!0,c()}])}catch(a){console.error(a)}return[o,s]},with:function(s){const o=this[us];return r([...o,(a,l)=>l(s)])},pipe:function(s,o){const a=this[us];return r([...a,(l,c)=>s({...l,...o},c)])},try:function(s){const o=this[us];return r([...o,(a,l)=>{let c=a;s(i()).some(d=>{d[us]=[(p,g)=>{g(c)},...d[us]];const[h,f]=d.run();return c={...c,...f},h?(l(c),!0):!1})}])},tryAll:function(s){const o=this[us];return r([...o,(a,l)=>{let c=a,u=!0;s(i()).forEach(h=>{h[us]=[(g,b)=>{b(c)},...h[us]];const[f,p]=h.run();c={...c,...p},f&&(u=!1)}),u||l(c)}])}}},this._getCommandCtx=()=>({std:this.std}),this.chain=()=>this._createChain([]),this.exec=(e,n)=>this.chain().pipe(e,n).run()}}kx.key="commandManager";function QM(t,[e,...n]){let r=t;return e&&e(t,i=>{r=QM({...t,...i},n)}),r}class ri{constructor(e){this.event=e,this.type="defaultState"}}class Qo{constructor(){this._map={},this.add=e=>{const n=e.type;this._map[n]&&console.warn("UIEventStateContext: state name duplicated",n),this._map[n]=e},this.get=e=>{const n=this._map[e];if(!n)throw new V(re.EventDispatcherError,`UIEventStateContext: state ${e} not found`);return n},this.has=e=>!!this._map[e]}static from(...e){const n=new Qo;return e.forEach(r=>{n.add(r)}),n}}class Tx extends ri{constructor({event:e}){super(e),this.type="clipboardState",this.raw=e}}var ro=(t=>(t.Selection="selection",t.Target="target",t))(ro||{});class Bc extends ri{constructor({event:e,sourceType:n}){super(e),this.type="sourceState",this.sourceType=n}}class yK{constructor(e){this._dispatcher=e,this._copy=n=>{const r=new Tx({event:n});this._dispatcher.run("copy",this._createContext(n,r))},this._cut=n=>{const r=new Tx({event:n});this._dispatcher.run("cut",this._createContext(n,r))},this._paste=n=>{const r=new Tx({event:n});this._dispatcher.run("paste",this._createContext(n,r))}}_createContext(e,n){return Qo.from(new ri(e),new Bc({event:e,sourceType:ro.Selection}),n)}listen(){this._dispatcher.disposables.addFromEvent(document,"cut",this._cut),this._dispatcher.disposables.addFromEvent(document,"copy",this._copy),this._dispatcher.disposables.addFromEvent(document,"paste",this._paste)}}var ZM,JM,eD,tD,nD,rD,iD;const im=(JM=(ZM=globalThis.navigator)==null?void 0:ZM.userAgent)!=null?JM:"",Sx=((eD=globalThis.navigator)==null?void 0:eD.platform)||((tD=globalThis.process)==null?void 0:tD.platform),_K=typeof window<"u"&&typeof document<"u",xK=/Apple Computer/.test((nD=globalThis.navigator)==null?void 0:nD.vendor);_K&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1;const EK=/Android \d/.test(im);xK&&(/Mobile\/\w+/.test(im)||((rD=globalThis.navigator)==null?void 0:rD.maxTouchPoints)>2);const sD=/Mac/i.test(Sx)||/darwin/.test(Sx),vK=/iPad/i.test(Sx)||/iPad/i.test(im)||/Macintosh/i.test(im)&&((iD=globalThis.navigator)==null?void 0:iD.maxTouchPoints)>2;for(var Zo={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},sm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},wK=typeof navigator<"u"&&/Mac/.test(navigator.platform),kK=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Un=0;Un<10;Un++)Zo[48+Un]=Zo[96+Un]=String(Un);for(var Un=1;Un<=24;Un++)Zo[Un+111]="F"+Un;for(var Un=65;Un<=90;Un++)Zo[Un]=String.fromCharCode(Un+32),sm[Un]=String.fromCharCode(Un);for(var Cx in Zo)sm.hasOwnProperty(Cx)||(sm[Cx]=Zo[Cx]);function TK(t){var e=wK&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||kK&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?sm:Zo)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function SK(t){const e=t.split(/-(?!$)/);let n=e.at(-1);n==="Space"&&(n=" ");let r,i,s,o;return e.slice(0,-1).forEach(a=>{if(/^(cmd|meta|m)$/i.test(a)){o=!0;return}if(/^a(lt)?$/i.test(a)){r=!0;return}if(/^(c|ctrl|control)$/i.test(a)){i=!0;return}if(/^s(hift)?$/i.test(a)){s=!0;return}if(/^mod$/i.test(a)){sD?o=!0:i=!0;return}throw new V(re.EventDispatcherError,"Unrecognized modifier name: "+a)}),r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Ax(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function CK(t){const e=Object.create(null);for(const n in t)e[SK(n)]=t[n];return e}function AK(t){const e=CK(t);return n=>{const i=n.get("keyboardState").raw,s=TK(i),o=e[Ax(s,i)];if(o&&o(n))return!0;if(s.length!==1||s===" ")return!1;if(i.shiftKey){const c=e[Ax(s,i,!1)];if(c&&c(n))return!0}const a=i.shiftKey||i.altKey||i.metaKey||s.charCodeAt(0)>127,l=Zo[i.keyCode];if(a&&l&&l!==s){const c=e[Ax(l,i)];if(c&&c(n))return!0}return!1}}function IK(t){return e=>{const n=e.get("defaultState").event;if(n instanceof InputEvent)return n.inputType==="deleteContentBackward"&&"Backspace"in t?t.Backspace(e):!1}}class Fc extends ri{constructor({event:e}){super(e),this.type="dndState",this.raw=e}}class Ix extends ri{constructor({event:e,composing:n}){super(e),this.type="keyboardState",this.raw=e,this.composing=n}}class Ti extends ri{constructor({event:e,rect:n,startX:r,startY:i,last:s}){super(e),this.type="pointerState";const o=e.clientX-n.left,a=e.clientY-n.top;this.raw=e,this.point={x:o,y:a},this.containerOffset={x:n.left,y:n.top},this.start={x:r,y:i},this.delta=s?{x:o-s.point.x,y:a-s.point.y}:{x:0,y:0},this.keys={shift:e.shiftKey,cmd:e.metaKey||e.ctrlKey,alt:e.altKey},this.button=(s==null?void 0:s.button)||e.button,this.pressure=e.pressure}get x(){return this.point.x}get y(){return this.point.y}}class MK extends ri{constructor(e,n){super(e),this.type="multiPointerState",this.pointers=n}}class DK{constructor(e){this._dispatcher=e,this._down=n=>{if(!this._shouldTrigger(n))return;const r=new Ix({event:n,composing:this.composition});this._dispatcher.run("keyDown",this._createContext(n,r))},this._shouldTrigger=n=>{if(n.isComposing)return!1;const r=sD?n.metaKey:n.ctrlKey;return!(["c","v","x"].includes(n.key)&&r&&!n.shiftKey&&!n.altKey)},this._up=n=>{if(!this._shouldTrigger(n))return;const r=new Ix({event:n,composing:this.composition});this._dispatcher.run("keyUp",this._createContext(n,r))},this.composition=!1,this._press=n=>{if(!this._shouldTrigger(n))return;const r=new Ix({event:n,composing:this.composition});this._dispatcher.run("keyPress",this._createContext(n,r))}}_createContext(e,n){return Qo.from(new ri(e),new Bc({event:e,sourceType:ro.Selection}),n)}bindHotkey(e,n){const r=new hn;return EK&&r.add(this._dispatcher.add("beforeInput",i=>this.composition?!1:IK(e)(i),n)),r.add(this._dispatcher.add("keyDown",i=>this.composition?!1:AK(e)(i),n)),()=>r.dispose()}listen(){this._dispatcher.disposables.addFromEvent(document,"keydown",this._down),this._dispatcher.disposables.addFromEvent(document,"keyup",this._up),this._dispatcher.disposables.addFromEvent(document,"keypress",this._press),this._dispatcher.disposables.addFromEvent(document,"compositionstart",()=>{this.composition=!0},{capture:!0}),this._dispatcher.disposables.addFromEvent(document,"compositionend",()=>{this.composition=!1},{capture:!0})}}function Sh(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.pow(n,2)+Math.pow(r,2)>4}const NK=t=>t.toLowerCase();function io(t,e){return Qo.from(new ri(t),new Bc({event:t,sourceType:ro.Target}),e)}const OK=1e3;class om{constructor(e,n){this._dispatcher=e,this._getRect=n}}class PK extends om{constructor(){super(...arguments),this._down=e=>{const{pointerId:n}=e,r=new Ti({event:e,rect:this._getRect(),startX:-1/0,startY:-1/0,last:null});this._startStates.set(n,r),this._lastStates.set(n,r),this._dispatcher.run("pointerDown",io(e,r))},this._lastStates=new Map,this._move=e=>{var n,r,i,s;const{pointerId:o}=e,a=(n=this._startStates.get(o))!=null?n:null,l=(r=this._lastStates.get(o))!=null?r:null,c=new Ti({event:e,rect:this._getRect(),startX:(i=a==null?void 0:a.x)!=null?i:-1/0,startY:(s=a==null?void 0:a.y)!=null?s:-1/0,last:l});this._lastStates.set(o,c),this._dispatcher.run("pointerMove",io(e,c))},this._startStates=new Map,this._upOrOut=e=>n=>{var r,i,s,o;const{pointerId:a}=n,l=(r=this._startStates.get(a))!=null?r:null,c=(i=this._lastStates.get(a))!=null?i:null,u=new Ti({event:n,rect:this._getRect(),startX:(s=l==null?void 0:l.x)!=null?s:-1/0,startY:(o=l==null?void 0:l.y)!=null?o:-1/0,last:c});this._startStates.delete(a),this._lastStates.delete(a),this._dispatcher.run(e?"pointerUp":"pointerOut",io(n,u))}}listen(){const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(e,"pointerdown",this._down),n.addFromEvent(e,"pointermove",this._move),n.addFromEvent(e,"pointerup",this._upOrOut(!0)),n.addFromEvent(e,"pointerout",this._upOrOut(!1))}}class LK extends om{constructor(){super(...arguments),this._down=e=>{e.isPrimary!==!1&&(this._downPointerState&&e.pointerId===this._downPointerState.raw.pointerId&&e.timeStamp-this._downPointerState.raw.timeStamp<500&&!Sh(e,this._downPointerState.raw)?this._pointerDownCount++:this._pointerDownCount=1,this._downPointerState=new Ti({event:e,rect:this._getRect(),startX:-1/0,startY:-1/0,last:null}))},this._downPointerState=null,this._pointerDownCount=0,this._up=e=>{if(!this._downPointerState)return;if(Sh(this._downPointerState.raw,e)){this._pointerDownCount=0,this._downPointerState=null;return}const n=new Ti({event:e,rect:this._getRect(),startX:-1/0,startY:-1/0,last:null}),r=io(e,n);(()=>{this._dispatcher.run("click",r),this._pointerDownCount===2&&this._dispatcher.run("doubleClick",r),this._pointerDownCount===3&&this._dispatcher.run("tripleClick",r)})()}}listen(){const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(e,"pointerdown",this._down),n.addFromEvent(e,"pointerup",this._up)}}class RK extends om{constructor(){super(...arguments),this._down=e=>{if(this._nativeDragging)return;if(!e.isPrimary){this._dragging&&this._lastPointerState&&this._up(this._lastPointerState.raw),this._reset();return}const n=new Ti({event:e,rect:this._getRect(),startX:-1/0,startY:-1/0,last:null});this._startPointerState=n,this._dispatcher.disposables.addFromEvent(document,"pointermove",this._move),this._dispatcher.disposables.addFromEvent(document,"pointerup",this._up)},this._dragging=!1,this._lastPointerState=null,this._move=e=>{var n;if(this._startPointerState===null||this._startPointerState.raw.pointerId!==e.pointerId)return;const r=this._startPointerState,i=(n=this._lastPointerState)!=null?n:r,s=new Ti({event:e,rect:this._getRect(),startX:r.x,startY:r.y,last:i});this._lastPointerState=s,!this._nativeDragging&&!this._dragging&&Sh(e,this._startPointerState.raw)&&(this._dragging=!0,this._dispatcher.run("dragStart",io(e,r))),this._dragging&&this._dispatcher.run("dragMove",io(e,s))},this._nativeDragEnd=e=>{this._nativeDragging=!1;const n=new Fc({event:e});this._dispatcher.run("nativeDragEnd",this._createContext(e,n))},this._nativeDragging=!1,this._nativeDragMove=e=>{const n=new Fc({event:e});this._dispatcher.run("nativeDragMove",this._createContext(e,n))},this._nativeDragStart=e=>{this._reset(),this._nativeDragging=!0;const n=new Fc({event:e});this._dispatcher.run("nativeDragStart",this._createContext(e,n))},this._nativeDragOver=e=>{e.preventDefault();const n=new Fc({event:e});this._dispatcher.run("nativeDragOver",this._createContext(e,n))},this._nativeDragLeave=e=>{const n=new Fc({event:e});this._dispatcher.run("nativeDragLeave",this._createContext(e,n))},this._nativeDrop=e=>{this._reset(),this._nativeDragging=!1;const n=new Fc({event:e});this._dispatcher.run("nativeDrop",this._createContext(e,n))},this._reset=()=>{this._dragging=!1,this._startPointerState=null,this._lastPointerState=null,document.removeEventListener("pointermove",this._move),document.removeEventListener("pointerup",this._up)},this._startPointerState=null,this._up=e=>{if(!this._startPointerState||this._startPointerState.raw.pointerId!==e.pointerId)return;const n=this._startPointerState,r=this._lastPointerState,i=new Ti({event:e,rect:this._getRect(),startX:n.x,startY:n.y,last:r});this._dragging&&this._dispatcher.run("dragEnd",io(e,i)),this._reset()}}_applyScribblePatch(){if(!vK)return;const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(e,"touchmove",r=>{this._dragging&&this._startPointerState&&this._startPointerState.raw.pointerType==="pen"&&r.preventDefault()})}_createContext(e,n){return Qo.from(new ri(e),new Bc({event:e,sourceType:ro.Target}),n)}listen(){const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(e,"pointerdown",this._down),this._applyScribblePatch(),n.add(e.std.dnd.monitor({onDragStart:()=>{this._nativeDragging=!0},onDrop:()=>{this._nativeDragging=!1}})),n.addFromEvent(e,"dragstart",this._nativeDragStart),n.addFromEvent(e,"dragend",this._nativeDragEnd),n.addFromEvent(e,"drag",this._nativeDragMove),n.addFromEvent(e,"drop",this._nativeDrop),n.addFromEvent(e,"dragover",this._nativeDragOver),n.addFromEvent(e,"dragleave",this._nativeDragLeave)}}class oD extends om{constructor(){super(...arguments),this._down=e=>{if(this._startPointerStates.primary!==null&&this._startPointerStates.secondary!==null&&this._reset(),this._startPointerStates.primary===null&&!e.isPrimary)return;const n=new Ti({event:e,rect:this._getRect(),startX:-1/0,startY:-1/0,last:null});e.isPrimary?this._startPointerStates.primary=n:this._startPointerStates.secondary=n},this._lastPointerStates={primary:null,secondary:null},this._move=e=>{if(this._startPointerStates.primary===null||this._startPointerStates.secondary===null)return;const{isPrimary:n}=e,r=this._startPointerStates.primary;let i=this._lastPointerStates.primary;const s=this._startPointerStates.secondary;let o=this._lastPointerStates.secondary;n?i=new Ti({event:e,rect:this._getRect(),startX:r.x,startY:r.y,last:i}):o=new Ti({event:e,rect:this._getRect(),startX:s.x,startY:s.y,last:o});const a=new MK(e,[i??r,o??s]);this._handleMove(e,a),this._lastPointerStates={primary:i,secondary:o}},this._reset=()=>{this._startPointerStates={primary:null,secondary:null},this._lastPointerStates={primary:null,secondary:null}},this._startPointerStates={primary:null,secondary:null},this._upOrOut=e=>{var n,r;const{pointerId:i}=e;(i===((n=this._startPointerStates.primary)==null?void 0:n.raw.pointerId)||i===((r=this._startPointerStates.secondary)==null?void 0:r.raw.pointerId))&&this._reset()}}listen(){const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(e,"pointerdown",this._down),n.addFromEvent(e,"pointermove",this._move),n.addFromEvent(e,"pointerup",this._upOrOut),n.addFromEvent(e,"pointerout",this._upOrOut)}}class BK extends oD{_handleMove(e,n){if(e.pointerType!=="touch")return;const r=n.pointers[0].delta,i=n.pointers[1].delta,s=R.toVec(r),o=R.toVec(i),a=R.len(s),l=R.len(o),c=R.dpr(s,o),u=.1;!Sh(r,i)||c>0||a<u||l<u||this._dispatcher.run("pinch",io(e,n))}}class FK extends oD{_handleMove(e,n){if(e.pointerType!=="touch")return;const r=n.pointers[0].delta,i=n.pointers[1].delta,s=R.dpr(R.toVec(r),R.toVec(i));!Sh(r,i)&&s<0||this._dispatcher.run("pan",io(e,n))}}class UK{constructor(e){this._dispatcher=e,this._cachedRect=null,this._getRect=()=>(this._cachedRect===null&&this._updateRect(),this._cachedRect),this._pollingInterval=null,this.controllers=[new PK(e,this._getRect),new LK(e,this._getRect),new RK(e,this._getRect),new FK(e,this._getRect),new BK(e,this._getRect)]}_startPolling(){const e=()=>{zv().then(()=>this._updateRect()).catch(console.error)};this._pollingInterval=window.setInterval(e,OK),e()}_updateRect(){this._dispatcher.host&&(this._cachedRect=this._dispatcher.host.getBoundingClientRect())}dispose(){this._pollingInterval!==null&&(clearInterval(this._pollingInterval),this._pollingInterval=null)}listen(){this._startPolling(),this.controllers.forEach(e=>e.listen())}}class $K{constructor(e){this._dispatcher=e,this._buildScope=n=>{let r;const i=document.getSelection();if(i&&i.rangeCount>0){const s=i.getRangeAt(0);r=this._buildEventScopeByNativeRange(n,s),this._prev=s}else this._prev!==null&&(r=this._buildEventScopeByNativeRange(n,this._prev),this._prev=null);return r},this._compositionEnd=n=>{const r=this._buildScope("compositionEnd");this._dispatcher.run("compositionEnd",this._createContext(n),r)},this._compositionStart=n=>{const r=this._buildScope("compositionStart");this._dispatcher.run("compositionStart",this._createContext(n),r)},this._compositionUpdate=n=>{const r=this._buildScope("compositionUpdate");this._dispatcher.run("compositionUpdate",this._createContext(n),r)},this._prev=null,this._selectionChange=n=>{const r=document.getSelection();if(!r||!r.containsNode(this._dispatcher.host,!0)||r.containsNode(this._dispatcher.host))return;const i=this._buildScope("selectionChange");this._dispatcher.run("selectionChange",this._createContext(n),i)}}_buildEventScopeByNativeRange(e,n){const r=this._findBlockComponentPath(n);return this._dispatcher.buildEventScope(e,r)}_createContext(e){return Qo.from(new ri(e),new Bc({event:e,sourceType:ro.Selection}))}_findBlockComponentPath(e){const n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,s=u=>{var d;const h=u instanceof Element?u:u.parentElement;return(d=h==null?void 0:h.closest("[data-block-id]"))!=null?d:null};if(i.nodeType===Node.TEXT_NODE){const u=s(i);if(u)return[u.blockId]}const o=new Set;let a=!1;const l=(u,d)=>{if(u&&u!==d){if(u===r){o.add(u),a=!1;return}u===n&&(a=!0),a&&(u.nodeType===Node.TEXT_NODE||u.nodeType===Node.ELEMENT_NODE)&&o.add(u),l(u.firstChild,d),l(u.nextSibling,d)}};l(i.firstChild,i);const c=new Set;return o.forEach(u=>{const d=s(u);d&&(c.has(d.blockId)||c.add(d.blockId))}),Array.from(c)}listen(){const{host:e,disposables:n}=this._dispatcher;n.addFromEvent(document,"selectionchange",this._selectionChange),n.addFromEvent(e,"compositionstart",this._compositionStart),n.addFromEvent(e,"compositionend",this._compositionEnd),n.addFromEvent(e,"compositionupdate",this._compositionUpdate)}}const aD=["beforeInput","blur","focus","contextMenu","wheel"],HK=["click","doubleClick","tripleClick","pointerDown","pointerMove","pointerUp","pointerOut","dragStart","dragMove","dragEnd","pinch","pan","keyDown","keyUp","keyPress","selectionChange","compositionStart","compositionUpdate","compositionEnd","cut","copy","paste","nativeDragStart","nativeDragMove","nativeDragEnd","nativeDrop","nativeDragOver","nativeDragLeave",...aD],Mx=class Sl extends Xi{constructor(e){super(e),this._active=un(!1),this._handlersMap=Object.fromEntries(HK.map(n=>[n,[]])),this.bindHotkey=(...n)=>this._keyboardControl.bindHotkey(...n),this.disposables=new hn,this._pointerControl=new UK(this),this._keyboardControl=new DK(this),this._rangeControl=new $K(this),this._clipboardControl=new yK(this),this.disposables.add(this._pointerControl)}get _currentSelections(){return this.std.selection.value}get active(){return this._active.peek()}get active$(){return this._active}get host(){return this.std.host}_bindEvents(){aD.forEach(n=>{this.disposables.addFromEvent(this.host,NK(n),r=>{this.run(n,Qo.from(new ri(r),new Bc({event:r,sourceType:ro.Selection})))},n==="wheel"?{passive:!1}:void 0)}),this._pointerControl.listen(),this._keyboardControl.listen(),this._rangeControl.listen(),this._clipboardControl.listen();let e=!1;this.disposables.addFromEvent(this.host,"pointerdown",()=>{e=!0,this._setActive(!0)}),this.disposables.addFromEvent(this.host,"pointerup",()=>{e=!1}),this.disposables.addFromEvent(this.host,"click",()=>{this._setActive(!0)}),this.disposables.addFromEvent(this.host,"focusin",()=>{this._setActive(!0)}),this.disposables.addFromEvent(document,"focusout",n=>{n.relatedTarget&&!this.host.contains(n.relatedTarget)&&this._setActive(!1)}),this.disposables.addFromEvent(this.host,"blur",()=>{e||this._setActive(!1)}),this.disposables.addFromEvent(this.host,"dragover",()=>{e=!0,this._setActive(!0)}),this.disposables.addFromEvent(this.host,"dragenter",()=>{e=!0,this._setActive(!0)}),this.disposables.addFromEvent(this.host,"dragstart",()=>{e=!0,this._setActive(!0)}),this.disposables.addFromEvent(this.host,"dragend",()=>{e=!1}),this.disposables.addFromEvent(this.host,"drop",()=>{e=!1,this._setActive(!0)}),this.disposables.addFromEvent(this.host,"pointerenter",()=>{this._isActiveElementOutsideHost()||this._setActive(!0)}),this.disposables.addFromEvent(this.host,"pointerleave",()=>{document.activeElement&&this.host.contains(document.activeElement)||e||this._setActive(!1)}),this.disposables.addFromEvent(document,"visibilitychange",()=>{document.visibilityState==="hidden"&&this._setActive(!1)})}_buildEventScopeBySelection(e){if(!this._handlersMap[e])return;const i=this._currentSelections.map(s=>s.blockId);return this.buildEventScope(e,i)}_buildEventScopeByTarget(e,n){if(!this._handlersMap[e])return;const i=n instanceof Element?n:n.parentElement,s=i==null?void 0:i.closest("[data-block-id]"),o=s==null?void 0:s.blockId;return o?this.buildEventScope(e,[o]):this._buildEventScopeBySelection(e)}_getDeepActiveElement(){let e=document.activeElement;for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_getEventScope(e,n){if(!this._handlersMap[e])return;let i;switch(n.sourceType){case ro.Selection:{i=this._buildEventScopeBySelection(e);break}case ro.Target:{i=this._buildEventScopeByTarget(e,n.event.target);break}default:throw new V(re.EventDispatcherError,`Unknown event scope source: ${n.sourceType}`)}return i}_isActiveElementOutsideHost(){const e=this._getDeepActiveElement();return e!==null&&this._isEditableElementActive(e)&&!this.host.contains(e)}_isEditableElementActive(e){return e?e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof Vs&&!e.store.readonly||e.isContentEditable:!1}_setActive(e){e?(Sl._activeDispatcher!==this&&(Sl._activeDispatcher&&(Sl._activeDispatcher._active.value=!1),Sl._activeDispatcher=this),this._active.value=!0):(Sl._activeDispatcher===this&&(Sl._activeDispatcher=null),this._active.value=!1)}set active(e){e!==this._active.peek()&&this._setActive(e)}add(e,n,r){const i={fn:n,flavour:r==null?void 0:r.flavour,blockId:r==null?void 0:r.blockId};return this._handlersMap[e].unshift(i),()=>{this._handlersMap[e].includes(i)&&(this._handlersMap[e]=this._handlersMap[e].filter(s=>s!==i))}}buildEventScope(e,n){const r=this._handlersMap[e];if(!r)return;const i=r.filter(l=>l.flavour===void 0&&l.blockId===void 0);let s=n;const o=[],a={};for(;s.length>0;){const l=r.filter(u=>u.blockId&&s.includes(u.blockId)),c=s.map(u=>{var d;return(d=this.std.store.getBlock(u))==null?void 0:d.flavour}).filter(u=>!u||a[u]?!1:(a[u]=!0,!0)).flatMap(u=>r.filter(d=>d.flavour===u));o.push(...l,...c),s=s.map(u=>{const d=this.std.store.getParent(u);return d==null?void 0:d.id}).filter(u=>!!u)}return o.concat(i)}mounted(){this.disposables.disposed&&(this.disposables=new hn),this._bindEvents();const e=this.std;this.std.provider.getAll(m9).forEach(({getter:n,options:r})=>{this.bindHotkey(n(e),r)})}run(e,n,r){if(!this.active)return;const i=n.get("sourceState");if(!(!r&&(r=this._getEventScope(e,i),!r)))for(const s of r){const{fn:o}=s;if(o(n)){n.get("defaultState").event.stopPropagation();return}}}unmounted(){this.disposables.dispose()}};Mx._activeDispatcher=null,Mx.key="UIEventDispatcher";let lD=Mx;const cD="data-v-root",zK="data-range-query-exclude",Dx="data-range-sync-exclude";function WK(t){const e=document.activeElement;if(!e||e.closest(`[${Dx}="true"]`))return!1;const n=e==null?void 0:e.closest("editor-host");return n?n===t:!1}var jK="Expected a function";function YK(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(jK);return Ws(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Ib(t,e,{leading:r,maxWait:e,trailing:i})}class GK{constructor(e){this.manager=e,this._compositionStartCallback=null,this._computePath=n=>{var r;const i=(r=this.host.std.store.getBlock(n))==null?void 0:r.model;if(!i)return[];const s=[];let o=i;for(;o;)s.unshift(o.id),o=this.host.store.getParent(o);return s},this._onBeforeInput=n=>{var r,i,s;const o=this.selectionManager.find(Po);if(!o||n.isComposing)return;const{from:a,to:l}=o;if(!l||a.blockId===l.blockId)return;const c=(r=this.rangeManager)==null?void 0:r.value;if(!c)return;const u=this.rangeManager.getSelectedBlockComponentsByRange(c,{mode:"flat"}),d=u.at(0),h=u.at(-1);if(!d||!h)return;const f=d.model.text,p=h.model.text;if(!f||!p)return;n.preventDefault(),this.host.store.transact(()=>{var b;f.delete(a.index,a.length),f.insert((b=n.data)!=null?b:"",a.index),p.delete(0,l.length),f.join(p),u.slice(1).reverse().forEach(_=>{const y=this.host.store.getParent(_.model);y&&this.host.store.deleteBlock(_.model,{bringChildrenTo:y})})});const g=this.selectionManager.create(Po,{from:{blockId:a.blockId,index:a.index+((s=(i=n.data)==null?void 0:i.length)!=null?s:0),length:0},to:null});this.selectionManager.setGroup("note",[g])},this._onCompositionEnd=n=>{this._compositionStartCallback&&(n.preventDefault(),n.stopPropagation(),this._compositionStartCallback(n).catch(console.error),this._compositionStartCallback=null)},this._onCompositionStart=()=>{var n;const r=this.selectionManager.find(Po);if(!r)return;const{from:i,to:s}=r;if(!s)return;this.isComposing=!0;const o=(n=this.rangeManager)==null?void 0:n.value;if(!o)return;const a=this.rangeManager.getSelectedBlockComponentsByRange(o,{mode:"flat"}),l=a.at(0),c=a.at(-1);if(!l||!c)return;const u=l.model.text,d=c.model.text;!u||!d||(this._compositionStartCallback=async h=>{var f,p,g;this.isComposing=!1,this.host.renderRoot.replaceChildren(),delete this.host.renderRoot._$litPart$,this.host.requestUpdate(),await this.host.updateComplete,this.host.store.captureSync(),this.host.store.transact(()=>{d.delete(0,s.length),u.delete(i.index,i.length),u.insert(h.data,i.index),u.join(d),a.slice(1).reverse().forEach(_=>{const y=this.host.store.getParent(_.model);y&&this.host.store.deleteBlock(_.model,{bringChildrenTo:y})})}),await this.host.updateComplete;const b=this.selectionManager.create(Po,{from:{blockId:i.blockId,index:i.index+((p=(f=h.data)==null?void 0:f.length)!=null?p:0),length:0},to:null});this.host.selection.setGroup("note",[b]),(g=this.rangeManager)==null||g.syncTextSelectionToRange(b)})},this._onNativeSelectionChanged=async()=>{var n,r,i;if(this.isComposing||!this.host)return;if(!WK(this.host)){this._prevTextSelection=null;return}await this.host.updateComplete;const s=document.getSelection();if(!s){this.selectionManager.clear(["text"]);return}const o=s.rangeCount>0?s.getRangeAt(0):null;if(!o){this._prevTextSelection=null,this.selectionManager.clear(["text"]);return}if(!this.host.contains(o.commonAncestorContainer)||o.commonAncestorContainer instanceof Vs)return;if(o.startContainer instanceof HTMLElement&&o.startContainer.contentEditable==="false"&&o.endContainer instanceof HTMLElement&&o.endContainer.contentEditable==="false"){this._prevTextSelection=null,this.selectionManager.clear(["text"]),s.removeRange(o);return}const l=Nx(o.commonAncestorContainer);if(!l||l.closest(`[${Dx}="true"]`)||!l.closest("[contenteditable]"))return;const d=Nx(o.startContainer),h=Nx(o.endContainer);if(!(d!=null&&d.closest("v-text"))&&!(h!=null&&h.closest("v-text"))){this._prevTextSelection=null,this.selectionManager.clear(["text"]),s.removeRange(o);return}const f=(n=this.rangeManager)==null?void 0:n.getClosestInlineEditor(o.commonAncestorContainer);if(f!=null&&f.isComposing)return;const p=!!s.anchorNode&&!!s.focusNode&&(s.anchorNode===s.focusNode?s.anchorOffset>s.focusOffset:s.anchorNode.compareDocumentPosition(s.focusNode)===Node.DOCUMENT_POSITION_PRECEDING),g=(r=this.rangeManager)==null?void 0:r.rangeToTextSelection(o,p);if(!g){this._prevTextSelection=null,this.selectionManager.clear(["text"]);return}const b=this.host.store.getModelById(g.blockId);b&&(this._prevTextSelection={selection:g,path:this._computePath(b.id)},(i=this.rangeManager)==null||i.syncRangeToTextSelection(o,p))},this._onStdSelectionChanged=n=>{var r,i;const s=(r=document.activeElement)==null?void 0:r.closest("editor-host");if(s&&s!==this.host)return;const o=this.host.event.active;if(!o)return;const a=(i=n.find(l=>l.is(Po)))!=null?i:null;!a&&n.length>0&&(n.find(c=>c.constructor.recoverable)||this.host.focus({preventScroll:!0})),a!==this._prevTextSelection&&this.host.updateComplete.then(()=>{var l,c;const u=a==null?void 0:a.blockId,d=u&&this._computePath(u);o&&(a&&this._prevTextSelection&&d&&a.equals(this._prevTextSelection.selection)&&d.join("")===this._prevTextSelection.path.join(""))||(this._prevTextSelection=a&&d?{selection:a,path:d}:null,a?(l=this.rangeManager)==null||l.syncTextSelectionToRange(a):(c=this.rangeManager)==null||c.clear())}).catch(console.error)},this._prevTextSelection=null,this.isComposing=!1,this.host.disposables.add(this.selectionManager.slots.changed.subscribe(this._onStdSelectionChanged)),this.host.disposables.addFromEvent(document,"selectionchange",YK(()=>{this._onNativeSelectionChanged().catch(console.error)},10)),this.host.disposables.add(this.host.event.add("beforeInput",n=>{const r=n.get("defaultState").event;this._onBeforeInput(r)})),this.host.disposables.addFromEvent(this.host,"compositionstart",this._onCompositionStart),this.host.disposables.addFromEvent(this.host,"compositionend",this._onCompositionEnd,{capture:!0})}get host(){return this.manager.std.host}get rangeManager(){return this.host.range}get selectionManager(){return this.host.selection}}function Nx(t){return t instanceof Element?t:t.parentElement}class Ox extends Xi{constructor(){super(...arguments),this.binding=null}get value(){const e=document.getSelection();if(e)return e.rangeCount===0?null:e.getRangeAt(0)}_isRangeSyncExcluded(e){return!!e.closest(`[${Dx}="true"]`)}clear(){const e=document.getSelection();if(!e||(e.removeAllRanges(),document.activeElement===this.std.host))return;const n=this.std.host.querySelector('[contenteditable="true"]');n instanceof HTMLElement&&n.contains(document.activeElement)&&n.blur(),document.activeElement instanceof HTMLElement&&document.activeElement.blur()}getClosestBlock(e){const n=e instanceof Element?e:e.parentElement;if(!n)return null;const r=n.closest(`[${Qb}]`);return!r||this._isRangeSyncExcluded(r)?null:r}getClosestInlineEditor(e){const n=e instanceof Element?e:e.parentElement;if(!n)return null;const r=n.closest(`[${cD}]`);return!r||this._isRangeSyncExcluded(r)?null:r.inlineEditor}getSelectedBlockComponentsByRange(e,n={}){const{mode:r="all",match:i=()=>!0}=n;let s=Array.from(this.std.host.querySelectorAll(`[${Qb}]:not([${zK}="true"])`)).filter(l=>e.intersectsNode(l)&&i(l));if(s.length===0)return[];const o=this.getClosestBlock(e.startContainer);if(!o)return[];const a=s.indexOf(o);if(a===-1)return[];if(r==="flat")s=s.slice(a);else if(r==="highest"){s=s.slice(a);let l=s[0];s=s.filter((c,u)=>u===0?!0:l.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY?!1:(l=c,!0))}return s}mounted(){this.binding=new GK(this)}queryInlineEditorByPath(e){const n=this.std.host.view.getBlock(e);if(!n)return null;const r=n.querySelector(`[${cD}]`);return!r||this._isRangeSyncExcluded(r)?null:r.inlineEditor}rangeToTextSelection(e,n=!1){const{startContainer:r,endContainer:i}=e,s=this.getClosestBlock(r),o=this.getClosestBlock(i);if(!s||!o)return null;const a=this.getClosestInlineEditor(r),l=this.getClosestInlineEditor(i);if(!a||!l)return null;const c=a.toInlineRange(e),u=l.toInlineRange(e);return!c||!u?null:this.std.host.selection.create(Po,{from:{blockId:s.blockId,index:c.index,length:c.length},to:s===o?null:{blockId:o.blockId,index:u.index,length:u.length},reverse:n})}set(e){const n=document.getSelection();n&&(n.removeAllRanges(),n.addRange(e))}syncRangeToTextSelection(e,n){const r=this.std.host.selection;if(!e){r.clear(["text"]);return}const i=this.rangeToTextSelection(e,n);i?r.setGroup("note",[i]):r.clear(["text"])}syncTextSelectionToRange(e){const n=this.textSelectionToRange(e);n?this.set(n):this.clear()}textSelectionToRange(e){const{from:n,to:r}=e,i=this.queryInlineEditorByPath(n.blockId);if(!i)return null;if(e.isInSameBlock())return i.toDomRange({index:n.index,length:n.length});if(!r)return null;const s=this.queryInlineEditorByPath(r.blockId);if(!s)return null;const o=i.toDomRange({index:n.index,length:n.length}),a=s.toDomRange({index:r.index,length:r.length});if(!o||!a)return null;const l=document.createRange(),c=o.startContainer,u=o.startOffset,d=a.endContainer,h=a.endOffset;return l.setStart(c,u),l.setEnd(d,h),l}}Ox.key="rangeManager";const uD=[NC,kx,lD,Ox,M1,wx,MS,$S,Sb,CS,zS,OC,I1,DC];class dD{get _lifeCycleWatchers(){return this.provider.getAll(lp)}get dnd(){return this.get(I1)}get clipboard(){return this.get(wx)}get workspace(){return this.store.workspace}get command(){return this.get(kx)}get event(){return this.get(lD)}get get(){return this.provider.get.bind(this.provider)}get getOptional(){return this.provider.getOptional.bind(this.provider)}get host(){if(!this._host)throw new V(re.ValueNotExists,"Host is not ready to use, the `render` method should be called first");return this._host}get range(){return this.get(Ox)}get selection(){return this.get(T0)}get view(){return this.get(M1)}constructor(e){this.store=e.store,this.userExtensions=e.extensions,this.container=new ed,this.container.addImpl(Y0,()=>this),uD.forEach(n=>{const r=this.container;n.setup(r)}),this.userExtensions.forEach(n=>{const r=this.container;n.setup(r)}),this.provider=this.container.provider(void 0,this.store.provider),this._lifeCycleWatchers.forEach(n=>{n.created()})}getView(e){return this.getOptional(p9(e))}mount(){this._lifeCycleWatchers.forEach(e=>{e.mounted()})}render(){const e=new Vs;return e.std=this,e.store=this.store,this._host=e,this._lifeCycleWatchers.forEach(n=>{n.rendered()}),e}unmount(){this._lifeCycleWatchers.forEach(e=>{e.unmounted()})}}dD.internalExtensions=uD;const hD=Me("BlockHtmlAdapterMatcher");function In(t){const e=hD(t.flavour);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class am{}const VK=(t,e,n={force:!1})=>{if(t.length===0)return[e];const r=t[t.length-1];return n!=null&&n.force?(r.insert=r.insert+e.insert,r.attributes=Object.create(null),t):typeof r.insert=="string"&&typeof e.insert=="string"&&(mp(r.attributes,e.attributes)||r.attributes===void 0&&e.attributes===void 0)?(r.insert+=e.insert,t):[...t,e]},fD=t=>t==null,qK=t=>({"$blocksuite:internal:text$":!0,delta:t.length===0?[]:[{insert:t}]}),XK=t=>typeof t=="object"&&t!==null&&"$blocksuite:internal:text$"in t?t["$blocksuite:internal:text$"]===!0:!1;function pD(t){if(!t)return;const e=Object.entries(t).filter(([n,r])=>!fD(r)).filter(([n,r])=>typeof r=="string"||Array.isArray(r)?r.length>0:!1).map(([n,r])=>[n,Array.isArray(r)?r.filter(i=>i.length):r]);return new URLSearchParams(e.filter(([n,r])=>r.length).map(([n,r])=>[n,Array.isArray(r)?r.join(","):r]))}function KK(t,e,n){const r=pD(n),i=r!=null&&r.size?`?${r.toString()}`:"";return t?`${t}/${e}${i}`:""}const Kn={mergeDeltas:VK,isNullish:fD,createText:qK,isText:XK,toURLSearchParams:pD,generateDocUrl:KK},mD=Me("InlineDeltaToHtmlAdapterMatcher");function so(t){const e=mD(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}const gD=Me("HtmlASTToDeltaMatcher");function Si(t){const e=gD(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class QK extends am{constructor(e,n,r,i){super(),this.configs=e,this.inlineDeltaMatchers=n,this.htmlASTToDeltaMatchers=r,this.provider=i}_applyTextFormatting(e){let n={type:"text",value:e.insert};const r={configs:this.configs,current:n};for(const i of this.inlineDeltaMatchers)i.match(e)&&(n=i.toAST(e,r,this.provider),r.current=n);return n}_spreadAstToDelta(e,n=Object.create(null)){const r={configs:this.configs,options:n,toDelta:(i,s)=>this._spreadAstToDelta(i,s)};for(const i of this.htmlASTToDeltaMatchers)if(i.match(e))return i.toDelta(e,r);return"children"in e?e.children.flatMap(i=>this._spreadAstToDelta(i,n)):[]}astToDelta(e,n=Object.create(null)){return this._spreadAstToDelta(e,n).reduce((r,i)=>Kn.mergeDeltas(r,i),[])}deltaToAST(e,n=0){return n>0&&e.unshift({insert:" ".repeat(4).repeat(n)}),e.map(r=>this._applyTextFormatting(r))}}const ZK=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],bD={}.hasOwnProperty;function yD(t,e){const n=e||{};function r(i,...s){let o=r.invalid;const a=r.handlers;if(i&&bD.call(i,t)){const l=String(i[t]);o=bD.call(a,l)?a[l]:r.unknown}if(o)return o.call(this,i,...s)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const JK=/["&'<>`]/g,eQ=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,tQ=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,nQ=/[|\\{}()[\]^$+*?.]/g,_D=new WeakMap;function rQ(t,e){if(t=t.replace(e.subset?iQ(e.subset):JK,r),e.subset||e.escapeOnly)return t;return t.replace(eQ,n).replace(tQ,r);function n(i,s,o){return e.format((i.charCodeAt(0)-55296)*1024+i.charCodeAt(1)-56320+65536,o.charCodeAt(s+2),e)}function r(i,s,o){return e.format(i.charCodeAt(0),o.charCodeAt(s+1),e)}}function iQ(t){let e=_D.get(t);return e||(e=sQ(t),_D.set(t,e)),e}function sQ(t){const e=[];let n=-1;for(;++n<t.length;)e.push(t[n].replace(nQ,"\\$&"));return new RegExp("(?:"+e.join("|")+")","g")}const oQ=/[\dA-Fa-f]/;function aQ(t,e,n){const r="&#x"+t.toString(16).toUpperCase();return n&&e&&!oQ.test(String.fromCharCode(e))?r:r+";"}const lQ=/\d/;function cQ(t,e,n){const r="&#"+String(t);return n&&e&&!lQ.test(String.fromCharCode(e))?r:r+";"}const uQ=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],Px={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},dQ=["cent","copy","divide","gt","lt","not","para","times"],xD={}.hasOwnProperty,Lx={};let lm;for(lm in Px)xD.call(Px,lm)&&(Lx[Px[lm]]=lm);const hQ=/[^\dA-Za-z]/;function fQ(t,e,n,r){const i=String.fromCharCode(t);if(xD.call(Lx,i)){const s=Lx[i],o="&"+s;return n&&uQ.includes(s)&&!dQ.includes(s)&&(!r||e&&e!==61&&hQ.test(String.fromCharCode(e)))?o:o+";"}return""}function pQ(t,e,n){let r=aQ(t,e,n.omitOptionalSemicolons),i;if((n.useNamedReferences||n.useShortestReferences)&&(i=fQ(t,e,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!i)&&n.useShortestReferences){const s=cQ(t,e,n.omitOptionalSemicolons);s.length<r.length&&(r=s)}return i&&(!n.useShortestReferences||i.length<r.length)?i:r}function Uc(t,e){return rQ(t,Object.assign({format:pQ},e))}const mQ=/^>|^->|<!--|-->|--!>|<!-$/g,gQ=[">"],bQ=["<",">"];function yQ(t,e,n,r){return r.settings.bogusComments?"<?"+Uc(t.value,Object.assign({},r.settings.characterReferences,{subset:gQ}))+">":"<!--"+t.value.replace(mQ,i)+"-->";function i(s){return Uc(s,Object.assign({},r.settings.characterReferences,{subset:bQ}))}}function _Q(t,e,n,r){return"<!"+(r.settings.upperDoctype?"DOCTYPE":"doctype")+(r.settings.tightDoctype?"":" ")+"html>"}function cm(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let r=0,i=n.indexOf(e);for(;i!==-1;)r++,i=n.indexOf(e,i+e.length);return r}const xQ=/[ \t\n\f\r]/g;function Rx(t){return typeof t=="object"?t.type==="text"?ED(t.value):!1:ED(t)}function ED(t){return t.replace(xQ,"")===""}const mn=wD(1),vD=wD(-1),EQ=[];function wD(t){return e;function e(n,r,i){const s=n?n.children:EQ;let o=(r||0)+t,a=s[o];if(!i)for(;a&&Rx(a);)o+=t,a=s[o];return a}}const vQ={}.hasOwnProperty;function kD(t){return e;function e(n,r,i){return vQ.call(t,n.tagName)&&t[n.tagName](n,r,i)}}const Bx=kD({body:kQ,caption:Fx,colgroup:Fx,dd:AQ,dt:CQ,head:Fx,html:wQ,li:SQ,optgroup:IQ,option:MQ,p:TQ,rp:TD,rt:TD,tbody:NQ,td:SD,tfoot:OQ,th:SD,thead:DQ,tr:PQ});function Fx(t,e,n){const r=mn(n,e,!0);return!r||r.type!=="comment"&&!(r.type==="text"&&Rx(r.value.charAt(0)))}function wQ(t,e,n){const r=mn(n,e);return!r||r.type!=="comment"}function kQ(t,e,n){const r=mn(n,e);return!r||r.type!=="comment"}function TQ(t,e,n){const r=mn(n,e);return r?r.type==="element"&&(r.tagName==="address"||r.tagName==="article"||r.tagName==="aside"||r.tagName==="blockquote"||r.tagName==="details"||r.tagName==="div"||r.tagName==="dl"||r.tagName==="fieldset"||r.tagName==="figcaption"||r.tagName==="figure"||r.tagName==="footer"||r.tagName==="form"||r.tagName==="h1"||r.tagName==="h2"||r.tagName==="h3"||r.tagName==="h4"||r.tagName==="h5"||r.tagName==="h6"||r.tagName==="header"||r.tagName==="hgroup"||r.tagName==="hr"||r.tagName==="main"||r.tagName==="menu"||r.tagName==="nav"||r.tagName==="ol"||r.tagName==="p"||r.tagName==="pre"||r.tagName==="section"||r.tagName==="table"||r.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function SQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&r.tagName==="li"}function CQ(t,e,n){const r=mn(n,e);return!!(r&&r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd"))}function AQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd")}function TD(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&(r.tagName==="rp"||r.tagName==="rt")}function IQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&r.tagName==="optgroup"}function MQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&(r.tagName==="option"||r.tagName==="optgroup")}function DQ(t,e,n){const r=mn(n,e);return!!(r&&r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot"))}function NQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot")}function OQ(t,e,n){return!mn(n,e)}function PQ(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&r.tagName==="tr"}function SD(t,e,n){const r=mn(n,e);return!r||r.type==="element"&&(r.tagName==="td"||r.tagName==="th")}const LQ=kD({body:FQ,colgroup:UQ,head:BQ,html:RQ,tbody:$Q});function RQ(t){const e=mn(t,-1);return!e||e.type!=="comment"}function BQ(t){const e=new Set;for(const r of t.children)if(r.type==="element"&&(r.tagName==="base"||r.tagName==="title")){if(e.has(r.tagName))return!1;e.add(r.tagName)}const n=t.children[0];return!n||n.type==="element"}function FQ(t){const e=mn(t,-1,!0);return!e||e.type!=="comment"&&!(e.type==="text"&&Rx(e.value.charAt(0)))&&!(e.type==="element"&&(e.tagName==="meta"||e.tagName==="link"||e.tagName==="script"||e.tagName==="style"||e.tagName==="template"))}function UQ(t,e,n){const r=vD(n,e),i=mn(t,-1,!0);return n&&r&&r.type==="element"&&r.tagName==="colgroup"&&Bx(r,n.children.indexOf(r),n)?!1:!!(i&&i.type==="element"&&i.tagName==="col")}function $Q(t,e,n){const r=vD(n,e),i=mn(t,-1);return n&&r&&r.type==="element"&&(r.tagName==="thead"||r.tagName==="tbody")&&Bx(r,n.children.indexOf(r),n)?!1:!!(i&&i.type==="element"&&i.tagName==="tr")}const um={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function HQ(t,e,n,r){const i=r.schema,s=i.space==="svg"?!1:r.settings.omitOptionalTags;let o=i.space==="svg"?r.settings.closeEmptyElements:r.settings.voids.includes(t.tagName.toLowerCase());const a=[];let l;i.space==="html"&&t.tagName==="svg"&&(r.schema=fh);const c=zQ(r,t.properties),u=r.all(i.space==="html"&&t.tagName==="template"?t.content:t);return r.schema=i,u&&(o=!1),(c||!s||!LQ(t,e,n))&&(a.push("<",t.tagName,c?" "+c:""),o&&(i.space==="svg"||r.settings.closeSelfClosing)&&(l=c.charAt(c.length-1),(!r.settings.tightSelfClosing||l==="/"||l&&l!=='"'&&l!=="'")&&a.push(" "),a.push("/")),a.push(">")),a.push(u),!o&&(!s||!Bx(t,e,n))&&a.push("</"+t.tagName+">"),a.join("")}function zQ(t,e){const n=[];let r=-1,i;if(e){for(i in e)if(e[i]!==null&&e[i]!==void 0){const s=WQ(t,i,e[i]);s&&n.push(s)}}for(;++r<n.length;){const s=t.settings.tightAttributes?n[r].charAt(n[r].length-1):void 0;r!==n.length-1&&s!=='"'&&s!=="'"&&(n[r]+=" ")}return n.join("")}function WQ(t,e,n){const r=K_(t.schema,e),i=t.settings.allowParseErrors&&t.schema.space==="html"?0:1,s=t.settings.allowDangerousCharacters?0:1;let o=t.quote,a;if(r.overloadedBoolean&&(n===r.attribute||n==="")?n=!0:(r.boolean||r.overloadedBoolean)&&(typeof n!="string"||n===r.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const l=Uc(r.attribute,Object.assign({},t.settings.characterReferences,{subset:um.name[i][s]}));return n===!0||(n=Array.isArray(n)?(r.commaSeparated?qG:KG)(n,{padLeft:!t.settings.tightCommaSeparatedLists}):String(n),t.settings.collapseEmptyAttributes&&!n)?l:(t.settings.preferUnquoted&&(a=Uc(n,Object.assign({},t.settings.characterReferences,{attribute:!0,subset:um.unquoted[i][s]}))),a!==n&&(t.settings.quoteSmart&&cm(n,o)>cm(n,t.alternative)&&(o=t.alternative),a=o+Uc(n,Object.assign({},t.settings.characterReferences,{subset:(o==="'"?um.single:um.double)[i][s],attribute:!0}))+o),l+(a&&"="+a))}const jQ=["<","&"];function CD(t,e,n,r){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?t.value:Uc(t.value,Object.assign({},r.settings.characterReferences,{subset:jQ}))}function YQ(t,e,n,r){return r.settings.allowDangerousHtml?t.value:CD(t,e,n,r)}function GQ(t,e,n,r){return r.all(t)}const VQ=yD("type",{invalid:qQ,unknown:XQ,handlers:{comment:yQ,doctype:_Q,element:HQ,raw:YQ,root:GQ,text:CD}});function qQ(t){throw new Error("Expected node, not `"+t+"`")}function XQ(t){const e=t;throw new Error("Cannot compile unknown node `"+e.type+"`")}const KQ={},QQ={},ZQ=[];function JQ(t,e){const n=e||KQ,r=n.quote||'"',i=r==='"'?"'":'"';if(r!=='"'&&r!=="'")throw new Error("Invalid quote `"+r+"`, expected `'` or `\"`");return{one:eZ,all:tZ,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||ZK,characterReferences:n.characterReferences||QQ,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?fh:Yp,quote:r,alternative:i}.one(Array.isArray(t)?{type:"root",children:t}:t,void 0,void 0)}function eZ(t,e,n){return VQ(t,e,n,this)}function tZ(t){const e=[],n=t&&t.children||ZQ;let r=-1;for(;++r<n.length;)e[r]=this.one(n[r],r,t);return e.join("")}function nZ(t){const e=this,n={...e.data("settings"),...t};e.compiler=r;function r(i){return JQ(i,n)}}class rZ{constructor(e,n){this.provider=e,this.identifier=n,this.preprocessors=new Map,this.preprocessors.set("doc",new Set),this.preprocessors.set("slice",new Set),this.preprocessors.set("block",new Set),this.initializePreprocessors()}initializePreprocessors(){const e=Array.from(this.provider.getAll(this.identifier).values());for(const n of e)for(const r of n.levels){const i=this.preprocessors.get(r);i&&i.add(n)}}process(e,n){var r;const i=(r=this.preprocessors.get(e))!=null?r:new Set;return Array.from(i).reduce((s,o)=>o.preprocess(s),n)}}const iZ=["div","p","h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","pre"],sZ=new Set(iZ),oZ=["a","abbr","audio","b","bdi","bdo","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","input","ins","kbd","label","link","map","mark","math","meta","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","var","video","wbr"],aZ=new Set(oZ),lZ=t=>t.type==="element",AD=(t,e="")=>{if(!t)return e;switch(t.type){case"text":return t.value.replace(/\s+/g," ");case"element":{switch(t.tagName){case"br":return`
`}return t.children.map(n=>AD(n)).join("")}}return e},ID=t=>t?t.type==="element"?t.children.filter(e=>e.type==="element"):[]:[],MD=t=>t?t.type==="element"?t.children.filter(e=>e.type==="text"):[]:[],cZ=t=>({...t,children:MD(t)}),uZ=t=>sZ.has(t),DD=t=>aZ.has(t),Ux=t=>{var e;return DD(t.tagName)||!!(typeof((e=t.properties)==null?void 0:e.style)=="string"&&t.properties.style.match(/display:\s*inline/))},dZ=t=>!t||!t.children?[]:t.children.filter(e=>!!(e.type==="text"||e.type==="element"&&e.tagName&&Ux(e))),hZ=t=>({...t,children:dZ(t)}),ND=(t,e)=>{if(t.type==="element"){if(t.tagName===e)return t;for(const n of t.children){const r=ND(n,e);if(r)return r}}},OD=(t,e)=>{var n;if(t.type==="element"){if(Array.isArray((n=t.properties)==null?void 0:n.className)&&t.properties.className.includes(e))return t;for(const r of t.children){const i=OD(r,e);if(i)return i}}},PD=(t,e)=>{if(t.type==="element"){if(t.properties.id===e)return t;for(const n of t.children){const r=PD(n,e);if(r)return r}}},LD=(t,e)=>{if(t.type==="root")for(const n of t.children){const r=LD(n,e);if(r)return r}else if(t.type==="element")return e.startsWith(".")?OD(t,e.slice(1)):e.startsWith("#")?PD(t,e.slice(1)):ND(t,e)},RD=(t,e)=>{if(t.type==="element"){const n=t.children.map(r=>RD(r,e));return{...t,children:n.flatMap(r=>r.type==="element"&&e(r.tagName)?r.children:r)}}return t},H={isElement:lZ,getTextContent:AD,getElementChildren:ID,getTextChildren:MD,getTextChildrenOnlyAst:cZ,getInlineOnlyElementAST:hZ,querySelector:LD,flatNodes:RD,isParagraphLike:t=>{var e;return typeof((e=t.properties)==null?void 0:e.style)=="string"&&t.properties.style.match(/display:\s*flex/)!==null||ID(t).every(n=>Ux(n))},isTagBlock:uZ,isTagInline:DD,isElementInline:Ux},dm=function(t){if(t==null)return gZ;if(typeof t=="function")return hm(t);if(typeof t=="object")return Array.isArray(t)?fZ(t):pZ(t);if(typeof t=="string")return mZ(t);throw new Error("Expected function, string, or object as test")};function fZ(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=dm(t[n]);return hm(r);function r(...i){let s=-1;for(;++s<e.length;)if(e[s].apply(this,i))return!0;return!1}}function pZ(t){const e=t;return hm(n);function n(r){const i=r;let s;for(s in t)if(i[s]!==e[s])return!1;return!0}}function mZ(t){return hm(e);function e(n){return n&&n.type===t}}function hm(t){return e;function e(n,r,i){return!!(bZ(n)&&t.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function gZ(){return!0}function bZ(t){return t!==null&&typeof t=="object"&&"type"in t}function Wge(t){return t}const BD=[],yZ=!0,$x=!1,_Z="skip";function FD(t,e,n,r){let i;typeof e=="function"&&typeof n!="function"?(r=n,n=e):i=e;const s=dm(i),o=r?-1:1;a(t,void 0,[])();function a(l,c,u){const d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){const f=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(h,"name",{value:"node ("+(l.type+(f?"<"+f+">":""))+")"})}return h;function h(){let f=BD,p,g,b;if((!e||s(l,c,u[u.length-1]||void 0))&&(f=xZ(n(l,u)),f[0]===$x))return f;if("children"in l&&l.children){const _=l;if(_.children&&f[0]!==_Z)for(g=(r?_.children.length:-1)+o,b=u.concat(_);g>-1&&g<_.children.length;){const y=_.children[g];if(p=a(y,g,b)(),p[0]===$x)return p;g=typeof p[1]=="number"?p[1]:g+o}}return f}}}function xZ(t){return Array.isArray(t)?t:typeof t=="number"?[yZ,t]:t==null?BD:[t]}function fm(t,e,n,r){let i,s,o;typeof e=="function"&&typeof n!="function"?(s=void 0,o=e,i=n):(s=e,o=n,i=r),FD(t,s,a,i);function a(l,c){const u=c[c.length-1],d=u?u.children.indexOf(l):void 0;return o(l,d,u)}}const EZ=new Set(["b"]),vZ=()=>t=>{fm(t,"element",e=>{if(EZ.has(e.tagName)&&e.children.some(r=>r.type==="element"&&H.isTagBlock(r.tagName))){const r=e.tagName;e.tagName="div",e.properties={...e.properties,"data-original-tag":r}}})},wZ=()=>t=>{fm(t,"element",e=>{if(e.tagName==="div"){let n=!1,r=!1;for(const i of e.children)if(i.type==="element"&&(H.isElementInline(i)?n=!0:H.isTagBlock(i.tagName)&&(r=!0),n&&r))break;if(n&&r){const i=[];let s=[];for(const o of e.children)if(o.type==="element"){const a=o;H.isElementInline(a)?s.push(a):H.isTagBlock(a.tagName)?(s.length>0&&(i.push({type:"element",tagName:"p",properties:{},children:s}),s=[]),i.push(a)):s.push(a)}else s.push(o);s.length>0&&i.push({type:"element",tagName:"p",properties:{},children:s}),e.children=i}}})};class kZ extends oc{constructor(e,n){super(e,n),this._astToHtml=o=>Rc().use(nZ).stringify(o),this._traverseHtml=async(o,a,l)=>{const c=new Co;return c.setONodeTypeGuard(u=>"type"in u&&u.type!==void 0),c.setEnter(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,textBuffer:{content:""},assets:l};await((f=(h=p.toBlockSnapshot).enter)==null?void 0:f.call(h,u,g))}}),c.setLeave(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,textBuffer:{content:""},assets:l};await((f=(h=p.toBlockSnapshot).leave)==null?void 0:f.call(h,u,g))}}),c.walk(o,a)},this._traverseSnapshot=async(o,a,l)=>{const c=[],u=new Co;return u.setONodeTypeGuard(d=>qi.safeParse(d).success),u.setEnter(async(d,h)=>{var f,p;for(const g of this.blockMatchers)if(g.fromMatch(d)){const b={walker:u,walkerContext:h,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l,updateAssetIds:_=>{c.push(_)}};await((p=(f=g.fromBlockSnapshot).enter)==null?void 0:p.call(f,d,b))}}),u.setLeave(async(d,h)=>{var f,p;for(const g of this.blockMatchers)if(g.fromMatch(d)){const b={walker:u,walkerContext:h,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l};await((p=(f=g.fromBlockSnapshot).leave)==null?void 0:p.call(f,d,b))}}),{ast:await u.walk(o,a),assetsIds:c}};const r=Array.from(n.getAll(hD).values()),i=Array.from(n.getAll(mD).values()),s=Array.from(n.getAll(gD).values());this.blockMatchers=r,this.deltaConverter=new QK(e.adapterConfigs,i,s,n)}_htmlToAst(e){const n=Rc().use(mx).use(vZ).use(wZ),r=n.parse(e);return n.runSync(r)}async fromBlockSnapshot(e){const n={type:"root",children:[{type:"doctype"}]},{ast:r,assetsIds:i}=await this._traverseSnapshot(e.snapshot,n,e.assets);return{file:this._astToHtml(r),assetsIds:i}}async fromDocSnapshot(e){const{file:n,assetsIds:r}=await this.fromBlockSnapshot({snapshot:e.snapshot.blocks,assets:e.assets});return{file:n.replace("<!--BlockSuiteDocTitlePlaceholder-->",`<h1>${e.snapshot.meta.title}</h1>`),assetsIds:r}}async fromSliceSnapshot(e){let n="";const r=[];for(const s of e.snapshot.content){const o={type:"root",children:[]},{ast:a,assetsIds:l}=await this._traverseSnapshot(s,o,e.assets);r.push(...l),n+=this._astToHtml(a)}return{file:n,assetsIds:r}}toBlockSnapshot(e){const n=this._htmlToAst(e.file),r={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return this._traverseHtml(n,r,e.assets)}async toDocSnapshot(e){const n=this._htmlToAst(e.file),r=H.querySelector(n,"title"),i={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return{type:"page",meta:{id:K(),title:H.getTextContent(r,"Untitled"),createDate:Date.now(),tags:[]},blocks:{type:"block",id:K(),flavour:"affine:page",props:{title:{"$blocksuite:internal:text$":!0,delta:this.deltaConverter.astToDelta(r??{type:"text",value:"Untitled"})}},children:[{type:"block",id:K(),flavour:"affine:surface",props:{elements:{}},children:[]},await this._traverseHtml(n,i,e.assets)]}}}async toSliceSnapshot(e){const n=this._htmlToAst(e.file),r={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]},i=await this._traverseHtml(n,r,e.assets);return i.children.length===0?null:{type:"slice",content:[i],workspaceId:e.workspaceId,pageId:e.pageId}}}const TZ=Dc("Html"),SZ={setup:t=>{t.addImpl(TZ,e=>({get:n=>new kZ(n,e)}))}},UD=Me("BlockMarkdownAdapterMatcher");function Rt(t){const e=UD(t.flavour);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}const $D=Me("InlineDeltaToMarkdownAdapterMatcher");function Jo(t){const e=$D(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}const HD=Me("MarkdownASTToDeltaMatcher");function ds(t){const e=HD(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class CZ extends am{constructor(e,n,r){super(),this.configs=e,this.inlineDeltaMatchers=n,this.markdownASTToDeltaMatchers=r}applyTextFormatting(e){var n;let r={type:"text",value:(n=e.attributes)!=null&&n.underline?`<u>${e.insert}</u>`:e.insert};const i={configs:this.configs,current:r};for(const s of this.inlineDeltaMatchers)s.match(e)&&(r=s.toAST(e,i),i.current=r);return r}astToDelta(e){const n={configs:this.configs,options:Object.create(null),toDelta:r=>this.astToDelta(r)};for(const r of this.markdownASTToDeltaMatchers)if(r.match(e))return r.toDelta(e,n);return"children"in e?e.children.flatMap(r=>this.astToDelta(r)):[]}deltaToAST(e,n=0){return n>0&&e.unshift({insert:" ".repeat(4).repeat(n)}),e.map(r=>this.applyTextFormatting(r))}}function zD(t,e){const n=String(t);let r=n.indexOf(e),i=r,s=0,o=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===i?++s>o&&(o=s):s=1,i=r+e.length,r=n.indexOf(e,i);return o}function AZ(){return{enter:{mathFlow:t,mathFlowFenceMeta:e,mathText:s},exit:{mathFlow:i,mathFlowFence:r,mathFlowFenceMeta:n,mathFlowValue:a,mathText:o,mathTextData:a}};function t(l){const c={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[c]}},l)}function e(){this.buffer()}function n(){const l=this.resume(),c=this.stack[this.stack.length-1];c.type,c.meta=l}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function i(l){const c=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),u=this.stack[this.stack.length-1];u.type,this.exit(l),u.value=c;const d=u.data.hChildren[0];d.type,d.tagName,d.children.push({type:"text",value:c}),this.data.mathFlowInside=void 0}function s(l){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},l),this.buffer()}function o(l){const c=this.resume(),u=this.stack[this.stack.length-1];u.type,this.exit(l),u.value=c,u.data.hChildren.push({type:"text",value:c})}function a(l){this.config.enter.data.call(this,l),this.config.exit.data.call(this,l)}}function IZ(t){let e=(t||{}).singleDollarTextMath;return e==null&&(e=!0),r.peek=i,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:e?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:n,inlineMath:r}};function n(s,o,a,l){const c=s.value||"",u=a.createTracker(l),d="$".repeat(Math.max(zD(c,"$")+1,2)),h=a.enter("mathFlow");let f=u.move(d);if(s.meta){const p=a.enter("mathFlowMeta");f+=u.move(a.safe(s.meta,{after:`
`,before:f,encode:["$"],...u.current()})),p()}return f+=u.move(`
`),c&&(f+=u.move(c+`
`)),f+=u.move(d),h(),f}function r(s,o,a){let l=s.value||"",c=1;for(e||c++;new RegExp("(^|[^$])"+"\\$".repeat(c)+"([^$]|$)").test(l);)c++;const u="$".repeat(c);/[^ \r\n]/.test(l)&&(/^[ \r\n]/.test(l)&&/[ \r\n]$/.test(l)||/^\$|\$$/.test(l))&&(l=" "+l+" ");let d=-1;for(;++d<a.unsafe.length;){const h=a.unsafe[d];if(!h.atBreak)continue;const f=a.compilePattern(h);let p;for(;p=f.exec(l);){let g=p.index;l.codePointAt(g)===10&&l.codePointAt(g-1)===13&&g--,l=l.slice(0,g)+" "+l.slice(p.index+1)}}return u+l+u}function i(){return"$"}}const hr=ea(/[A-Za-z]/),wr=ea(/[\dA-Za-z]/),MZ=ea(/[#-'*+\--9=?A-Z^-~]/);function pm(t){return t!==null&&(t<32||t===127)}const Hx=ea(/\d/),DZ=ea(/[\dA-Fa-f]/),NZ=ea(/[!-/:-@[-`{-~]/);function ye(t){return t!==null&&t<-2}function mt(t){return t!==null&&(t<0||t===32)}function Ge(t){return t===-2||t===-1||t===32}const mm=ea(new RegExp("\\p{P}|\\p{S}","u")),pl=ea(/\s/);function ea(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function je(t,e,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let s=0;return o;function o(l){return Ge(l)?(t.enter(n),a(l)):e(l)}function a(l){return Ge(l)&&s++<i?(t.consume(l),a):(t.exit(n),e(l))}}const OZ={tokenize:PZ,concrete:!0,name:"mathFlow"},WD={tokenize:LZ,partial:!0};function PZ(t,e,n){const r=this,i=r.events[r.events.length-1],s=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0;let o=0;return a;function a(y){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),l(y)}function l(y){return y===36?(t.consume(y),o++,l):o<2?n(y):(t.exit("mathFlowFenceSequence"),je(t,c,"whitespace")(y))}function c(y){return y===null||ye(y)?d(y):(t.enter("mathFlowFenceMeta"),t.enter("chunkString",{contentType:"string"}),u(y))}function u(y){return y===null||ye(y)?(t.exit("chunkString"),t.exit("mathFlowFenceMeta"),d(y)):y===36?n(y):(t.consume(y),u)}function d(y){return t.exit("mathFlowFence"),r.interrupt?e(y):t.attempt(WD,h,b)(y)}function h(y){return t.attempt({tokenize:_,partial:!0},b,f)(y)}function f(y){return(s?je(t,p,"linePrefix",s+1):p)(y)}function p(y){return y===null?b(y):ye(y)?t.attempt(WD,h,b)(y):(t.enter("mathFlowValue"),g(y))}function g(y){return y===null||ye(y)?(t.exit("mathFlowValue"),p(y)):(t.consume(y),g)}function b(y){return t.exit("mathFlow"),e(y)}function _(y,x,E){let I=0;return je(y,v,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function v(z){return y.enter("mathFlowFence"),y.enter("mathFlowFenceSequence"),N(z)}function N(z){return z===36?(I++,y.consume(z),N):I<o?E(z):(y.exit("mathFlowFenceSequence"),je(y,L,"whitespace")(z))}function L(z){return z===null||ye(z)?(y.exit("mathFlowFence"),x(z)):E(z)}}}function LZ(t,e,n){const r=this;return i;function i(o){return o===null?e(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s)}function s(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function RZ(t){let n=(t||{}).singleDollarTextMath;return n==null&&(n=!0),{tokenize:r,resolve:BZ,previous:FZ,name:"mathText"};function r(i,s,o){let a=0,l,c;return u;function u(g){return i.enter("mathText"),i.enter("mathTextSequence"),d(g)}function d(g){return g===36?(i.consume(g),a++,d):a<2&&!n?o(g):(i.exit("mathTextSequence"),h(g))}function h(g){return g===null?o(g):g===36?(c=i.enter("mathTextSequence"),l=0,p(g)):g===32?(i.enter("space"),i.consume(g),i.exit("space"),h):ye(g)?(i.enter("lineEnding"),i.consume(g),i.exit("lineEnding"),h):(i.enter("mathTextData"),f(g))}function f(g){return g===null||g===32||g===36||ye(g)?(i.exit("mathTextData"),h(g)):(i.consume(g),f)}function p(g){return g===36?(i.consume(g),l++,p):l===a?(i.exit("mathTextSequence"),i.exit("mathText"),s(g)):(c.type="mathTextData",f(g))}}}function BZ(t){let e=t.length-4,n=3,r,i;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="mathTextData"){t[e][1].type="mathTextPadding",t[n][1].type="mathTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(i=r):(r===e||t[r][1].type==="lineEnding")&&(t[i][1].type="mathTextData",r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function FZ(t){return t!==36||this.events[this.events.length-1][1].type==="characterEscape"}function UZ(t){return{flow:{36:OZ},text:{36:RZ(t)}}}const $Z={};function jD(t){const e=this,n=t||$Z,r=e.data(),i=r.micromarkExtensions||(r.micromarkExtensions=[]),s=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),o=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);i.push(UZ(n)),s.push(AZ()),o.push(IZ(n))}const HZ={};function zx(t,e){const n=HZ,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,i=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return YD(t,r,i)}function YD(t,e,n){if(zZ(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return GD(t.children,e,n)}return Array.isArray(t)?GD(t,e,n):""}function GD(t,e,n){const r=[];let i=-1;for(;++i<t.length;)r[i]=YD(t[i],e,n);return r.join("")}function zZ(t){return!!(t&&typeof t=="object")}const VD=document.createElement("i");function Wx(t){const e="&"+t+";";VD.innerHTML=e;const n=VD.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Ur(t,e,n,r){const i=t.length;let s=0,o;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(e,n),t.splice(...o);else for(n&&t.splice(e,n);s<r.length;)o=r.slice(s,s+1e4),o.unshift(e,0),t.splice(...o),s+=1e4,e+=1e4}function ii(t,e){return t.length>0?(Ur(t,t.length,0,e),t):e}const qD={}.hasOwnProperty;function XD(t){const e={};let n=-1;for(;++n<t.length;)WZ(e,t[n]);return e}function WZ(t,e){let n;for(n in e){const i=(qD.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let o;if(s)for(o in s){qD.call(i,o)||(i[o]=[]);const a=s[o];jZ(i[o],Array.isArray(a)?a:a?[a]:[])}}}function jZ(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);Ur(t,0,0,r)}function KD(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Ci(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const YZ={tokenize:GZ};function GZ(t){const e=t.attempt(this.parser.constructs.contentInitial,r,i);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),je(t,e,"linePrefix")}function i(a){return t.enter("paragraph"),s(a)}function s(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,o(a)}function o(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return ye(a)?(t.consume(a),t.exit("chunkText"),s):(t.consume(a),o)}}const VZ={tokenize:qZ},QD={tokenize:XZ};function qZ(t){const e=this,n=[];let r=0,i,s,o;return a;function a(x){if(r<n.length){const E=n[r];return e.containerState=E[1],t.attempt(E[0].continuation,l,c)(x)}return c(x)}function l(x){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&y();const E=e.events.length;let I=E,v;for(;I--;)if(e.events[I][0]==="exit"&&e.events[I][1].type==="chunkFlow"){v=e.events[I][1].end;break}_(r);let N=E;for(;N<e.events.length;)e.events[N][1].end={...v},N++;return Ur(e.events,I+1,0,e.events.slice(E)),e.events.length=N,c(x)}return a(x)}function c(x){if(r===n.length){if(!i)return h(x);if(i.currentConstruct&&i.currentConstruct.concrete)return p(x);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(QD,u,d)(x)}function u(x){return i&&y(),_(r),h(x)}function d(x){return e.parser.lazy[e.now().line]=r!==n.length,o=e.now().offset,p(x)}function h(x){return e.containerState={},t.attempt(QD,f,p)(x)}function f(x){return r++,n.push([e.currentConstruct,e.containerState]),h(x)}function p(x){if(x===null){i&&y(),_(0),t.consume(x);return}return i=i||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:s}),g(x)}function g(x){if(x===null){b(t.exit("chunkFlow"),!0),_(0),t.consume(x);return}return ye(x)?(t.consume(x),b(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(x),g)}function b(x,E){const I=e.sliceStream(x);if(E&&I.push(null),x.previous=s,s&&(s.next=x),s=x,i.defineSkip(x.start),i.write(I),e.parser.lazy[x.start.line]){let v=i.events.length;for(;v--;)if(i.events[v][1].start.offset<o&&(!i.events[v][1].end||i.events[v][1].end.offset>o))return;const N=e.events.length;let L=N,z,M;for(;L--;)if(e.events[L][0]==="exit"&&e.events[L][1].type==="chunkFlow"){if(z){M=e.events[L][1].end;break}z=!0}for(_(r),v=N;v<e.events.length;)e.events[v][1].end={...M},v++;Ur(e.events,L+1,0,e.events.slice(N)),e.events.length=v}}function _(x){let E=n.length;for(;E-- >x;){const I=n[E];e.containerState=I[1],I[0].exit.call(e,t)}n.length=x}function y(){i.write([null]),s=void 0,i=void 0,e.containerState._closeFlow=void 0}}function XZ(t,e,n){return je(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function $c(t){if(t===null||mt(t)||pl(t))return 1;if(mm(t))return 2}function gm(t,e,n){const r=[];let i=-1;for(;++i<t.length;){const s=t[i].resolveAll;s&&!r.includes(s)&&(e=s(e,n),r.push(s))}return e}const jx={name:"attention",resolveAll:KZ,tokenize:QZ};function KZ(t,e){let n=-1,r,i,s,o,a,l,c,u;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[r][1].end},h={...t[n][1].start};ZD(d,-l),ZD(h,l),o={type:l>1?"strongSequence":"emphasisSequence",start:d,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:h},s={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},i={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},t[r][1].end={...o.start},t[n][1].start={...a.end},c=[],t[r][1].end.offset-t[r][1].start.offset&&(c=ii(c,[["enter",t[r][1],e],["exit",t[r][1],e]])),c=ii(c,[["enter",i,e],["enter",o,e],["exit",o,e],["enter",s,e]]),c=ii(c,gm(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),c=ii(c,[["exit",s,e],["enter",a,e],["exit",a,e],["exit",i,e]]),t[n][1].end.offset-t[n][1].start.offset?(u=2,c=ii(c,[["enter",t[n][1],e],["exit",t[n][1],e]])):u=0,Ur(t,r-1,n-r+3,c),n=r+c.length-u-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function QZ(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=$c(r);let s;return o;function o(l){return s=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===s)return t.consume(l),a;const c=t.exit("attentionSequence"),u=$c(l),d=!u||u===2&&i||n.includes(l),h=!i||i===2&&u||n.includes(r);return c._open=!!(s===42?d:d&&(i||!h)),c._close=!!(s===42?h:h&&(u||!d)),e(l)}}function ZD(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const ZZ={name:"autolink",tokenize:JZ};function JZ(t,e,n){let r=0;return i;function i(f){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),s}function s(f){return hr(f)?(t.consume(f),o):f===64?n(f):c(f)}function o(f){return f===43||f===45||f===46||wr(f)?(r=1,a(f)):c(f)}function a(f){return f===58?(t.consume(f),r=0,l):(f===43||f===45||f===46||wr(f))&&r++<32?(t.consume(f),a):(r=0,c(f))}function l(f){return f===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):f===null||f===32||f===60||pm(f)?n(f):(t.consume(f),l)}function c(f){return f===64?(t.consume(f),u):MZ(f)?(t.consume(f),c):n(f)}function u(f){return wr(f)?d(f):n(f)}function d(f){return f===46?(t.consume(f),r=0,u):f===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):h(f)}function h(f){if((f===45||wr(f))&&r++<63){const p=f===45?h:d;return t.consume(f),p}return n(f)}}const Ch={partial:!0,tokenize:eJ};function eJ(t,e,n){return r;function r(s){return Ge(s)?je(t,i,"linePrefix")(s):i(s)}function i(s){return s===null||ye(s)?e(s):n(s)}}const JD={continuation:{tokenize:nJ},exit:rJ,name:"blockQuote",tokenize:tJ};function tJ(t,e,n){const r=this;return i;function i(o){if(o===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),s}return n(o)}function s(o){return Ge(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(o))}}function nJ(t,e,n){const r=this;return i;function i(o){return Ge(o)?je(t,s,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):s(o)}function s(o){return t.attempt(JD,e,n)(o)}}function rJ(t){t.exit("blockQuote")}const e4={name:"characterEscape",tokenize:iJ};function iJ(t,e,n){return r;function r(s){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(s),t.exit("escapeMarker"),i}function i(s){return NZ(s)?(t.enter("characterEscapeValue"),t.consume(s),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(s)}}const t4={name:"characterReference",tokenize:sJ};function sJ(t,e,n){const r=this;let i=0,s,o;return a;function a(d){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),l}function l(d){return d===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(d),t.exit("characterReferenceMarkerNumeric"),c):(t.enter("characterReferenceValue"),s=31,o=wr,u(d))}function c(d){return d===88||d===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(d),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),s=6,o=DZ,u):(t.enter("characterReferenceValue"),s=7,o=Hx,u(d))}function u(d){if(d===59&&i){const h=t.exit("characterReferenceValue");return o===wr&&!Wx(r.sliceSerialize(h))?n(d):(t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return o(d)&&i++<s?(t.consume(d),u):n(d)}}const n4={partial:!0,tokenize:aJ},r4={concrete:!0,name:"codeFenced",tokenize:oJ};function oJ(t,e,n){const r=this,i={partial:!0,tokenize:I};let s=0,o=0,a;return l;function l(v){return c(v)}function c(v){const N=r.events[r.events.length-1];return s=N&&N[1].type==="linePrefix"?N[2].sliceSerialize(N[1],!0).length:0,a=v,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),u(v)}function u(v){return v===a?(o++,t.consume(v),u):o<3?n(v):(t.exit("codeFencedFenceSequence"),Ge(v)?je(t,d,"whitespace")(v):d(v))}function d(v){return v===null||ye(v)?(t.exit("codeFencedFence"),r.interrupt?e(v):t.check(n4,g,E)(v)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(v))}function h(v){return v===null||ye(v)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),d(v)):Ge(v)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),je(t,f,"whitespace")(v)):v===96&&v===a?n(v):(t.consume(v),h)}function f(v){return v===null||ye(v)?d(v):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),p(v))}function p(v){return v===null||ye(v)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),d(v)):v===96&&v===a?n(v):(t.consume(v),p)}function g(v){return t.attempt(i,E,b)(v)}function b(v){return t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),_}function _(v){return s>0&&Ge(v)?je(t,y,"linePrefix",s+1)(v):y(v)}function y(v){return v===null||ye(v)?t.check(n4,g,E)(v):(t.enter("codeFlowValue"),x(v))}function x(v){return v===null||ye(v)?(t.exit("codeFlowValue"),y(v)):(t.consume(v),x)}function E(v){return t.exit("codeFenced"),e(v)}function I(v,N,L){let z=0;return M;function M(_e){return v.enter("lineEnding"),v.consume(_e),v.exit("lineEnding"),B}function B(_e){return v.enter("codeFencedFence"),Ge(_e)?je(v,$,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(_e):$(_e)}function $(_e){return _e===a?(v.enter("codeFencedFenceSequence"),se(_e)):L(_e)}function se(_e){return _e===a?(z++,v.consume(_e),se):z>=o?(v.exit("codeFencedFenceSequence"),Ge(_e)?je(v,be,"whitespace")(_e):be(_e)):L(_e)}function be(_e){return _e===null||ye(_e)?(v.exit("codeFencedFence"),N(_e)):L(_e)}}}function aJ(t,e,n){const r=this;return i;function i(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s)}function s(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}const Yx={name:"codeIndented",tokenize:cJ},lJ={partial:!0,tokenize:uJ};function cJ(t,e,n){const r=this;return i;function i(c){return t.enter("codeIndented"),je(t,s,"linePrefix",5)(c)}function s(c){const u=r.events[r.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(c):n(c)}function o(c){return c===null?l(c):ye(c)?t.attempt(lJ,o,l)(c):(t.enter("codeFlowValue"),a(c))}function a(c){return c===null||ye(c)?(t.exit("codeFlowValue"),o(c)):(t.consume(c),a)}function l(c){return t.exit("codeIndented"),e(c)}}function uJ(t,e,n){const r=this;return i;function i(o){return r.parser.lazy[r.now().line]?n(o):ye(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),i):je(t,s,"linePrefix",5)(o)}function s(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):ye(o)?i(o):n(o)}}const dJ={name:"codeText",previous:fJ,resolve:hJ,tokenize:pJ};function hJ(t){let e=t.length-4,n=3,r,i;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(i=r):(r===e||t[r][1].type==="lineEnding")&&(t[i][1].type="codeTextData",r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function fJ(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function pJ(t,e,n){let r=0,i,s;return o;function o(d){return t.enter("codeText"),t.enter("codeTextSequence"),a(d)}function a(d){return d===96?(t.consume(d),r++,a):(t.exit("codeTextSequence"),l(d))}function l(d){return d===null?n(d):d===32?(t.enter("space"),t.consume(d),t.exit("space"),l):d===96?(s=t.enter("codeTextSequence"),i=0,u(d)):ye(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),l):(t.enter("codeTextData"),c(d))}function c(d){return d===null||d===32||d===96||ye(d)?(t.exit("codeTextData"),l(d)):(t.consume(d),c)}function u(d){return d===96?(t.consume(d),i++,u):i===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(d)):(s.type="codeTextData",c(d))}}class mJ{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const i=n||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&Ah(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Ah(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Ah(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);Ah(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Ah(this.left,n.reverse())}}}function Ah(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function i4(t){const e={};let n=-1,r,i,s,o,a,l,c;const u=new mJ(t);for(;++n<u.length;){for(;n in e;)n=e[n];if(r=u.get(n),n&&r[1].type==="chunkFlow"&&u.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,gJ(u,n)),n=e[n],c=!0);else if(r[1]._container){for(s=n,i=void 0;s--;)if(o=u.get(s),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(i&&(u.get(i)[1].type="lineEndingBlank"),o[1].type="lineEnding",i=s);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;i&&(r[1].end={...u.get(i)[1].start},a=u.slice(i,n),a.unshift(r),u.splice(i,n-i+1,a))}}return Ur(t,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function gJ(t,e){const n=t.get(e)[1],r=t.get(e)[2];let i=e-1;const s=[];let o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],c={};let u,d,h=-1,f=n,p=0,g=0;const b=[g];for(;f;){for(;t.get(++i)[1]!==f;);s.push(i),f._tokenizer||(u=r.sliceStream(f),f.next||u.push(null),d&&o.defineSkip(f.start),f._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),f._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=f,f=f.next}for(f=n;++h<a.length;)a[h][0]==="exit"&&a[h-1][0]==="enter"&&a[h][1].type===a[h-1][1].type&&a[h][1].start.line!==a[h][1].end.line&&(g=h+1,b.push(g),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(o.events=[],f?(f._tokenizer=void 0,f.previous=void 0):b.pop(),h=b.length;h--;){const _=a.slice(b[h],b[h+1]),y=s.pop();l.push([y,y+_.length-1]),t.splice(y,2,_)}for(l.reverse(),h=-1;++h<l.length;)c[p+l[h][0]]=p+l[h][1],p+=l[h][1]-l[h][0]-1;return c}const bJ={resolve:_J,tokenize:xJ},yJ={partial:!0,tokenize:EJ};function _J(t){return i4(t),t}function xJ(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),i(a)}function i(a){return a===null?s(a):ye(a)?t.check(yJ,o,s)(a):(t.consume(a),i)}function s(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function o(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}}function EJ(t,e,n){const r=this;return i;function i(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),je(t,s,"linePrefix")}function s(o){if(o===null||ye(o))return n(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):t.interrupt(r.parser.constructs.flow,n,e)(o)}}function s4(t,e,n,r,i,s,o,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return d;function d(_){return _===60?(t.enter(r),t.enter(i),t.enter(s),t.consume(_),t.exit(s),h):_===null||_===32||_===41||pm(_)?n(_):(t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),g(_))}function h(_){return _===62?(t.enter(s),t.consume(_),t.exit(s),t.exit(i),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),f(_))}function f(_){return _===62?(t.exit("chunkString"),t.exit(a),h(_)):_===null||_===60||ye(_)?n(_):(t.consume(_),_===92?p:f)}function p(_){return _===60||_===62||_===92?(t.consume(_),f):f(_)}function g(_){return!u&&(_===null||_===41||mt(_))?(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(_)):u<c&&_===40?(t.consume(_),u++,g):_===41?(t.consume(_),u--,g):_===null||_===32||_===40||pm(_)?n(_):(t.consume(_),_===92?b:g)}function b(_){return _===40||_===41||_===92?(t.consume(_),g):g(_)}}function o4(t,e,n,r,i,s){const o=this;let a=0,l;return c;function c(f){return t.enter(r),t.enter(i),t.consume(f),t.exit(i),t.enter(s),u}function u(f){return a>999||f===null||f===91||f===93&&!l||f===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(f):f===93?(t.exit(s),t.enter(i),t.consume(f),t.exit(i),t.exit(r),e):ye(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),u):(t.enter("chunkString",{contentType:"string"}),d(f))}function d(f){return f===null||f===91||f===93||ye(f)||a++>999?(t.exit("chunkString"),u(f)):(t.consume(f),l||(l=!Ge(f)),f===92?h:d)}function h(f){return f===91||f===92||f===93?(t.consume(f),a++,d):d(f)}}function a4(t,e,n,r,i,s){let o;return a;function a(h){return h===34||h===39||h===40?(t.enter(r),t.enter(i),t.consume(h),t.exit(i),o=h===40?41:h,l):n(h)}function l(h){return h===o?(t.enter(i),t.consume(h),t.exit(i),t.exit(r),e):(t.enter(s),c(h))}function c(h){return h===o?(t.exit(s),l(o)):h===null?n(h):ye(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),je(t,c,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),u(h))}function u(h){return h===o||h===null||ye(h)?(t.exit("chunkString"),c(h)):(t.consume(h),h===92?d:u)}function d(h){return h===o||h===92?(t.consume(h),u):u(h)}}function Ih(t,e){let n;return r;function r(i){return ye(i)?(t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),n=!0,r):Ge(i)?je(t,r,n?"linePrefix":"lineSuffix")(i):e(i)}}const vJ={name:"definition",tokenize:kJ},wJ={partial:!0,tokenize:TJ};function kJ(t,e,n){const r=this;let i;return s;function s(f){return t.enter("definition"),o(f)}function o(f){return o4.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function a(f){return i=Ci(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(t.enter("definitionMarker"),t.consume(f),t.exit("definitionMarker"),l):n(f)}function l(f){return mt(f)?Ih(t,c)(f):c(f)}function c(f){return s4(t,u,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function u(f){return t.attempt(wJ,d,d)(f)}function d(f){return Ge(f)?je(t,h,"whitespace")(f):h(f)}function h(f){return f===null||ye(f)?(t.exit("definition"),r.parser.defined.push(i),e(f)):n(f)}}function TJ(t,e,n){return r;function r(a){return mt(a)?Ih(t,i)(a):n(a)}function i(a){return a4(t,s,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function s(a){return Ge(a)?je(t,o,"whitespace")(a):o(a)}function o(a){return a===null||ye(a)?e(a):n(a)}}const SJ={name:"hardBreakEscape",tokenize:CJ};function CJ(t,e,n){return r;function r(s){return t.enter("hardBreakEscape"),t.consume(s),i}function i(s){return ye(s)?(t.exit("hardBreakEscape"),e(s)):n(s)}}const AJ={name:"headingAtx",resolve:IJ,tokenize:MJ};function IJ(t,e){let n=t.length-2,r=3,i,s;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(i={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},s={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},Ur(t,r,n-r+1,[["enter",i,e],["enter",s,e],["exit",s,e],["exit",i,e]])),t}function MJ(t,e,n){let r=0;return i;function i(u){return t.enter("atxHeading"),s(u)}function s(u){return t.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&r++<6?(t.consume(u),o):u===null||mt(u)?(t.exit("atxHeadingSequence"),a(u)):n(u)}function a(u){return u===35?(t.enter("atxHeadingSequence"),l(u)):u===null||ye(u)?(t.exit("atxHeading"),e(u)):Ge(u)?je(t,a,"whitespace")(u):(t.enter("atxHeadingText"),c(u))}function l(u){return u===35?(t.consume(u),l):(t.exit("atxHeadingSequence"),a(u))}function c(u){return u===null||u===35||mt(u)?(t.exit("atxHeadingText"),a(u)):(t.consume(u),c)}}const DJ=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],l4=["pre","script","style","textarea"],NJ={concrete:!0,name:"htmlFlow",resolveTo:LJ,tokenize:RJ},OJ={partial:!0,tokenize:FJ},PJ={partial:!0,tokenize:BJ};function LJ(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function RJ(t,e,n){const r=this;let i,s,o,a,l;return c;function c(A){return u(A)}function u(A){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(A),d}function d(A){return A===33?(t.consume(A),h):A===47?(t.consume(A),s=!0,g):A===63?(t.consume(A),i=3,r.interrupt?e:C):hr(A)?(t.consume(A),o=String.fromCharCode(A),b):n(A)}function h(A){return A===45?(t.consume(A),i=2,f):A===91?(t.consume(A),i=5,a=0,p):hr(A)?(t.consume(A),i=4,r.interrupt?e:C):n(A)}function f(A){return A===45?(t.consume(A),r.interrupt?e:C):n(A)}function p(A){const ot="CDATA[";return A===ot.charCodeAt(a++)?(t.consume(A),a===ot.length?r.interrupt?e:$:p):n(A)}function g(A){return hr(A)?(t.consume(A),o=String.fromCharCode(A),b):n(A)}function b(A){if(A===null||A===47||A===62||mt(A)){const ot=A===47,Ce=o.toLowerCase();return!ot&&!s&&l4.includes(Ce)?(i=1,r.interrupt?e(A):$(A)):DJ.includes(o.toLowerCase())?(i=6,ot?(t.consume(A),_):r.interrupt?e(A):$(A)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(A):s?y(A):x(A))}return A===45||wr(A)?(t.consume(A),o+=String.fromCharCode(A),b):n(A)}function _(A){return A===62?(t.consume(A),r.interrupt?e:$):n(A)}function y(A){return Ge(A)?(t.consume(A),y):M(A)}function x(A){return A===47?(t.consume(A),M):A===58||A===95||hr(A)?(t.consume(A),E):Ge(A)?(t.consume(A),x):M(A)}function E(A){return A===45||A===46||A===58||A===95||wr(A)?(t.consume(A),E):I(A)}function I(A){return A===61?(t.consume(A),v):Ge(A)?(t.consume(A),I):x(A)}function v(A){return A===null||A===60||A===61||A===62||A===96?n(A):A===34||A===39?(t.consume(A),l=A,N):Ge(A)?(t.consume(A),v):L(A)}function N(A){return A===l?(t.consume(A),l=null,z):A===null||ye(A)?n(A):(t.consume(A),N)}function L(A){return A===null||A===34||A===39||A===47||A===60||A===61||A===62||A===96||mt(A)?I(A):(t.consume(A),L)}function z(A){return A===47||A===62||Ge(A)?x(A):n(A)}function M(A){return A===62?(t.consume(A),B):n(A)}function B(A){return A===null||ye(A)?$(A):Ge(A)?(t.consume(A),B):n(A)}function $(A){return A===45&&i===2?(t.consume(A),we):A===60&&i===1?(t.consume(A),de):A===62&&i===4?(t.consume(A),he):A===63&&i===3?(t.consume(A),C):A===93&&i===5?(t.consume(A),Se):ye(A)&&(i===6||i===7)?(t.exit("htmlFlowData"),t.check(OJ,qe,se)(A)):A===null||ye(A)?(t.exit("htmlFlowData"),se(A)):(t.consume(A),$)}function se(A){return t.check(PJ,be,qe)(A)}function be(A){return t.enter("lineEnding"),t.consume(A),t.exit("lineEnding"),_e}function _e(A){return A===null||ye(A)?se(A):(t.enter("htmlFlowData"),$(A))}function we(A){return A===45?(t.consume(A),C):$(A)}function de(A){return A===47?(t.consume(A),o="",Ue):$(A)}function Ue(A){if(A===62){const ot=o.toLowerCase();return l4.includes(ot)?(t.consume(A),he):$(A)}return hr(A)&&o.length<8?(t.consume(A),o+=String.fromCharCode(A),Ue):$(A)}function Se(A){return A===93?(t.consume(A),C):$(A)}function C(A){return A===62?(t.consume(A),he):A===45&&i===2?(t.consume(A),C):$(A)}function he(A){return A===null||ye(A)?(t.exit("htmlFlowData"),qe(A)):(t.consume(A),he)}function qe(A){return t.exit("htmlFlow"),e(A)}}function BJ(t,e,n){const r=this;return i;function i(o){return ye(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),s):n(o)}function s(o){return r.parser.lazy[r.now().line]?n(o):e(o)}}function FJ(t,e,n){return r;function r(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),t.attempt(Ch,e,n)}}const UJ={name:"htmlText",tokenize:$J};function $J(t,e,n){const r=this;let i,s,o;return a;function a(C){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(C),l}function l(C){return C===33?(t.consume(C),c):C===47?(t.consume(C),I):C===63?(t.consume(C),x):hr(C)?(t.consume(C),L):n(C)}function c(C){return C===45?(t.consume(C),u):C===91?(t.consume(C),s=0,p):hr(C)?(t.consume(C),y):n(C)}function u(C){return C===45?(t.consume(C),f):n(C)}function d(C){return C===null?n(C):C===45?(t.consume(C),h):ye(C)?(o=d,de(C)):(t.consume(C),d)}function h(C){return C===45?(t.consume(C),f):d(C)}function f(C){return C===62?we(C):C===45?h(C):d(C)}function p(C){const he="CDATA[";return C===he.charCodeAt(s++)?(t.consume(C),s===he.length?g:p):n(C)}function g(C){return C===null?n(C):C===93?(t.consume(C),b):ye(C)?(o=g,de(C)):(t.consume(C),g)}function b(C){return C===93?(t.consume(C),_):g(C)}function _(C){return C===62?we(C):C===93?(t.consume(C),_):g(C)}function y(C){return C===null||C===62?we(C):ye(C)?(o=y,de(C)):(t.consume(C),y)}function x(C){return C===null?n(C):C===63?(t.consume(C),E):ye(C)?(o=x,de(C)):(t.consume(C),x)}function E(C){return C===62?we(C):x(C)}function I(C){return hr(C)?(t.consume(C),v):n(C)}function v(C){return C===45||wr(C)?(t.consume(C),v):N(C)}function N(C){return ye(C)?(o=N,de(C)):Ge(C)?(t.consume(C),N):we(C)}function L(C){return C===45||wr(C)?(t.consume(C),L):C===47||C===62||mt(C)?z(C):n(C)}function z(C){return C===47?(t.consume(C),we):C===58||C===95||hr(C)?(t.consume(C),M):ye(C)?(o=z,de(C)):Ge(C)?(t.consume(C),z):we(C)}function M(C){return C===45||C===46||C===58||C===95||wr(C)?(t.consume(C),M):B(C)}function B(C){return C===61?(t.consume(C),$):ye(C)?(o=B,de(C)):Ge(C)?(t.consume(C),B):z(C)}function $(C){return C===null||C===60||C===61||C===62||C===96?n(C):C===34||C===39?(t.consume(C),i=C,se):ye(C)?(o=$,de(C)):Ge(C)?(t.consume(C),$):(t.consume(C),be)}function se(C){return C===i?(t.consume(C),i=void 0,_e):C===null?n(C):ye(C)?(o=se,de(C)):(t.consume(C),se)}function be(C){return C===null||C===34||C===39||C===60||C===61||C===96?n(C):C===47||C===62||mt(C)?z(C):(t.consume(C),be)}function _e(C){return C===47||C===62||mt(C)?z(C):n(C)}function we(C){return C===62?(t.consume(C),t.exit("htmlTextData"),t.exit("htmlText"),e):n(C)}function de(C){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(C),t.exit("lineEnding"),Ue}function Ue(C){return Ge(C)?je(t,Se,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):Se(C)}function Se(C){return t.enter("htmlTextData"),o(C)}}const Gx={name:"labelEnd",resolveAll:jJ,resolveTo:YJ,tokenize:GJ},HJ={tokenize:VJ},zJ={tokenize:qJ},WJ={tokenize:XJ};function jJ(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",e+=i}}return t.length!==n.length&&Ur(t,0,t.length,n),t}function YJ(t,e){let n=t.length,r=0,i,s,o,a;for(;n--;)if(i=t[n][1],s){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;t[n][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(s=n,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(o=n);const l={type:t[s][1].type==="labelLink"?"link":"image",start:{...t[s][1].start},end:{...t[t.length-1][1].end}},c={type:"label",start:{...t[s][1].start},end:{...t[o][1].end}},u={type:"labelText",start:{...t[s+r+2][1].end},end:{...t[o-2][1].start}};return a=[["enter",l,e],["enter",c,e]],a=ii(a,t.slice(s+1,s+r+3)),a=ii(a,[["enter",u,e]]),a=ii(a,gm(e.parser.constructs.insideSpan.null,t.slice(s+r+4,o-3),e)),a=ii(a,[["exit",u,e],t[o-2],t[o-1],["exit",c,e]]),a=ii(a,t.slice(o+1)),a=ii(a,[["exit",l,e]]),Ur(t,s,t.length,a),t}function GJ(t,e,n){const r=this;let i=r.events.length,s,o;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){s=r.events[i][1];break}return a;function a(h){return s?s._inactive?d(h):(o=r.parser.defined.includes(Ci(r.sliceSerialize({start:s.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(h),t.exit("labelMarker"),t.exit("labelEnd"),l):n(h)}function l(h){return h===40?t.attempt(HJ,u,o?u:d)(h):h===91?t.attempt(zJ,u,o?c:d)(h):o?u(h):d(h)}function c(h){return t.attempt(WJ,u,d)(h)}function u(h){return e(h)}function d(h){return s._balanced=!0,n(h)}}function VJ(t,e,n){return r;function r(d){return t.enter("resource"),t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),i}function i(d){return mt(d)?Ih(t,s)(d):s(d)}function s(d){return d===41?u(d):s4(t,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function o(d){return mt(d)?Ih(t,l)(d):u(d)}function a(d){return n(d)}function l(d){return d===34||d===39||d===40?a4(t,c,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):u(d)}function c(d){return mt(d)?Ih(t,u)(d):u(d)}function u(d){return d===41?(t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),t.exit("resource"),e):n(d)}}function qJ(t,e,n){const r=this;return i;function i(a){return o4.call(r,t,s,o,"reference","referenceMarker","referenceString")(a)}function s(a){return r.parser.defined.includes(Ci(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function o(a){return n(a)}}function XJ(t,e,n){return r;function r(s){return t.enter("reference"),t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),i}function i(s){return s===93?(t.enter("referenceMarker"),t.consume(s),t.exit("referenceMarker"),t.exit("reference"),e):n(s)}}const KJ={name:"labelStartImage",resolveAll:Gx.resolveAll,tokenize:QJ};function QJ(t,e,n){const r=this;return i;function i(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),s}function s(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const ZJ={name:"labelStartLink",resolveAll:Gx.resolveAll,tokenize:JJ};function JJ(t,e,n){const r=this;return i;function i(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),s}function s(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const Vx={name:"lineEnding",tokenize:eee};function eee(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),je(t,e,"linePrefix")}}const bm={name:"thematicBreak",tokenize:tee};function tee(t,e,n){let r=0,i;return s;function s(c){return t.enter("thematicBreak"),o(c)}function o(c){return i=c,a(c)}function a(c){return c===i?(t.enter("thematicBreakSequence"),l(c)):r>=3&&(c===null||ye(c))?(t.exit("thematicBreak"),e(c)):n(c)}function l(c){return c===i?(t.consume(c),r++,l):(t.exit("thematicBreakSequence"),Ge(c)?je(t,a,"whitespace")(c):a(c))}}const kr={continuation:{tokenize:see},exit:aee,name:"list",tokenize:iee},nee={partial:!0,tokenize:lee},ree={partial:!0,tokenize:oee};function iee(t,e,n){const r=this,i=r.events[r.events.length-1];let s=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,o=0;return a;function a(f){const p=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(p==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:Hx(f)){if(r.containerState.type||(r.containerState.type=p,t.enter(p,{_container:!0})),p==="listUnordered")return t.enter("listItemPrefix"),f===42||f===45?t.check(bm,n,c)(f):c(f);if(!r.interrupt||f===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(f)}return n(f)}function l(f){return Hx(f)&&++o<10?(t.consume(f),l):(!r.interrupt||o<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(t.exit("listItemValue"),c(f)):n(f)}function c(f){return t.enter("listItemMarker"),t.consume(f),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,t.check(Ch,r.interrupt?n:u,t.attempt(nee,h,d))}function u(f){return r.containerState.initialBlankLine=!0,s++,h(f)}function d(f){return Ge(f)?(t.enter("listItemPrefixWhitespace"),t.consume(f),t.exit("listItemPrefixWhitespace"),h):n(f)}function h(f){return r.containerState.size=s+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(f)}}function see(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(Ch,i,s);function i(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,je(t,e,"listItemIndent",r.containerState.size+1)(a)}function s(a){return r.containerState.furtherBlankLines||!Ge(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(ree,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,je(t,t.attempt(kr,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function oee(t,e,n){const r=this;return je(t,i,"listItemIndent",r.containerState.size+1);function i(s){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(s):n(s)}}function aee(t){t.exit(this.containerState.type)}function lee(t,e,n){const r=this;return je(t,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(s){const o=r.events[r.events.length-1];return!Ge(s)&&o&&o[1].type==="listItemPrefixWhitespace"?e(s):n(s)}}const c4={name:"setextUnderline",resolveTo:cee,tokenize:uee};function cee(t,e){let n=t.length,r,i,s;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(i=n)}else t[n][1].type==="content"&&t.splice(n,1),!s&&t[n][1].type==="definition"&&(s=n);const o={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[i][1].type="setextHeadingText",s?(t.splice(i,0,["enter",o,e]),t.splice(s+1,0,["exit",t[r][1],e]),t[r][1].end={...t[s][1].end}):t[r][1]=o,t.push(["exit",o,e]),t}function uee(t,e,n){const r=this;let i;return s;function s(c){let u=r.events.length,d;for(;u--;)if(r.events[u][1].type!=="lineEnding"&&r.events[u][1].type!=="linePrefix"&&r.events[u][1].type!=="content"){d=r.events[u][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(t.enter("setextHeadingLine"),i=c,o(c)):n(c)}function o(c){return t.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===i?(t.consume(c),a):(t.exit("setextHeadingLineSequence"),Ge(c)?je(t,l,"lineSuffix")(c):l(c))}function l(c){return c===null||ye(c)?(t.exit("setextHeadingLine"),e(c)):n(c)}}const dee={tokenize:hee};function hee(t){const e=this,n=t.attempt(Ch,r,t.attempt(this.parser.constructs.flowInitial,i,je(t,t.attempt(this.parser.constructs.flow,i,t.attempt(bJ,i)),"linePrefix")));return n;function r(s){if(s===null){t.consume(s);return}return t.enter("lineEndingBlank"),t.consume(s),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function i(s){if(s===null){t.consume(s);return}return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const fee={resolveAll:d4()},pee=u4("string"),mee=u4("text");function u4(t){return{resolveAll:d4(t==="text"?gee:void 0),tokenize:e};function e(n){const r=this,i=this.parser.constructs[t],s=n.attempt(i,o,a);return o;function o(u){return c(u)?s(u):a(u)}function a(u){if(u===null){n.consume(u);return}return n.enter("data"),n.consume(u),l}function l(u){return c(u)?(n.exit("data"),s(u)):(n.consume(u),l)}function c(u){if(u===null)return!0;const d=i[u];let h=-1;if(d)for(;++h<d.length;){const f=d[h];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function d4(t){return e;function e(n,r){let i=-1,s;for(;++i<=n.length;)s===void 0?n[i]&&n[i][1].type==="data"&&(s=i,i++):(!n[i]||n[i][1].type!=="data")&&(i!==s+2&&(n[s][1].end=n[i-1][1].end,n.splice(s+2,i-s-2),i=s+2),s=void 0);return t?t(n,r):n}}function gee(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],i=e.sliceStream(r);let s=i.length,o=-1,a=0,l;for(;s--;){const c=i[s];if(typeof c=="string"){for(o=c.length;c.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(c===-2)l=!0,a++;else if(c!==-1){s++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const c={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?o:r.start._bufferIndex+o,_index:r.start._index+s,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(t.splice(n,0,["enter",c,e],["exit",c,e]),n+=2)}n++}return t}const bee=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:{91:vJ},disable:{null:[]},document:{42:kr,43:kr,45:kr,48:kr,49:kr,50:kr,51:kr,52:kr,53:kr,54:kr,55:kr,56:kr,57:kr,62:JD},flow:{35:AJ,42:bm,45:[c4,bm],60:NJ,61:c4,95:bm,96:r4,126:r4},flowInitial:{[-2]:Yx,[-1]:Yx,32:Yx},insideSpan:{null:[jx,fee]},string:{38:t4,92:e4},text:{[-5]:Vx,[-4]:Vx,[-3]:Vx,33:KJ,38:t4,42:jx,60:[ZZ,UJ],91:ZJ,92:[SJ,e4],93:Gx,95:jx,96:dJ}},Symbol.toStringTag,{value:"Module"}));function yee(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},s=[];let o=[],a=[];const l={attempt:N(I),check:N(v),consume:y,enter:x,exit:E,interrupt:N(v,{interrupt:!0})},c={code:null,containerState:{},defineSkip:g,events:[],now:p,parser:t,previous:null,sliceSerialize:h,sliceStream:f,write:d};let u=e.tokenize.call(c,l);return e.resolveAll&&s.push(e),c;function d(B){return o=ii(o,B),b(),o[o.length-1]!==null?[]:(L(e,0),c.events=gm(s,c.events,c),c.events)}function h(B,$){return xee(f(B),$)}function f(B){return _ee(o,B)}function p(){const{_bufferIndex:B,_index:$,line:se,column:be,offset:_e}=r;return{_bufferIndex:B,_index:$,line:se,column:be,offset:_e}}function g(B){i[B.line]=B.column,M()}function b(){let B;for(;r._index<o.length;){const $=o[r._index];if(typeof $=="string")for(B=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===B&&r._bufferIndex<$.length;)_($.charCodeAt(r._bufferIndex));else _($)}}function _(B){u=u(B)}function y(B){ye(B)?(r.line++,r.column=1,r.offset+=B===-3?2:1,M()):B!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=B}function x(B,$){const se=$||{};return se.type=B,se.start=p(),c.events.push(["enter",se,c]),a.push(se),se}function E(B){const $=a.pop();return $.end=p(),c.events.push(["exit",$,c]),$}function I(B,$){L(B,$.from)}function v(B,$){$.restore()}function N(B,$){return se;function se(be,_e,we){let de,Ue,Se,C;return Array.isArray(be)?qe(be):"tokenize"in be?qe([be]):he(be);function he(Xe){return Zn;function Zn(xn){const En=xn!==null&&Xe[xn],$n=xn!==null&&Xe.null,Gt=[...Array.isArray(En)?En:En?[En]:[],...Array.isArray($n)?$n:$n?[$n]:[]];return qe(Gt)(xn)}}function qe(Xe){return de=Xe,Ue=0,Xe.length===0?we:A(Xe[Ue])}function A(Xe){return Zn;function Zn(xn){return C=z(),Se=Xe,Xe.partial||(c.currentConstruct=Xe),Xe.name&&c.parser.constructs.disable.null.includes(Xe.name)?Ce():Xe.tokenize.call($?Object.assign(Object.create(c),$):c,l,ot,Ce)(xn)}}function ot(Xe){return B(Se,C),_e}function Ce(Xe){return C.restore(),++Ue<de.length?A(de[Ue]):we}}}function L(B,$){B.resolveAll&&!s.includes(B)&&s.push(B),B.resolve&&Ur(c.events,$,c.events.length-$,B.resolve(c.events.slice($),c)),B.resolveTo&&(c.events=B.resolveTo(c.events,c))}function z(){const B=p(),$=c.previous,se=c.currentConstruct,be=c.events.length,_e=Array.from(a);return{from:be,restore:we};function we(){r=B,c.previous=$,c.currentConstruct=se,c.events.length=be,a=_e,M()}}function M(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function _ee(t,e){const n=e.start._index,r=e.start._bufferIndex,i=e.end._index,s=e.end._bufferIndex;let o;if(n===i)o=[t[n].slice(r,s)];else{if(o=t.slice(n,i),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}s>0&&o.push(t[i].slice(0,s))}return o}function xee(t,e){let n=-1;const r=[];let i;for(;++n<t.length;){const s=t[n];let o;if(typeof s=="string")o=s;else switch(s){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&i)continue;o=" ";break}default:o=String.fromCharCode(s)}i=s===-2,r.push(o)}return r.join("")}function Eee(t){const r={constructs:XD([bee,...(t||{}).extensions||[]]),content:i(YZ),defined:[],document:i(VZ),flow:i(dee),lazy:{},string:i(pee),text:i(mee)};return r;function i(s){return o;function o(a){return yee(r,s,a)}}}function vee(t){for(;!i4(t););return t}const h4=/[\0\t\n\r]/g;function wee(){let t=1,e="",n=!0,r;return i;function i(s,o,a){const l=[];let c,u,d,h,f;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(o||void 0).decode(s)),d=0,e="",n&&(s.charCodeAt(0)===65279&&d++,n=void 0);d<s.length;){if(h4.lastIndex=d,c=h4.exec(s),h=c&&c.index!==void 0?c.index:s.length,f=s.charCodeAt(h),!c){e=s.slice(d);break}if(f===10&&d===h&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),d<h&&(l.push(s.slice(d,h)),t+=h-d),f){case 0:{l.push(65533),t++;break}case 9:{for(u=Math.ceil(t/4)*4,l.push(-2);t++<u;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}d=h+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const kee=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function f4(t){return t.replace(kee,Tee)}function Tee(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const i=n.charCodeAt(1),s=i===120||i===88;return KD(n.slice(s?2:1),s?16:10)}return Wx(n)||t}const p4={}.hasOwnProperty;function See(t,e,n){return typeof e!="string"&&(n=e,e=void 0),Cee(n)(vee(Eee(n).document().write(wee()(t,e,!0))))}function Cee(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(co),autolinkProtocol:z,autolinkEmail:z,atxHeading:s(xs),blockQuote:s($n),characterEscape:z,characterReference:z,codeFenced:s(Gt),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:s(Gt,o),codeText:s(Hn,o),codeTextData:z,data:z,codeFlowValue:z,definition:s(Jn),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:s(Di),hardBreakEscape:s(ma),hardBreakTrailing:s(ma),htmlFlow:s(Ni,o),htmlFlowData:z,htmlText:s(Ni,o),htmlTextData:z,image:s(ga),label:o,link:s(co),listItem:s(uo),listItemValue:h,listOrdered:s(El,d),listUnordered:s(El),paragraph:s(vl),reference:A,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:s(xs),strong:s(ba),thematicBreak:s(On)},exit:{atxHeading:l(),atxHeadingSequence:I,autolink:l(),autolinkEmail:En,autolinkProtocol:xn,blockQuote:l(),characterEscapeValue:M,characterReferenceMarkerHexadecimal:Ce,characterReferenceMarkerNumeric:Ce,characterReferenceValue:Xe,characterReference:Zn,codeFenced:l(b),codeFencedFence:g,codeFencedFenceInfo:f,codeFencedFenceMeta:p,codeFlowValue:M,codeIndented:l(_),codeText:l(_e),codeTextData:M,data:M,definition:l(),definitionDestinationString:E,definitionLabelString:y,definitionTitleString:x,emphasis:l(),hardBreakEscape:l($),hardBreakTrailing:l($),htmlFlow:l(se),htmlFlowData:M,htmlText:l(be),htmlTextData:M,image:l(de),label:Se,labelText:Ue,lineEnding:B,link:l(we),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:ot,resourceDestinationString:C,resourceTitleString:he,resource:qe,setextHeading:l(L),setextHeadingLineSequence:N,setextHeadingText:v,strong:l(),thematicBreak:l()}};m4(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(U){let te={type:"root",children:[]};const Ae={stack:[te],tokenStack:[],config:e,enter:a,exit:c,buffer:o,resume:u,data:n},Be=[];let nt=-1;for(;++nt<U.length;)if(U[nt][1].type==="listOrdered"||U[nt][1].type==="listUnordered")if(U[nt][0]==="enter")Be.push(nt);else{const er=Be.pop();nt=i(U,er,nt)}for(nt=-1;++nt<U.length;){const er=e[U[nt][0]];p4.call(er,U[nt][1].type)&&er[U[nt][1].type].call(Object.assign({sliceSerialize:U[nt][2].sliceSerialize},Ae),U[nt][1])}if(Ae.tokenStack.length>0){const er=Ae.tokenStack[Ae.tokenStack.length-1];(er[1]||g4).call(Ae,void 0,er[0])}for(te.position={start:ta(U.length>0?U[0][1].start:{line:1,column:1,offset:0}),end:ta(U.length>0?U[U.length-2][1].end:{line:1,column:1,offset:0})},nt=-1;++nt<e.transforms.length;)te=e.transforms[nt](te)||te;return te}function i(U,te,Ae){let Be=te-1,nt=-1,er=!1,Cr,Pn,Vt,tr;for(;++Be<=Ae;){const qt=U[Be];switch(qt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{qt[0]==="enter"?nt++:nt--,tr=void 0;break}case"lineEndingBlank":{qt[0]==="enter"&&(Cr&&!tr&&!nt&&!Vt&&(Vt=Be),tr=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:tr=void 0}if(!nt&&qt[0]==="enter"&&qt[1].type==="listItemPrefix"||nt===-1&&qt[0]==="exit"&&(qt[1].type==="listUnordered"||qt[1].type==="listOrdered")){if(Cr){let Ar=Be;for(Pn=void 0;Ar--;){const zn=U[Ar];if(zn[1].type==="lineEnding"||zn[1].type==="lineEndingBlank"){if(zn[0]==="exit")continue;Pn&&(U[Pn][1].type="lineEndingBlank",er=!0),zn[1].type="lineEnding",Pn=Ar}else if(!(zn[1].type==="linePrefix"||zn[1].type==="blockQuotePrefix"||zn[1].type==="blockQuotePrefixWhitespace"||zn[1].type==="blockQuoteMarker"||zn[1].type==="listItemIndent"))break}Vt&&(!Pn||Vt<Pn)&&(Cr._spread=!0),Cr.end=Object.assign({},Pn?U[Pn][1].start:qt[1].end),U.splice(Pn||Be,0,["exit",Cr,qt[2]]),Be++,Ae++}if(qt[1].type==="listItemPrefix"){const Ar={type:"listItem",_spread:!1,start:Object.assign({},qt[1].start),end:void 0};Cr=Ar,U.splice(Be,0,["enter",Ar,qt[2]]),Be++,Ae++,Vt=void 0,tr=!0}}}return U[te][1]._spread=er,Ae}function s(U,te){return Ae;function Ae(Be){a.call(this,U(Be),Be),te&&te.call(this,Be)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(U,te,Ae){this.stack[this.stack.length-1].children.push(U),this.stack.push(U),this.tokenStack.push([te,Ae||void 0]),U.position={start:ta(te.start),end:void 0}}function l(U){return te;function te(Ae){U&&U.call(this,Ae),c.call(this,Ae)}}function c(U,te){const Ae=this.stack.pop(),Be=this.tokenStack.pop();if(Be)Be[0].type!==U.type&&(te?te.call(this,U,Be[0]):(Be[1]||g4).call(this,U,Be[0]));else throw new Error("Cannot close `"+U.type+"` ("+kh({start:U.start,end:U.end})+"): its not open");Ae.position.end=ta(U.end)}function u(){return zx(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function h(U){if(this.data.expectingFirstListItemValue){const te=this.stack[this.stack.length-2];te.start=Number.parseInt(this.sliceSerialize(U),10),this.data.expectingFirstListItemValue=void 0}}function f(){const U=this.resume(),te=this.stack[this.stack.length-1];te.lang=U}function p(){const U=this.resume(),te=this.stack[this.stack.length-1];te.meta=U}function g(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function b(){const U=this.resume(),te=this.stack[this.stack.length-1];te.value=U.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const U=this.resume(),te=this.stack[this.stack.length-1];te.value=U.replace(/(\r?\n|\r)$/g,"")}function y(U){const te=this.resume(),Ae=this.stack[this.stack.length-1];Ae.label=te,Ae.identifier=Ci(this.sliceSerialize(U)).toLowerCase()}function x(){const U=this.resume(),te=this.stack[this.stack.length-1];te.title=U}function E(){const U=this.resume(),te=this.stack[this.stack.length-1];te.url=U}function I(U){const te=this.stack[this.stack.length-1];if(!te.depth){const Ae=this.sliceSerialize(U).length;te.depth=Ae}}function v(){this.data.setextHeadingSlurpLineEnding=!0}function N(U){const te=this.stack[this.stack.length-1];te.depth=this.sliceSerialize(U).codePointAt(0)===61?1:2}function L(){this.data.setextHeadingSlurpLineEnding=void 0}function z(U){const Ae=this.stack[this.stack.length-1].children;let Be=Ae[Ae.length-1];(!Be||Be.type!=="text")&&(Be=Es(),Be.position={start:ta(U.start),end:void 0},Ae.push(Be)),this.stack.push(Be)}function M(U){const te=this.stack.pop();te.value+=this.sliceSerialize(U),te.position.end=ta(U.end)}function B(U){const te=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Ae=te.children[te.children.length-1];Ae.position.end=ta(U.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(te.type)&&(z.call(this,U),M.call(this,U))}function $(){this.data.atHardBreak=!0}function se(){const U=this.resume(),te=this.stack[this.stack.length-1];te.value=U}function be(){const U=this.resume(),te=this.stack[this.stack.length-1];te.value=U}function _e(){const U=this.resume(),te=this.stack[this.stack.length-1];te.value=U}function we(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=te,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function de(){const U=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";U.type+="Reference",U.referenceType=te,delete U.url,delete U.title}else delete U.identifier,delete U.label;this.data.referenceType=void 0}function Ue(U){const te=this.sliceSerialize(U),Ae=this.stack[this.stack.length-2];Ae.label=f4(te),Ae.identifier=Ci(te).toLowerCase()}function Se(){const U=this.stack[this.stack.length-1],te=this.resume(),Ae=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ae.type==="link"){const Be=U.children;Ae.children=Be}else Ae.alt=te}function C(){const U=this.resume(),te=this.stack[this.stack.length-1];te.url=U}function he(){const U=this.resume(),te=this.stack[this.stack.length-1];te.title=U}function qe(){this.data.inReference=void 0}function A(){this.data.referenceType="collapsed"}function ot(U){const te=this.resume(),Ae=this.stack[this.stack.length-1];Ae.label=te,Ae.identifier=Ci(this.sliceSerialize(U)).toLowerCase(),this.data.referenceType="full"}function Ce(U){this.data.characterReferenceType=U.type}function Xe(U){const te=this.sliceSerialize(U),Ae=this.data.characterReferenceType;let Be;Ae?(Be=KD(te,Ae==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Be=Wx(te);const nt=this.stack[this.stack.length-1];nt.value+=Be}function Zn(U){const te=this.stack.pop();te.position.end=ta(U.end)}function xn(U){M.call(this,U);const te=this.stack[this.stack.length-1];te.url=this.sliceSerialize(U)}function En(U){M.call(this,U);const te=this.stack[this.stack.length-1];te.url="mailto:"+this.sliceSerialize(U)}function $n(){return{type:"blockquote",children:[]}}function Gt(){return{type:"code",lang:null,meta:null,value:""}}function Hn(){return{type:"inlineCode",value:""}}function Jn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Di(){return{type:"emphasis",children:[]}}function xs(){return{type:"heading",depth:0,children:[]}}function ma(){return{type:"break"}}function Ni(){return{type:"html",value:""}}function ga(){return{type:"image",title:null,url:"",alt:null}}function co(){return{type:"link",title:null,url:"",children:[]}}function El(U){return{type:"list",ordered:U.type==="listOrdered",start:null,spread:U._spread,children:[]}}function uo(U){return{type:"listItem",spread:U._spread,checked:null,children:[]}}function vl(){return{type:"paragraph",children:[]}}function ba(){return{type:"strong",children:[]}}function Es(){return{type:"text",value:""}}function On(){return{type:"thematicBreak"}}}function ta(t){return{line:t.line,column:t.column,offset:t.offset}}function m4(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?m4(t,r):Aee(t,r)}}function Aee(t,e){let n;for(n in e)if(p4.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function g4(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+kh({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+kh({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+kh({start:e.start,end:e.end})+") is still open")}function Iee(t){const e=this;e.parser=n;function n(r){return See(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}const Mee={}.hasOwnProperty;function b4(t,e){let n=-1,r;if(e.extensions)for(;++n<e.extensions.length;)b4(t,e.extensions[n]);for(r in e)if(Mee.call(e,r))switch(r){case"extensions":break;case"unsafe":{y4(t[r],e[r]);break}case"join":{y4(t[r],e[r]);break}case"handlers":{Dee(t[r],e[r]);break}default:t.options[r]=e[r]}return t}function y4(t,e){e&&t.push(...e)}function Dee(t,e){e&&Object.assign(t,e)}function Nee(t,e,n,r){const i=n.enter("blockquote"),s=n.createTracker(r);s.move("> "),s.shift(2);const o=n.indentLines(n.containerFlow(t,s.current()),Oee);return i(),o}function Oee(t,e,n){return">"+(n?"":" ")+t}function _4(t,e){return x4(t,e.inConstruct,!0)&&!x4(t,e.notInConstruct,!1)}function x4(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let r=-1;for(;++r<e.length;)if(t.includes(e[r]))return!0;return!1}function E4(t,e,n,r){let i=-1;for(;++i<n.unsafe.length;)if(n.unsafe[i].character===`
`&&_4(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function qx(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function Pee(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function Lee(t,e,n,r){const i=Pee(n),s=t.value||"",o=i==="`"?"GraveAccent":"Tilde";if(qx(t,n)){const d=n.enter("codeIndented"),h=n.indentLines(s,Ree);return d(),h}const a=n.createTracker(r),l=i.repeat(Math.max(zD(s,i)+1,3)),c=n.enter("codeFenced");let u=a.move(l);if(t.lang){const d=n.enter(`codeFencedLang${o}`);u+=a.move(n.safe(t.lang,{before:u,after:" ",encode:["`"],...a.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${o}`);u+=a.move(" "),u+=a.move(n.safe(t.meta,{before:u,after:`
`,encode:["`"],...a.current()})),d()}return u+=a.move(`
`),s&&(u+=a.move(s+`
`)),u+=a.move(l),c(),u}function Ree(t,e,n){return(n?"":"    ")+t}function Xx(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function Bee(t,e,n,r){const i=Xx(n),s=i==='"'?"Quote":"Apostrophe",o=n.enter("definition");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("[");return c+=l.move(n.safe(n.associationId(t),{before:c,after:"]",...l.current()})),c+=l.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(t.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(t.url,{before:c,after:t.title?" ":`
`,...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),c+=l.move(" "+i),c+=l.move(n.safe(t.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),o(),c}function Fee(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function na(t){return"&#x"+t.toString(16).toUpperCase()+";"}function ym(t,e,n){const r=$c(t),i=$c(e);return r===void 0?i===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}v4.peek=Uee;function v4(t,e,n,r){const i=Fee(n),s=n.enter("emphasis"),o=n.createTracker(r),a=o.move(i);let l=o.move(n.containerPhrasing(t,{after:i,before:a,...o.current()}));const c=l.charCodeAt(0),u=ym(r.before.charCodeAt(r.before.length-1),c,i);u.inside&&(l=na(c)+l.slice(1));const d=l.charCodeAt(l.length-1),h=ym(r.after.charCodeAt(0),d,i);h.inside&&(l=l.slice(0,-1)+na(d));const f=o.move(i);return s(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},a+l+f}function Uee(t,e,n){return n.options.emphasis||"*"}function w4(t,e){let n=!1;return fm(t,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,$x}),!!((!t.depth||t.depth<3)&&zx(t)&&(e.options.setext||n))}function $ee(t,e,n,r){const i=Math.max(Math.min(6,t.depth||1),1),s=n.createTracker(r);if(w4(t,n)){const u=n.enter("headingSetext"),d=n.enter("phrasing"),h=n.containerPhrasing(t,{...s.current(),before:`
`,after:`
`});return d(),u(),h+`
`+(i===1?"=":"-").repeat(h.length-(Math.max(h.lastIndexOf("\r"),h.lastIndexOf(`
`))+1))}const o="#".repeat(i),a=n.enter("headingAtx"),l=n.enter("phrasing");s.move(o+" ");let c=n.containerPhrasing(t,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(c)&&(c=na(c.charCodeAt(0))+c.slice(1)),c=c?o+" "+c:o,n.options.closeAtx&&(c+=" "+o),l(),a(),c}k4.peek=Hee;function k4(t){return t.value||""}function Hee(){return"<"}T4.peek=zee;function T4(t,e,n,r){const i=Xx(n),s=i==='"'?"Quote":"Apostrophe",o=n.enter("image");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("![");return c+=l.move(n.safe(t.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(t.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(t.url,{before:c,after:t.title?" ":")",...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),c+=l.move(" "+i),c+=l.move(n.safe(t.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),c+=l.move(")"),o(),c}function zee(){return"!"}S4.peek=Wee;function S4(t,e,n,r){const i=t.referenceType,s=n.enter("imageReference");let o=n.enter("label");const a=n.createTracker(r);let l=a.move("![");const c=n.safe(t.alt,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=u,s(),i==="full"||!c||c!==d?l+=a.move(d+"]"):i==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function Wee(){return"!"}C4.peek=jee;function C4(t,e,n){let r=t.value||"",i="`",s=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++s<n.unsafe.length;){const o=n.unsafe[s],a=n.compilePattern(o);let l;if(o.atBreak)for(;l=a.exec(r);){let c=l.index;r.charCodeAt(c)===10&&r.charCodeAt(c-1)===13&&c--,r=r.slice(0,c)+" "+r.slice(l.index+1)}}return i+r+i}function jee(){return"`"}function A4(t,e){const n=zx(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}I4.peek=Yee;function I4(t,e,n,r){const i=Xx(n),s=i==='"'?"Quote":"Apostrophe",o=n.createTracker(r);let a,l;if(A4(t,n)){const u=n.stack;n.stack=[],a=n.enter("autolink");let d=o.move("<");return d+=o.move(n.containerPhrasing(t,{before:d,after:">",...o.current()})),d+=o.move(">"),a(),n.stack=u,d}a=n.enter("link"),l=n.enter("label");let c=o.move("[");return c+=o.move(n.containerPhrasing(t,{before:c,after:"](",...o.current()})),c+=o.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),c+=o.move("<"),c+=o.move(n.safe(t.url,{before:c,after:">",...o.current()})),c+=o.move(">")):(l=n.enter("destinationRaw"),c+=o.move(n.safe(t.url,{before:c,after:t.title?" ":")",...o.current()}))),l(),t.title&&(l=n.enter(`title${s}`),c+=o.move(" "+i),c+=o.move(n.safe(t.title,{before:c,after:i,...o.current()})),c+=o.move(i),l()),c+=o.move(")"),a(),c}function Yee(t,e,n){return A4(t,n)?"<":"["}M4.peek=Gee;function M4(t,e,n,r){const i=t.referenceType,s=n.enter("linkReference");let o=n.enter("label");const a=n.createTracker(r);let l=a.move("[");const c=n.containerPhrasing(t,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=n.stack;n.stack=[],o=n.enter("reference");const d=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=u,s(),i==="full"||!c||c!==d?l+=a.move(d+"]"):i==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function Gee(){return"["}function Kx(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function Vee(t){const e=Kx(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function qee(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function D4(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function Xee(t,e,n,r){const i=n.enter("list"),s=n.bulletCurrent;let o=t.ordered?qee(n):Kx(n);const a=t.ordered?o==="."?")":".":Vee(n);let l=e&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const u=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(l=!0),D4(n)===o&&u){let d=-1;for(;++d<t.children.length;){const h=t.children[d];if(h&&h.type==="listItem"&&h.children&&h.children[0]&&h.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(o=a),n.bulletCurrent=o;const c=n.containerFlow(t,r);return n.bulletLastUsed=o,n.bulletCurrent=s,i(),c}function Kee(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function Qee(t,e,n,r){const i=Kee(n);let s=n.bulletCurrent||Kx(n);e&&e.type==="list"&&e.ordered&&(s=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+s);let o=s.length+1;(i==="tab"||i==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(o=Math.ceil(o/4)*4);const a=n.createTracker(r);a.move(s+" ".repeat(o-s.length)),a.shift(o);const l=n.enter("listItem"),c=n.indentLines(n.containerFlow(t,a.current()),u);return l(),c;function u(d,h,f){return h?(f?"":" ".repeat(o))+d:(f?s:s+" ".repeat(o-s.length))+d}}function Zee(t,e,n,r){const i=n.enter("paragraph"),s=n.enter("phrasing"),o=n.containerPhrasing(t,r);return s(),i(),o}const Jee=dm(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function ete(t,e,n,r){return(t.children.some(function(o){return Jee(o)})?n.containerPhrasing:n.containerFlow).call(n,t,r)}function tte(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}N4.peek=nte;function N4(t,e,n,r){const i=tte(n),s=n.enter("strong"),o=n.createTracker(r),a=o.move(i+i);let l=o.move(n.containerPhrasing(t,{after:i,before:a,...o.current()}));const c=l.charCodeAt(0),u=ym(r.before.charCodeAt(r.before.length-1),c,i);u.inside&&(l=na(c)+l.slice(1));const d=l.charCodeAt(l.length-1),h=ym(r.after.charCodeAt(0),d,i);h.inside&&(l=l.slice(0,-1)+na(d));const f=o.move(i+i);return s(),n.attentionEncodeSurroundingInfo={after:h.outside,before:u.outside},a+l+f}function nte(t,e,n){return n.options.strong||"*"}function rte(t,e,n,r){return n.safe(t.value,r)}function ite(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function ste(t,e,n){const r=(D4(n)+(n.options.ruleSpaces?" ":"")).repeat(ite(n));return n.options.ruleSpaces?r.slice(0,-1):r}const Qx={blockquote:Nee,break:E4,code:Lee,definition:Bee,emphasis:v4,hardBreak:E4,heading:$ee,html:k4,image:T4,imageReference:S4,inlineCode:C4,link:I4,linkReference:M4,list:Xee,listItem:Qee,paragraph:Zee,root:ete,strong:N4,text:rte,thematicBreak:ste},ote=[ate];function ate(t,e,n,r){if(e.type==="code"&&qx(e,r)&&(t.type==="list"||t.type===e.type&&qx(t,r)))return!1;if("spread"in n&&typeof n.spread=="boolean")return t.type==="paragraph"&&(t.type===e.type||e.type==="definition"||e.type==="heading"&&w4(e,r))?void 0:n.spread?1:0}const ml=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],lte=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:ml},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:ml},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:ml},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:ml},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:ml},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:ml},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:ml},{atBreak:!0,character:"~"}];function cte(t){return t.label||!t.identifier?t.label||"":f4(t.identifier)}function ute(t){if(!t._compiled){const e=(t.atBreak?"[\\r\\n][\\t ]*":"")+(t.before?"(?:"+t.before+")":"");t._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(t.character)?"\\":"")+t.character+(t.after?"(?:"+t.after+")":""),"g")}return t._compiled}function dte(t,e,n){const r=e.indexStack,i=t.children||[],s=[];let o=-1,a=n.before,l;r.push(-1);let c=e.createTracker(n);for(;++o<i.length;){const u=i[o];let d;if(r[r.length-1]=o,o+1<i.length){let p=e.handle.handlers[i[o+1].type];p&&p.peek&&(p=p.peek),d=p?p(i[o+1],t,e,{before:"",after:"",...c.current()}).charAt(0):""}else d=n.after;s.length>0&&(a==="\r"||a===`
`)&&u.type==="html"&&(s[s.length-1]=s[s.length-1].replace(/(\r?\n|\r)$/," "),a=" ",c=e.createTracker(n),c.move(s.join("")));let h=e.handle(u,t,e,{...c.current(),after:d,before:a});l&&l===h.slice(0,1)&&(h=na(l.charCodeAt(0))+h.slice(1));const f=e.attentionEncodeSurroundingInfo;e.attentionEncodeSurroundingInfo=void 0,l=void 0,f&&(s.length>0&&f.before&&a===s[s.length-1].slice(-1)&&(s[s.length-1]=s[s.length-1].slice(0,-1)+na(a.charCodeAt(0))),f.after&&(l=d)),c.move(h),s.push(h),a=h.slice(-1)}return r.pop(),s.join("")}function hte(t,e,n){const r=e.indexStack,i=t.children||[],s=e.createTracker(n),o=[];let a=-1;for(r.push(-1);++a<i.length;){const l=i[a];r[r.length-1]=a,o.push(s.move(e.handle(l,t,e,{before:`
`,after:`
`,...s.current()}))),l.type!=="list"&&(e.bulletLastUsed=void 0),a<i.length-1&&o.push(s.move(fte(l,i[a+1],t,e)))}return r.pop(),o.join("")}function fte(t,e,n,r){let i=r.join.length;for(;i--;){const s=r.join[i](t,e,n,r);if(s===!0||s===1)break;if(typeof s=="number")return`
`.repeat(1+s);if(s===!1)return`

<!---->

`}return`

`}const pte=/\r?\n|\r/g;function mte(t,e){const n=[];let r=0,i=0,s;for(;s=pte.exec(t);)o(t.slice(r,s.index)),n.push(s[0]),r=s.index+s[0].length,i++;return o(t.slice(r)),n.join("");function o(a){n.push(e(a,i,!a))}}function gte(t,e,n){const r=(n.before||"")+(e||"")+(n.after||""),i=[],s=[],o={};let a=-1;for(;++a<t.unsafe.length;){const u=t.unsafe[a];if(!_4(t.stack,u))continue;const d=t.compilePattern(u);let h;for(;h=d.exec(r);){const f="before"in u||!!u.atBreak,p="after"in u,g=h.index+(f?h[1].length:0);i.includes(g)?(o[g].before&&!f&&(o[g].before=!1),o[g].after&&!p&&(o[g].after=!1)):(i.push(g),o[g]={before:f,after:p})}}i.sort(bte);let l=n.before?n.before.length:0;const c=r.length-(n.after?n.after.length:0);for(a=-1;++a<i.length;){const u=i[a];u<l||u>=c||u+1<c&&i[a+1]===u+1&&o[u].after&&!o[u+1].before&&!o[u+1].after||i[a-1]===u-1&&o[u].before&&!o[u-1].before&&!o[u-1].after||(l!==u&&s.push(O4(r.slice(l,u),"\\")),l=u,/[!-/:-@[-`{-~]/.test(r.charAt(u))&&(!n.encode||!n.encode.includes(r.charAt(u)))?s.push("\\"):(s.push(na(r.charCodeAt(u))),l++))}return s.push(O4(r.slice(l,c),n.after)),s.join("")}function bte(t,e){return t-e}function O4(t,e){const n=/\\(?=[!-/:-@[-`{-~])/g,r=[],i=[],s=t+e;let o=-1,a=0,l;for(;l=n.exec(s);)r.push(l.index);for(;++o<r.length;)a!==r[o]&&i.push(t.slice(a,r[o])),i.push("\\"),a=r[o];return i.push(t.slice(a)),i.join("")}function yte(t){const e=t||{},n=e.now||{};let r=e.lineShift||0,i=n.line||1,s=n.column||1;return{move:l,current:o,shift:a};function o(){return{now:{line:i,column:s},lineShift:r}}function a(c){r+=c}function l(c){const u=c||"",d=u.split(/\r?\n|\r/g),h=d[d.length-1];return i+=d.length-1,s=d.length===1?s+h.length:1+h.length+r,u}}function _te(t,e){const n=e||{},r={associationId:cte,containerPhrasing:wte,containerFlow:kte,createTracker:yte,compilePattern:ute,enter:s,handlers:{...Qx},handle:void 0,indentLines:mte,indexStack:[],join:[...ote],options:{},safe:Tte,stack:[],unsafe:[...lte]};b4(r,n),r.options.tightDefinitions&&r.join.push(vte),r.handle=yD("type",{invalid:xte,unknown:Ete,handlers:r.handlers});let i=r.handle(t,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return i&&i.charCodeAt(i.length-1)!==10&&i.charCodeAt(i.length-1)!==13&&(i+=`
`),i;function s(o){return r.stack.push(o),a;function a(){r.stack.pop()}}}function xte(t){throw new Error("Cannot handle value `"+t+"`, expected node")}function Ete(t){const e=t;throw new Error("Cannot handle unknown node `"+e.type+"`")}function vte(t,e){if(t.type==="definition"&&t.type===e.type)return 0}function wte(t,e){return dte(t,this,e)}function kte(t,e){return hte(t,this,e)}function Tte(t,e){return gte(this,t,e)}function Ste(t){const e=this;e.compiler=n;function n(r){return _te(r,{...e.data("settings"),...t,extensions:e.data("toMarkdownExtensions")||[]})}}function Cte(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Ate(t,e,n){const i=dm((n||{}).ignore||[]),s=Ite(e);let o=-1;for(;++o<s.length;)FD(t,"text",a);function a(c,u){let d=-1,h;for(;++d<u.length;){const f=u[d],p=h?h.children:void 0;if(i(f,p?p.indexOf(f):void 0,h))return;h=f}if(h)return l(c,u)}function l(c,u){const d=u[u.length-1],h=s[o][0],f=s[o][1];let p=0;const b=d.children.indexOf(c);let _=!1,y=[];h.lastIndex=0;let x=h.exec(c.value);for(;x;){const E=x.index,I={index:x.index,input:x.input,stack:[...u,c]};let v=f(...x,I);if(typeof v=="string"&&(v=v.length>0?{type:"text",value:v}:void 0),v===!1?h.lastIndex=E+1:(p!==E&&y.push({type:"text",value:c.value.slice(p,E)}),Array.isArray(v)?y.push(...v):v&&y.push(v),p=E+x[0].length,_=!0),!h.global)break;x=h.exec(c.value)}return _?(p<c.value.length&&y.push({type:"text",value:c.value.slice(p)}),d.children.splice(b,1,...y)):y=[c],b+y.length}}function Ite(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const i=n[r];e.push([Mte(i[0]),Dte(i[1])])}return e}function Mte(t){return typeof t=="string"?new RegExp(Cte(t),"g"):t}function Dte(t){return typeof t=="function"?t:function(){return t}}function Nte(){return{transforms:[Fte],enter:{literalAutolink:Ote,literalAutolinkEmail:Zx,literalAutolinkHttp:Zx,literalAutolinkWww:Zx},exit:{literalAutolink:Bte,literalAutolinkEmail:Rte,literalAutolinkHttp:Pte,literalAutolinkWww:Lte}}}function Ote(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Zx(t){this.config.enter.autolinkProtocol.call(this,t)}function Pte(t){this.config.exit.autolinkProtocol.call(this,t)}function Lte(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function Rte(t){this.config.exit.autolinkEmail.call(this,t)}function Bte(t){this.exit(t)}function Fte(t){Ate(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Ute],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),$te]],{ignore:["link","linkReference"]})}function Ute(t,e,n,r,i){let s="";if(!P4(i)||(/^w/i.test(e)&&(n=e+n,e="",s="http://"),!Hte(n)))return!1;const o=zte(n+r);if(!o[0])return!1;const a={type:"link",title:null,url:s+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function $te(t,e,n,r){return!P4(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function Hte(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function zte(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],r=n.indexOf(")");const i=cm(t,"(");let s=cm(t,")");for(;r!==-1&&i>s;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),s++;return[t,n]}function P4(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||pl(n)||mm(n))&&(!e||n!==47)}L4.peek=Qte;function Wte(){this.buffer()}function jte(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function Yte(){this.buffer()}function Gte(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Vte(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Ci(this.sliceSerialize(t)).toLowerCase(),n.label=e}function qte(t){this.exit(t)}function Xte(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Ci(this.sliceSerialize(t)).toLowerCase(),n.label=e}function Kte(t){this.exit(t)}function Qte(){return"["}function L4(t,e,n,r){const i=n.createTracker(r);let s=i.move("[^");const o=n.enter("footnoteReference"),a=n.enter("reference");return s+=i.move(n.safe(n.associationId(t),{after:"]",before:s})),a(),o(),s+=i.move("]"),s}function Zte(){return{enter:{gfmFootnoteCallString:Wte,gfmFootnoteCall:jte,gfmFootnoteDefinitionLabelString:Yte,gfmFootnoteDefinition:Gte},exit:{gfmFootnoteCallString:Vte,gfmFootnoteCall:qte,gfmFootnoteDefinitionLabelString:Xte,gfmFootnoteDefinition:Kte}}}function Jte(t){return{handlers:{footnoteDefinition:e,footnoteReference:L4},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function e(n,r,i,s){const o=i.createTracker(s);let a=o.move("[^");const l=i.enter("footnoteDefinition"),c=i.enter("label");return a+=o.move(i.safe(i.associationId(n),{before:a,after:"]"})),c(),a+=o.move("]:"),n.children&&n.children.length>0&&(o.shift(4),a+=o.move(" "+i.indentLines(i.containerFlow(n,o.current()),ene))),l(),a}}function ene(t,e,n){return e===0?t:tne(t,e,n)}function tne(t,e,n){return(n?"":"    ")+t}const nne=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];R4.peek=ane;function rne(){return{canContainEols:["delete"],enter:{strikethrough:sne},exit:{strikethrough:one}}}function ine(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:nne}],handlers:{delete:R4}}}function sne(t){this.enter({type:"delete",children:[]},t)}function one(t){this.exit(t)}function R4(t,e,n,r){const i=n.createTracker(r),s=n.enter("strikethrough");let o=i.move("~~");return o+=n.containerPhrasing(t,{...i.current(),before:o,after:"~"}),o+=i.move("~~"),s(),o}function ane(){return"~"}function lne(t){return t.length}function cne(t,e){const n=e||{},r=(n.align||[]).concat(),i=n.stringLength||lne,s=[],o=[],a=[],l=[];let c=0,u=-1;for(;++u<t.length;){const g=[],b=[];let _=-1;for(t[u].length>c&&(c=t[u].length);++_<t[u].length;){const y=une(t[u][_]);if(n.alignDelimiters!==!1){const x=i(y);b[_]=x,(l[_]===void 0||x>l[_])&&(l[_]=x)}g.push(y)}o[u]=g,a[u]=b}let d=-1;if(typeof r=="object"&&"length"in r)for(;++d<c;)s[d]=B4(r[d]);else{const g=B4(r);for(;++d<c;)s[d]=g}d=-1;const h=[],f=[];for(;++d<c;){const g=s[d];let b="",_="";g===99?(b=":",_=":"):g===108?b=":":g===114&&(_=":");let y=n.alignDelimiters===!1?1:Math.max(1,l[d]-b.length-_.length);const x=b+"-".repeat(y)+_;n.alignDelimiters!==!1&&(y=b.length+y+_.length,y>l[d]&&(l[d]=y),f[d]=y),h[d]=x}o.splice(1,0,h),a.splice(1,0,f),u=-1;const p=[];for(;++u<o.length;){const g=o[u],b=a[u];d=-1;const _=[];for(;++d<c;){const y=g[d]||"";let x="",E="";if(n.alignDelimiters!==!1){const I=l[d]-(b[d]||0),v=s[d];v===114?x=" ".repeat(I):v===99?I%2?(x=" ".repeat(I/2+.5),E=" ".repeat(I/2-.5)):(x=" ".repeat(I/2),E=x):E=" ".repeat(I)}n.delimiterStart!==!1&&!d&&_.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&y==="")&&(n.delimiterStart!==!1||d)&&_.push(" "),n.alignDelimiters!==!1&&_.push(x),_.push(y),n.alignDelimiters!==!1&&_.push(E),n.padding!==!1&&_.push(" "),(n.delimiterEnd!==!1||d!==c-1)&&_.push("|")}p.push(n.delimiterEnd===!1?_.join("").replace(/ +$/,""):_.join(""))}return p.join(`
`)}function une(t){return t==null?"":String(t)}function B4(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function dne(){return{enter:{table:hne,tableData:F4,tableHeader:F4,tableRow:pne},exit:{codeText:mne,table:fne,tableData:Jx,tableHeader:Jx,tableRow:Jx}}}function hne(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function fne(t){this.exit(t),this.data.inTable=void 0}function pne(t){this.enter({type:"tableRow",children:[]},t)}function Jx(t){this.exit(t)}function F4(t){this.enter({type:"tableCell",children:[]},t)}function mne(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,gne));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function gne(t,e){return e==="|"?e:t}function bne(t){const e={},n=e.tableCellPadding,r=e.tablePipeAlign,i=e.stringLength,s=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:h,table:o,tableCell:l,tableRow:a}};function o(f,p,g,b){return c(u(f,g,b),f.align)}function a(f,p,g,b){const _=d(f,g,b),y=c([_]);return y.slice(0,y.indexOf(`
`))}function l(f,p,g,b){const _=g.enter("tableCell"),y=g.enter("phrasing"),x=g.containerPhrasing(f,{...b,before:s,after:s});return y(),_(),x}function c(f,p){return cne(f,{align:p,alignDelimiters:r,padding:n,stringLength:i})}function u(f,p,g){const b=f.children;let _=-1;const y=[],x=p.enter("table");for(;++_<b.length;)y[_]=d(b[_],p,g);return x(),y}function d(f,p,g){const b=f.children;let _=-1;const y=[],x=p.enter("tableRow");for(;++_<b.length;)y[_]=l(b[_],f,p,g);return x(),y}function h(f,p,g){let b=Qx.inlineCode(f,p,g);return g.stack.includes("tableCell")&&(b=b.replace(/\|/g,"\\$&")),b}}function yne(){return{exit:{taskListCheckValueChecked:U4,taskListCheckValueUnchecked:U4,paragraph:xne}}}function _ne(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Ene}}}function U4(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function xne(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const i=e.children;let s=-1,o;for(;++s<i.length;){const a=i[s];if(a.type==="paragraph"){o=a;break}}o===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(t)}function Ene(t,e,n,r){const i=t.children[0],s=typeof t.checked=="boolean"&&i&&i.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",a=n.createTracker(r);s&&a.move(o);let l=Qx.listItem(t,e,n,{...r,...a.current()});return s&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,c)),l;function c(u){return u+o}}const vne={tokenize:Ane,partial:!0},$4={tokenize:Ine,partial:!0},H4={tokenize:Mne,partial:!0},z4={tokenize:Dne,partial:!0},wne={tokenize:Nne,partial:!0},W4={name:"wwwAutolink",tokenize:Sne,previous:Y4},j4={name:"protocolAutolink",tokenize:Cne,previous:G4},oo={name:"emailAutolink",tokenize:Tne,previous:V4},hs={};function kne(){return{text:hs}}let gl=48;for(;gl<123;)hs[gl]=oo,gl++,gl===58?gl=65:gl===91&&(gl=97);hs[43]=oo,hs[45]=oo,hs[46]=oo,hs[95]=oo,hs[72]=[oo,j4],hs[104]=[oo,j4],hs[87]=[oo,W4],hs[119]=[oo,W4];function Tne(t,e,n){const r=this;let i,s;return o;function o(d){return!eE(d)||!V4.call(r,r.previous)||tE(r.events)?n(d):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),a(d))}function a(d){return eE(d)?(t.consume(d),a):d===64?(t.consume(d),l):n(d)}function l(d){return d===46?t.check(wne,u,c)(d):d===45||d===95||wr(d)?(s=!0,t.consume(d),l):u(d)}function c(d){return t.consume(d),i=!0,l}function u(d){return s&&i&&hr(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(d)):n(d)}}function Sne(t,e,n){const r=this;return i;function i(o){return o!==87&&o!==119||!Y4.call(r,r.previous)||tE(r.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(vne,t.attempt($4,t.attempt(H4,s),n),n)(o))}function s(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(o)}}function Cne(t,e,n){const r=this;let i="",s=!1;return o;function o(d){return(d===72||d===104)&&G4.call(r,r.previous)&&!tE(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),i+=String.fromCodePoint(d),t.consume(d),a):n(d)}function a(d){if(hr(d)&&i.length<5)return i+=String.fromCodePoint(d),t.consume(d),a;if(d===58){const h=i.toLowerCase();if(h==="http"||h==="https")return t.consume(d),l}return n(d)}function l(d){return d===47?(t.consume(d),s?c:(s=!0,l)):n(d)}function c(d){return d===null||pm(d)||mt(d)||pl(d)||mm(d)?n(d):t.attempt($4,t.attempt(H4,u),n)(d)}function u(d){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(d)}}function Ane(t,e,n){let r=0;return i;function i(o){return(o===87||o===119)&&r<3?(r++,t.consume(o),i):o===46&&r===3?(t.consume(o),s):n(o)}function s(o){return o===null?n(o):e(o)}}function Ine(t,e,n){let r,i,s;return o;function o(c){return c===46||c===95?t.check(z4,l,a)(c):c===null||mt(c)||pl(c)||c!==45&&mm(c)?l(c):(s=!0,t.consume(c),o)}function a(c){return c===95?r=!0:(i=r,r=void 0),t.consume(c),o}function l(c){return i||r||!s?n(c):e(c)}}function Mne(t,e){let n=0,r=0;return i;function i(o){return o===40?(n++,t.consume(o),i):o===41&&r<n?s(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(z4,e,s)(o):o===null||mt(o)||pl(o)?e(o):(t.consume(o),i)}function s(o){return o===41&&r++,t.consume(o),i}}function Dne(t,e,n){return r;function r(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(t.consume(a),r):a===38?(t.consume(a),s):a===93?(t.consume(a),i):a===60||a===null||mt(a)||pl(a)?e(a):n(a)}function i(a){return a===null||a===40||a===91||mt(a)||pl(a)?e(a):r(a)}function s(a){return hr(a)?o(a):n(a)}function o(a){return a===59?(t.consume(a),r):hr(a)?(t.consume(a),o):n(a)}}function Nne(t,e,n){return r;function r(s){return t.consume(s),i}function i(s){return wr(s)?n(s):e(s)}}function Y4(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||mt(t)}function G4(t){return!hr(t)}function V4(t){return!(t===47||eE(t))}function eE(t){return t===43||t===45||t===46||t===95||wr(t)}function tE(t){let e=t.length,n=!1;for(;e--;){const r=t[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const One={tokenize:Hne,partial:!0};function Pne(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:Fne,continuation:{tokenize:Une},exit:$ne}},text:{91:{name:"gfmFootnoteCall",tokenize:Bne},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Lne,resolveTo:Rne}}}}function Lne(t,e,n){const r=this;let i=r.events.length;const s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o;for(;i--;){const l=r.events[i][1];if(l.type==="labelImage"){o=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return a;function a(l){if(!o||!o._balanced)return n(l);const c=Ci(r.sliceSerialize({start:o.end,end:r.now()}));return c.codePointAt(0)!==94||!s.includes(c.slice(1))?n(l):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),e(l))}}function Rne(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},a=[t[n+1],t[n+2],["enter",r,e],t[n+3],t[n+4],["enter",i,e],["exit",i,e],["enter",s,e],["enter",o,e],["exit",o,e],["exit",s,e],t[t.length-2],t[t.length-1],["exit",r,e]];return t.splice(n,t.length-n+1,...a),t}function Bne(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s=0,o;return a;function a(d){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),l}function l(d){return d!==94?n(d):(t.enter("gfmFootnoteCallMarker"),t.consume(d),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",c)}function c(d){if(s>999||d===93&&!o||d===null||d===91||mt(d))return n(d);if(d===93){t.exit("chunkString");const h=t.exit("gfmFootnoteCallString");return i.includes(Ci(r.sliceSerialize(h)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(d)}return mt(d)||(o=!0),s++,t.consume(d),d===92?u:c}function u(d){return d===91||d===92||d===93?(t.consume(d),s++,c):c(d)}}function Fne(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,o=0,a;return l;function l(p){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(p){return p===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",u):n(p)}function u(p){if(o>999||p===93&&!a||p===null||p===91||mt(p))return n(p);if(p===93){t.exit("chunkString");const g=t.exit("gfmFootnoteDefinitionLabelString");return s=Ci(r.sliceSerialize(g)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(p),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),h}return mt(p)||(a=!0),o++,t.consume(p),p===92?d:u}function d(p){return p===91||p===92||p===93?(t.consume(p),o++,u):u(p)}function h(p){return p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),i.includes(s)||i.push(s),je(t,f,"gfmFootnoteDefinitionWhitespace")):n(p)}function f(p){return e(p)}}function Une(t,e,n){return t.check(Ch,e,t.attempt(One,e,n))}function $ne(t){t.exit("gfmFootnoteDefinition")}function Hne(t,e,n){const r=this;return je(t,i,"gfmFootnoteDefinitionIndent",5);function i(s){const o=r.events[r.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?e(s):n(s)}}function zne(t){let n={}.singleTilde;const r={name:"strikethrough",tokenize:s,resolveAll:i};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function i(o,a){let l=-1;for(;++l<o.length;)if(o[l][0]==="enter"&&o[l][1].type==="strikethroughSequenceTemporary"&&o[l][1]._close){let c=l;for(;c--;)if(o[c][0]==="exit"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._open&&o[l][1].end.offset-o[l][1].start.offset===o[c][1].end.offset-o[c][1].start.offset){o[l][1].type="strikethroughSequence",o[c][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[c][1].start),end:Object.assign({},o[l][1].end)},d={type:"strikethroughText",start:Object.assign({},o[c][1].end),end:Object.assign({},o[l][1].start)},h=[["enter",u,a],["enter",o[c][1],a],["exit",o[c][1],a],["enter",d,a]],f=a.parser.constructs.insideSpan.null;f&&Ur(h,h.length,0,gm(f,o.slice(c+1,l),a)),Ur(h,h.length,0,[["exit",d,a],["enter",o[l][1],a],["exit",o[l][1],a],["exit",u,a]]),Ur(o,c-1,l-c+3,h),l=c+h.length-2;break}}for(l=-1;++l<o.length;)o[l][1].type==="strikethroughSequenceTemporary"&&(o[l][1].type="data");return o}function s(o,a,l){const c=this.previous,u=this.events;let d=0;return h;function h(p){return c===126&&u[u.length-1][1].type!=="characterEscape"?l(p):(o.enter("strikethroughSequenceTemporary"),f(p))}function f(p){const g=$c(c);if(p===126)return d>1?l(p):(o.consume(p),d++,f);if(d<2&&!n)return l(p);const b=o.exit("strikethroughSequenceTemporary"),_=$c(p);return b._open=!_||_===2&&!!g,b._close=!g||g===2&&!!_,a(p)}}}class Wne{constructor(){this.map=[]}add(e,n,r){jne(this,e,n,r)}consume(e){if(this.map.sort(function(s,o){return s[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];r.push(e.slice()),e.length=0;let i=r.pop();for(;i;){for(const s of i)e.push(s);i=r.pop()}this.map.length=0}}function jne(t,e,n,r){let i=0;if(!(n===0&&r.length===0)){for(;i<t.map.length;){if(t.map[i][0]===e){t.map[i][1]+=n,t.map[i][2].push(...r);return}i+=1}t.map.push([e,n,r])}}function Yne(t,e){let n=!1;const r=[];for(;e<t.length;){const i=t[e];if(n){if(i[0]==="enter")i[1].type==="tableContent"&&r.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(i[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const s=r.length-1;r[s]=r[s]==="left"?"center":"right"}}else if(i[1].type==="tableDelimiterRow")break}else i[0]==="enter"&&i[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return r}function Gne(){return{flow:{null:{name:"table",tokenize:Vne,resolveAll:qne}}}}function Vne(t,e,n){const r=this;let i=0,s=0,o;return a;function a(M){let B=r.events.length-1;for(;B>-1;){const be=r.events[B][1].type;if(be==="lineEnding"||be==="linePrefix")B--;else break}const $=B>-1?r.events[B][1].type:null,se=$==="tableHead"||$==="tableRow"?v:l;return se===v&&r.parser.lazy[r.now().line]?n(M):se(M)}function l(M){return t.enter("tableHead"),t.enter("tableRow"),c(M)}function c(M){return M===124||(o=!0,s+=1),u(M)}function u(M){return M===null?n(M):ye(M)?s>1?(s=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(M),t.exit("lineEnding"),f):n(M):Ge(M)?je(t,u,"whitespace")(M):(s+=1,o&&(o=!1,i+=1),M===124?(t.enter("tableCellDivider"),t.consume(M),t.exit("tableCellDivider"),o=!0,u):(t.enter("data"),d(M)))}function d(M){return M===null||M===124||mt(M)?(t.exit("data"),u(M)):(t.consume(M),M===92?h:d)}function h(M){return M===92||M===124?(t.consume(M),d):d(M)}function f(M){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(M):(t.enter("tableDelimiterRow"),o=!1,Ge(M)?je(t,p,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(M):p(M))}function p(M){return M===45||M===58?b(M):M===124?(o=!0,t.enter("tableCellDivider"),t.consume(M),t.exit("tableCellDivider"),g):I(M)}function g(M){return Ge(M)?je(t,b,"whitespace")(M):b(M)}function b(M){return M===58?(s+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(M),t.exit("tableDelimiterMarker"),_):M===45?(s+=1,_(M)):M===null||ye(M)?E(M):I(M)}function _(M){return M===45?(t.enter("tableDelimiterFiller"),y(M)):I(M)}function y(M){return M===45?(t.consume(M),y):M===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(M),t.exit("tableDelimiterMarker"),x):(t.exit("tableDelimiterFiller"),x(M))}function x(M){return Ge(M)?je(t,E,"whitespace")(M):E(M)}function E(M){return M===124?p(M):M===null||ye(M)?!o||i!==s?I(M):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(M)):I(M)}function I(M){return n(M)}function v(M){return t.enter("tableRow"),N(M)}function N(M){return M===124?(t.enter("tableCellDivider"),t.consume(M),t.exit("tableCellDivider"),N):M===null||ye(M)?(t.exit("tableRow"),e(M)):Ge(M)?je(t,N,"whitespace")(M):(t.enter("data"),L(M))}function L(M){return M===null||M===124||mt(M)?(t.exit("data"),N(M)):(t.consume(M),M===92?z:L)}function z(M){return M===92||M===124?(t.consume(M),L):L(M)}}function qne(t,e){let n=-1,r=!0,i=0,s=[0,0,0,0],o=[0,0,0,0],a=!1,l=0,c,u,d;const h=new Wne;for(;++n<t.length;){const f=t[n],p=f[1];f[0]==="enter"?p.type==="tableHead"?(a=!1,l!==0&&(q4(h,e,l,c,u),u=void 0,l=0),c={type:"table",start:Object.assign({},p.start),end:Object.assign({},p.end)},h.add(n,0,[["enter",c,e]])):p.type==="tableRow"||p.type==="tableDelimiterRow"?(r=!0,d=void 0,s=[0,0,0,0],o=[0,n+1,0,0],a&&(a=!1,u={type:"tableBody",start:Object.assign({},p.start),end:Object.assign({},p.end)},h.add(n,0,[["enter",u,e]])),i=p.type==="tableDelimiterRow"?2:u?3:1):i&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")?(r=!1,o[2]===0&&(s[1]!==0&&(o[0]=o[1],d=_m(h,e,s,i,void 0,d),s=[0,0,0,0]),o[2]=n)):p.type==="tableCellDivider"&&(r?r=!1:(s[1]!==0&&(o[0]=o[1],d=_m(h,e,s,i,void 0,d)),s=o,o=[s[1],n,0,0])):p.type==="tableHead"?(a=!0,l=n):p.type==="tableRow"||p.type==="tableDelimiterRow"?(l=n,s[1]!==0?(o[0]=o[1],d=_m(h,e,s,i,n,d)):o[1]!==0&&(d=_m(h,e,o,i,n,d)),i=0):i&&(p.type==="data"||p.type==="tableDelimiterMarker"||p.type==="tableDelimiterFiller")&&(o[3]=n)}for(l!==0&&q4(h,e,l,c,u),h.consume(e.events),n=-1;++n<e.events.length;){const f=e.events[n];f[0]==="enter"&&f[1].type==="table"&&(f[1]._align=Yne(e.events,n))}return t}function _m(t,e,n,r,i,s){const o=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",a="tableContent";n[0]!==0&&(s.end=Object.assign({},Hc(e.events,n[0])),t.add(n[0],0,[["exit",s,e]]));const l=Hc(e.events,n[1]);if(s={type:o,start:Object.assign({},l),end:Object.assign({},l)},t.add(n[1],0,[["enter",s,e]]),n[2]!==0){const c=Hc(e.events,n[2]),u=Hc(e.events,n[3]),d={type:a,start:Object.assign({},c),end:Object.assign({},u)};if(t.add(n[2],0,[["enter",d,e]]),r!==2){const h=e.events[n[2]],f=e.events[n[3]];if(h[1].end=Object.assign({},f[1].end),h[1].type="chunkText",h[1].contentType="text",n[3]>n[2]+1){const p=n[2]+1,g=n[3]-n[2]-1;t.add(p,g,[])}}t.add(n[3]+1,0,[["exit",d,e]])}return i!==void 0&&(s.end=Object.assign({},Hc(e.events,i)),t.add(i,0,[["exit",s,e]]),s=void 0),s}function q4(t,e,n,r,i){const s=[],o=Hc(e.events,n);i&&(i.end=Object.assign({},o),s.push(["exit",i,e])),r.end=Object.assign({},o),s.push(["exit",r,e]),t.add(n+1,0,s)}function Hc(t,e){const n=t[e],r=n[0]==="enter"?"start":"end";return n[1][r]}const Xne={name:"tasklistCheck",tokenize:Qne};function Kne(){return{text:{91:Xne}}}function Qne(t,e,n){const r=this;return i;function i(l){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(l):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),s)}function s(l){return mt(l)?(t.enter("taskListCheckValueUnchecked"),t.consume(l),t.exit("taskListCheckValueUnchecked"),o):l===88||l===120?(t.enter("taskListCheckValueChecked"),t.consume(l),t.exit("taskListCheckValueChecked"),o):n(l)}function o(l){return l===93?(t.enter("taskListCheckMarker"),t.consume(l),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),a):n(l)}function a(l){return ye(l)?e(l):Ge(l)?t.check({tokenize:Zne},e,n)(l):n(l)}}function Zne(t,e,n){return je(t,r,"whitespace");function r(i){return i===null?n(i):e(i)}}function Jne(){return XD([kne(),zne(),Gne(),Kne(),Pne()])}function ere(){return[rne(),dne(),yne(),Nte(),Zte()]}function tre(){return{extensions:[ine(),bne(),_ne(),Jte()]}}function X4(){const e=this.data(),n=e.micromarkExtensions||(e.micromarkExtensions=[]),r=e.fromMarkdownExtensions||(e.fromMarkdownExtensions=[]),i=e.toMarkdownExtensions||(e.toMarkdownExtensions=[]);n.push(Jne()),r.push(ere()),i.push(tre())}const K4=Me("MarkdownPreprocessor"),xm=t=>{const e=K4(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}};class nre extends rZ{constructor(e){super(e,K4)}}const Q4=/^\[!([\p{Extended_Pictographic}]?)\]/u,rre=()=>t=>{fm(t,"blockquote",e=>{const n=e.children[0];let r=e.children;if((n==null?void 0:n.type)==="paragraph"){const i=n.children[0];if((i==null?void 0:i.type)==="text"){const s=i.value,o=s.match(Q4);if(o){const a=o[1];e.data={isCallout:!0,calloutEmoji:a};const l=s.replace(Q4,"").replace(/^\n/,"");n.children.length===1&&l.length===0?(n.children=[],r=r.slice(1)):n.children[0]={type:"text",value:l.trim()}}}}e.children=[...r]})};class Z4 extends oc{constructor(e,n){super(e,n),this._traverseMarkdown=(o,a,l)=>{const c=new Co;return c.setONodeTypeGuard(u=>!Array.isArray(u)&&"type"in u&&u.type!==void 0),c.setEnter(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l};await((f=(h=p.toBlockSnapshot).enter)==null?void 0:f.call(h,u,g))}}),c.setLeave(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l};await((f=(h=p.toBlockSnapshot).leave)==null?void 0:f.call(h,u,g))}}),c.walk(o,a)},this._traverseSnapshot=async(o,a,l)=>{const c=[],u=new Co;return u.setONodeTypeGuard(d=>qi.safeParse(d).success),u.setEnter(async(d,h)=>{var f,p;for(const g of this.blockMatchers)if(g.fromMatch(d)){const b={walker:u,walkerContext:h,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l,updateAssetIds:_=>{c.push(_)}};await((p=(f=g.fromBlockSnapshot).enter)==null?void 0:p.call(f,d,b))}}),u.setLeave(async(d,h)=>{var f,p;for(const g of this.blockMatchers)if(g.fromMatch(d)){const b={walker:u,walkerContext:h,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:{content:""},assets:l};await((p=(f=g.fromBlockSnapshot).leave)==null?void 0:p.call(f,d,b))}}),{ast:await u.walk(o,a),assetsIds:c}};const r=Array.from(n.getAll(UD).values()),i=Array.from(n.getAll($D).values()),s=Array.from(n.getAll(HD).values());this.blockMatchers=r,this.deltaConverter=new CZ(e.adapterConfigs,i,s),this.preprocessorManager=new nre(n)}_astToMarkdown(e){return Rc().use(X4).use(Ste,{resourceLink:!0}).use(jD).stringify(e).replace(/&#x20;\n/g,` 
`)}_markdownToAst(e){const n=Rc().use(Iee).use(X4).use(jD).use(rre),r=n.parse(e);return n.runSync(r)}async fromBlockSnapshot({snapshot:e,assets:n}){const r={type:"root",children:[]},{ast:i,assetsIds:s}=await this._traverseSnapshot(e,r,n);return{file:this._astToMarkdown(i),assetsIds:s}}async fromDocSnapshot({snapshot:e,assets:n}){let r="";const{file:i,assetsIds:s}=await this.fromBlockSnapshot({snapshot:e.blocks,assets:n});return r+=i,{file:r,assetsIds:s}}async fromSliceSnapshot({snapshot:e,assets:n}){var r;let i="";const s=[];for(const a of e.content){const l={type:"root",children:[]},{ast:c,assetsIds:u}=await this._traverseSnapshot(a,l,n);s.push(...u),i+=this._astToMarkdown(c)}return{file:((r=i.match(/\n/g))==null?void 0:r.length)===1?i.trimEnd():i,assetsIds:s}}async toBlockSnapshot(e){const n=this.preprocessorManager.process("block",e.file),r=this._markdownToAst(n),i={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return this._traverseMarkdown(r,i,e.assets)}async toDocSnapshot(e){const n=this.preprocessorManager.process("doc",e.file),r=this._markdownToAst(n),i={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return{type:"page",meta:{id:K(),title:"Untitled",createDate:Date.now(),tags:[]},blocks:{type:"block",id:K(),flavour:"affine:page",props:{title:{"$blocksuite:internal:text$":!0,delta:[{insert:"Untitled"}]}},children:[{type:"block",id:K(),flavour:"affine:surface",props:{elements:{}},children:[]},await this._traverseMarkdown(r,i,e.assets)]}}}async toSliceSnapshot(e){const n=this.preprocessorManager.process("slice",e.file),r=this._markdownToAst(n),i={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]},s=await this._traverseMarkdown(r,i,e.assets);return s.children.length===0?null:{type:"slice",content:[s],workspaceId:e.workspaceId,pageId:e.pageId}}}const ire=Dc("Markdown"),sre={setup:t=>{t.addImpl(ire,e=>({get:n=>new Z4(n,e)}))}},ra=t=>t.type==="footnoteDefinition",nE=t=>{const e=t.children[0];if(e.type!=="paragraph")return"";const n=e.children[0];return n.type!=="text"?"":n.value},Mh=t=>{var e;return t.type==="blockquote"&&!!((e=t.data)!=null&&e.isCallout)},ore=t=>{var e,n;return(n=(e=t.data)==null?void 0:e.calloutEmoji)!=null?n:""},ia="footnoteDefinition:",rE="mdast:paragraph",are="calloutMarkdownExportOptions";var Dh=(t=>(t.GFM="GFM",t.Admonitions="Admonitions",t))(Dh||{}),iE=(t=>(t.Info="info",t.Tip="tip",t.Warning="warning",t.Danger="danger",t.Details="details",t))(iE||{});const lre="info",cre=new Set(Object.values(iE)),ure=$e({style:qr(Dh),admonitionType:qr(iE).optional()}),sE="codeBlockWrap",dre="fullFilePath",hre="https://affine-worker.toeverything.workers.dev/api/worker/image-proxy",fre=RC.extend({highlight:le.boolean().optional()}),oE=class T6 extends Us{constructor({mode:e,blockIds:n,elementIds:r,highlight:i=!0}){super({blockId:"[scene-highlight]"}),this.blockIds=[],this.elementIds=[],this.mode="page",this.highlight=!0,this.mode=e??"page",this.blockIds=n??[],this.elementIds=r??[],this.highlight=i}static fromJSON(e){const n=fre.parse(e);return new T6(n)}equals(e){return this.mode===e.mode&&this.blockId===e.blockId&&this.blockIds.length===e.blockIds.length&&this.elementIds.length===e.elementIds.length&&this.blockIds.every((n,r)=>n===e.blockIds[r])&&this.elementIds.every((n,r)=>n===e.elementIds[r])}toJSON(){return{type:"highlight",mode:this.mode,blockId:this.blockId,blockIds:this.blockIds,elementIds:this.elementIds}}};oE.group="scene",oE.type="highlight";const pre=So(oE),mre=le.object({blockId:le.string()}),aE=class ev extends Us{static fromJSON(e){const n=mre.parse(e);return new ev(n)}equals(e){return e instanceof ev?this.blockId===e.blockId:!1}toJSON(){return{type:this.type,blockId:this.blockId}}};aE.group="note",aE.type="image";const gre=So(aE);class lE extends za{constructor(e){super(e),this._flags=un({enable_database_number_formatting:!1,enable_database_attachment_note:!1,enable_database_full_width:!1,enable_block_query:!1,enable_edgeless_text:!0,enable_ai_onboarding:!0,enable_ai_chat_block:!0,enable_color_picker:!0,enable_mind_map_import:!0,enable_advanced_block_visibility:!1,enable_shape_shadow_blur:!1,enable_mobile_keyboard_toolbar:!1,enable_mobile_linked_doc_menu:!1,enable_block_meta:!0,enable_callout:!1,enable_edgeless_scribbled_style:!1,enable_table_virtual_scroll:!1,enable_turbo_renderer:!1,enable_dom_renderer:!1})}setFlag(e,n){this._flags.value={...this._flags.value,[e]:n}}getFlag(e){return this._flags.value[e]}}lE.key="feature-flag-server";const bre=Me("affine-writer-info-service"),yre=30*1e3;class J4 extends za{constructor(){super(...arguments),this._onBlockCreated=e=>{if(!eN(e))return;const n=this._getWriterInfo();if(!n)return;const r=tN();this.store.withoutTransact(()=>{e.props["meta:createdAt"]=r,e.props["meta:createdBy"]=n.id})},this._onBlockUpdated=e=>{if(!eN(e))return;const n=this._getWriterInfo();if(!n)return;const r=tN();this.store.withoutTransact(()=>{e.props["meta:updatedAt"]=r,e.props["meta:updatedBy"]=n.id,e.props["meta:createdAt"]||(e.props["meta:createdAt"]=r),e.props["meta:createdBy"]||(e.props["meta:createdBy"]=n.id)})},this._getWriterInfo=()=>{var e;return(e=this.store.getOptional(bre))==null?void 0:e.getWriterInfo()}}get isBlockMetaEnabled(){return this.store.get(lE).getFlag("enable_block_meta")===!0}loaded(){this.store.disposableGroup.add(this.store.slots.blockUpdated.pipe(kB(e=>e.isLocal),SB(e=>`${e.type}-${e.id}`),Rk(e=>e.pipe(AB(yre)))).subscribe(e=>{var n;const{type:r,id:i}=e;if(!this.isBlockMetaEnabled)return;const s=(n=this.store.getBlock(i))==null?void 0:n.model;if(s){if(r==="add")return this._onBlockCreated(s);if(r==="update")return this._onBlockUpdated(s)}}))}}J4.key="affine-block-meta-service";function eN(t){return["meta:createdAt","meta:createdBy","meta:updatedAt","meta:updatedBy"].every(e=>t.keys.includes(e))}function tN(){return Date.now()}const nN=t=>{t=t.trim();const e=[],n=Object.create(null);for(let i=0;i<t.length;i++)t[i]==='"'&&t[i-1]!=="\\"&&e.push(i);let r=t.indexOf("filename=");for(let i=0;i<e.length;i+=2){const s=e[i],o=e[i+1];n[s]=o,s<r&&r<o&&(r=t.indexOf("filename=",o))}if(r!==-1){if(n[r+9]===void 0){const i=t.indexOf(" ",r);return t.slice(r+9,i===-1?t.length:i)}return t.slice(r+10,n[r+9])}};function _re(t,e){return t.startsWith(e)||e.startsWith(t)}function xre(t,e){function r(a=32){const l="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c=new Uint8Array(a);crypto.getRandomValues(c);let u="";for(let d=0;d<a;d++)u+=l.charAt(c[d]%l.length);return u}function i(a){return a===null?null:a.length<=33?a:a.substring(0,a.length-32-1)}const s=i(t),o=i(e);if(s===null&&o===null)return jn(null,null)+"0"+r();if(s===null&&o!==null)return jn(null,o)+"0"+r();if(o===null&&s!==null)return jn(s,null)+"0"+r();if(s!==null&&o!==null&&!(_re(s,o)&&t!==null&&e!==null))return jn(s,o)+"0"+r();throw new Error("Never reach here")}function Ere(t,e,n=r=>r.id){return typeof t=="object"?e.findIndex(i=>n(i)===t.id)+(t.before?0:1):t==null||t==="start"?0:t==="end"?e.length:e.findIndex(r=>n(r)===t)+1}const vre=(t,e,n)=>{const r=t.findIndex(a=>e(a));if(r<0)return t;const i=[...t],[s]=i.splice(r,1),o=n(i);return i.splice(o,0,s),i},wre=new Set(["http","https","ftp","sftp","mailto","tel"]),kre=/(?:\.[a-zA-Z]+)?(\.[a-zA-Z]{2,})$/,Tre=/^(25[0-5]|2[0-4]\d|[01]?\d\d?)(\.(25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/,Sre=t=>{try{return URL.canParse(t)?new URL(t):null}catch{return null}};function rN(t,e,n=!1){const r=Sre(t);if(!r)return null;const i=r.protocol.substring(0,r.protocol.length-1),s=r.hostname,o=r.origin;let a=wre.has(i);return a&&s.includes(".")&&(a=o===e||kre.test(s)||(n?!1:Tre.test(s))),{url:r,allowed:a}}function Cre(t,e=location.origin){var n;t=t.trim();let r=rN(t,e);if(r&&!r.allowed)return!1;if(!r&&!t.match(/^https?:\/\//)){const s=t.indexOf(".");s>0&&s<t.length-1&&(r=rN(`https://${t}`,e,!0))}return(n=r==null?void 0:r.allowed)!=null?n:!1}const iN=Me("EmbedIframeConfig");function zc(t){const e=iN(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class sN extends za{constructor(e){super(e),this.canEmbed=n=>this._configs.some(r=>r.match(n)),this.buildOEmbedUrl=n=>{var r;return(r=this._configs.find(i=>i.match(n)))==null?void 0:r.buildOEmbedUrl(n)},this.getConfig=n=>this._configs.find(r=>r.match(n)),this.getEmbedIframeData=async(n,r)=>{try{const i=this._configs.find(l=>l.match(n));if(!i)return null;const s=i.buildOEmbedUrl(n);if(!s)return null;if(i.useOEmbedUrlDirectly)return{iframe_url:s};const o=await fetch(s,{signal:r});return o.ok?await o.json():(console.warn(`Failed to fetch oEmbed data: ${o.status} ${o.statusText}`),null)}catch(i){return i instanceof Error&&i.name!=="AbortError"&&console.error("Error fetching embed iframe data:",i),null}},this.addEmbedIframeBlock=(n,r,i)=>this.store.addBlock("affine:embed-iframe",n,r,i),this._configs=Array.from(e.provider.getAll(iN).values())}}sN.key="embed-iframe-service";function oN(t){const e=t.replace(/\n/g,"").replace(/[\s]{2,}/g," ");return`data:image/svg+xml,${encodeURIComponent(e)}`}const Are=oN(`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M10.6944 8.33487C10.9653 7.67285 11.6283 7.21423 12.3869 7.21423C13.1346 7.21423 13.7895 7.65975 14.0675 8.30642C14.3487 8.13443 14.6802 8.03569 15.0322 8.03569C16.0254 8.03569 16.8548 8.82187 16.8548 9.8214V9.90652C17.103 9.78332 17.383 9.71426 17.6774 9.71426C18.6706 9.71426 19.5 10.5004 19.5 11.5V14.5714C19.5 18.4111 16.3018 21.5 12.3869 21.5C11.4279 21.5 10.5029 21.3687 9.61008 20.9533C8.71611 20.5373 7.89034 19.8532 7.10147 18.8019L5.08581 16.1683C4.51001 15.4567 4.57347 14.4352 5.23 13.797C5.93899 13.1078 7.08249 13.1078 7.79148 13.797L7.79968 13.805C7.84226 13.8483 7.88165 13.889 7.91846 13.9273C7.92006 13.726 7.91977 13.4872 7.91942 13.2045C7.91926 13.0733 7.91909 12.9325 7.91909 12.7817V9.85709C7.91909 8.85756 8.74847 8.07138 9.7417 8.07138C10.0887 8.07138 10.4158 8.16735 10.6944 8.33487ZM10.5643 9.85712C10.5643 9.43634 10.2095 9.07138 9.7417 9.07138C9.27389 9.07138 8.91909 9.43633 8.91909 9.85709V12.7817C8.91909 12.9257 8.91926 13.0621 8.91943 13.1909C8.92002 13.6625 8.92049 14.0329 8.91187 14.307C8.9064 14.481 8.89684 14.6361 8.87748 14.7637C8.8624 14.863 8.82868 15.055 8.70064 15.2061C8.62011 15.3012 8.49922 15.3839 8.34225 15.4068C8.19872 15.4279 8.07952 15.3907 8.00536 15.3581C7.87099 15.299 7.7587 15.1973 7.68787 15.1301C7.60764 15.0539 7.49797 14.9378 7.37723 14.8099C7.28546 14.7128 7.18728 14.6088 7.09077 14.5105C6.76957 14.2021 6.24669 14.2033 5.92703 14.514C5.63861 14.7944 5.614 15.2343 5.86566 15.5423L5.87549 15.5548L7.90002 18.2C8.61071 19.1475 9.31465 19.7129 10.032 20.0466C10.751 20.3812 11.5195 20.5 12.3869 20.5C15.7764 20.5 18.5 17.8323 18.5 14.5714V11.5C18.5 11.0792 18.1452 10.7143 17.6774 10.7143C17.2096 10.7143 16.8548 11.0792 16.8548 11.5V12C16.8548 12.2761 16.6309 12.5 16.3548 12.5C16.0786 12.5 15.8548 12.2761 15.8548 12V9.8214C15.8548 9.40064 15.5 9.03569 15.0322 9.03569C14.5643 9.03569 14.2095 9.40064 14.2095 9.8214V11.1428C14.2095 11.419 13.9857 11.6428 13.7095 11.6428C13.4334 11.6428 13.2095 11.419 13.2095 11.1428V8.99995C13.2095 8.57919 12.8547 8.21423 12.3869 8.21423C11.9191 8.21423 11.5643 8.57919 11.5643 8.99995V11.1428C11.5643 11.419 11.3405 11.6428 11.0643 11.6428C10.7882 11.6428 10.5643 11.419 10.5643 11.1428V9.85712Z"
      fill="black"
    />
    <path
      d="M9.7417 9.07138C10.2095 9.07138 10.5643 9.43634 10.5643 9.85712V11.1428C10.5643 11.419 10.7882 11.6428 11.0643 11.6428C11.3405 11.6428 11.5643 11.419 11.5643 11.1428V8.99995C11.5643 8.57919 11.9191 8.21423 12.3869 8.21423C12.8547 8.21423 13.2095 8.57919 13.2095 8.99995V11.1428C13.2095 11.419 13.4334 11.6428 13.7095 11.6428C13.9857 11.6428 14.2095 11.419 14.2095 11.1428V9.8214C14.2095 9.40064 14.5643 9.03569 15.0322 9.03569C15.5 9.03569 15.8548 9.40064 15.8548 9.8214V12C15.8548 12.2761 16.0786 12.5 16.3548 12.5C16.6309 12.5 16.8548 12.2761 16.8548 12V11.5C16.8548 11.0792 17.2096 10.7143 17.6774 10.7143C18.1452 10.7143 18.5 11.0792 18.5 11.5V14.5714C18.5 17.8323 15.7764 20.5 12.3869 20.5C11.5195 20.5 10.751 20.3812 10.032 20.0466C9.31465 19.7129 8.61071 19.1475 7.90002 18.2L5.87549 15.5548L5.86566 15.5423C5.614 15.2343 5.63861 14.7944 5.92703 14.514C6.24669 14.2033 6.76957 14.2021 7.09077 14.5105C7.18728 14.6088 7.28546 14.7128 7.37723 14.8099C7.49797 14.9378 7.60764 15.0539 7.68787 15.1301C7.7587 15.1973 7.87099 15.299 8.00536 15.3581C8.07952 15.3907 8.19872 15.4279 8.34225 15.4068C8.49922 15.3839 8.62011 15.3012 8.70064 15.2061C8.82868 15.055 8.8624 14.863 8.87748 14.7637C8.89684 14.6361 8.9064 14.481 8.91187 14.307C8.92049 14.0329 8.92002 13.6625 8.91943 13.1909C8.91926 13.0621 8.91909 12.9257 8.91909 12.7817V9.85709C8.91909 9.43633 9.27389 9.07138 9.7417 9.07138Z"
      fill="white"
    />
  </svg>
`),Ire=oN(`
  <svg
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M10.6944 3.62063C10.9653 2.95862 11.6283 2.5 12.3869 2.5C13.3802 2.5 14.2096 3.28619 14.2096 4.28571V4.40655C14.4578 4.28334 14.7378 4.21429 15.0322 4.21429C16.0254 4.21429 16.8548 5.00047 16.8548 6V6.97798C17.103 6.85477 17.383 6.78571 17.6774 6.78571C18.6706 6.78571 19.5 7.5719 19.5 8.57143V14.5714C19.5 18.4111 16.3018 21.5 12.3869 21.5C11.4279 21.5 10.5029 21.3687 9.61009 20.9533C8.71742 20.538 7.89275 19.8553 7.10492 18.8065L3.89715 14.8057C3.31723 14.0938 3.37951 13.0692 4.03749 12.4296C4.74649 11.7404 5.88998 11.7404 6.59897 12.4296C6.60945 12.4398 6.61948 12.4504 6.62902 12.4615L7.19243 13.1145C7.49969 13.4896 7.73216 13.7452 7.90552 13.9094C7.90575 13.9058 7.90599 13.9021 7.90621 13.8984C7.92066 13.6641 7.92009 13.374 7.91941 13.0239C7.91926 12.9461 7.9191 12.8654 7.9191 12.7817V5.14286C7.9191 4.14333 8.74848 3.35714 9.74172 3.35714C10.0887 3.35714 10.4158 3.45312 10.6944 3.62063ZM11.5643 11.1429C11.5643 11.419 11.3405 11.6429 11.0643 11.6429C10.7882 11.6429 10.5643 11.419 10.5643 11.1429V5.14286C10.5643 4.7221 10.2095 4.35714 9.74172 4.35714C9.2739 4.35714 8.9191 4.7221 8.9191 5.14286V12.7817C8.9191 12.858 8.91927 12.9337 8.91943 13.0085C8.92019 13.3597 8.92092 13.6907 8.90432 13.9599C8.89417 14.1245 8.87652 14.2886 8.84181 14.4348C8.80979 14.5696 8.74873 14.7552 8.60644 14.9018C8.43071 15.0827 8.19413 15.142 7.96546 15.0976C7.77497 15.0607 7.60654 14.9565 7.46937 14.8519C7.18917 14.6383 6.84626 14.2699 6.4228 13.7533L5.88792 13.1333C5.56593 12.8348 5.05078 12.8392 4.73453 13.1467C4.44611 13.427 4.4215 13.8669 4.67315 14.175L4.67604 14.1785L7.89011 18.1872L7.90002 18.2C8.6107 19.1476 9.31466 19.7129 10.032 20.0467C10.751 20.3813 11.5195 20.5 12.3869 20.5C15.7764 20.5 18.5 17.8323 18.5 14.5714V8.57143C18.5 8.15067 18.1452 7.78571 17.6774 7.78571C17.2096 7.78571 16.8548 8.15067 16.8548 8.57143V12C16.8548 12.2761 16.6309 12.5 16.3548 12.5C16.0786 12.5 15.8548 12.2761 15.8548 12V6C15.8548 5.57924 15.5 5.21429 15.0322 5.21429C14.5644 5.21429 14.2096 5.57924 14.2096 6V11.1429C14.2096 11.419 13.9857 11.6429 13.7096 11.6429C13.4334 11.6429 13.2096 11.419 13.2096 11.1429V4.28571C13.2096 3.86496 12.8548 3.5 12.3869 3.5C11.9191 3.5 11.5643 3.86496 11.5643 4.28571V11.1429Z"
      fill="black"
    />
    <path
      d="M11.0643 11.6429C11.3405 11.6429 11.5643 11.419 11.5643 11.1429V4.28571C11.5643 3.86496 11.9191 3.5 12.3869 3.5C12.8548 3.5 13.2096 3.86496 13.2096 4.28571V11.1429C13.2096 11.419 13.4334 11.6429 13.7096 11.6429C13.9857 11.6429 14.2096 11.419 14.2096 11.1429V6C14.2096 5.57924 14.5644 5.21429 15.0322 5.21429C15.5 5.21429 15.8548 5.57924 15.8548 6V12C15.8548 12.2761 16.0786 12.5 16.3548 12.5C16.6309 12.5 16.8548 12.2761 16.8548 12V8.57143C16.8548 8.15067 17.2096 7.78571 17.6774 7.78571C18.1452 7.78571 18.5 8.15067 18.5 8.57143V14.5714C18.5 17.8323 15.7764 20.5 12.3869 20.5C11.5195 20.5 10.751 20.3813 10.032 20.0467C9.31466 19.7129 8.6107 19.1476 7.90002 18.2L7.89011 18.1872L4.67604 14.1785L4.67315 14.175C4.4215 13.8669 4.44611 13.427 4.73453 13.1467C5.05078 12.8392 5.56593 12.8348 5.88792 13.1333L6.4228 13.7533C6.84626 14.2699 7.18917 14.6383 7.46937 14.8519C7.60654 14.9565 7.77497 15.0607 7.96546 15.0976C8.19413 15.142 8.43071 15.0827 8.60644 14.9018C8.74873 14.7552 8.80979 14.5696 8.84181 14.4348C8.87652 14.2886 8.89417 14.1245 8.90432 13.9599C8.92092 13.6907 8.92019 13.3597 8.91943 13.0085C8.91927 12.9337 8.9191 12.858 8.9191 12.7817V5.14286C8.9191 4.7221 9.2739 4.35714 9.74172 4.35714C10.2095 4.35714 10.5643 4.7221 10.5643 5.14286V11.1429C10.5643 11.419 10.7882 11.6429 11.0643 11.6429Z"
      fill="white"
    />
  </svg>
`),Mre=t=>typeof t!="string"?"":t.replace(/-/g,"_").replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z])([A-Z])(?=[a-z])/g,"$1-$2").toLowerCase().replace(/(\D+)(\d+)$/g,"$1-$2").replace(/\s|_/g,"-"),aN=(t,e)=>`url(${t}), ${e.join(", ")}`,Dre=t=>`--affine-${Mre(t)}`,Nre=t=>Object.entries(t),Wc="apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",jc="'Helvetica Neue', Tahoma, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",lN={fontFamily:`'Inter', 'Source Sans 3', Poppins, ${Wc}`,fontSerifFamily:`'Source Serif 4', 'Noto Serif' , serif, 'Cambria', ${Wc}`,fontMonoFamily:`'Source Code Pro', 'IBM Plex Mono', 'Roboto Mono','Noto Sans Mono', 'Noto Sans CJK',  ${Wc}`,fontSansFamily:`'Inter', 'Source Sans 3', Poppins, ${Wc}`,fontNumberFamily:`'Roboto Mono', 'Noto Sans Mono', ${Wc}`,fontCodeFamily:`'IBM Plex Mono', 'Space Mono', Consolas, Menlo, Monaco, Courier, monospace, ${Wc}`,fontTitle:"36px",fontH1:"28px",fontH2:"26px",fontH3:"24px",fontH4:"22px",fontH5:"20px",fontH6:"18px",fontBase:"15px",fontSm:"14px",fontXs:"12px",lineHeight:"calc(1em + 8px)",zIndexModal:"1000",zIndexPopover:"1000",paragraphSpace:"8px",popoverRadius:"12px",editorWidth:"944px",editorSidePadding:"96px",zoom:"1",scale:"calc(1 / var(--affine-zoom))",paletteLineYellow:"rgb(255, 211, 56)",paletteLineOrange:"rgb(255, 175, 56)",paletteLineTangerine:"rgb(250, 124, 69)",paletteLineRed:"rgb(237, 63, 63)",paletteLineMagenta:"rgb(230, 96, 164)",paletteLinePurple:"rgb(110, 82, 223)",paletteLineNavy:"rgb(59, 37, 204)",paletteLineBlue:"rgb(79, 144, 255)",paletteLineTeal:"rgb(122, 226, 213)",paletteLineGreen:"rgb(124, 194, 112)",paletteLineWhite:"rgb(255, 255, 255)",paletteLineBlack:"rgb(35, 35, 35)",paletteLineGrey:"rgb(191, 192, 191)",paletteShapeYellow:"rgb(255, 223, 107)",paletteShapeOrange:"rgb(255, 196, 107)",paletteShapeTangerine:"rgb(251, 161, 121)",paletteShapeRed:"rgb(241, 111, 111)",paletteShapeMagenta:"rgb(237, 140, 189)",paletteShapePurple:"rgb(147, 126, 231)",paletteShapeNavy:"rgb(122, 149, 246)",paletteShapeBlue:"rgb(184, 227, 255)",paletteShapeGreen:"rgb(157, 209, 148)",paletteShapeWhite:"rgb(255, 255, 255)",paletteShapeBlack:"rgb(35, 35, 35)",paletteShapeGrey:"rgb(216, 217, 216)",multiPlayersPurple:"rgba(123,97,255,1)",multiPlayersMagenta:"rgba(245, 49, 179, 1)",multiPlayersRed:"rgba(243,87,52,1)",multiPlayersOrange:"rgba(255, 138, 0, 1)",multiPlayersGreen:"rgba(27, 196, 125, 1)",paletteShapeTeal:"rgb(184, 242, 231)",multiPlayersBlue:"rgba(24, 160, 251, 1)",multiPlayersBrown:"rgba(154, 101, 51, 1)",multiPlayersGrey:"rgba(170, 170, 170, 1)",blue:"rgba(30, 150, 235, 1)",pureBlack:"rgba(0, 0, 0, 1)",pureBlack10:"rgba(0, 0, 0, 0.1)",pureBlack20:"rgba(0, 0, 0, 0.2)",pureBlack80:"rgba(0, 0, 0, 0.8)",pureWhite:"rgba(255, 255, 255, 1)",pureWhite10:"rgba(255, 255, 255, 0.1)",toggleCircleBackgroundColor:"rgba(255, 255, 255, 1)",toggleDisableBackgroundColor:"rgba(119, 117, 125, 1)",toggleCircleShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.25), inset -2px -3px 2px 0px rgba(0, 0, 0, 0.05)",buttonInnerShadow:"unset",multiCursorsShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.28)",multiPlayersShadow:"0px 1px 6px 0px rgba(0, 0, 0, 0.16)",grabbingCursor:aN(Are,["grabbing"]),grabCursor:aN(Ire,["grab"])},cN={themeMode:"light",brandColor:"#1E96EB",tertiaryColor:"rgba(239, 250, 255, 1)",primaryColor:"#1E96EB",primaryColor04:"rgba(30, 150, 235, 0.04)",secondaryColor:"rgb(125, 145, 255)",blue50:"rgba(239, 250, 255, 1)",blue100:"rgba(219, 244, 254, 1)",blue200:"rgba(191, 236, 254, 1)",blue300:"rgba(147, 226, 253, 1)",blue400:"rgba(96, 207, 250, 1)",blue500:"rgba(58, 181, 247, 1)",blue600:"rgba(30, 150, 235, 1)",blue700:"rgba(28, 129, 217, 1)",blue800:"rgba(30, 103, 175, 1)",blue900:"rgba(30, 87, 138, 1)",blue950:"rgba(23, 54, 84, 1)",backgroundSuccessColor:"rgba(231, 250, 243, 1)",backgroundErrorColor:"rgba(253, 236, 235, 1)",backgroundProcessingColor:"rgba(233, 241, 255, 1)",backgroundWarningColor:"rgba(255, 237, 219, 1)",backgroundPrimaryColor:"rgb(255, 255, 255)",backgroundOverlayPanelColor:"rgb(251, 251, 252)",backgroundSecondaryColor:"rgba(244, 244, 245, 1)",backgroundTertiaryColor:"rgb(238, 238, 238)",backgroundCodeBlock:"rgba(247, 248, 250, 1)",backgroundModalColor:"rgba(0, 0, 0, 0.75)",textPrimaryColor:"rgb(18, 18, 18)",textSecondaryColor:"rgb(142, 141, 145)",textDisableColor:"rgb(169, 169, 173)",textEmphasisColor:"#1E96EB",hoverColor:"rgba(0, 0, 0, 0.04)",hoverColorFilled:"rgb(245, 245, 245)",linkColor:"#1E67AF",quoteColor:"rgba(194, 193, 197, 1)",listColor:"rgba(133, 131, 140, 1)",iconColor:"rgb(119, 117, 125)",iconSecondary:"rgba(119, 117, 125, 0.6)",borderColor:"rgb(227, 226, 228)",dividerColor:"rgb(227, 226, 228)",placeholderColor:"rgb(192, 191, 193)",edgelessGridColor:"rgb(230, 230, 230)",successColor:"rgb(16, 203, 134)",warningColor:"rgb(235, 67, 53)",errorColor:"rgb(235, 67, 53)",processingColor:"rgb(39, 118, 255)",black10:"rgba(0, 0, 0, 0.1)",black30:"rgba(0, 0, 0, 0.3)",black50:"rgba(0, 0, 0, 0.5)",black60:"rgba(0, 0, 0, 0.6)",black80:"rgba(0, 0, 0, 0.8)",black90:"rgba(0, 0, 0, 0.9)",black:"rgb(0, 0, 0)",white10:"rgba(255, 255, 255, 0.1)",white30:"rgba(255, 255, 255, 0.3)",white50:"rgba(255, 255, 255, 0.5)",white60:"rgba(255, 255, 255, 0.6)",white80:"rgba(255, 255, 255, 0.8)",white90:"rgba(255, 255, 255, 0.9)",white:"rgb(255, 255, 255)",tagWhite:"rgba(245, 245, 245, 1)",tagGray:"rgba(227, 226, 224, 1)",tagRed:"rgba(255, 225, 225, 1)",tagOrange:"rgba(255, 233, 201, 1)",tagYellow:"rgba(255, 243, 215, 1)",tagGreen:"rgba(222, 244, 231, 1)",tagTeal:"rgba(222, 244, 243, 1)",tagBlue:"rgba(225, 238, 255, 1)",tagPurple:"rgba(243, 240, 255, 1)",tagPink:"rgba(251, 231, 255, 1)",tagMagenta:"rgba(249, 232, 255, 1)",tooltip:"rgba(0, 0, 0, 1)",buttonShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.12), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)",overlayPanelShadow:"0px 1px 6px rgba(0,0,0,0.16), 0px 8px 14px rgba(0,0,0,0.08)",activeShadow:"0px 0px 0px 2px rgba(30, 150, 235, 0.30)",embedShadow:"0px 0px 0px 2px rgba(0, 0, 0, 0.08)",menuShadow:"0px 10px 18px rgba(0,0,0,0.14), 0px -1px 12px rgba(0,0,0,0.08)",toolbarShadow:"0px 6px 16px #00000024",shadow1:"0px 0px 4px 0px rgba(66, 65, 73, 0.14)",shadow2:"0px 0px 12px 0px rgba(66, 65, 73, 0.18)",shadow3:"0px 0px 20px 0px rgba(66, 65, 73, 0.22)",overlayShadow:"0px 1px 6px 0px rgba(0, 0, 0, 0.16), 0px 8px 14px 0px rgba(0, 0, 0, 0.08)",popoverShadow:"0px 0px 30px rgba(75, 75, 75, 0.2), 0px 0px 4px rgba(75, 75, 75, 0.3), inset 0px 0px 0px rgba(227, 226, 228, 1)",floatButtonShadow:"0px 0px 10px rgba(0, 0, 0, 0.05), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.1)",floatButtonShadow1:"0px 4px 6px -3px rgba(66, 65, 73, 0.10), 0px 10px 12px -2px rgba(66, 65, 73, 0.10)",floatButtonShadow2:"0px 4px 4px -2px rgba(66, 65, 73, 0.10), 0px 6px 8px 1px rgba(66, 65, 73, 0.05)",kanbanShadow:"0px 2px 3px 0px rgba(0, 0, 0, 0.05)",cmdShadow:"0px 10px 80px 0px rgba(0, 0, 0, 0.20)",largeButtonEffect:"0px 12px 21px 4px rgba(30, 150, 235, 0.15)",noteShadowBox:"0px 0px 4px 0px rgba(0, 0, 0, 0.14), 0px 2px 12px 0px rgba(0, 0, 0, 0.14)",noteShadowSticker:"0px 6px 16px 0px rgba(0, 0, 0, 0.08), 0px 26px 18px -20px rgba(0, 0, 0, 0.10)",noteShadowPaper:"0px 2px 4px 0px rgba(0, 0, 0, 0.05), 0px 0px 0px 10px #FFF, 0px 3px 6px 12px rgba(0, 0, 0, 0.14)",noteShadowFloat:"0px 0px 32px 0px rgba(0, 0, 0, 0.09), 0px 0px 3px 0px rgba(0, 0, 0, 0.10)",noteShadowFilm:"10px 10px 0px 6px #000, 0px 0px 0px 6px #000",aiEmptyShadow:"0px 4px 4px rgba(66, 65, 73, 0.10), 0px 6px 8px rgba(66, 65, 73, 0.05)",buttonGrayColor:"rgba(245, 245, 245, 1)",cardBackgroundBlue:"linear-gradient(180deg, #F0F3FD 0%, #FCFCFD 100%)",cardBackgroundGreen:"linear-gradient(180deg, #F3F9FD 0%, #FCFCFD 100%)",cardBackgroundGrey:"linear-gradient(180deg, #F1F1F1 0%, #FCFCFD 100%)",windowsCloseButton:"#C42B1C",textHighlightPink:"rgba(255, 206, 206, 1)",textHighlightRed:"rgba(254, 213, 213, 1)",textHighlightOrange:"rgba(254, 223, 187, 1)",textHighlightYellow:"rgba(254, 243, 161, 1)",textHighlightGreen:"rgba(225, 250, 177, 1)",textHighlightTeal:"rgba(173, 248, 233, 1)",textHighlightBlue:"rgba(204, 226, 254, 1)",textHighlightPurple:"rgba(237, 221, 255, 1)",textHighlightGrey:"rgba(234, 236, 239, 1)",textHighlightForegroundRed:"rgba(198, 34, 34, 1)",textHighlightForegroundOrange:"rgba(211, 79, 11, 1)",textHighlightForegroundYellow:"rgba(182, 124, 4, 1)",textHighlightForegroundGreen:"rgba(20, 147, 67, 1)",textHighlightForegroundTeal:"rgba(7, 130, 160, 1)",textHighlightForegroundBlue:"rgba(33, 89, 211, 1)",textHighlightForegroundPurple:"rgba(132, 46, 211, 1)",textHighlightForegroundGrey:"rgba(122, 122, 122, 1)",noteBackgroundYellow:"rgba(253, 230, 138, 1)",noteBackgroundOrange:"rgba(255, 196, 143, 1)",noteBackgroundRed:"rgba(250, 182, 182, 1)",noteBackgroundMagenta:"rgba(255, 218, 237, 1)",noteBackgroundPurple:"rgba(221, 214, 254, 1)",noteBackgroundBlue:"rgba(205, 235, 255, 1)",noteBackgroundTeal:"rgba(199, 248, 242, 1)",noteBackgroundGreen:"rgba(201, 248, 193, 1)",noteBackgroundBlack:"rgba(0, 0, 0, 1)",noteBackgroundGrey:"rgba(230, 230, 230, 1)",noteBackgroundWhite:"rgba(255, 255, 255, 1)"},Ore={...lN,...cN},uN={themeMode:"dark",brandColor:"#1E96EB",primaryColor:"#1C9EE4",primaryColor04:"rgba(52, 116, 173, 0.1)",secondaryColor:"rgb(144, 150, 245)",tertiaryColor:"rgb(30, 30, 30)",blue950:"rgba(32, 45, 55, 1)",blue50:"rgba(181, 208, 242, 1)",blue100:"rgba(171, 204, 237, 1)",blue200:"rgba(149, 194, 234, 1)",blue300:"rgba(115, 182, 226, 1)",blue400:"rgba(79, 162, 216, 1)",blue500:"rgba(53, 140, 208, 1)",blue600:"rgba(52, 116, 173, 1)",blue700:"rgba(55, 106, 154, 1)",blue800:"rgba(51, 88, 122, 1)",blue900:"rgba(47, 75, 96, 1)",hoverColor:"rgba(255, 255, 255, 0.1)",hoverColorFilled:"rgb(42, 42, 42)",iconColor:"rgb(168, 168, 160)",iconSecondary:"rgba(168,168,160,0.6)",borderColor:"rgba(46, 46, 46, 1)",dividerColor:"rgb(114, 114, 114)",placeholderColor:"rgb(62, 62, 63)",quoteColor:"rgba(142, 141, 145, 1)",listColor:"rgba(156, 155, 160, 1)",linkColor:"#78BEFF",edgelessGridColor:"rgba(49, 49, 49, 0.35)",successColor:"rgb(13, 162, 107)",warningColor:"rgb(188, 54, 42)",errorColor:"rgb(188, 54, 42)",processingColor:"rgb(31, 94, 204)",textEmphasisColor:"#1E96EB",textPrimaryColor:"rgb(234, 234, 234)",textSecondaryColor:"rgb(156, 156, 160)",textDisableColor:"rgb(119, 117, 125)",black10:"rgba(255, 255, 255, 0.1)",black30:"rgba(255, 255, 255, 0.3)",black50:"rgba(255, 255, 255, 0.5)",black60:"rgba(255, 255, 255, 0.6)",black80:"rgba(255, 255, 255, 0.8)",black90:"rgba(255, 255, 255, 0.9)",black:"rgb(255, 255, 255)",white10:"rgba(0, 0, 0, 0.1)",white30:"rgba(0, 0, 0, 0.3)",white50:"rgba(0, 0, 0, 0.5)",white60:"rgba(0, 0, 0, 0.6)",white80:"rgba(0, 0, 0, 0.8)",white90:"rgba(0, 0, 0, 0.9)",white:"rgb(0, 0, 0)",backgroundCodeBlock:"rgba(31, 32, 34, 1)",backgroundTertiaryColor:"rgb(48, 48, 48)",backgroundProcessingColor:"rgba(22, 32, 48, 1)",backgroundErrorColor:"rgba(46, 26, 24, 1)",backgroundWarningColor:"rgba(48, 35, 19, 1)",backgroundSuccessColor:"rgba(20, 42, 34, 1)",backgroundPrimaryColor:"rgb(20, 20, 20)",backgroundSecondaryColor:"rgba(37, 37, 37, 1)",backgroundModalColor:"rgba(0, 0, 0, 0.5)",backgroundOverlayPanelColor:"rgb(30, 30, 30)",tagBlue:"rgba(8, 67, 136, 1)",tagGreen:"rgba(44, 108, 63, 1)",tagTeal:"rgba(26, 115, 110, 1)",tagWhite:"rgba(67, 67, 67, 1)",tagPurple:"rgba(47, 30, 113, 1)",tagRed:"rgba(111, 50, 50, 1)",tagPink:"rgba(155, 106, 106, 1)",tagMagenta:"rgba(105, 47, 111, 1)",tagYellow:"rgba(150, 132, 49, 1)",tagOrange:"rgba(185, 129, 46, 1)",tagGray:"rgba(41, 41, 41, 1)",tooltip:"rgba(234, 234, 234, 1)",buttonShadow:"0px 0px 1px 0px rgba(0, 0, 0, 0.20), 0px 1px 5px 0px rgba(0, 0, 0, 0.20)",overlayPanelShadow:"0px 1px 6px rgba(0,0,0,0.2), 0px 8px 14px rgba(0,0,0,0.3)",activeShadow:"0px 0px 0px 2px rgba(28, 158, 228, 0.30)",embedShadow:"0px 0px 0px 2px rgba(255, 255, 255, 0.14)",menuShadow:"0px 10px 18px rgba(0,0,0,0.14), 0px -1px 12px rgba(0,0,0,0.08)",toolbarShadow:"0px 6px 18px #00000052",shadow1:"0px 0px 4px 0px rgba(0, 0, 0, 0.24)",shadow2:"0px 0px 12px 0px rgba(0, 0, 0, 0.28)",shadow3:"0px 0px 20px 0px rgba(0, 0, 0, 0.32)",overlayShadow:"0px 1px 6px 0px rgba(0, 0, 0, 0.72), 0px 8px 14px 0px rgba(0, 0, 0, 0.32)",popoverShadow:"0px 0px 30px 0px rgba(0, 0, 0, 0.1), 0px 0px 8px 0px rgba(0, 0, 0, 0.18), 0px 0px 0px 0.5px rgba(48, 48, 48, 1) inset",floatButtonShadow:"0px 0px 10px rgba(0, 0, 0, 0.05), 0px 0px 0px 0.5px rgba(0, 0, 0, 0.1)",floatButtonShadow1:"0px 4px 6px -3px rgba(0, 0, 0, 0.1), 0px 10px 12px -2px rgba(0, 0, 0, 0.1)",floatButtonShadow2:"0px 4px 4px -2px rgba(15, 15, 15, 0.1), 0px 6px 8px 1px rgba(15, 15, 15, 0.05)",kanbanShadow:"0px 2px 3px 0px rgba(0, 0, 0, 0.60)",cmdShadow:"0px 16px 80px 0px rgba(0, 0, 0, 0.80)",largeButtonEffect:"0px 12px 20px 4px rgba(28, 158, 228, 0.18)",noteShadowBox:"0px 0px 2px 0px rgba(255, 255, 255, 0.44), 0px 2px 12px 0px rgba(0, 0, 0, 0.30)",noteShadowSticker:"0px 24px 26px -10px rgba(0, 0, 0, 0.22), 0px 26px 18px -18px rgba(0, 0, 0, 0.52)",noteShadowPaper:"0px 2px 4px 0px rgba(0, 0, 0, 0.30), 0px 0px 10px #7A7A7A, 0px 6px 12px rgba(0, 0, 0, 0.40)",noteShadowFloat:"0px 0px 32px 0px rgba(0, 0, 0, 0.30), 0px 0px 2px 0px rgba(255, 255, 255, 0.44)",noteShadowFilm:"10px 10px 0px 6px #7A7A7A, 0px 0px 0px 6px #7A7A7A",aiEmptyShadow:"0px 4px 4px rgba(66, 65, 73, 0.10), 0px 6px 8px rgba(66, 65, 73, 0.05)",buttonGrayColor:"rgba(85, 85, 85, 1)",cardBackgroundBlue:"linear-gradient(180deg, #14171F 0%, #202020 100%)",cardBackgroundGreen:"linear-gradient(180deg, #192023 0%, #202020 100%)",cardBackgroundGrey:"linear-gradient(180deg, #313131 0%, #202020 100%)",windowsCloseButton:"#C42B1C",textHighlightPink:"rgba(127, 93, 93, 1)",textHighlightRed:"rgba(108, 39, 39, 1)",textHighlightOrange:"rgba(112, 58, 21, 1)",textHighlightYellow:"rgba(106, 84, 15, 1)",textHighlightGreen:"rgba(26, 91, 50, 1)",textHighlightTeal:"rgba(14, 85, 97, 1)",textHighlightBlue:"rgba(56, 75, 122, 1)",textHighlightPurple:"rgba(80, 46, 111, 1)",textHighlightGrey:"rgba(64, 67, 74, 1)",textHighlightForegroundRed:"rgba(249, 141, 141, 1)",textHighlightForegroundOrange:"rgba(252, 168, 99, 1)",textHighlightForegroundYellow:"rgba(251, 214, 68, 1)",textHighlightForegroundGreen:"rgba(110, 229, 153, 1)",textHighlightForegroundTeal:"rgba(87, 221, 204, 1)",textHighlightForegroundBlue:"rgba(128, 183, 251, 1)",textHighlightForegroundPurple:"rgba(205, 157, 253, 1)",textHighlightForegroundGrey:"rgba(86, 86, 86, 1)",noteBackgroundYellow:"rgba(111, 65, 0, 1)",noteBackgroundOrange:"rgba(132, 59, 6, 1)",noteBackgroundRed:"rgba(118, 23, 23, 1)",noteBackgroundMagenta:"rgba(148, 21, 85, 1)",noteBackgroundPurple:"rgba(49, 46, 129, 1)",noteBackgroundBlue:"rgba(3, 95, 159, 1)",noteBackgroundTeal:"rgba(28, 107, 99, 1)",noteBackgroundGreen:"rgba(59, 83, 21, 1)",noteBackgroundBlack:"rgba(255, 255, 255, 1)",noteBackgroundGrey:"rgba(86, 86, 86, 1)",noteBackgroundWhite:"rgba(0, 0, 0, 1)"},Pre={...lN,...uN},Lre={fontFamily:`'Inter', 'Source Sans 3', Poppins, ${jc}`,fontSerifFamily:`'Source Serif 4', 'Noto Serif' , serif, 'Cambria', ${jc}`,fontMonoFamily:`'Source Code Pro', 'IBM Plex Mono', 'Roboto Mono','Noto Sans Mono', 'Noto Sans CJK',  ${jc}`,fontSansFamily:`'Inter', 'Source Sans 3', Poppins, ${jc}`,fontNumberFamily:`'Roboto Mono', 'Noto Sans Mono', ${jc}`,fontCodeFamily:`'IBM Plex Mono', 'Space Mono', Consolas, Menlo, Monaco, Courier, monospace, ${jc}`},Nh=t=>Nre(t).reduce((e,[n,r])=>({...e,[Dre(n)]:r}),{}),Rre=Nh(Ore),Bre=Nh(Pre);Nh(Lre),{...Rre},{...Bre},{...Nh(cN)},{...Nh(uN)},Me("AffineThemeExtension");const Em=Me("AffineThemeProvider");class dN extends za{constructor(){super(...arguments),this._imageProxyURL=hre}setImageProxyURL(e){this._imageProxyURL=e}buildUrl(e){return e.startsWith(this.imageProxyURL)?e:`${this.imageProxyURL}?url=${encodeURIComponent(e)}`}get imageProxyURL(){return this._imageProxyURL}}dN.key="image-proxy";class Fre extends oc{constructor(e,n){super(e,n),this._markdownAdapter=new Z4(e,n)}_splitDeltas(e){const n=[[]],r=e;for(;r.length>0;){const i=r.shift();if(!i)break;if(i.insert.includes(`
`)){const s=i.insert.indexOf(`
`),o=i.insert.slice(0,s),a=i.insert.slice(s+1);n[n.length-1].push({...i,insert:o}),n.push([]),a&&r.unshift({...i,insert:a})}else n[n.length-1].push(i)}return n}async _traverseSnapshot(e){let n="";const r=new Co;return r.setONodeTypeGuard(i=>qi.safeParse(i).success),r.setEnter(i=>{var s;const o=(s=i.node.props.text)!=null?s:{delta:[]};switch(n.length>0&&(n+=`
`),i.node.flavour){case"affine:code":{n+=o.delta.map(a=>a.insert).join("");break}case"affine:paragraph":{n+=o.delta.map(a=>a.insert).join("");break}case"affine:list":{n+=o.delta.map(a=>a.insert).join("");break}case"affine:divider":{n+="---";break}}}),await r.walkONode(e),{mixtext:n}}async fromBlockSnapshot({snapshot:e}){const{mixtext:n}=await this._traverseSnapshot(e);return{file:n,assetsIds:[]}}async fromDocSnapshot({snapshot:e,assets:n}){let r="";e.meta.title&&(r+=`${e.meta.title}

`);const{file:i,assetsIds:s}=await this.fromBlockSnapshot({snapshot:e.blocks,assets:n});return r+=i,{file:r,assetsIds:s}}async fromSliceSnapshot({snapshot:e}){var n;let r="";const i=[];for(const o of e.content){const{mixtext:a}=await this._traverseSnapshot(o);r+=a}return{file:((n=r.match(/\n/g))==null?void 0:n.length)===1?r.trimEnd():r,assetsIds:i}}toBlockSnapshot(e){return e.file=e.file.replaceAll("\r",""),{type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:e.file.split(`
`).map(n=>({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:n}]}},children:[]}))}}toDocSnapshot(e){return e.file=e.file.replaceAll("\r",""),{type:"page",meta:{id:K(),title:"Untitled",createDate:Date.now(),tags:[]},blocks:{type:"block",id:K(),flavour:"affine:page",props:{title:{"$blocksuite:internal:text$":!0,delta:[{insert:"Untitled"}]}},children:[{type:"block",id:K(),flavour:"affine:surface",props:{elements:{}},children:[]},{type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:e.file.split(`
`).map(n=>({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:n}]}},children:[]}))}]}}}async toSliceSnapshot(e){if(e.file.trim().length===0)return null;e.file=e.file.replaceAll("\r","");const n=await this._markdownAdapter.toSliceSnapshot({file:e.file,assets:e.assets,workspaceId:e.workspaceId,pageId:e.pageId});if(!n)return null;for(const r of n.content){const i={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]},s=new Co;s.setONodeTypeGuard(o=>qi.safeParse(o).success),s.setEnter((o,a)=>{var l,c;switch(o.node.flavour){case"affine:note":break;case"affine:paragraph":{if(((l=o.parent)==null?void 0:l.node.flavour)!=="affine:note"){a.openNode({...o.node,children:[]});break}const u=(c=o.node.props.text)!=null?c:{delta:[]},d=this._splitDeltas(u.delta);for(const[h,f]of d.entries())a.openNode({...o.node,id:h===0?o.node.id:K(),props:{...o.node.props,text:{"$blocksuite:internal:text$":!0,delta:f}},children:[]}),h<d.length-1&&a.closeNode();break}default:a.openNode({...o.node,children:[]})}}),s.setLeave((o,a)=>{switch(o.node.flavour){case"affine:note":break;default:a.closeNode()}}),await s.walk(r,i),r.children=i.children}return n}}const Ure=Dc("MixText"),$re={setup:t=>{t.addImpl(Ure,e=>({get:n=>new Fre(n,e)}))}},hN=Me("BlockNotionHtmlAdapterMatcher");function fr(t){const e=hN(t.flavour);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}const fN=Me("NotionHtmlASTToDeltaMatcher");function $r(t){const e=fN(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class Hre extends am{constructor(e,n,r){super(),this.configs=e,this.inlineDeltaMatchers=n,this.htmlASTToDeltaMatchers=r}_spreadAstToDelta(e,n=Object.create(null)){const r={configs:this.configs,options:n,toDelta:(s,o)=>this._spreadAstToDelta(s,o)};for(const s of this.htmlASTToDeltaMatchers)if(s.match(e))return s.toDelta(e,r);const i="children"in e?e.children.flatMap(s=>this._spreadAstToDelta(s,n)):[];return n.removeLastBr&&i.length>0&&i[i.length-1].insert===`
`&&i.pop(),i}astToDelta(e,n=Object.create(null)){return this._spreadAstToDelta(e,n).reduce((r,i)=>{if(r.length===0)return[i];const s=r[r.length-1];return typeof s.insert=="string"&&typeof i.insert=="string"&&mp(s.attributes,i.attributes)?(s.insert+=i.insert,r):[...r,i]},[])}deltaToAST(e){return[]}}class zre extends oc{constructor(e,n){super(e,n),this._traverseNotionHtml=async(s,o,a,l)=>{const c=new Co;return c.setONodeTypeGuard(u=>"type"in u&&u.type!==void 0),c.setEnter(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,textBuffer:{content:""},assets:a,pageMap:l};await((f=(h=p.toBlockSnapshot).enter)==null?void 0:f.call(h,u,g))}}),c.setLeave(async(u,d)=>{var h,f;for(const p of this.blockMatchers)if(p.toMatch(u)){const g={walker:c,walkerContext:d,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,textBuffer:{content:""},assets:a,pageMap:l};await((f=(h=p.toBlockSnapshot).leave)==null?void 0:f.call(h,u,g))}}),c.walk(s,o)};const r=Array.from(n.getAll(hN).values()),i=Array.from(n.getAll(fN).values());this.blockMatchers=r,this.deltaConverter=new Hre(e.adapterConfigs,[],i)}_htmlToAst(e){return Rc().use(mx).parse(e)}fromBlockSnapshot(e){throw new V(re.TransformerNotImplementedError,"NotionHtmlAdapter.fromBlockSnapshot is not implemented")}fromDocSnapshot(e){throw new V(re.TransformerNotImplementedError,"NotionHtmlAdapter.fromDocSnapshot is not implemented")}fromSliceSnapshot(e){throw new V(re.TransformerNotImplementedError,"NotionHtmlAdapter.fromSliceSnapshot is not implemented")}toBlockSnapshot(e){const n=this._htmlToAst(e.file),r={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return this._traverseNotionHtml(n,r,e.assets,e.pageMap)}async toDoc(e){const n=await this.toDocSnapshot(e);return this.job.snapshotToDoc(n)}async toDocSnapshot(e){var n;const r=this._htmlToAst(e.file),i=H.querySelector(r,"title"),s={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]};return{type:"page",meta:{id:(n=e.pageId)!=null?n:K(),title:H.getTextContent(i,""),createDate:Date.now(),tags:[]},blocks:{type:"block",id:K(),flavour:"affine:page",props:{title:{"$blocksuite:internal:text$":!0,delta:this.deltaConverter.astToDelta(i??{type:"text",value:""})}},children:[{type:"block",id:K(),flavour:"affine:surface",props:{elements:{}},children:[]},await this._traverseNotionHtml(r,s,e.assets,e.pageMap)]}}}async toSliceSnapshot(e){const n=this._htmlToAst(e.file),r={type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:[]},i=await this._traverseNotionHtml(n,r,e.assets);return i.children.length===0?null:{type:"slice",content:[i],workspaceId:e.workspaceId,pageId:e.pageId}}}const Wre=Dc("NotionHtml"),jre={setup:t=>{t.addImpl(Wre,e=>({get:n=>new zre(n,e)}))}};class Yre extends oc{fromBlockSnapshot(){throw new V(re.TransformerNotImplementedError,"NotionTextAdapter.fromBlockSnapshot is not implemented.")}fromDocSnapshot(){throw new V(re.TransformerNotImplementedError,"NotionTextAdapter.fromDocSnapshot is not implemented.")}fromSliceSnapshot(){return{file:JSON.stringify({blockType:"text",editing:[["Notion Text is not supported to be exported from BlockSuite",[]]]}),assetsIds:[]}}toBlockSnapshot(){throw new V(re.TransformerNotImplementedError,"NotionTextAdapter.toBlockSnapshot is not implemented.")}toDocSnapshot(){throw new V(re.TransformerNotImplementedError,"NotionTextAdapter.toDocSnapshot is not implemented.")}toSliceSnapshot(e){const n=JSON.parse(e.file),r=[],i=[];if(!Array.isArray(n.editing))return null;for(const s of n.editing){const o={insert:s[0]},a=s[1];if(Array.isArray(a)){for(const l of a)if(!(!l||typeof l[0]!="string"))switch(o.attributes||(o.attributes=Object.create(null)),l[0]){case"b":o.attributes.bold=!0;break;case"i":o.attributes.italic=!0;break;case"_":o.attributes.underline=!0;break;case"c":o.attributes.code=!0;break;case"s":o.attributes.strike=!0;break}}i.push(o)}return r.push({type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:"both"},children:[{type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:i}},children:[]}]}),{type:"slice",content:r,workspaceId:e.workspaceId,pageId:e.pageId}}}const Gre=Dc("NotionText"),Vre={setup:t=>{t.addImpl(Gre,e=>({get:n=>new Yre(n,e)}))}},pN=Me("BlockPlainTextAdapterMatcher");function gn(t){const e=pN(t.flavour);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}const mN=Me("InlineDeltaToPlainTextAdapterMatcher");function cE(t){const e=mN(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class qre extends am{constructor(e,n,r){super(),this.configs=e,this.inlineDeltaMatchers=n,this.plainTextASTToDeltaMatchers=r}astToDelta(e){const n={configs:this.configs,options:Object.create(null),toDelta:r=>this.astToDelta(r)};for(const r of this.plainTextASTToDeltaMatchers)if(r.match(e))return r.toDelta(e,n);return[]}deltaToAST(e){return e.map(n=>{const r={configs:this.configs,current:{content:n.insert}};for(const i of this.inlineDeltaMatchers)i.match(n)&&(r.current=i.toAST(n,r));return r.current.content})}}class Xre extends oc{constructor(e,n){super(e,n);const r=Array.from(n.getAll(pN).values()),i=Array.from(n.getAll(mN).values());this.blockMatchers=r,this.deltaConverter=new qre(e.adapterConfigs,i,[])}async _traverseSnapshot(e){const n={content:""},r=new Co;return r.setONodeTypeGuard(i=>qi.safeParse(i).success),r.setEnter(async(i,s)=>{var o,a;for(const l of this.blockMatchers)if(l.fromMatch(i)){const c={walker:r,walkerContext:s,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:n};await((a=(o=l.fromBlockSnapshot).enter)==null?void 0:a.call(o,i,c))}}),r.setLeave(async(i,s)=>{var o,a;for(const l of this.blockMatchers)if(l.fromMatch(i)){const c={walker:r,walkerContext:s,configs:this.configs,job:this.job,deltaConverter:this.deltaConverter,provider:this.provider,textBuffer:n};await((a=(o=l.fromBlockSnapshot).leave)==null?void 0:a.call(o,i,c))}}),await r.walkONode(e),{plaintext:n.content}}async fromBlockSnapshot({snapshot:e}){const{plaintext:n}=await this._traverseSnapshot(e);return{file:n,assetsIds:[]}}async fromDocSnapshot({snapshot:e,assets:n}){let r="";e.meta.title&&(r+=`${e.meta.title}

`);const{file:i,assetsIds:s}=await this.fromBlockSnapshot({snapshot:e.blocks,assets:n});return r+=i,{file:r,assetsIds:s}}async fromSliceSnapshot({snapshot:e}){var n;let r="";const i=[];for(const o of e.content){const{plaintext:a}=await this._traverseSnapshot(o);r+=a}return{file:((n=r.match(/\n/g))==null?void 0:n.length)===1?r.trimEnd():r,assetsIds:i}}toBlockSnapshot(e){return e.file=e.file.replaceAll("\r",""),{type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:e.file.split(`
`).map(n=>({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:n}]}},children:[]}))}}toDocSnapshot(e){return e.file=e.file.replaceAll("\r",""),{type:"page",meta:{id:K(),title:"Untitled",createDate:Date.now(),tags:[]},blocks:{type:"block",id:K(),flavour:"affine:page",props:{title:{"$blocksuite:internal:text$":!0,delta:[{insert:"Untitled"}]}},children:[{type:"block",id:K(),flavour:"affine:surface",props:{elements:{}},children:[]},{type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:e.file.split(`
`).map(n=>({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:n}]}},children:[]}))}]}}}toSliceSnapshot(e){return e.file.trim().length===0?null:(e.file=e.file.replaceAll("\r",""),{type:"slice",content:[{type:"block",id:K(),flavour:"affine:note",props:{xywh:"[0,0,800,95]",background:ae.noteBackgrounColor,index:"a0",hidden:!1,displayMode:ft.DocAndEdgeless},children:e.file.split(`
`).map(r=>({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:[{insert:r}]}},children:[]}))}],workspaceId:e.workspaceId,pageId:e.pageId})}}const Kre=Dc("PlainText"),Qre={setup:t=>{t.addImpl(Kre,e=>({get:n=>new Xre(n,e)}))}},uE={fetchImage:async(t,e,n)=>{try{return n?t.startsWith("blob:")?await fetch(t,e):t.startsWith("data:")?await fetch(t,e):t.startsWith(window.location.origin)?await fetch(t,e):await fetch(n+"?url="+encodeURIComponent(t),e).then(r=>{if(!r.ok)throw new Error("Network response was not ok");return r}).catch(()=>fetch(t,e)):await fetch(t,e)}catch(r){return console.warn("Error fetching image:",r),null}},fetchable:t=>t.startsWith("http:")||t.startsWith("https:")||t.startsWith("data:")};function Zre(t,e){const n=t.split("/").filter(Boolean),r=e.split("/").filter(Boolean);for(const i of r)i!=="."&&(i===".."?n.length>0&&n.pop():n.push(i));return n.join("/")}function Jre(t,e){const n=decodeURIComponent(e),r=t.substring(0,t.lastIndexOf("/"));return!n.startsWith("/")?Zre(r,n):n.replace(/^\//,"")}class eie{constructor(e,n,r){this.args=e,this.rt=n,this.vars=r,this._validate=gN,this._valueType=void 0,this.name="function"}subst(e){const n={...e},r=[];for(const s of this.args){const o=s.subst(n);if(!o)return;r.push(o)}const i=this.rt.subst(n);if(i)return dE.fn.instance(r,i)}unify(e,n,r){const i={...e};for(let s=0;s<n.args.length;s++){const o=n.args[s],a=this.args[s];if(o==null||a!=null&&!r(i,a,o))return!1}return r(i,n.rt,this.rt)}valueValidate(e){return gN.safeParse(e).success}}const gN=le.function();class tie{constructor(e){this.element=e,this._valueType=void 0,this.name="array",this._validate=le.array(e._validate)}subst(e){const n=this.element.subst(e);if(n)return dE.array.instance(n)}unify(e,n,r){return r(e,this.element,n.element)}valueValidate(e){return this._validate.safeParse(e).success}}const dE={fn:{is:t=>t.name==="function",instance:(t,e,n)=>new eie(t,e,n??[])},array:{is:t=>t.name==="array",instance:t=>new tie(t)}};class nie{constructor(e,n,r){this.name=e,this._validate=n,this.data=r,this._valueType=void 0}subst(e){return this}unify(e,n,r){return this.name!==n.name?!1:n.data==null?!0:this.data!=null}valueValidate(e){return this._validate.safeParse(e).success}}class rie{constructor(e,n,r){this.name=e,this.valueSchema=r}instance(e){return new nie(this.name,this.valueSchema,e)}is(e){return e.name===this.name}}const fs=(t,e,n)=>new rie(t,e,n),iie=le.unknown();class sie{constructor(e,n){this.varName=e,this.typeConstraint=n,this.name="__TypeVarDefine"}}class oie{constructor(e){this.varName=e,this._validate=iie,this._valueType=void 0,this.name="__TypeVarReference"}subst(e){var n;return(n=e[this.varName])==null?void 0:n.type}unify(e,n,r){throw new V(re.DatabaseBlockError,"unexpected type unify, type var reference")}valueValidate(e){return!0}}const hE={typeVarDefine:{create:(t,e)=>new sie(t,e)},typeVarReference:{create:t=>new oie(t),is:t=>t.name==="__TypeVarReference"}};hE.typeVarReference.create,hE.typeVarDefine.create;const bN=le.object({id:le.string(),color:le.string(),value:le.string()}),aie=le.object({userService:le.custom(()=>!0),userListService:le.custom(()=>!0)}),fE=fs("Unknown",fk(),i0()),yN={number:fs("Number",dn(),dn()),string:fs("String",pe(),pe()),boolean:fs("Boolean",Ba(),Ba()),richText:fs("RichText",pe(),pe()),date:fs("Date",dn(),dn()),url:fs("URL",pe(),pe()),image:fs("Image",pe(),pe()),tag:fs("Tag",ec(bN),pe()),user:fs("User",aie,pe())},sn={unknown:fE,...yN,...hE,...dE},vm=(t,e,n)=>({from:t,to:e,convert:n});[...Object.values(yN).map(t=>({from:t.instance(),to:sn.unknown.instance(),convert:e=>e})),vm(sn.array.instance(fE.instance()),fE.instance(),t=>t),vm(sn.richText.instance(),sn.string.instance(),t=>t),vm(sn.url.instance(),sn.string.instance(),t=>t),vm(sn.user.instance(),sn.string.instance(),t=>t)];const Ai=t=>({type:t,modelConfig:e=>{const n=(r,i)=>({type:t,name:r,data:i??e.propertyData.default()});return{type:t,config:e,create:n,createPropertyMeta:r=>({type:t,config:e,create:n,renderer:{type:t,...r}})}}}),lie=Ai("checkbox"),cie=new Set(["false","no","0","","undefined","null","","","","","",""]),uie=lie.modelConfig({name:"Checkbox",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.boolean(),isEmpty:()=>!1,type:()=>sn.boolean.instance()},rawValue:{schema:le.boolean(),default:()=>!1,fromString:({value:t})=>{var e;return{value:!cie.has(((e=t==null?void 0:t.trim())!=null?e:"").toLowerCase())}},toString:({value:t})=>t?"True":"False",toJson:({value:t})=>t,fromJson:({value:t})=>t},minWidth:34}),die={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},hie=(t,e,n)=>{let r;const i=die[t];return typeof i=="string"?r=i:e===1?r=i.one:r=i.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function pE(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const fie={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},pie={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},mie={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},gie={date:pE({formats:fie,defaultWidth:"full"}),time:pE({formats:pie,defaultWidth:"full"}),dateTime:pE({formats:mie,defaultWidth:"full"})},bie={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},yie=(t,e,n,r)=>bie[t];function Oh(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let i;if(r==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;i=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;i=t.values[a]||t.values[o]}const s=t.argumentCallback?t.argumentCallback(e):e;return i[s]}}const _ie={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xie={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Eie={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},vie={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},wie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},kie={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Tie={ordinalNumber:(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Oh({values:_ie,defaultWidth:"wide"}),quarter:Oh({values:xie,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Oh({values:Eie,defaultWidth:"wide"}),day:Oh({values:vie,defaultWidth:"wide"}),dayPeriod:Oh({values:wie,defaultWidth:"wide",formattingValues:kie,defaultFormattingWidth:"wide"})};function Ph(t){return(e,n={})=>{const r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;const o=s[0],a=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?Cie(a,d=>d.test(o)):Sie(a,d=>d.test(o));let c;c=t.valueCallback?t.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;const u=e.slice(o.length);return{value:c,rest:u}}}function Sie(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Cie(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function Aie(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const i=r[0],s=e.match(t.parsePattern);if(!s)return null;let o=t.valueCallback?t.valueCallback(s[0]):s[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(i.length);return{value:o,rest:a}}}const Iie=/^(\d+)(th|st|nd|rd)?/i,Mie=/\d+/i,Die={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Nie={any:[/^b/i,/^(a|c)/i]},Oie={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Pie={any:[/1/i,/2/i,/3/i,/4/i]},Lie={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Rie={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Bie={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Fie={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Uie={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},$ie={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Hie={ordinalNumber:Aie({matchPattern:Iie,parsePattern:Mie,valueCallback:t=>parseInt(t,10)}),era:Ph({matchPatterns:Die,defaultMatchWidth:"wide",parsePatterns:Nie,defaultParseWidth:"any"}),quarter:Ph({matchPatterns:Oie,defaultMatchWidth:"wide",parsePatterns:Pie,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Ph({matchPatterns:Lie,defaultMatchWidth:"wide",parsePatterns:Rie,defaultParseWidth:"any"}),day:Ph({matchPatterns:Bie,defaultMatchWidth:"wide",parsePatterns:Fie,defaultParseWidth:"any"}),dayPeriod:Ph({matchPatterns:Uie,defaultMatchWidth:"any",parsePatterns:$ie,defaultParseWidth:"any"})},_N={code:"en-US",formatDistance:hie,formatLong:gie,formatRelative:yie,localize:Tie,match:Hie,options:{weekStartsOn:0,firstWeekContainsDate:1}};let zie={};function Yc(){return zie}const xN=6048e5,Wie=864e5,jie=6e4,Yie=36e5,Gie=1e3,EN=Symbol.for("constructDateFrom");function Mn(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&EN in t?t[EN](e):t instanceof Date?new t.constructor(e):new Date(e)}function bn(t,e){return Mn(e||t,t)}function wm(t){const e=bn(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function Vie(t,...e){const n=Mn.bind(null,e.find(r=>typeof r=="object"));return e.map(n)}function vN(t,e){const n=bn(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function qie(t,e,n){const[r,i]=Vie(n==null?void 0:n.in,t,e),s=vN(r),o=vN(i),a=+s-wm(s),l=+o-wm(o);return Math.round((a-l)/Wie)}function Xie(t,e){const n=bn(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function Kie(t,e){const n=bn(t,e==null?void 0:e.in);return qie(n,Xie(n))+1}function sa(t,e){var a,l,c,u;const n=Yc(),r=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((u=(c=n.locale)==null?void 0:c.options)==null?void 0:u.weekStartsOn)??0,i=bn(t,e==null?void 0:e.in),s=i.getDay(),o=(s<r?7:0)+s-r;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function Gc(t,e){return sa(t,{...e,weekStartsOn:1})}function wN(t,e){const n=bn(t,e==null?void 0:e.in),r=n.getFullYear(),i=Mn(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const s=Gc(i),o=Mn(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const a=Gc(o);return n.getTime()>=s.getTime()?r+1:n.getTime()>=a.getTime()?r:r-1}function Qie(t,e){const n=wN(t,e),r=Mn(t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),Gc(r)}function kN(t,e){const n=bn(t,e==null?void 0:e.in),r=+Gc(n)-+Qie(n);return Math.round(r/xN)+1}function mE(t,e){var u,d,h,f;const n=bn(t,e==null?void 0:e.in),r=n.getFullYear(),i=Yc(),s=(e==null?void 0:e.firstWeekContainsDate)??((d=(u=e==null?void 0:e.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??i.firstWeekContainsDate??((f=(h=i.locale)==null?void 0:h.options)==null?void 0:f.firstWeekContainsDate)??1,o=Mn((e==null?void 0:e.in)||t,0);o.setFullYear(r+1,0,s),o.setHours(0,0,0,0);const a=sa(o,e),l=Mn((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,s),l.setHours(0,0,0,0);const c=sa(l,e);return+n>=+a?r+1:+n>=+c?r:r-1}function Zie(t,e){var a,l,c,u;const n=Yc(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((u=(c=n.locale)==null?void 0:c.options)==null?void 0:u.firstWeekContainsDate)??1,i=mE(t,e),s=Mn((e==null?void 0:e.in)||t,0);return s.setFullYear(i,0,r),s.setHours(0,0,0,0),sa(s,e)}function TN(t,e){const n=bn(t,e==null?void 0:e.in),r=+sa(n,e)-+Zie(n,e);return Math.round(r/xN)+1}function ut(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const oa={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return ut(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):ut(n+1,2)},d(t,e){return ut(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return ut(t.getHours()%12||12,e.length)},H(t,e){return ut(t.getHours(),e.length)},m(t,e){return ut(t.getMinutes(),e.length)},s(t,e){return ut(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),i=Math.trunc(r*Math.pow(10,n-3));return ut(i,e.length)}},Vc={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},SN={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return oa.y(t,e)},Y:function(t,e,n,r){const i=mE(t,r),s=i>0?i:1-i;if(e==="YY"){const o=s%100;return ut(o,2)}return e==="Yo"?n.ordinalNumber(s,{unit:"year"}):ut(s,e.length)},R:function(t,e){const n=wN(t);return ut(n,e.length)},u:function(t,e){const n=t.getFullYear();return ut(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return ut(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return ut(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return oa.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return ut(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const i=TN(t,r);return e==="wo"?n.ordinalNumber(i,{unit:"week"}):ut(i,e.length)},I:function(t,e,n){const r=kN(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):ut(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):oa.d(t,e)},D:function(t,e,n){const r=Kie(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):ut(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return ut(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return ut(s,e.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),i=r===0?7:r;switch(e){case"i":return String(i);case"ii":return ut(i,e.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let i;switch(r===12?i=Vc.noon:r===0?i=Vc.midnight:i=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let i;switch(r>=17?i=Vc.evening:r>=12?i=Vc.afternoon:r>=4?i=Vc.morning:i=Vc.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return oa.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):oa.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):ut(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):ut(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):oa.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):oa.s(t,e)},S:function(t,e){return oa.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return AN(r);case"XXXX":case"XX":return bl(r);case"XXXXX":case"XXX":default:return bl(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return AN(r);case"xxxx":case"xx":return bl(r);case"xxxxx":case"xxx":default:return bl(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+CN(r,":");case"OOOO":default:return"GMT"+bl(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+CN(r,":");case"zzzz":default:return"GMT"+bl(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return ut(r,e.length)},T:function(t,e,n){return ut(+t,e.length)}};function CN(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Math.trunc(r/60),s=r%60;return s===0?n+String(i):n+String(i)+e+ut(s,2)}function AN(t,e){return t%60===0?(t>0?"-":"+")+ut(Math.abs(t)/60,2):bl(t,e)}function bl(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=ut(Math.trunc(r/60),2),s=ut(r%60,2);return n+i+e+s}const IN=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},MN=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},gE={p:MN,P:(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return IN(t,e);let s;switch(r){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;case"PPPP":default:s=e.dateTime({width:"full"});break}return s.replace("{{date}}",IN(r,e)).replace("{{time}}",MN(i,e))}},Jie=/^D+$/,ese=/^Y+$/,tse=["D","DD","YY","YYYY"];function DN(t){return Jie.test(t)}function NN(t){return ese.test(t)}function bE(t,e,n){const r=nse(t,e,n);if(console.warn(r),tse.includes(t))throw new RangeError(r)}function nse(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function rse(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function ise(t){return!(!rse(t)&&typeof t!="number"||isNaN(+bn(t)))}const sse=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ose=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ase=/^'([^]*?)'?$/,lse=/''/g,cse=/[a-zA-Z]/;function use(t,e,n){var u,d,h,f;const r=Yc(),i=r.locale??_N,s=r.firstWeekContainsDate??((d=(u=r.locale)==null?void 0:u.options)==null?void 0:d.firstWeekContainsDate)??1,o=r.weekStartsOn??((f=(h=r.locale)==null?void 0:h.options)==null?void 0:f.weekStartsOn)??0,a=bn(t,n==null?void 0:n.in);if(!ise(a))throw new RangeError("Invalid time value");let l=e.match(ose).map(p=>{const g=p[0];if(g==="p"||g==="P"){const b=gE[g];return b(p,i.formatLong)}return p}).join("").match(sse).map(p=>{if(p==="''")return{isToken:!1,value:"'"};const g=p[0];if(g==="'")return{isToken:!1,value:dse(p)};if(SN[g])return{isToken:!0,value:p};if(g.match(cse))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:p}});i.localize.preprocessor&&(l=i.localize.preprocessor(a,l));const c={firstWeekContainsDate:s,weekStartsOn:o,locale:i};return l.map(p=>{if(!p.isToken)return p.value;const g=p.value;(NN(g)||DN(g))&&bE(g,e,String(t));const b=SN[g[0]];return b(a,g,i.localize,c)}).join("")}function dse(t){const e=t.match(ase);return e?e[1].replace(lse,"'"):t}function hse(){return Object.assign({},Yc())}function fse(t,e){const n=pse(e)?new e(0):Mn(e,0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),n}function pse(t){var e;return typeof t=="function"&&((e=t.prototype)==null?void 0:e.constructor)===t}const mse=10;class ON{constructor(){J(this,"subPriority",0)}validate(e,n){return!0}}class gse extends ON{constructor(e,n,r,i,s){super(),this.value=e,this.validateValue=n,this.setValue=r,this.priority=i,s&&(this.subPriority=s)}validate(e,n){return this.validateValue(e,this.value,n)}set(e,n,r){return this.setValue(e,n,this.value,r)}}class bse extends ON{constructor(n,r){super();J(this,"priority",mse);J(this,"subPriority",-1);this.context=n||(i=>Mn(r,i))}set(n,r){return r.timestampIsSet?n:Mn(n,fse(n,this.context))}}class st{run(e,n,r,i){const s=this.parse(e,n,r,i);return s?{setter:new gse(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}validate(e,n,r){return!0}}class yse extends st{constructor(){super(...arguments);J(this,"priority",140);J(this,"incompatibleTokens",["R","u","t","T"])}parse(n,r,i){switch(r){case"G":case"GG":case"GGG":return i.era(n,{width:"abbreviated"})||i.era(n,{width:"narrow"});case"GGGGG":return i.era(n,{width:"narrow"});case"GGGG":default:return i.era(n,{width:"wide"})||i.era(n,{width:"abbreviated"})||i.era(n,{width:"narrow"})}}set(n,r,i){return r.era=i,n.setFullYear(i,0,1),n.setHours(0,0,0,0),n}}const jt={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},ps={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Yt(t,e){return t&&{value:e(t.value),rest:t.rest}}function Bt(t,e){const n=e.match(t);return n?{value:parseInt(n[0],10),rest:e.slice(n[0].length)}:null}function ms(t,e){const n=e.match(t);if(!n)return null;if(n[0]==="Z")return{value:0,rest:e.slice(1)};const r=n[1]==="+"?1:-1,i=n[2]?parseInt(n[2],10):0,s=n[3]?parseInt(n[3],10):0,o=n[5]?parseInt(n[5],10):0;return{value:r*(i*Yie+s*jie+o*Gie),rest:e.slice(n[0].length)}}function PN(t){return Bt(jt.anyDigitsSigned,t)}function Ft(t,e){switch(t){case 1:return Bt(jt.singleDigit,e);case 2:return Bt(jt.twoDigits,e);case 3:return Bt(jt.threeDigits,e);case 4:return Bt(jt.fourDigits,e);default:return Bt(new RegExp("^\\d{1,"+t+"}"),e)}}function km(t,e){switch(t){case 1:return Bt(jt.singleDigitSigned,e);case 2:return Bt(jt.twoDigitsSigned,e);case 3:return Bt(jt.threeDigitsSigned,e);case 4:return Bt(jt.fourDigitsSigned,e);default:return Bt(new RegExp("^-?\\d{1,"+t+"}"),e)}}function yE(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function LN(t,e){const n=e>0,r=n?e:1-e;let i;if(r<=50)i=t||100;else{const s=r+50,o=Math.trunc(s/100)*100,a=t>=s%100;i=t+o-(a?100:0)}return n?i:1-i}function RN(t){return t%400===0||t%4===0&&t%100!==0}class _se extends st{constructor(){super(...arguments);J(this,"priority",130);J(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(n,r,i){const s=o=>({year:o,isTwoDigitYear:r==="yy"});switch(r){case"y":return Yt(Ft(4,n),s);case"yo":return Yt(i.ordinalNumber(n,{unit:"year"}),s);default:return Yt(Ft(r.length,n),s)}}validate(n,r){return r.isTwoDigitYear||r.year>0}set(n,r,i){const s=n.getFullYear();if(i.isTwoDigitYear){const a=LN(i.year,s);return n.setFullYear(a,0,1),n.setHours(0,0,0,0),n}const o=!("era"in r)||r.era===1?i.year:1-i.year;return n.setFullYear(o,0,1),n.setHours(0,0,0,0),n}}class xse extends st{constructor(){super(...arguments);J(this,"priority",130);J(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(n,r,i){const s=o=>({year:o,isTwoDigitYear:r==="YY"});switch(r){case"Y":return Yt(Ft(4,n),s);case"Yo":return Yt(i.ordinalNumber(n,{unit:"year"}),s);default:return Yt(Ft(r.length,n),s)}}validate(n,r){return r.isTwoDigitYear||r.year>0}set(n,r,i,s){const o=mE(n,s);if(i.isTwoDigitYear){const l=LN(i.year,o);return n.setFullYear(l,0,s.firstWeekContainsDate),n.setHours(0,0,0,0),sa(n,s)}const a=!("era"in r)||r.era===1?i.year:1-i.year;return n.setFullYear(a,0,s.firstWeekContainsDate),n.setHours(0,0,0,0),sa(n,s)}}class Ese extends st{constructor(){super(...arguments);J(this,"priority",130);J(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(n,r){return km(r==="R"?4:r.length,n)}set(n,r,i){const s=Mn(n,0);return s.setFullYear(i,0,4),s.setHours(0,0,0,0),Gc(s)}}class vse extends st{constructor(){super(...arguments);J(this,"priority",130);J(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(n,r){return km(r==="u"?4:r.length,n)}set(n,r,i){return n.setFullYear(i,0,1),n.setHours(0,0,0,0),n}}class wse extends st{constructor(){super(...arguments);J(this,"priority",120);J(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"Q":case"QQ":return Ft(r.length,n);case"Qo":return i.ordinalNumber(n,{unit:"quarter"});case"QQQ":return i.quarter(n,{width:"abbreviated",context:"formatting"})||i.quarter(n,{width:"narrow",context:"formatting"});case"QQQQQ":return i.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(n,{width:"wide",context:"formatting"})||i.quarter(n,{width:"abbreviated",context:"formatting"})||i.quarter(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=1&&r<=4}set(n,r,i){return n.setMonth((i-1)*3,1),n.setHours(0,0,0,0),n}}class kse extends st{constructor(){super(...arguments);J(this,"priority",120);J(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"q":case"qq":return Ft(r.length,n);case"qo":return i.ordinalNumber(n,{unit:"quarter"});case"qqq":return i.quarter(n,{width:"abbreviated",context:"standalone"})||i.quarter(n,{width:"narrow",context:"standalone"});case"qqqqq":return i.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(n,{width:"wide",context:"standalone"})||i.quarter(n,{width:"abbreviated",context:"standalone"})||i.quarter(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=1&&r<=4}set(n,r,i){return n.setMonth((i-1)*3,1),n.setHours(0,0,0,0),n}}class Tse extends st{constructor(){super(...arguments);J(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);J(this,"priority",110)}parse(n,r,i){const s=o=>o-1;switch(r){case"M":return Yt(Bt(jt.month,n),s);case"MM":return Yt(Ft(2,n),s);case"Mo":return Yt(i.ordinalNumber(n,{unit:"month"}),s);case"MMM":return i.month(n,{width:"abbreviated",context:"formatting"})||i.month(n,{width:"narrow",context:"formatting"});case"MMMMM":return i.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(n,{width:"wide",context:"formatting"})||i.month(n,{width:"abbreviated",context:"formatting"})||i.month(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.setMonth(i,1),n.setHours(0,0,0,0),n}}class Sse extends st{constructor(){super(...arguments);J(this,"priority",110);J(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(n,r,i){const s=o=>o-1;switch(r){case"L":return Yt(Bt(jt.month,n),s);case"LL":return Yt(Ft(2,n),s);case"Lo":return Yt(i.ordinalNumber(n,{unit:"month"}),s);case"LLL":return i.month(n,{width:"abbreviated",context:"standalone"})||i.month(n,{width:"narrow",context:"standalone"});case"LLLLL":return i.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(n,{width:"wide",context:"standalone"})||i.month(n,{width:"abbreviated",context:"standalone"})||i.month(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.setMonth(i,1),n.setHours(0,0,0,0),n}}function Cse(t,e,n){const r=bn(t,n==null?void 0:n.in),i=TN(r,n)-e;return r.setDate(r.getDate()-i*7),bn(r,n==null?void 0:n.in)}class Ase extends st{constructor(){super(...arguments);J(this,"priority",100);J(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(n,r,i){switch(r){case"w":return Bt(jt.week,n);case"wo":return i.ordinalNumber(n,{unit:"week"});default:return Ft(r.length,n)}}validate(n,r){return r>=1&&r<=53}set(n,r,i,s){return sa(Cse(n,i,s),s)}}function Ise(t,e,n){const r=bn(t,n==null?void 0:n.in),i=kN(r,n)-e;return r.setDate(r.getDate()-i*7),r}class Mse extends st{constructor(){super(...arguments);J(this,"priority",100);J(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(n,r,i){switch(r){case"I":return Bt(jt.week,n);case"Io":return i.ordinalNumber(n,{unit:"week"});default:return Ft(r.length,n)}}validate(n,r){return r>=1&&r<=53}set(n,r,i){return Gc(Ise(n,i))}}const Dse=[31,28,31,30,31,30,31,31,30,31,30,31],Nse=[31,29,31,30,31,30,31,31,30,31,30,31];class Ose extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"subPriority",1);J(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"d":return Bt(jt.date,n);case"do":return i.ordinalNumber(n,{unit:"date"});default:return Ft(r.length,n)}}validate(n,r){const i=n.getFullYear(),s=RN(i),o=n.getMonth();return s?r>=1&&r<=Nse[o]:r>=1&&r<=Dse[o]}set(n,r,i){return n.setDate(i),n.setHours(0,0,0,0),n}}class Pse extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"subpriority",1);J(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(n,r,i){switch(r){case"D":case"DD":return Bt(jt.dayOfYear,n);case"Do":return i.ordinalNumber(n,{unit:"date"});default:return Ft(r.length,n)}}validate(n,r){const i=n.getFullYear();return RN(i)?r>=1&&r<=366:r>=1&&r<=365}set(n,r,i){return n.setMonth(0,i),n.setHours(0,0,0,0),n}}function BN(t,e,n){const r=bn(t,n==null?void 0:n.in);return isNaN(e)?Mn((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}function _E(t,e,n){var d,h,f,p;const r=Yc(),i=(n==null?void 0:n.weekStartsOn)??((h=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:h.weekStartsOn)??r.weekStartsOn??((p=(f=r.locale)==null?void 0:f.options)==null?void 0:p.weekStartsOn)??0,s=bn(t,n==null?void 0:n.in),o=s.getDay(),l=(e%7+7)%7,c=7-i,u=e<0||e>6?e-(o+c)%7:(l+c)%7-(o+c)%7;return BN(s,u,n)}class Lse extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"E":case"EE":case"EEE":return i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"EEEEE":return i.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"EEEE":default:return i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=_E(n,i,s),n.setHours(0,0,0,0),n}}class Rse extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(n,r,i,s){const o=a=>{const l=Math.floor((a-1)/7)*7;return(a+s.weekStartsOn+6)%7+l};switch(r){case"e":case"ee":return Yt(Ft(r.length,n),o);case"eo":return Yt(i.ordinalNumber(n,{unit:"day"}),o);case"eee":return i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"eeeee":return i.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"eeee":default:return i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=_E(n,i,s),n.setHours(0,0,0,0),n}}class Bse extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(n,r,i,s){const o=a=>{const l=Math.floor((a-1)/7)*7;return(a+s.weekStartsOn+6)%7+l};switch(r){case"c":case"cc":return Yt(Ft(r.length,n),o);case"co":return Yt(i.ordinalNumber(n,{unit:"day"}),o);case"ccc":return i.day(n,{width:"abbreviated",context:"standalone"})||i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"});case"ccccc":return i.day(n,{width:"narrow",context:"standalone"});case"cccccc":return i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"});case"cccc":default:return i.day(n,{width:"wide",context:"standalone"})||i.day(n,{width:"abbreviated",context:"standalone"})||i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=_E(n,i,s),n.setHours(0,0,0,0),n}}function Fse(t,e){const n=bn(t,e==null?void 0:e.in).getDay();return n===0?7:n}function Use(t,e,n){const r=bn(t,n==null?void 0:n.in),i=Fse(r,n),s=e-i;return BN(r,s,n)}class $se extends st{constructor(){super(...arguments);J(this,"priority",90);J(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(n,r,i){const s=o=>o===0?7:o;switch(r){case"i":case"ii":return Ft(r.length,n);case"io":return i.ordinalNumber(n,{unit:"day"});case"iii":return Yt(i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s);case"iiiii":return Yt(i.day(n,{width:"narrow",context:"formatting"}),s);case"iiiiii":return Yt(i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s);case"iiii":default:return Yt(i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s)}}validate(n,r){return r>=1&&r<=7}set(n,r,i){return n=Use(n,i),n.setHours(0,0,0,0),n}}class Hse extends st{constructor(){super(...arguments);J(this,"priority",80);J(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(n,r,i){switch(r){case"a":case"aa":case"aaa":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaaa":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(yE(i),0,0,0),n}}class zse extends st{constructor(){super(...arguments);J(this,"priority",80);J(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(n,r,i){switch(r){case"b":case"bb":case"bbb":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbbb":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(yE(i),0,0,0),n}}class Wse extends st{constructor(){super(...arguments);J(this,"priority",80);J(this,"incompatibleTokens",["a","b","t","T"])}parse(n,r,i){switch(r){case"B":case"BB":case"BBB":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBBB":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(yE(i),0,0,0),n}}class jse extends st{constructor(){super(...arguments);J(this,"priority",70);J(this,"incompatibleTokens",["H","K","k","t","T"])}parse(n,r,i){switch(r){case"h":return Bt(jt.hour12h,n);case"ho":return i.ordinalNumber(n,{unit:"hour"});default:return Ft(r.length,n)}}validate(n,r){return r>=1&&r<=12}set(n,r,i){const s=n.getHours()>=12;return s&&i<12?n.setHours(i+12,0,0,0):!s&&i===12?n.setHours(0,0,0,0):n.setHours(i,0,0,0),n}}class Yse extends st{constructor(){super(...arguments);J(this,"priority",70);J(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(n,r,i){switch(r){case"H":return Bt(jt.hour23h,n);case"Ho":return i.ordinalNumber(n,{unit:"hour"});default:return Ft(r.length,n)}}validate(n,r){return r>=0&&r<=23}set(n,r,i){return n.setHours(i,0,0,0),n}}class Gse extends st{constructor(){super(...arguments);J(this,"priority",70);J(this,"incompatibleTokens",["h","H","k","t","T"])}parse(n,r,i){switch(r){case"K":return Bt(jt.hour11h,n);case"Ko":return i.ordinalNumber(n,{unit:"hour"});default:return Ft(r.length,n)}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.getHours()>=12&&i<12?n.setHours(i+12,0,0,0):n.setHours(i,0,0,0),n}}class Vse extends st{constructor(){super(...arguments);J(this,"priority",70);J(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(n,r,i){switch(r){case"k":return Bt(jt.hour24h,n);case"ko":return i.ordinalNumber(n,{unit:"hour"});default:return Ft(r.length,n)}}validate(n,r){return r>=1&&r<=24}set(n,r,i){const s=i<=24?i%24:i;return n.setHours(s,0,0,0),n}}class qse extends st{constructor(){super(...arguments);J(this,"priority",60);J(this,"incompatibleTokens",["t","T"])}parse(n,r,i){switch(r){case"m":return Bt(jt.minute,n);case"mo":return i.ordinalNumber(n,{unit:"minute"});default:return Ft(r.length,n)}}validate(n,r){return r>=0&&r<=59}set(n,r,i){return n.setMinutes(i,0,0),n}}class Xse extends st{constructor(){super(...arguments);J(this,"priority",50);J(this,"incompatibleTokens",["t","T"])}parse(n,r,i){switch(r){case"s":return Bt(jt.second,n);case"so":return i.ordinalNumber(n,{unit:"second"});default:return Ft(r.length,n)}}validate(n,r){return r>=0&&r<=59}set(n,r,i){return n.setSeconds(i,0),n}}class Kse extends st{constructor(){super(...arguments);J(this,"priority",30);J(this,"incompatibleTokens",["t","T"])}parse(n,r){const i=s=>Math.trunc(s*Math.pow(10,-r.length+3));return Yt(Ft(r.length,n),i)}set(n,r,i){return n.setMilliseconds(i),n}}class Qse extends st{constructor(){super(...arguments);J(this,"priority",10);J(this,"incompatibleTokens",["t","T","x"])}parse(n,r){switch(r){case"X":return ms(ps.basicOptionalMinutes,n);case"XX":return ms(ps.basic,n);case"XXXX":return ms(ps.basicOptionalSeconds,n);case"XXXXX":return ms(ps.extendedOptionalSeconds,n);case"XXX":default:return ms(ps.extended,n)}}set(n,r,i){return r.timestampIsSet?n:Mn(n,n.getTime()-wm(n)-i)}}class Zse extends st{constructor(){super(...arguments);J(this,"priority",10);J(this,"incompatibleTokens",["t","T","X"])}parse(n,r){switch(r){case"x":return ms(ps.basicOptionalMinutes,n);case"xx":return ms(ps.basic,n);case"xxxx":return ms(ps.basicOptionalSeconds,n);case"xxxxx":return ms(ps.extendedOptionalSeconds,n);case"xxx":default:return ms(ps.extended,n)}}set(n,r,i){return r.timestampIsSet?n:Mn(n,n.getTime()-wm(n)-i)}}class Jse extends st{constructor(){super(...arguments);J(this,"priority",40);J(this,"incompatibleTokens","*")}parse(n){return PN(n)}set(n,r,i){return[Mn(n,i*1e3),{timestampIsSet:!0}]}}class eoe extends st{constructor(){super(...arguments);J(this,"priority",20);J(this,"incompatibleTokens","*")}parse(n){return PN(n)}set(n,r,i){return[Mn(n,i),{timestampIsSet:!0}]}}const toe={G:new yse,y:new _se,Y:new xse,R:new Ese,u:new vse,Q:new wse,q:new kse,M:new Tse,L:new Sse,w:new Ase,I:new Mse,d:new Ose,D:new Pse,E:new Lse,e:new Rse,c:new Bse,i:new $se,a:new Hse,b:new zse,B:new Wse,h:new jse,H:new Yse,K:new Gse,k:new Vse,m:new qse,s:new Xse,S:new Kse,X:new Qse,x:new Zse,t:new Jse,T:new eoe},noe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,roe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ioe=/^'([^]*?)'?$/,soe=/''/g,ooe=/\S/,aoe=/[a-zA-Z]/;function loe(t,e,n,r){var b,_,y,x;const i=()=>Mn(n,NaN),s=hse(),o=s.locale??_N,a=s.firstWeekContainsDate??((_=(b=s.locale)==null?void 0:b.options)==null?void 0:_.firstWeekContainsDate)??1,l=s.weekStartsOn??((x=(y=s.locale)==null?void 0:y.options)==null?void 0:x.weekStartsOn)??0,c={firstWeekContainsDate:a,weekStartsOn:l,locale:o},u=[new bse(r==null?void 0:r.in,n)],d=e.match(roe).map(E=>{const I=E[0];if(I in gE){const v=gE[I];return v(E,o.formatLong)}return E}).join("").match(noe),h=[];for(let E of d){NN(E)&&bE(E,e,t),DN(E)&&bE(E,e,t);const I=E[0],v=toe[I];if(v){const{incompatibleTokens:N}=v;if(Array.isArray(N)){const z=h.find(M=>N.includes(M.token)||M.token===I);if(z)throw new RangeError(`The format string mustn't contain \`${z.fullToken}\` and \`${E}\` at the same time`)}else if(v.incompatibleTokens==="*"&&h.length>0)throw new RangeError(`The format string mustn't contain \`${E}\` and any other token at the same time`);h.push({token:I,fullToken:E});const L=v.run(t,E,o.match,c);if(!L)return i();u.push(L.setter),t=L.rest}else{if(I.match(aoe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+I+"`");if(E==="''"?E="'":I==="'"&&(E=coe(E)),t.indexOf(E)===0)t=t.slice(E.length);else return i()}}if(t.length>0&&ooe.test(t))return i();const f=u.map(E=>E.priority).sort((E,I)=>I-E).filter((E,I,v)=>v.indexOf(E)===I).map(E=>u.filter(I=>I.priority===E).sort((I,v)=>v.subPriority-I.subPriority)).map(E=>E[0]);let p=bn(n,r==null?void 0:r.in);if(isNaN(+p))return i();const g={};for(const E of f){if(!E.validate(p,c))return i();const I=E.set(p,g,c);Array.isArray(I)?(p=I[0],Object.assign(g,I[1])):p=I}return p}function coe(t){return t.match(ioe)[1].replace(soe,"'")}const uoe=Ai("date").modelConfig({name:"Date",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.number().nullable(),isEmpty:()=>!1,type:()=>sn.date.instance()},rawValue:{schema:le.number().nullable(),default:()=>null,toString:({value:t})=>t!=null?use(t,"yyyy-MM-dd"):"",fromString:({value:t})=>({value:+loe(t,"yyyy-MM-dd",new Date)}),toJson:({value:t})=>t,fromJson:({value:t})=>t}});Ai("image").modelConfig({name:"image",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.string().nullable(),isEmpty:({value:t})=>t==null,type:()=>sn.image.instance()},rawValue:{schema:le.string().nullable(),default:()=>null,toString:({value:t})=>t??"",fromString:({value:t})=>({value:t}),toJson:({value:t})=>t,fromJson:({value:t})=>t},hide:!0});const FN=[{oldColor:"var(--affine-tag-red)",color:ns("chip/label/red"),name:"Red"},{oldColor:"var(--affine-tag-pink)",color:ns("chip/label/magenta"),name:"Magenta"},{oldColor:"var(--affine-tag-orange)",color:ns("chip/label/orange"),name:"Orange"},{oldColor:"var(--affine-tag-yellow)",color:ns("chip/label/yellow"),name:"Yellow"},{oldColor:"var(--affine-tag-green)",color:ns("chip/label/green"),name:"Green"},{oldColor:"var(--affine-tag-teal)",color:ns("chip/label/teal"),name:"Teal"},{oldColor:"var(--affine-tag-blue)",color:ns("chip/label/blue"),name:"Blue"},{oldColor:"var(--affine-tag-purple)",color:ns("chip/label/purple"),name:"Purple"},{oldColor:"var(--affine-tag-gray)",color:ns("chip/label/grey"),name:"Grey"},{oldColor:"var(--affine-tag-white)",color:ns("chip/label/white"),name:"White"}];Object.fromEntries(FN.map(t=>[t.oldColor,t.color]));const UN=FN.map(t=>t.color);function doe(){let t=[...UN];return()=>{t.length===0&&(t=[...UN]);const e=Math.floor(Math.random()*t.length),n=t.splice(e,1)[0];return n||""}}const Lh=doe();/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hoe=r2(class extends i2{constructor(){super(...arguments),this.key=St}render(t,e){return this.key=t,e}update(t,[e,n]){return e!==this.key&&(n2(t),this.key=e),n}}),foe=Ai("select"),$N=le.object({options:le.array(bN)}),poe=foe.modelConfig({name:"Select",propertyData:{schema:$N,default:()=>({options:[]})},jsonValue:{schema:le.string().nullable(),isEmpty:({value:t})=>t==null,type:({data:t})=>sn.tag.instance(t.options)},rawValue:{schema:le.string().nullable(),default:()=>null,toString:({value:t,data:e})=>{var n,r;return(r=(n=e.options.find(i=>i.id===t))==null?void 0:n.value)!=null?r:""},fromString:({value:t,data:e})=>{if(!t)return{value:null,data:e};const n=Object.fromEntries(e.options.map(o=>[o.value,o])),r=t.split(",").map(o=>o.trim()).find(o=>o);if(!r)return{value:null,data:e};let i;const s=n[r];if(s)i=s.id;else{const o={id:K(),value:r,color:Lh()};e.options.push(o),i=o.id}return{value:i,data:e}},toJson:({value:t})=>t,fromJson:({value:t})=>t},addGroup:({text:t,oldData:e})=>{var n;return{options:[...(n=e.options)!=null?n:[],{id:K(),value:t,color:Lh()}]}}}),moe=Ai("multi-select").modelConfig({name:"Multi-select",propertyData:{schema:$N,default:()=>({options:[]})},jsonValue:{schema:le.array(le.string()),isEmpty:({value:t})=>t.length===0,type:({data:t})=>sn.array.instance(sn.tag.instance(t.options))},rawValue:{schema:le.array(le.string()),default:()=>[],toString:({value:t,data:e})=>t.map(n=>{var r;return(r=e.options.find(i=>i.id===n))==null?void 0:r.value}).join(","),fromString:({value:t,data:e})=>{const n=Object.fromEntries(e.options.map(s=>[s.value,s])),r=t.split(",").map(s=>s.trim()).filter(s=>s),i=[];return r.forEach(s=>{if(n[s])i.push(n[s].id);else{const o={id:K(),value:s,color:Lh()};e.options.push(o),i.push(o.id)}}),{value:i,data:e}},toJson:({value:t})=>t??null,fromJson:({value:t})=>Array.isArray(t)&&t.every(e=>typeof e=="string")?t:void 0},addGroup:({text:t,oldData:e})=>{var n;return{options:[...(n=e.options)!=null?n:[],{id:K(),value:t,color:Lh()}]}}}),goe=le.enum(["number","numberWithCommas","percent","currencyYen","currencyINR","currencyCNY","currencyUSD","currencyEUR","currencyGBP"]),boe=le.object({decimal:le.number().optional(),format:goe}),yoe=Ai("number").modelConfig({name:"Number",propertyData:{schema:boe,default:()=>({decimal:0,format:"number"})},jsonValue:{schema:le.number().nullable(),isEmpty:({value:t})=>t==null,type:()=>sn.number.instance()},rawValue:{schema:le.number().nullable(),default:()=>null,toString:({value:t})=>{var e;return(e=t==null?void 0:t.toString())!=null?e:""},fromString:({value:t})=>{const e=t?Number(t):NaN;return{value:isNaN(e)?null:e}},toJson:({value:t})=>t??null,fromJson:({value:t})=>typeof t!="number"?null:t}}),_oe=Ai("progress").modelConfig({name:"Progress",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.number(),isEmpty:()=>!1,type:()=>sn.number.instance()},rawValue:{schema:le.number(),default:()=>0,toString:({value:t})=>t.toString(),fromString:({value:t})=>{const e=t?Number(t):NaN;return{value:isNaN(e)?0:e}},toJson:({value:t})=>t,fromJson:({value:t})=>t}});Ai("text").modelConfig({name:"Plain-Text",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.string(),type:()=>sn.string.instance(),isEmpty:({value:t})=>!t},rawValue:{schema:le.string(),default:()=>"",toString:({value:t})=>t,fromString:({value:t})=>({value:t}),toJson:({value:t})=>t,fromJson:({value:t})=>t},hide:!0});const qc={checkboxPropertyModelConfig:uie,datePropertyModelConfig:uoe,multiSelectPropertyModelConfig:moe,numberPropertyModelConfig:yoe,progressPropertyModelConfig:_oe,selectPropertyModelConfig:poe},xoe=Ai("link").modelConfig({name:"Link",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.string(),type:()=>sn.string.instance(),isEmpty:({value:t})=>!t},rawValue:{schema:le.string(),default:()=>"",toString:({value:t})=>t,fromString:({value:t})=>({value:t}),toJson:({value:t})=>t,fromJson:({value:t})=>t}}),HN=Me("editor-host"),zN=t=>{var e;const n=t.attributes;return((e=n==null?void 0:n.reference)==null?void 0:e.type)==="LinkedPage"},Eoe=Ai("rich-text"),WN=t=>t instanceof Qt?t.yText:t,voe=Eoe.modelConfig({name:"Text",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.string(),type:()=>sn.richText.instance(),isEmpty:({value:t})=>!t},rawValue:{schema:le.custom(t=>t instanceof Qt||t instanceof gt).optional(),default:()=>{},toString:({value:t})=>{var e;return(e=t==null?void 0:t.toString())!=null?e:""},fromString:({value:t})=>({value:new Qt(t)}),toJson:({value:t,dataSource:e})=>{var n;if(!t)return null;const r=e.serviceGet(HN);if(r){const i=r.std.workspace,s=WN(t);return(s==null?void 0:s.toDelta()).map(l=>{var c,u,d,h;if(zN(l)){const f=(u=(c=l.attributes)==null?void 0:c.reference)==null?void 0:u.pageId;return(h=(d=i.getDoc(f))==null?void 0:d.meta)==null?void 0:h.title}return l.insert}).join("")}return(n=t==null?void 0:t.toString())!=null?n:null},fromJson:({value:t})=>typeof t!="string"?void 0:new Qt(t),onUpdate:({value:t,callback:e})=>{const n=WN(t);return n==null||n.observe(e),e(),{dispose:()=>{n==null||n.unobserve(e)}}}}}),woe=Ai("title").modelConfig({name:"Title",propertyData:{schema:le.object({}),default:()=>({})},jsonValue:{schema:le.string(),type:()=>sn.richText.instance(),isEmpty:({value:t})=>!t},rawValue:{schema:le.custom(t=>t instanceof Qt).optional(),default:()=>{},toString:({value:t})=>{var e;return(e=t==null?void 0:t.toString())!=null?e:""},fromString:({value:t})=>({value:new Qt(t)}),toJson:({value:t,dataSource:e})=>{var n;if(!t)return"";const r=e.serviceGet(HN);if(r){const i=r.std.workspace;return t.deltas$.value.map(a=>{var l,c,u,d;if(zN(a)){const h=(c=(l=a.attributes)==null?void 0:l.reference)==null?void 0:c.pageId;return(d=(u=i.getDoc(h))==null?void 0:u.meta)==null?void 0:d.title}return a.insert}).join("")}return(n=t==null?void 0:t.toString())!=null?n:""},fromJson:({value:t})=>new Qt(t),onUpdate:({value:t,callback:e})=>(t==null||t.yText.observe(e),e(),{dispose:()=>{t==null||t.yText.unobserve(e)}}),setValue:({value:t,newValue:e})=>{if(t==null)return;const n=e;if(n==null){t.replace(0,t.length,"");return}if(typeof n=="string"){t.replace(0,t.length,n);return}if(e instanceof Qt){new Ds().getMap("root").set("text",e.yText),t.clear(),t.applyDelta(e.toDelta());return}}},fixed:{defaultData:{},defaultShow:!0}}),koe=Object.fromEntries([qc.checkboxPropertyModelConfig,qc.datePropertyModelConfig,qc.numberPropertyModelConfig,qc.progressPropertyModelConfig,qc.selectPropertyModelConfig,qc.multiSelectPropertyModelConfig,xoe,voe,woe].map(t=>[t.type,t]));function Toe(t){var e,n;return(n=(e=t[0])==null?void 0:e.map((r,i)=>Math.max(...t.map(s=>(s[i]||"").length))))!=null?n:[]}function Soe(t,e,n){const i=`| ${t.map((s,o)=>{var a;return s==null?void 0:s.padEnd((a=e[o])!=null?a:0," ")}).join(" | ")} |`;return n?`${i}
${Coe(e)}`:i}function Coe(t){return`| ${t.map(n=>"-".repeat(n)).join(" | ")} |`}function Aoe(t){const e=Toe(t);return t.map((r,i)=>Soe(r,e,i===0)).join(`
`)}const jN=t=>typeof t=="object"&&t!==null?"$blocksuite:internal:text$"in t:!1,xE=(t,e,n)=>{const r={headers:t,rows:[]};return e.forEach(i=>{const s={cells:[]},o=i.props.text;jN(o)?s.cells.push({value:o}):s.cells.push({value:""}),t.forEach(a=>{var l;const c=koe[a.type],u=(l=n[i.id])==null?void 0:l[a.id];if(a.type==="title")return;if(!u||!c){s.cells.push({value:""});return}let d;jN(u.value)?d=u.value:d=c.config.rawValue.toString({value:u.value,data:a.data}),s.cells.push({value:d})}),r.rows.push(s)}),r},Ioe={flavour:Ji.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Ji.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e,r=t.node.props.columns,i=t.node.children,s=t.node.props.cells,o=xE(r,i,s),a=f=>({type:"element",tagName:"td",properties:Object.create(null),children:f}),l=f=>({type:"element",tagName:"th",properties:Object.create(null),children:f}),c=f=>({type:"element",tagName:"tr",properties:Object.create(null),children:f}),{deltaConverter:u}=e,d={type:"element",tagName:"thead",properties:Object.create(null),children:[c(o.headers.map(f=>{var p;return l([{type:"text",value:(p=f.name)!=null?p:""}])}))]},h={type:"element",tagName:"tbody",properties:Object.create(null),children:o.rows.map(f=>c(f.cells.map(p=>a(typeof p.value=="string"?[{type:"text",value:p.value}]:u.deltaToAST(p.value.delta)))))};n.openNode({type:"element",tagName:"table",properties:Object.create(null),children:[d,h]}).closeNode(),n.skipAllChildren()}}},Moe=In(Ioe),Doe=new Set(["table","tableRow"]),Noe=t=>Doe.has(t.type),Ooe={flavour:Ji.model.flavour,toMatch:t=>Noe(t.node),fromMatch:t=>t.node.flavour===Ji.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,deltaConverter:r}=e,i=[],s=t.node.props.columns,o=t.node.children,a=t.node.props.cells,l=xE(s,o,a);i.push({type:"tableRow",children:l.headers.map(c=>({type:"tableCell",children:[{type:"text",value:c.name}]}))}),l.rows.forEach(c=>{i.push({type:"tableRow",children:c.cells.map(u=>({type:"tableCell",children:typeof u.value=="string"?[{type:"text",value:u.value}]:r.deltaToAST(u.value.delta)}))})}),n.openNode({type:"table",children:i}).closeNode(),n.skipAllChildren()}}},Poe=Rt(Ooe),Loe={typesSelect:"select",typesMultipleSelect:"multi-select",typesNumber:"number",typesCheckbox:"checkbox",typesText:"rich-text",typesTitle:"title"},Roe=".collection-content",Boe=".collection-title",Foe=new Set(["table","th","tr"]),Uoe={flavour:Ji.model.flavour,toMatch:t=>H.isElement(t.node)&&Foe.has(t.node.tagName),fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{var n,r,i,s,o;if(!H.isElement(t.node))return;const{walkerContext:a,deltaConverter:l,pageMap:c}=e;switch(t.node.tagName){case"th":{const u=K(),d=(r=(n=H.querySelector(t.node,"svg"))==null?void 0:n.properties)==null?void 0:r.className,h=Array.isArray(d)&&(s=Loe[(i=d[0])!=null?i:""])!=null?s:"rich-text";a.pushGlobalContextStack("hast:table:column",{type:h,name:H.getTextContent(H.getTextChildrenOnlyAst(t.node)),data:Object.create(null),id:u}),a.setGlobalContext("hast:disableimg",!0);break}case"tr":if(((o=t.parent)==null?void 0:o.node.type)==="element"&&t.parent.node.tagName==="tbody"){const u=a.getGlobalContextStack("hast:table:column"),d=Object.create(null);let h=!1;H.getElementChildren(t.node).forEach((f,p)=>{if(h||u[p]===void 0){h=!0,u[p]===void 0&&(u.push({type:"rich-text",name:"",data:Object.create(null),id:K()}),a.pushGlobalContextStack("hast:table:children",{type:"block",id:K(),flavour:"affine:paragraph",props:{text:{"$blocksuite:internal:text$":!0,delta:l.astToDelta(f)},type:"text"},children:[]})),a.pushGlobalContextStack("hast:table:children",{type:"block",id:K(),flavour:"affine:paragraph",props:{text:{"$blocksuite:internal:text$":!0,delta:l.astToDelta(f)},type:"text"},children:[]});const _=u[p];if(!_)return;d[_.id]={columnId:_.id,value:H.getTextContent(f)}}else if(H.querySelector(f,".cell-title")){a.pushGlobalContextStack("hast:table:children",{type:"block",id:K(),flavour:"affine:paragraph",props:{text:{"$blocksuite:internal:text$":!0,delta:l.astToDelta(f,{pageMap:c})},type:"text"},children:[]}),u[p].type="title";return}const g=[],b=u[p];if(b){if(H.querySelector(f,".selected-value"))"options"in b.data||(b.data.options=[]),["multi-select","select"].includes(b.type)||(b.type="select"),b.type==="select"&&f.type==="element"&&f.children.length>1&&(b.type="multi-select"),f.type==="element"&&f.children.forEach(_=>{var y,x,E,I;const v=(y=b.data.options)==null?void 0:y.filter(L=>L.value===H.getTextContent(_)),N=v!=null&&v.length&&(E=(x=v[0])==null?void 0:x.id)!=null?E:K();v!=null&&v.length||(I=b.data.options)==null||I.push({id:N,value:H.getTextContent(_),color:Lh()}),g.push(N)}),d[b.id]={columnId:b.id,value:g};else if(H.querySelector(f,".checkbox"))b.type!=="checkbox"&&(b.type="checkbox"),d[b.id]={columnId:b.id,value:!!H.querySelector(f,".checkbox-on")};else if(b.type==="number"){const _=H.getTextContent(f),y=Number(_);Number.isNaN(y)?(b.type="rich-text",d[b.id]={columnId:b.id,value:Kn.createText(_)}):d[b.id]={columnId:b.id,value:y}}else d[b.id]={columnId:b.id,value:H.getTextContent(f)};b.type==="rich-text"&&!Kn.isText(d[b.id].value)&&(d[b.id]={columnId:b.id,value:Kn.createText(d[b.id].value)})}}),a.setGlobalContextStack("hast:table:column",u),a.pushGlobalContextStack("hast:table:rows",d)}}},leave:(t,e)=>{var n,r,i;if(!H.isElement(t.node))return;const{walkerContext:s}=e;switch(t.node.tagName){case"table":{const o=s.getGlobalContextStack("hast:table:column");s.setGlobalContextStack("hast:table:column",[]);const a=s.getGlobalContextStack("hast:table:children");s.setGlobalContextStack("hast:table:children",[]);const l=Object.create(null);s.getGlobalContextStack("hast:table:rows").forEach((u,d)=>{var h,f;Object.keys(u).forEach(p=>{var g;const b=u[p];b&&((g=o.find(_=>_.id===p))==null?void 0:g.type)==="select"&&(b.value=b.value[0])}),l[(f=(h=a.at(d))==null?void 0:h.id)!=null?f:K()]=u}),s.setGlobalContextStack("hast:table:cells",[]);let c="";((n=t.parent)==null?void 0:n.node.type)==="element"&&H.querySelector(t.parent.node,Roe)&&(c=H.getTextContent(H.querySelector(t.parent.node,Boe))),s.openNode({type:"block",id:K(),flavour:Ji.model.flavour,props:{views:[{id:K(),name:"Table View",mode:"table",columns:[],filter:{type:"group",op:"and",conditions:[]},header:{titleColumn:(i=(r=o.find(u=>u.type==="title"))==null?void 0:r.id)!=null?i:"",iconColumn:"type"}}],title:{"$blocksuite:internal:text$":!0,delta:c?[{insert:c}]:[]},columns:o,cells:l},children:[]},"children"),a.forEach(u=>{s.openNode(u,"children").closeNode()}),s.closeNode(),s.cleanGlobalContextStack("hast:table:column"),s.cleanGlobalContextStack("hast:table:rows"),s.cleanGlobalContextStack("hast:table:children");break}case"th":{s.setGlobalContext("hast:disableimg",!1);break}}}},fromBlockSnapshot:{}},$oe=fr(Uoe),Hoe={flavour:Ji.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Ji.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,deltaConverter:r}=e,i=[],s=t.node.props.columns,o=t.node.children,a=t.node.props.cells,l=xE(s,o,a);i.push(l.headers.map(u=>u.name)),l.rows.forEach(u=>{i.push(u.cells.map(d=>typeof d.value=="string"?d.value:r.deltaToAST(d.value.delta).join("")))});const c=Aoe(i);e.textBuffer.content+=c,e.textBuffer.content+=`
`,n.skipAllChildren()}}},zoe=gn(Hoe),Woe=so({name:"reference",match:t=>{var e;return!!((e=t.attributes)!=null&&e.reference)},toAST:(t,e)=>{var n,r,i;let s={type:"text",value:t.insert};const o=(n=t.attributes)==null?void 0:n.reference;if(!o)return s;const{configs:a}=e,l=a.get(`title:${o.pageId}`),c=Kn.generateDocUrl((r=a.get("docLinkBaseUrl"))!=null?r:"",String(o.pageId),(i=o.params)!=null?i:Object.create(null));return l&&(s.value=l),s={type:"element",tagName:"a",properties:{href:c},children:[s]},s}}),joe=Jo({name:"reference",match:t=>{var e;return!!((e=t.attributes)!=null&&e.reference)},toAST:(t,e)=>{var n,r,i;let s={type:"text",value:t.insert};const o=(n=t.attributes)==null?void 0:n.reference;if(!o)return s;const{configs:a}=e,l=a.get(`title:${o.pageId}`),c=(r=o.params)!=null?r:{};return s={type:"link",url:Kn.generateDocUrl((i=a.get("docLinkBaseUrl"))!=null?i:"",String(o.pageId),c),children:[{type:"text",value:l??""}]},s}}),Yoe=cE({name:"reference",match:t=>{var e;return!!((e=t.attributes)!=null&&e.reference)},toAST:(t,e)=>{var n,r,i,s;const o={content:t.insert},a=(n=t.attributes)==null?void 0:n.reference;if(!a)return o;const{configs:l}=e,c=(r=l.get(`title:${a.pageId}`))!=null?r:"",u=Kn.generateDocUrl((i=l.get("docLinkBaseUrl"))!=null?i:"",String(a.pageId),(s=a.params)!=null?s:Object.create(null));return{content:`${c?`${c}: `:""}${u}`}}}),Goe=/\s+/g,Voe=/[\t\n\v\f\r ]+/g;function Rh(t,e){e?typeof e=="string"&&(e={style:e}):e={};const n=e.preserveLineEndings?qoe:Xoe;return String(t).replace(e.style==="html"?Voe:Goe,e.trim?Koe(n):n)}function qoe(t){const e=/\r?\n|\r/.exec(t);return e?e[0]:" "}function Xoe(){return" "}function Koe(t){return e;function e(n,r,i){return r===0||r+n.length===i.length?"":t(n)}}const Qoe=t=>t.type==="text"&&Rh(t.value,{trim:!0})==="",Qn=t=>t.type==="element",Zoe=new Set(["span","bdi","bdo","ins"]),Joe=new Set(["ol","ul"]),eae=new Set(["strong","b"]),tae=new Set(["i","em"]),YN=t=>{if(!Qn(t))return!1;const e=typeof t.properties.style=="string"?t.properties.style:"",n=eae.has(t.tagName),r=!/font-weight:\s*normal/.test(e),i=/font-weight:\s*(([5-9]\d{2})|bold)/.test(e);return n&&r||i},GN=t=>{if(!Qn(t))return!1;const e=typeof t.properties.style=="string"?t.properties.style:"",n=tae.has(t.tagName),r=/font-style:\s*italic/.test(e);return n||r},VN=t=>{if(!Qn(t))return!1;const e=typeof t.properties.style=="string"?t.properties.style:"",n=t.tagName==="u",r=/text-decoration:\s*underline/.test(e);return n||r},qN=t=>{if(!Qn(t))return!1;const e=typeof t.properties.style=="string"?t.properties.style:"",n=t.tagName==="del",r=/text-decoration:\s*line-through/.test(e);return n||r},nae=t=>Qn(t)?Zoe.has(t.tagName)&&!YN(t)&&!GN(t)&&!VN(t)&&!qN(t):!1,rae=Si({name:"text",match:t=>t.type==="text",toDelta:(t,e)=>{var n;if(!("value"in t))return[];const{options:r}=e;if((n=r.trim)!=null||(r.trim=!1),r.pre)return[{insert:t.value}];if(Qoe(t))return[];const i=r.trim?Rh(t.value,{trim:r.trim}):Rh(t.value);return i?[{insert:i}]:[]}}),iae=Si({name:"text-like-element",match:t=>nae(t),toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1})):[]});Si({name:"list-element",match:t=>Qn(t)&&Joe.has(t.tagName),toDelta:()=>[]});const sae=Si({name:"strong-element",match:t=>YN(t),toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes,bold:!0},r))):[]}),oae=Si({name:"italic-element",match:t=>GN(t),toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes,italic:!0},r))):[]}),aae=Si({name:"code-element",match:t=>Qn(t)&&t.tagName==="code",toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes,code:!0},r))):[]}),lae=Si({name:"del-element",match:t=>qN(t),toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes,strike:!0},r))):[]}),cae=Si({name:"underline-element",match:t=>VN(t),toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes,underline:!0},r))):[]}),uae=Si({name:"mark-element",match:t=>Qn(t)&&t.tagName==="mark",toDelta:(t,e)=>Qn(t)?t.children.flatMap(n=>e.toDelta(n,{trim:!1}).map(r=>(r.attributes={...r.attributes},r))):[]}),dae=Si({name:"br-element",match:t=>Qn(t)&&t.tagName==="br",toDelta:()=>[{insert:`
`}]}),hae=[rae,iae,sae,oae,aae,lae,cae,uae,dae],fae=so({name:"bold",match:t=>{var e;return!!((e=t.attributes)!=null&&e.bold)},toAST:(t,e)=>({type:"element",tagName:"strong",properties:{},children:[e.current]})}),pae=so({name:"italic",match:t=>{var e;return!!((e=t.attributes)!=null&&e.italic)},toAST:(t,e)=>({type:"element",tagName:"em",properties:{},children:[e.current]})}),mae=so({name:"strike",match:t=>{var e;return!!((e=t.attributes)!=null&&e.strike)},toAST:(t,e)=>({type:"element",tagName:"del",properties:{},children:[e.current]})}),gae=so({name:"inlineCode",match:t=>{var e;return!!((e=t.attributes)!=null&&e.code)},toAST:(t,e)=>({type:"element",tagName:"code",properties:{},children:[e.current]})}),bae=so({name:"underline",match:t=>{var e;return!!((e=t.attributes)!=null&&e.underline)},toAST:(t,e)=>({type:"element",tagName:"u",properties:{},children:[e.current]})}),yae=so({name:"highlight-background",match:t=>{var e;return!!((e=t.attributes)!=null&&e.background)},toAST:(t,e,n)=>{var r,i,s;const o={type:"element",tagName:"span",properties:{},children:[e.current]};if(!n||!((r=t.attributes)!=null&&r.background))return o;const a=n.getOptional(Em);if(!a)return o;const l=(s=t.attributes)==null?void 0:s.background.substring(4,(i=t.attributes)==null?void 0:i.background.indexOf(")"));return{type:"element",tagName:"mark",properties:{style:`background-color: ${a.getCssVariableColor(l)};`},children:[e.current]}}}),_ae=so({name:"highlight-color",match:t=>{var e;return!!((e=t.attributes)!=null&&e.color)},toAST:(t,e,n)=>{var r,i,s;const o={type:"element",tagName:"span",properties:{},children:[e.current]};if(!n||!((r=t.attributes)!=null&&r.color))return o;const a=n.getOptional(Em);if(!a)return o;const l=(s=t.attributes)==null?void 0:s.color.substring(4,(i=t.attributes)==null?void 0:i.color.indexOf(")"));return{type:"element",tagName:"mark",properties:{style:`color: ${a.getCssVariableColor(l)};background-color: transparent`},children:[e.current]}}}),xae=[fae,pae,mae,bae,yae,_ae,gae],Eae=Jo({name:"bold",match:t=>{var e;return!!((e=t.attributes)!=null&&e.bold)},toAST:(t,e)=>{const{current:n}=e;return{type:"strong",children:[n]}}}),vae=Jo({name:"italic",match:t=>{var e;return!!((e=t.attributes)!=null&&e.italic)},toAST:(t,e)=>{const{current:n}=e;return{type:"emphasis",children:[n]}}}),wae=Jo({name:"strike",match:t=>{var e;return!!((e=t.attributes)!=null&&e.strike)},toAST:(t,e)=>{const{current:n}=e;return{type:"delete",children:[n]}}}),kae=[Jo({name:"inlineCode",match:t=>{var e;return!!((e=t.attributes)!=null&&e.code)},toAST:t=>({type:"inlineCode",value:t.insert})}),Eae,vae,wae],Tae=ds({name:"text",match:t=>t.type==="text",toDelta:t=>"value"in t?[{insert:t.value}]:[]}),Sae=ds({name:"inlineCode",match:t=>t.type==="inlineCode",toDelta:t=>"value"in t?[{insert:t.value,attributes:{code:!0}}]:[]}),Cae=ds({name:"strong",match:t=>t.type==="strong",toDelta:(t,e)=>"children"in t?t.children.flatMap(n=>e.toDelta(n).map(r=>(r.attributes={...r.attributes,bold:!0},r))):[]}),Aae=ds({name:"emphasis",match:t=>t.type==="emphasis",toDelta:(t,e)=>"children"in t?t.children.flatMap(n=>e.toDelta(n).map(r=>(r.attributes={...r.attributes,italic:!0},r))):[]}),Iae=ds({name:"delete",match:t=>t.type==="delete",toDelta:(t,e)=>"children"in t?t.children.flatMap(n=>e.toDelta(n).map(r=>(r.attributes={...r.attributes,strike:!0},r))):[]}),Mae=ds({name:"list",match:t=>t.type==="list",toDelta:()=>[]}),Dae=ds({name:"html",match:t=>t.type==="html",toDelta:t=>"value"in t?[{insert:t.value}]:[]}),Nae=[Tae,Sae,Cae,Aae,Iae,Mae,Dae],yn=t=>t.type==="element",XN=t=>t.type==="text",Oae=new Set(["ol","ul"]),Pae=new Set(["strong","b"]),Lae=new Set(["i","em"]),Rae="notion-text-equation-token",Bae="border-bottom:0.05em solid",Fae=$r({name:"text",match:t=>XN(t),toDelta:(t,e)=>{var n;if(!XN(t))return[];const{options:r}=e;if((n=r.trim)!=null||(r.trim=!0),r.pre||t.value===" ")return[{insert:t.value}];if(r.trim){const i=Rh(t.value,{trim:r.trim});return i?[{insert:i}]:[]}return t.value?[{insert:Rh(t.value)}]:[]}}),Uae=$r({name:"span-element",match:t=>yn(t)&&t.tagName==="span",toDelta:(t,e)=>{var n,r,i,s,o;if(!yn(t))return[];const{toDelta:a,options:l}=e;return Array.isArray((n=t.properties)==null?void 0:n.className)&&((r=t.properties)!=null&&r.className.includes(Rae))?[{insert:" ",attributes:{latex:H.getTextContent(H.querySelector(t,"annotation"))}}]:typeof((i=t.properties)==null?void 0:i.style)=="string"&&((o=(s=t.properties)==null?void 0:s.style)!=null&&o.includes(Bae))?t.children.flatMap(c=>e.toDelta(c,l).map(u=>(u.attributes={...u.attributes,underline:!0},u))):t.children.flatMap(c=>a(c,l))}}),$ae=$r({name:"list-element",match:t=>yn(t)&&Oae.has(t.tagName),toDelta:()=>[]}),Hae=$r({name:"strong-element",match:t=>yn(t)&&Pae.has(t.tagName),toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes,bold:!0},s)))}}),zae=$r({name:"italic-element",match:t=>yn(t)&&Lae.has(t.tagName),toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes,italic:!0},s)))}}),Wae=$r({name:"code-element",match:t=>yn(t)&&t.tagName==="code",toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes,code:!0},s)))}}),jae=$r({name:"del-element",match:t=>yn(t)&&t.tagName==="del",toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes,strike:!0},s)))}}),Yae=$r({name:"underline-element",match:t=>yn(t)&&t.tagName==="u",toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes,underline:!0},s)))}}),Gae=$r({name:"mark-element",match:t=>yn(t)&&t.tagName==="mark",toDelta:(t,e)=>{if(!yn(t))return[];const{toDelta:n,options:r}=e;return t.children.flatMap(i=>n(i,r).map(s=>(s.attributes={...s.attributes},s)))}}),Vae=$r({name:"li-element",match:t=>yn(t)&&t.tagName==="li"&&!!H.querySelector(t,".checkbox"),toDelta:(t,e)=>{if(!yn(t)||!H.querySelector(t,".checkbox"))return[];const{toDelta:n,options:r}=e,i=H.querySelector(t,".checkbox"),s=t.children.findIndex(o=>o===i);return t.children.slice(s+2).flatMap(o=>n(o,r))}}),qae=$r({name:"br-element",match:t=>yn(t)&&t.tagName==="br",toDelta:()=>[{insert:`
`}]}),Xae=$r({name:"style-element",match:t=>yn(t)&&t.tagName==="style",toDelta:()=>[]}),Kae=[hae,xae,[Fae,Uae,Hae,zae,Wae,jae,Yae,Gae,$ae,Vae,qae,Xae],kae,Nae].flat(),KN=t=>t.type==="element",Qae=Si({name:"link-element",match:t=>KN(t)&&t.tagName==="a",toDelta:(t,e)=>{var n,r,i,s;if(!KN(t))return[];const o=(n=t.properties)==null?void 0:n.href;if(typeof o!="string")return[];const{configs:a}=e,l=(r=a.get("docLinkBaseUrl"))!=null?r:"";if(l&&o.startsWith(l)){const u=o.substring(l.length).match(/^\/([^?]+)(\?.*)?$/);if(u){const d=u==null?void 0:u[1],h=u==null?void 0:u[2],f=h?new URLSearchParams(h):void 0,p=f==null?void 0:f.get("mode"),g=(i=f==null?void 0:f.get("blockIds"))==null?void 0:i.split(","),b=(s=f==null?void 0:f.get("elementIds"))==null?void 0:s.split(",");return[{insert:" ",attributes:{reference:{type:"LinkedPage",pageId:d,params:{mode:p&&["edgeless","page"].includes(p)?p:void 0,blockIds:g,elementIds:b}}}}]}}return t.children.flatMap(c=>e.toDelta(c,{trim:!1}).map(u=>(o.startsWith("http")&&(u.attributes={...u.attributes,link:o}),u)))}}),Zae=so({name:"link",match:t=>{var e;return!!((e=t.attributes)!=null&&e.link)},toAST:(t,e)=>{var n;const r={type:"text",value:t.insert},i=(n=t.attributes)==null?void 0:n.link;return i?{type:"element",tagName:"a",properties:{href:i},children:[r]}:r}}),Jae=Jo({name:"link",match:t=>{var e;return!!((e=t.attributes)!=null&&e.link)},toAST:(t,e)=>{var n;const r={type:"text",value:t.insert},i=(n=t.attributes)==null?void 0:n.link;if(!i)return r;const{current:s}=e;if("value"in s){if(s.value==="")return{type:"text",value:i};if(r.value!==i)return{type:"link",url:i,children:[s]}}return r}}),ele=ds({name:"link",match:t=>t.type==="link",toDelta:(t,e)=>{var n,r,i;if(!("children"in t)||!("url"in t))return[];const{configs:s}=e,o=(n=s.get("docLinkBaseUrl"))!=null?n:"";if(o&&t.url.startsWith(o)){const l=t.url.substring(o.length).match(/^\/([^?]+)(\?.*)?$/);if(l){const c=l==null?void 0:l[1],u=l==null?void 0:l[2],d=u?new URLSearchParams(u):void 0,h=d==null?void 0:d.get("mode"),f=(r=d==null?void 0:d.get("blockIds"))==null?void 0:r.split(","),p=(i=d==null?void 0:d.get("elementIds"))==null?void 0:i.split(",");return[{insert:" ",attributes:{reference:{type:"LinkedPage",pageId:c,params:{mode:h&&["edgeless","page"].includes(h)?h:void 0,blockIds:f,elementIds:p}}}}]}}return t.children.flatMap(a=>e.toDelta(a).map(l=>(l.attributes={...l.attributes,link:t.url},l)))}}),QN=t=>t.type==="element",tle=$r({name:"link-element",match:t=>QN(t)&&t.tagName==="a",toDelta:(t,e)=>{var n;if(!QN(t))return[];const r=(n=t.properties)==null?void 0:n.href;if(typeof r!="string")return[];const{toDelta:i,options:s}=e;return t.children.flatMap(o=>i(o,s).map(a=>{if(s.pageMap){const l=s.pageMap.get(decodeURIComponent(r));if(l)return a.attributes={...a.attributes,reference:{type:"LinkedPage",pageId:l}},a.insert=" ",a}return r.startsWith("http")&&(a.attributes={...a.attributes,link:r}),a}))}}),nle=cE({name:"link",match:t=>{var e;return!!((e=t.attributes)!=null&&e.link)},toAST:t=>{var e;const n=t.insert,r={content:n},i=(e=t.attributes)==null?void 0:e.link;return i?{content:`${n?`${n}: `:""}${i}`}:r}}),rle=Jo({name:"footnote-reference",match:t=>{var e;return!!((e=t.attributes)!=null&&e.footnote)},toAST:(t,e)=>{var n;const r={type:"text",value:t.insert},i=(n=t.attributes)==null?void 0:n.footnote;if(!i)return r;const s=`${ia}${i.label}`,{configs:o}=e;if(!o.has(s)){const a={...i.reference};a.url&&(a.url=encodeURIComponent(a.url)),a.favicon&&(a.favicon=encodeURIComponent(a.favicon)),o.set(s,JSON.stringify(a))}return{type:"footnoteReference",label:i.label,identifier:i.label}}}),ile=ds({name:"footnote-reference",match:t=>t.type==="footnoteReference",toDelta:(t,e)=>{var n;if(t.type!=="footnoteReference")return[];try{const{configs:r}=e,i=`${ia}${t.identifier}`,s=r.get(i);if(!s)return[];const o=JSON.parse(s);o.url&&(o.url=decodeURIComponent(o.url)),o.favicon&&(o.favicon=decodeURIComponent(o.favicon));const a=Xs.parse(o),{type:l,fileName:c,fileType:u}=a;if(l==="attachment"&&c&&!u){const h=(n=c.split(".").pop())==null?void 0:n.toLowerCase();h&&(a.fileType=h)}return[{insert:" ",attributes:{footnote:{label:t.identifier,reference:a}}}]}catch{return[]}}});function sle(t){try{return new URL(t),!0}catch{return!1}}function ole(t){return t.replace(/([^\s]+?)(\[\^[^\]]+\])(?!:)/g,(e,n,r)=>sle(n)?n+" "+r:e)}const ale=xm({name:"footnote-reference",levels:["block","slice","doc"],preprocess:t=>ole(t)}),lle=Jo({name:"inlineLatex",match:t=>{var e;return!!((e=t.attributes)!=null&&e.latex)},toAST:t=>{var e;const n={type:"text",value:t.insert};return(e=t.attributes)!=null&&e.latex?{type:"inlineMath",value:t.attributes.latex}:n}}),cle=ds({name:"inlineMath",match:t=>t.type==="inlineMath",toDelta:t=>"value"in t?[{insert:" ",attributes:{latex:t.value}}]:[]}),ule=cE({name:"inlineLatex",match:t=>{var e;return!!((e=t.attributes)!=null&&e.latex)},toAST:t=>{var e,n;const r={content:t.insert};return(e=t.attributes)!=null&&e.latex?{content:(n=t.attributes)==null?void 0:n.latex}:r}}),EE=$e({viewId:pe(),type:_r("kanban")}),ZN=$e({selectionType:_r("cell"),groupKey:pe(),cardId:pe(),columnId:pe(),isEditing:Ba()}),JN=$e({groupKey:pe(),cardId:pe()}),eO=$e({selectionType:_r("card"),cards:s0([JN]).rest(JN)}),tO=$e({selectionType:_r("group"),groupKeys:s0([pe()]).rest(pe())});ko([ZN,eO,tO]);const dle=ko([tc(EE,ZN),tc(EE,eO),tc(EE,tO)]),nO=$e({viewId:pe(),type:_r("table")}),rO=$e({start:dn(),end:dn()}),hle=$e({rowIndex:dn(),columnIndex:dn()}),iO=$e({selectionType:_r("area"),groupKey:pe().optional(),rowsSelection:rO,columnsSelection:rO,focus:hle,isEditing:Ba()}),fle=$e({id:pe(),groupKey:pe().optional()}),sO=$e({selectionType:_r("row"),rows:ec(fle)});ko([iO,sO]);const ple=ko([tc(nO,iO),tc(nO,sO)]),mle={group:Ic,connector:Mt,shape:pt,brush:al,text:ei,mindmap:eh,highlighter:ll};class oO extends nd{constructor(e){super(),this.gfx=e,this._renderer=null}static setup(e){if(!this.overlayName)throw new V(re.ValueNotExists,`The overlay constructor '${this.name}' should have a static 'overlayName' property.`);e.addImpl(gle(this.overlayName),this,[Tb])}clear(){this.refresh()}dispose(){}refresh(){this._renderer&&this._renderer.refresh()}setRenderer(e){this._renderer=e}}oO.overlayName="";const gle=Me("Overlay");class aO{}const lO=Me("elementToMarkdownAdapterMatcher");function Xc(t){const e=lO(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class ble extends aO{constructor(e){super(),this.elementModelMatchers=e}fromElementModel(e,n){for(const i of this.elementModelMatchers)if(i.match(e))return i.toAST(e,n);return null}}Rt({flavour:"affine:surface",toMatch:()=>!1,fromMatch:t=>t.node.flavour==="affine:surface",toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{e.walkerContext.skipAllChildren()}}});const yle=Rt({flavour:"affine:surface",toMatch:()=>!1,fromMatch:t=>t.node.flavour==="affine:surface",toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,provider:r}=e;if(!r){e.walkerContext.skipAllChildren();return}const i=Array.from(r.getAll(lO).values()),s=new ble(i);if("elements"in t.node.props){const o=t.node.props.elements,a=Object.entries(o).filter(([l,c])=>c.type==="mindmap").map(([l,c])=>Oy(c));n.setGlobalContext("surface:mindMap:nodeMapArray",a),Object.entries(t.node.props.elements).forEach(([l,c])=>{const u=s.fromElementModel(c,{walkerContext:n,elements:o});u&&n.openNode(u,"children").closeNode()})}}}}),cO=Me("elementToPlainTextAdapterMatcher");function Kc(t){const e=cO(t.name);return{setup:n=>{n.addImpl(e,()=>t)},identifier:e}}class _le extends aO{constructor(e){super(),this.elementModelMatchers=e}fromElementModel(e,n){var r,i;for(const s of this.elementModelMatchers)if(s.match(e))return(i=(r=s.toAST(e,n))==null?void 0:r.content)!=null?i:"";return""}}gn({flavour:"affine:surface",toMatch:()=>!1,fromMatch:t=>t.node.flavour==="affine:surface",toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{e.walkerContext.skipAllChildren()}}});const xle=[gn({flavour:"affine:surface",toMatch:()=>!1,fromMatch:t=>t.node.flavour==="affine:surface",toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,provider:r}=e;if(!r){e.walkerContext.skipAllChildren();return}const i=Array.from(r.getAll(cO).values()),s=new _le(i);if("elements"in t.node.props){const o=t.node.props.elements,a=Object.entries(o).filter(([l,c])=>c.type==="mindmap").map(([l,c])=>Oy(c));n.setGlobalContext("surface:mindMap:nodeMapArray",a),Object.entries(t.node.props.elements).forEach(([l,c])=>{const u=s.fromElementModel(c,{walkerContext:n,elements:o});u&&(e.textBuffer.content+=u+`
`)})}}}}),yle],uO=Me("surface-middleware");function dO(t,e){return{setup:n=>{n.addImpl(uO(t),{middleware:e})}}}class Ele extends sp{_elementToJSON(e){const n={};return e.forEach((r,i)=>{n[i]=this._toJSON(r)}),n}_fromJSON(e){if(e instanceof Object){if(Reflect.has(e,vb)){const n=new gt;return n.applyDelta(Reflect.get(e,"delta")),n}else if(Reflect.has(e,wb)){const n=new at,r=Reflect.get(e,"json");return Object.entries(r).forEach(([i,s])=>{n.set(i,s)}),n}}return e}_toJSON(e){return e instanceof gt?{[vb]:!0,delta:e.toDelta()}:e instanceof at?{[wb]:!0,json:e.toJSON()}:e}elementFromJSON(e){const n=new at;return Object.entries(e).forEach(([r,i])=>{n.set(r,this._fromJSON(i))}),n}async fromSnapshot(e){const n=await super.fromSnapshot(e),r=n.props.elements,i=new at;Object.entries(r).forEach(([o,a])=>{const l=this.elementFromJSON(a);i.set(o,l)});const s=this._internal.Boxed(i);return n.props={elements:s},n}toSnapshot(e){const n=super.toSnapshot(e),r=e.model.props.elements.getValue(),i={},s=this.transformerConfigs.get("selectedElements");return r&&r.forEach((o,a)=>{(s!=null&&s.has(a)||!s)&&(i[a]=this._elementToJSON(o))}),n.props={elements:i},n}}const hO=Zt({flavour:"affine:surface",props:t=>({elements:t.Boxed(new at)}),metadata:{version:5,role:"hub",parent:["@root"],children:["affine:frame","affine:image","affine:bookmark","affine:attachment","affine:embed-*","affine:edgeless-text"]},transformer:t=>new Ele(t),toModel:()=>new wle}),vle=bt(hO);class wle extends hc{constructor(){super(...arguments),this._disposables=new hn}_init(){this._extendElement(mle),super._init(),this.store.provider.getAll(uO).forEach(({middleware:e})=>{this._disposables.add(e(this))})}getConnectors(e){return this.getElementsByType("connector").filter(r=>{var i,s;return((i=r.source)==null?void 0:i.id)===e||((s=r.target)==null?void 0:s.id)===e})}getElementsByType(e){return super.getElementsByType(e)}}function kle(t,e){return[t[0][1],t[1][1],e[0][1],e[1][1]].every(n=>Je(n,t[0][1],.02))?uu(t,e,0):[t[0][0],t[1][0],e[0][0],e[1][0]].every(n=>Je(n,t[0][0],.02))?uu(t,e,1):!1}function vE(t,e){return Je(t[0],e[0])&&Je(t[1],e[1])}class Tle{constructor(e,n=[],r=[],i=[]){this.points=e,this.blocks=n,this.expandedBlocks=r,this.excludedPoints=i,this._xMap=new Map,this._yMap=new Map;const s=this._xMap,o=this._yMap;this.points.forEach(a=>{var l,c;const[u,d]=a;s.has(u)||s.set(u,[]),o.has(d)||o.set(d,[]),(l=s.get(u))==null||l.push(a),(c=o.get(d))==null||c.push(a)})}_canSkipBlock(e){return this.excludedPoints.some(n=>vE(e,n))}_isBlock(e,n){return this.blocks.some(r=>{const i=Ri(e,n,r.points);return(i==null?void 0:i.length)===2||r.isPointInBound(e,0)||r.isPointInBound(n,0)||[r.leftLine,r.upperLine,r.rightLine,r.lowerLine].some(s=>kle(s,[e,n]))})||this.expandedBlocks.some(r=>{const i=Ri(e,n,r.expand(-.5).points);return(i==null?void 0:i.length)===2})}neighbors(e){const[n,r]=e,i=new Set,s=this._xMap.get(n),o=this._yMap.get(r);if(s){let a=1/0,l=1/0,c,u;s.forEach(d=>{if(vE(d,e))return;const h=d[1]-e[1];h>0&&h<a&&(a=h,c=d),h<0&&Math.abs(h)<l&&(l=Math.abs(h),u=d)}),c&&(this._canSkipBlock(c)||!this._isBlock(e,c))&&i.add(c),u&&(this._canSkipBlock(u)||!this._isBlock(e,u))&&i.add(u)}if(o){let a=1/0,l=1/0,c,u;o.forEach(d=>{if(vE(d,e))return;const h=d[0]-e[0];h>0&&h<a&&(a=h,c=d),h<0&&Math.abs(h)<l&&(l=Math.abs(h),u=d)}),c&&(this._canSkipBlock(c)||!this._isBlock(e,c))&&i.add(c),u&&(this._canSkipBlock(u)||!this._isBlock(e,u))&&i.add(u)}return Array.from(i)}}class Sle{constructor(e){this._compare=e,this.heap=[]}bubbleDown(){let e=0;const n=this.heap.length,r=this.heap[0];for(;;){const i=2*e+1,s=2*e+2;let o=-1,a,l;if(i<n&&(a=this.heap[i],this._compare(a.priority,r.priority)<0&&(o=i)),s<n&&(a=this.heap[i],l=this.heap[s],(o===null&&this._compare(l.priority,r.priority)<0||o!==null&&this._compare(l.priority,a.priority)<0)&&(o=s)),o===-1)break;this.heap[e]=this.heap[o],this.heap[o]=r,e=o}}bubbleUp(e=this.heap.length-1){const n=this.heap[e];for(;e>0;){const r=Math.floor((e-1)/2),i=this.heap[r];if(this._compare(i.priority,n.priority)<=0)break;this.heap[r]=n,this.heap[e]=i,e=r}}dequeue(){var e;const n=this.heap[0],r=this.heap.pop();return this.heap.length>0&&r&&(this.heap[0]=r,this.bubbleDown()),(e=n==null?void 0:n.value)!=null?e:null}empty(){return this.heap.length===0}enqueue(e,n){const r={value:e,priority:n};this.heap.push(r),this.bubbleUp()}}function fO(t){return t==null}function Cle(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])}function pO(t,e){return t[2]+.01<e[2]?-1:t[2]-.01>e[2]?1:t[0]<e[0]?-1:t[0]>e[0]?1:t[1]>e[1]?-1:t[1]<e[1]?1:0}function Ale(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])}function Ile(t,e,n){return Je(t[0],e[0])&&Je(t[0],n[0])||Je(t[1],e[1])&&Je(t[1],n[1])?0:1}function Tm(t,e){return Je(t[0],e[0],.02)&&Je(t[1],e[1],.02)}class Mle{constructor(e,n,r,i,s,o=[],a=[]){this._sp=n,this._ep=r,this._originalSp=i,this._originalEp=s,this._cameFrom=new Map,this._complete=!1,this._costSoFar=new Map,this._current=null,this._diagonalCount=new Map,this._pointPriority=new Map,this._sp[2]=0,this._ep[2]=0,this._originalEp[2]=0,this._graph=new Tle([...e],o,a),this._init()}get path(){const e=[];let n=this._complete?this._originalEp:this._current;const r=[0];for(;n;){e.unshift(n);const i=this._cameFrom.get(n);if(!i)return e;const s=r.shift();if(fO(s))break;r.push(i.indexs[s]),n=i.from[s]}return e}_init(){this._cameFrom.set(this._sp,{from:[this._originalSp],indexs:[-1]}),this._cameFrom.set(this._originalSp,{from:[],indexs:[]}),this._costSoFar.set(this._sp,[0]),this._diagonalCount.set(this._sp,[0]),this._pointPriority.set(this._sp,[0]),this._frontier=new Sle(pO),this._frontier.enqueue(this._sp,[0,0,0])}_neighbors(e){const n=this._graph.neighbors(e),r=this._cameFrom.get(e);return r&&r.from.forEach(i=>{const s=n.findIndex(o=>Tm(o,i));s>=0&&n.splice(s,1)}),e===this._ep&&n.push(this._originalEp),n}reset(){this._cameFrom.clear(),this._costSoFar.clear(),this._diagonalCount.clear(),this._pointPriority.clear(),this._complete=!1,this._init()}run(){for(;!this._complete;)this.step()}step(){var e,n,r,i;if(this._complete)return;this._current=this._frontier.dequeue();const s=this._current;if(!s){this._complete=!0;return}s===this._ep&&Tm(this._ep,this._originalEp)&&(this._originalEp=this._ep);const o=this._neighbors(s);for(let a=0;a<o.length;a++){const l=o[a],c=this._costSoFar.get(s),u=this._diagonalCount.get(s),d=this._pointPriority.get(s),h=this._cameFrom.get(s);if(!c||!u||!d||!h)continue;const f=c.map(M=>M+Cle(s,l)),p=u.map((M,B)=>M+Ile(l,s,h.from[B]));if(fO(l[2]))continue;const g=d.map(M=>M+l[2]);let b=-1;if(f.length===1)b=0;else{const M=mO(f,(B,$)=>B+.01<$,(B,$)=>Je(B,$,.02));if(M.length===1)b=M[0];else{const B=M.map(se=>p[se]),$=mO(B,(se,be)=>se<be,(se,be)=>se===be);if($.length===1)b=M[$[0]];else{const se=$.map(_e=>g[M[_e]]);b=Dle(se,(_e,we)=>_e>we,(_e,we)=>_e===we)[0]}}}const _=!this._costSoFar.has(l),y=(e=this._costSoFar.get(l))!=null?e:[],x=(n=this._diagonalCount.get(l))!=null?n:[],E=(r=this._pointPriority.get(l))!=null?r:[],I=(i=this._cameFrom.get(l))!=null?i:{from:[],indexs:[]};y.push(f[b]),x.push(p[b]),E.push(g[b]),I.from.push(s),I.indexs.push(b);const v=p[b],N=g[b],L=f[b];this._costSoFar.set(l,y),this._diagonalCount.set(l,x),this._pointPriority.set(l,E),this._cameFrom.set(l,I);const z=[v,N,L+Ale(l,this._ep)];if(_)this._frontier.enqueue(l,z);else{const M=this._frontier.heap.findIndex($=>$.value===l),B=this._frontier.heap[M];B?pO(z,B.priority)<0&&(B.priority=z,this._frontier.bubbleUp(M)):this._frontier.enqueue(l,z)}if(Tm(s,this._ep)&&Tm(l,this._originalEp)){this._originalEp=l,this._complete=!0;return}}}}function mO(t,e,n){let r=1/0,i=[];for(let s=0;s<t.length;s++){const o=t[s];e(o,r)?(r=o,i=[s]):n(o,r)&&i.push(s)}return i}function Dle(t,e,n){let r=-1/0,i=[];for(let s=0;s<t.length;s++){const o=t[s];e(o,r)?(r=o,i=[s]):n(o,r)&&i.push(s)}return i}const gO=t=>({flavour:Vo.model.flavour,toMatch:()=>!1,fromMatch:e=>e.node.flavour===Vo.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(e,n)=>{e.node.props.displayMode===t&&n.walkerContext.skipAllChildren()}}}),Nle=gO(ft.EdgelessOnly),Ole=gO(ft.DocOnly),Ple=In(Nle),Lle=In(Ole),bO=t=>t.type==="root",Rle=(t,e)=>({type:"footnoteDefinition",label:t,identifier:t,children:[{type:"paragraph",children:[{type:"text",value:e}]}]}),yO=t=>({flavour:Vo.model.flavour,toMatch:e=>bO(e.node),fromMatch:e=>e.node.flavour===Vo.model.flavour,toBlockSnapshot:{enter:(e,n)=>{if(!bO(e.node))return;const r=e.node,{configs:i}=n;r.children.forEach(o=>{var a,l;if(ra(o)){const c=o.identifier,u=`${ia}${c}`,d=(l=(a=o.children.find(h=>h.type==="paragraph"))==null?void 0:a.children.find(h=>h.type==="text"))==null?void 0:l.value;d&&i.set(u,d)}});const s=r.children.findIndex(o=>ra(o));s!==-1&&r.children.splice(s,0,{type:"heading",depth:6,data:{collapsed:!0},children:[{type:"text",value:"Sources"}]})}},fromBlockSnapshot:{enter:(e,n)=>{e.node.props.displayMode===t&&n.walkerContext.skipAllChildren()},leave:(e,n)=>{const{walkerContext:r,configs:i}=n;Array.from(i.keys()).filter(s=>s.startsWith(ia)).forEach(s=>{if(!!r.getGlobalContext(s))return;const a=i.get(s),l=s.slice(ia.length);a&&l&&(r.openNode(Rle(l,a),"children").closeNode(),r.setGlobalContext(s,!0))})}}}),Ble=yO(ft.EdgelessOnly),Fle=yO(ft.DocOnly),Ule=Rt(Ble),$le=Rt(Fle),_O=t=>({flavour:Vo.model.flavour,toMatch:()=>!1,fromMatch:e=>e.node.flavour===Vo.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(e,n)=>{e.node.props.displayMode===t&&n.walkerContext.skipAllChildren()}}}),Hle=_O(ft.EdgelessOnly),zle=_O(ft.DocOnly),Wle=gn(Hle),jle=gn(zle),Yle=[Ule,Ple,Wle],Gle=[$le,Lle,jle],Vle=new Set(["p","h1","h2","h3","h4","h5","h6","blockquote","body","div","span","footer"]),qle=(t,e)=>{let n=t.parent;for(;n;){if(H.isElement(n.node)&&e.includes(n.node.tagName))return!0;n=n.parent}return!1},Xle={flavour:Js.model.flavour,toMatch:t=>H.isElement(t.node)&&Vle.has(t.node.tagName),fromMatch:t=>t.node.flavour===Js.model.flavour,toBlockSnapshot:{enter:(t,e)=>{var n;if(!H.isElement(t.node))return;const{walkerContext:r,deltaConverter:i}=e;switch(t.node.tagName){case"blockquote":{r.setGlobalContext("hast:blockquote",!0);const s=H.getTextChildren(t.node),o=s.every(a=>!a.value.trim());s&&!o&&r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"quote",text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(H.getTextChildrenOnlyAst(t.node))}},children:[]},"children").closeNode();break}case"body":case"div":case"span":case"footer":{((n=t.parent)==null?void 0:n.node.type)==="element"&&!qle(t,["p","li"])&&H.isParagraphLike(t.node)&&(r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children").closeNode(),r.skipAllChildren());break}case"p":{r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:r.getGlobalContext("hast:blockquote")?"quote":"text",text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children");break}case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":{r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:t.node.tagName,text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children").closeNode(),r.skipAllChildren();break}}},leave:(t,e)=>{var n,r,i,s;if(!H.isElement(t.node))return;const{walkerContext:o}=e;switch(t.node.tagName){case"div":{((n=t.parent)==null?void 0:n.node.type)==="element"&&t.parent.node.tagName!=="li"&&Array.isArray((r=t.node.properties)==null?void 0:r.className)&&(t.node.properties.className.includes("affine-paragraph-block-container")||t.node.properties.className.includes("affine-block-children-container")||t.node.properties.className.includes("indented"))&&o.closeNode();break}case"blockquote":{o.setGlobalContext("hast:blockquote",!1);break}case"p":{if(((i=t.next)==null?void 0:i.type)==="element"&&t.next.tagName==="div"&&Array.isArray((s=t.next.properties)==null?void 0:s.className)&&(t.next.properties.className.includes("affine-block-children-container")||t.next.properties.className.includes("indented")))break;o.closeNode();break}}}},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=(n=t.node.props.text)!=null?n:{delta:[]},{walkerContext:i,deltaConverter:s}=e;switch(t.node.props.type){case"text":{i.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"p",properties:{},children:s.deltaToAST(r.delta)},"children").closeNode().openNode({type:"element",tagName:"div",properties:{className:["affine-block-children-container"],style:"padding-left: 26px;"},children:[]},"children");break}case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":{i.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:t.node.props.type,properties:{},children:s.deltaToAST(r.delta)},"children").closeNode().openNode({type:"element",tagName:"div",properties:{className:["affine-block-children-container"],style:"padding-left: 26px;"},children:[]},"children");break}case"quote":{i.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"blockquote",properties:{className:["quote"]},children:[]},"children").openNode({type:"element",tagName:"p",properties:{},children:s.deltaToAST(r.delta)},"children").closeNode().closeNode().openNode({type:"element",tagName:"div",properties:{className:["affine-block-children-container"],style:"padding-left: 26px;"},children:[]},"children");break}}},leave:(t,e)=>{const{walkerContext:n}=e;n.closeNode().closeNode()}}},Kle=In(Xle),Qle=new Set(["paragraph","heading","blockquote"]),Zle=t=>Qle.has(t.type),Jle={flavour:Js.model.flavour,toMatch:t=>Zle(t.node)&&!Mh(t.node),fromMatch:t=>t.node.flavour===Js.model.flavour,toBlockSnapshot:{enter:(t,e)=>{var n;const{walkerContext:r,deltaConverter:i}=e;switch(t.node.type){case"paragraph":{r.setGlobalContext(rE,!0),r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children").closeNode();break}case"heading":{const s=!!((n=t.node.data)!=null&&n.collapsed);r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:`h${t.node.depth}`,collapsed:s,text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children").closeNode();break}case"blockquote":{if(Mh(t.node))return;r.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"quote",text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(t.node)}},children:[]},"children").closeNode(),r.skipAllChildren();break}}},leave:(t,e)=>{if(t.node.type==="paragraph"){const{walkerContext:n}=e;n.setGlobalContext(rE,!1)}}},fromBlockSnapshot:{enter:(t,e)=>{var n,r;const{walkerContext:i,deltaConverter:s}=e,o=(n=i.getGlobalContext("affine:paragraph:depth"))!=null?n:0,a=(r=t.node.props.text)!=null?r:{delta:[]};switch(t.node.props.type){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":{i.openNode({type:"heading",depth:parseInt(t.node.props.type[1]),children:s.deltaToAST(a.delta,o)},"children").closeNode();break}case"text":{i.openNode({type:"paragraph",children:s.deltaToAST(a.delta,o)},"children").closeNode();break}case"quote":{i.openNode({type:"blockquote",children:[]},"children").openNode({type:"paragraph",children:s.deltaToAST(a.delta)},"children").closeNode().closeNode();break}}i.setGlobalContext("affine:paragraph:depth",o+1)},leave:(t,e)=>{const{walkerContext:n}=e;n.setGlobalContext("affine:paragraph:depth",n.getGlobalContext("affine:paragraph:depth")-1)}}},ece=Rt(Jle),tce=new Set(["p","h1","h2","h3","h4","h5","h6","blockquote","div","span","figure"]),nce=".collection-title",rce=".link-to-page",ice=".callout",sce=".checkbox",oce={flavour:Js.model.flavour,toMatch:t=>H.isElement(t.node)&&tce.has(t.node.tagName),fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n,deltaConverter:r,pageMap:i}=e;switch(t.node.tagName){case"blockquote":{n.setGlobalContext("hast:blockquote",!0),n.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"quote",text:{"$blocksuite:internal:text$":!0,delta:r.astToDelta(H.getInlineOnlyElementAST(t.node),{pageMap:i,removeLastBr:!0})}},children:[]},"children");break}case"p":{if(!t.node.properties.id)break;n.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:n.getGlobalContext("hast:blockquote")?"quote":"text",text:{"$blocksuite:internal:text$":!0,delta:r.astToDelta(t.node,{pageMap:i})}},children:[]},"children");break}case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":{if(H.querySelector(t.node,nce))break;n.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:t.node.tagName,text:{"$blocksuite:internal:text$":!0,delta:r.astToDelta(t.node,{pageMap:i})}},children:[]},"children").closeNode();break}case"figure":if(H.querySelector(t.node,rce)){n.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"text",text:{"$blocksuite:internal:text$":!0,delta:r.astToDelta(t.node,{pageMap:i})}},children:[]},"children").closeNode(),n.skipAllChildren();break}if(H.querySelector(t.node,ice)){const s=H.getElementChildren(t.node)[0],o=H.getElementChildren(t.node)[1],a=H.querySelector(s,".icon"),l=a?H.getTextContent(a):"";n.openNode({type:"block",id:K(),flavour:"affine:paragraph",props:{type:"quote",text:{"$blocksuite:internal:text$":!0,delta:[{insert:l+`
`},...r.astToDelta(o,{pageMap:i})]}},children:[]},"children").closeNode(),n.skipAllChildren();break}}},leave:(t,e)=>{var n,r,i,s;if(!H.isElement(t.node))return;const{walkerContext:o}=e;switch(t.node.tagName){case"div":{((n=t.parent)==null?void 0:n.node.type)==="element"&&!(t.parent.node.tagName==="li"&&H.querySelector(t.parent.node,sce))&&Array.isArray((r=t.node.properties)==null?void 0:r.className)&&t.node.properties.className.includes("indented")&&o.closeNode();break}case"blockquote":{o.closeNode(),o.setGlobalContext("hast:blockquote",!1);break}case"p":{if(!t.node.properties.id||((i=t.next)==null?void 0:i.type)==="element"&&t.next.tagName==="div"&&Array.isArray((s=t.next.properties)==null?void 0:s.className)&&t.next.properties.className.includes("indented"))break;o.closeNode();break}}}},fromBlockSnapshot:{}},ace=fr(oce),lce={flavour:Js.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Js.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=(n=t.node.props.text)!=null?n:{delta:[]},{deltaConverter:i}=e,s=i.deltaToAST(r.delta).join("");e.textBuffer.content+=s,e.textBuffer.content+=`
`}}},cce=gn(lce);function Qc(t,{toMatch:e=()=>!1,fromMatch:n=s=>s.node.flavour===t,toBlockSnapshot:r={},fromBlockSnapshot:i={enter:(s,o)=>{const{walkerContext:a}=o;typeof s.node.props.title!="string"||typeof s.node.props.url!="string"||a.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"a",properties:{href:s.node.props.url},children:[{type:"text",value:s.node.props.title}]},"children").closeNode().closeNode()}}}=Object.create(null)){return{flavour:t,toMatch:e,fromMatch:n,toBlockSnapshot:r,fromBlockSnapshot:i}}function Zc(t,{toMatch:e=()=>!1,fromMatch:n=s=>s.node.flavour===t,toBlockSnapshot:r={},fromBlockSnapshot:i={enter:(s,o)=>{const{walkerContext:a}=o;typeof s.node.props.title!="string"||typeof s.node.props.url!="string"||a.openNode({type:"paragraph",children:[]},"children").openNode({type:"link",url:s.node.props.url,children:[{type:"text",value:s.node.props.title}]},"children").closeNode().closeNode()}}}={}){return{flavour:t,toMatch:e,fromMatch:n,toBlockSnapshot:r,fromBlockSnapshot:i}}function Jc(t,{toMatch:e=()=>!1,fromMatch:n=s=>s.node.flavour===t,toBlockSnapshot:r={},fromBlockSnapshot:i={enter:(s,o)=>{const{textBuffer:a}=o;if(typeof s.node.props.title!="string"||typeof s.node.props.url!="string")return;const l=`[${s.node.props.title}](${s.node.props.url})`;l.length>0&&(a.content+=l,a.content+=`
`)}}}={}){return{flavour:t,toMatch:e,fromMatch:n,toBlockSnapshot:r,fromBlockSnapshot:i}}const uce=Qc(kc.model.flavour),dce=In(uce),hce=Zc(kc.model.flavour),fce=Rt(hce);function Sm(t,e,{toMatch:n=o=>{var a;const l=H.isElement(o.node)&&o.node.tagName==="figure",c=H.querySelector(o.node,".source");if(!l||!c)return!1;const u=(a=H.querySelector(c,"a"))==null?void 0:a.properties.href;return!u||typeof u!="string"||u.length>1e3?!1:e.test(u)},fromMatch:r=o=>o.node.flavour===t,toBlockSnapshot:i={enter:(o,a)=>{if(!H.isElement(o.node))return;const{assets:l,walkerContext:c}=a;if(!l)return;const u=H.querySelector(o.node,".source");if(!u)return;let d="";const h=H.querySelector(u,"a");d=typeof(h==null?void 0:h.properties.href)=="string"?h.properties.href:"",d&&(c.openNode({type:"block",id:K(),flavour:t,props:{url:d},children:[]},"children").closeNode(),c.skipAllChildren())}},fromBlockSnapshot:s={}}=Object.create(null)){return{flavour:t,toMatch:n,fromMatch:r,toBlockSnapshot:i,fromBlockSnapshot:s}}const pce=/https:\/\/[\w.-]+\.?figma.com\/([\w-]+)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/,mce=Sm(kc.model.flavour,pce),gce=fr(mce),bce=Jc(kc.model.flavour),yce=gn(bce),_ce=Qc(Tc.model.flavour),xce=In(_ce),Ece=Zc(Tc.model.flavour),vce=Rt(Ece),wce=/^(?:https?:\/\/)?(?:www\.)?github\.com\/([^/]+)\/([^/]+)\/(issue|pull)s?\/(\d+)$/,kce=Sm(Tc.model.flavour,wce),Tce=fr(kce),Sce=Jc(Tc.model.flavour),Cce=gn(Sce),Ace=Qc(Up.model.flavour,{fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;typeof t.node.props.title!="string"||typeof t.node.props.url!="string"||n.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"a",properties:{href:t.node.props.url},children:[{type:"text",value:t.node.props.title}]},"children").closeNode().closeNode()}}}),Ice=In(Ace),Mce=Zc(Up.model.flavour,{fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;typeof t.node.props.title!="string"||typeof t.node.props.url!="string"||n.openNode({type:"paragraph",children:[]},"children").openNode({type:"link",url:t.node.props.url,children:[{type:"text",value:t.node.props.title}]},"children").closeNode().closeNode()}}}),Dce=Rt(Mce),Nce=Jc(Up.model.flavour,{fromBlockSnapshot:{enter:(t,e)=>{const{textBuffer:n}=e;if(typeof t.node.props.title!="string"||typeof t.node.props.url!="string")return;const r=`[${t.node.props.title}](${t.node.props.url})`;r.length>0&&(n.content+=r,n.content+=`
`)}}}),Oce=gn(Nce),Pce=[Ice,Dce,Oce];function aa(t,e){try{const n=new URL(t),{protocols:r,hostnames:i}=e;return r.includes(n.protocol)&&i.includes(n.hostname)}catch(n){return console.warn(`Invalid embed iframe url: ${t}`,n),!1}}const Lce=640,Rce=480,Bce=480,Fce=100,xO={protocols:["https:"],hostnames:["excalidraw.com"]},Uce=zc({name:"excalidraw",match:t=>aa(t,xO),buildOEmbedUrl:t=>{if(aa(t,xO))return t},useOEmbedUrlDirectly:!0,options:{widthInSurface:Lce,heightInSurface:Rce,heightInNote:Bce,widthPercent:Fce,allow:"clipboard-read; clipboard-write",style:"border: none; border-radius: 8px;",allowFullscreen:!0}}),$ce=800,Hce=600,zce=100,Wce=400,jce=["affine.pro","app.affine.pro","insider.affine.pro","affine.fail","toeverything.app","apple.getaffineapp.com"];function EO(t){try{const e=new URL(t);if(e.protocol!=="https:")return!1;const n=e.hostname.toLowerCase();return!jce.some(r=>n===r||n.endsWith(`.${r}`))}catch{return!1}}const Yce=zc({name:"generic",match:t=>EO(t),buildOEmbedUrl:t=>{if(EO(t))return t},useOEmbedUrlDirectly:!0,options:{widthInSurface:$ce,heightInSurface:Hce,widthPercent:zce,heightInNote:Wce,allowFullscreen:!0,style:"border: none; border-radius: 8px;",allow:"clipboard-read; clipboard-write; picture-in-picture;",referrerpolicy:"no-referrer-when-downgrade"}}),Gce=800,Vce=600,qce=100,Xce=600,Kce={protocols:["https:"],hostnames:["docs.google.com"]};function Qce(t){return t.searchParams.get("usp")==="sharing"}function vO(t,e=!0){try{if(!aa(t,Kce))return!1;const n=new URL(t);if(e&&!Qce(n))return!1;const r=n.pathname.split("/").filter(Boolean);return r[0]==="document"&&r[1]==="d"&&r.length>=3&&!!r[2]}catch(n){return console.warn("Invalid Google Docs URL:",n),!1}}const Zce=zc({name:"google-docs",match:t=>vO(t),buildOEmbedUrl:t=>{if(vO(t))return t},useOEmbedUrlDirectly:!0,options:{widthInSurface:Gce,heightInSurface:Vce,widthPercent:qce,heightInNote:Xce,allowFullscreen:!0,style:"border: none; border-radius: 8px;"}}),Jce=640,eue=480,tue=100,nue=480,rue="https://drive.google.com/embeddedfolderview",iue="https://drive.google.com/file/d/",sue={protocols:["https:"],hostnames:["drive.google.com"]};function oue(t){return t.searchParams.get("usp")==="sharing"}function wO(t){const e=t.pathname.split("/").filter(Boolean);return e[0]==="file"&&e[1]==="d"&&e.length>=3&&!!e[2]}function kO(t){const e=t.pathname.split("/").filter(Boolean);return e[0]==="drive"&&e[1]==="folders"&&e.length>=3&&!!e[2]}function aue(t){return t.pathname.split("/").filter(Boolean).length<2?!1:!!(wO(t)||kO(t))}function TO(t,e=!0){try{if(!aa(t,sue))return!1;const n=new URL(t);return e&&!oue(n)?!1:aue(n)}catch(n){return console.warn("Invalid Google Drive URL:",n),!1}}function lue(t){const e=new URL("preview",`${iue}${t}/`);return e.searchParams.set("usp","embed_googleplus"),e.toString()}function cue(t){const e=new URL(rue);return e.searchParams.set("id",t),e.hash="list",e.toString()}function uue(t){try{const e=new URL(t),n=e.pathname.split("/").filter(Boolean);return n.length<2?void 0:wO(e)?lue(n[2]):kO(e)?cue(n[2]):void 0}catch(e){console.warn("Failed to parse Google Drive path URL:",e);return}}const due=zc({name:"google-drive",match:t=>TO(t),buildOEmbedUrl:t=>{if(TO(t))return uue(t)},useOEmbedUrlDirectly:!0,options:{widthInSurface:Jce,heightInSurface:eue,widthPercent:tue,heightInNote:nue,allowFullscreen:!0,style:"border: none; border-radius: 8px;"}}),hue=640,fue=480,pue=480,mue=100,gue="https://miro.com/api/v1/oembed",SO={protocols:["https:"],hostnames:["miro.com"]},bue=zc({name:"miro",match:t=>aa(t,SO),buildOEmbedUrl:t=>{if(!aa(t,SO))return;const n=encodeURIComponent(t);return`${gue}?url=${n}`},useOEmbedUrlDirectly:!1,options:{widthInSurface:hue,heightInSurface:fue,heightInNote:pue,widthPercent:mue,allow:"clipboard-read; clipboard-write",style:"border: none;",allowFullscreen:!0,containerBorderRadius:0}}),yue=640,_ue=152,xue=152,Eue=100,vue="https://open.spotify.com/oembed",CO={protocols:["https:"],hostnames:["open.spotify.com","spotify.link"]},wue=[zc({name:"spotify",match:t=>aa(t,CO),buildOEmbedUrl:t=>{if(!aa(t,CO))return;const n=encodeURIComponent(t);return`${vue}?url=${n}`},useOEmbedUrlDirectly:!1,options:{widthInSurface:yue,heightInSurface:_ue,heightInNote:xue,widthPercent:Eue,allow:"autoplay; clipboard-write; encrypted-media; picture-in-picture",style:"border-radius: 8px;",allowFullscreen:!0,containerBorderRadius:12}}),due,bue,Uce,Zce,Yce],kue=Qc(Sc.model.flavour),Tue=In(kue),Sue=Zc(Sc.model.flavour),Cue=Rt(Sue),Aue=/(?:https?:\/\/)??(?:www\.)?loom\.com\/share\/([a-zA-Z0-9]+)/,Iue=Sm(Sc.model.flavour,Aue),Mue=fr(Iue),Due=Jc(Sc.model.flavour),Nue=gn(Due),Oue=Qc(Cc.model.flavour,{toMatch:t=>H.isElement(t.node)&&t.node.tagName==="iframe",toBlockSnapshot:{enter:(t,e)=>{var n;if(!H.isElement(t.node))return;const r=(n=t.node.properties)==null?void 0:n.src;if(typeof r!="string")return;const{walkerContext:i}=e;if(r.startsWith("https://www.youtube.com/embed/")){const s=r.substring(30,r.indexOf("?")!==-1?r.indexOf("?"):void 0);i.openNode({type:"block",id:K(),flavour:"affine:embed-youtube",props:{url:`https://www.youtube.com/watch?v=${s}`},children:[]},"children").closeNode()}}}}),Pue=In(Oue),Lue=Zc(Cc.model.flavour),Rue=Rt(Lue),Bue=/(?:https?:\/\/)?(?:(?:www|m)\.)?youtu\.?be(?:\.com)?\/?.*(?:watch|embed)?(?:.*v=|v\/|\/)([\w-_]+)/,Fue=Sm(Cc.model.flavour,Bue),Uue=fr(Fue),$ue=Jc(Cc.model.flavour),Hue=gn($ue);class zue{constructor(e){this._extensions=new Map,this._providerOptions=new Map,this._providerInstances=new Map,this._build=n=>{const r=this._getContextByScope(n);this._providers.forEach(i=>{let s;this._providerInstances.has(i)?s=this._providerInstances.get(i):(s=new i,this._providerInstances.set(i,s)),s.setup(r,this._providerOptions.get(i))})},this._registerToScope=(n,r)=>{let i;this._extensions.has(n)?i=this._extensions.get(n):i=new Set,(Array.isArray(r)?r:[r]).forEach(o=>{i.add(o)}),this._extensions.set(n,i)},this._getContextByScope=n=>{const r={scope:n,register:i=>(this._registerToScope(n,i),r)};return r},this._providers=new Set(e)}get(e){this._extensions.has(e)&&this._extensions.delete(e),this._build(e);const n=this._extensions.get(e);if(!n)throw new V(V.ErrorCode.ValueNotExists,`Extension scope ${e} not found`);return Array.from(n)}configure(e,n){const r=this._providerOptions.get(e);let i;typeof n=="function"?i=n(r):i=n,r!==i&&(i===void 0?this._providerOptions.delete(e):this._providerOptions.set(e,i),this._providerInstances.delete(e))}}const Wue=Me("StoreExtensionManager");class jue extends zue{get(e){const n=super.get(e),r={setup:i=>{i.addImpl(Wue,()=>this)}};return n.concat(r)}}class Yue{constructor(){this.name="BaseExtension",this.schema=$e({})}setup(e,n){n&&this.schema.parse(n)}}class it extends Yue{constructor(){super(...arguments),this.name="StoreExtension"}}const Gue={flavour:Zs.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="li",fromMatch:t=>t.node.flavour===Zs.model.flavour,toBlockSnapshot:{enter:(t,e)=>{var n,r,i,s;if(!H.isElement(t.node))return;const o=(n=t.parent)==null?void 0:n.node;let a="bulleted";o.tagName==="ol"?a="numbered":Array.isArray((r=o.properties)==null?void 0:r.className)&&(o.properties.className.includes("to-do-list")?a="todo":o.properties.className.includes("toggle")?a="toggle":o.properties.className.includes("bulleted-list")&&(a="bulleted"));const l=typeof o.properties.start=="number"?o.properties.start+o.children.indexOf(t.node):null,c=H.getElementChildren(t.node)[0];t.node=H.flatNodes(t.node,h=>h==="div"||h==="p");const{walkerContext:u,deltaConverter:d}=e;u.openNode({type:"block",id:K(),flavour:"affine:list",props:{type:a,text:{"$blocksuite:internal:text$":!0,delta:a!=="toggle"?d.astToDelta(H.getInlineOnlyElementAST(t.node)):d.astToDelta((i=H.querySelector(t.node,"summary"))!=null?i:t.node)},checked:a==="todo"?c&&Array.isArray((s=c.properties)==null?void 0:s.className)&&c.properties.className.includes("checkbox-on"):!1,collapsed:a==="toggle"?c&&c.tagName==="details"&&c.properties.open===void 0:!1,order:l},children:[]},"children")},leave:(t,e)=>{const{walkerContext:n}=e;n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=(n=t.node.props.text)!=null?n:{delta:[]},{deltaConverter:i,walkerContext:s}=e,o=s.currentNode(),a=i.deltaToAST(r.delta);t.node.props.type==="todo"&&a.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.node.props.checked},children:[{type:"element",tagName:"label",properties:{style:"margin-right: 3px;"},children:[]}]}),s.getNodeContext("affine:list:parent")===t.parent&&o.type==="element"&&o.tagName===(t.node.props.type==="numbered"?"ol":"ul")&&!(Array.isArray(o.properties.className)&&o.properties.className.includes("todo-list"))===Kn.isNullish(t.node.props.type==="todo"?t.node.props.checked:void 0)||(s.openNode({type:"element",tagName:t.node.props.type==="numbered"?"ol":"ul",properties:{style:t.node.props.type==="todo"?"list-style-type: none; padding-inline-start: 18px;":null,className:[t.node.props.type+"-list"]},children:[]},"children"),s.setNodeContext("affine:list:parent",t.parent)),s.openNode({type:"element",tagName:"li",properties:{className:["affine-list-block-container"]},children:a},"children")},leave:(t,e)=>{var n;const{walkerContext:r}=e,i=r.currentNode(),s=r.previousNode();r.getPreviousNodeContext("affine:list:parent")===t.parent&&i.tagName==="li"&&s.tagName===(t.node.props.type==="numbered"?"ol":"ul")&&!(Array.isArray(s.properties.className)&&s.properties.className.includes("todo-list"))===Kn.isNullish(t.node.props.type==="todo"?t.node.props.checked:void 0)?(r.closeNode(),(((n=t.next)==null?void 0:n.flavour)!=="affine:list"||t.next.props.type!==t.node.props.type)&&r.closeNode()):r.closeNode().closeNode()}}},Vue=In(Gue),que=new Set(["list","listItem"]),Xue=t=>que.has(t.type),Kue={flavour:Zs.model.flavour,toMatch:t=>Xue(t.node),fromMatch:t=>t.node.flavour===Zs.model.flavour,toBlockSnapshot:{enter:(t,e)=>{var n,r;const{walkerContext:i,deltaConverter:s}=e;if(t.node.type==="listItem"){const o=(n=t.parent)==null?void 0:n.node,a=o.start?o.start+o.children.indexOf(t.node):null;i.openNode({type:"block",id:K(),flavour:"affine:list",props:{type:t.node.checked!==null?"todo":o.ordered?"numbered":"bulleted",text:{"$blocksuite:internal:text$":!0,delta:t.node.children[0]&&t.node.children[0].type==="paragraph"?s.astToDelta(t.node.children[0]):[]},checked:(r=t.node.checked)!=null?r:!1,collapsed:!1,order:a},children:[]},"children"),t.node.children[0]&&t.node.children[0].type==="paragraph"&&i.skipChildren(1)}},leave:(t,e)=>{const{walkerContext:n}=e;t.node.type==="listItem"&&n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{var n;const{walkerContext:r,deltaConverter:i}=e,s=(n=t.node.props.text)!=null?n:{delta:[]},o=r.currentNode();r.getNodeContext("affine:list:parent")===t.parent&&o.type==="list"&&o.ordered===(t.node.props.type==="numbered")&&Kn.isNullish(o.children[0].checked)===Kn.isNullish(t.node.props.type==="todo"?t.node.props.checked:void 0)||r.openNode({type:"list",ordered:t.node.props.type==="numbered",spread:!1,children:[]},"children").setNodeContext("affine:list:parent",t.parent),r.openNode({type:"listItem",checked:t.node.props.type==="todo"?t.node.props.checked:void 0,spread:!1,children:[]},"children").openNode({type:"paragraph",children:i.deltaToAST(s.delta)},"children").closeNode()},leave:(t,e)=>{var n;const{walkerContext:r}=e,i=r.currentNode(),s=r.previousNode();r.getPreviousNodeContext("affine:list:parent")===t.parent&&i.type==="listItem"&&(s==null?void 0:s.type)==="list"&&s.ordered===(t.node.props.type==="numbered")&&Kn.isNullish(i.checked)===Kn.isNullish(t.node.props.type==="todo"?t.node.props.checked:void 0)?(r.closeNode(),(((n=t.next)==null?void 0:n.flavour)!=="affine:list"||t.next.props.type!==t.node.props.type)&&r.closeNode()):r.closeNode().closeNode()}}},Que=Rt(Kue),Zue=new Set(["ul","ol","li"]),Jue={flavour:Zs.model.flavour,toMatch:t=>H.isElement(t.node)&&Zue.has(t.node.tagName),fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{var n,r,i;if(!H.isElement(t.node))return;const{walkerContext:s,pageMap:o,deltaConverter:a}=e;switch(t.node.tagName){case"ul":case"ol":{s.setNodeContext("hast:list:type","bulleted"),t.node.tagName==="ol"?s.setNodeContext("hast:list:type","numbered"):Array.isArray((n=t.node.properties)==null?void 0:n.className)&&(t.node.properties.className.includes("to-do-list")?s.setNodeContext("hast:list:type","todo"):t.node.properties.className.includes("toggle")?s.setNodeContext("hast:list:type","toggle"):t.node.properties.className.includes("bulleted-list")&&s.setNodeContext("hast:list:type","bulleted"));break}case"li":{const l=H.getElementChildren(t.node)[0],c=s.getNodeContext("hast:list:type"),u=c==="toggle"?"bulleted":c;let d=[];c==="toggle"?d=a.astToDelta((r=H.querySelector(t.node,"summary"))!=null?r:t.node,{pageMap:o}):c==="todo"?d=a.astToDelta(t.node,{pageMap:o}):d=a.astToDelta(H.getInlineOnlyElementAST(t.node),{pageMap:o}),s.openNode({type:"block",id:K(),flavour:"affine:list",props:{type:u,text:{"$blocksuite:internal:text$":!0,delta:d},checked:c==="todo"?l&&Array.isArray((i=l.properties)==null?void 0:i.className)&&l.properties.className.includes("checkbox-on"):!1,collapsed:c==="toggle"?l&&l.tagName==="details"&&l.properties.open===void 0:!1},children:[]},"children");break}}},leave:(t,e)=>{const{walkerContext:n}=e;H.isElement(t.node)&&t.node.tagName==="li"&&n.closeNode()}},fromBlockSnapshot:{}},ede=fr(Jue),tde={flavour:Zs.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Zs.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=(n=t.node.props.text)!=null?n:{delta:[]},{deltaConverter:i}=e,s=i.deltaToAST(r.delta).join("");e.textBuffer.content+=s,e.textBuffer.content+=`
`}}},nde=gn(tde),rde=ko([ple,dle]),ide=$e({blockId:pe(),viewSelection:rde}),wE=class tv extends Us{get viewId(){return this.viewSelection.viewId}constructor({blockId:e,viewSelection:n}){super({blockId:e}),this.viewSelection=n}static fromJSON(e){const{blockId:n,viewSelection:r}=ide.parse(e);return new tv({blockId:n,viewSelection:r})}equals(e){return e instanceof tv?this.blockId===e.blockId:!1}toJSON(){return{type:"database",blockId:this.blockId,viewSelection:this.viewSelection}}};wE.group="note",wE.type="database";const sde=So(wE);class ode extends Qe{constructor(){super()}applyViewsUpdate(){this.store.updateBlock(this,{views:this.props.views})}deleteView(e){this.store.captureSync(),this.store.transact(()=>{this.props.views=this.props.views.filter(n=>n.id!==e)})}duplicateView(e){const n=this.store.workspace.idGenerator();return this.store.transact(()=>{const r=this.props.views.findIndex(s=>s.id===e),i=this.props.views[r];i&&this.props.views.splice(r+1,0,JSON.parse(JSON.stringify({...i,id:n})))}),n}moveViewTo(e,n){this.store.transact(()=>{this.props.views=vre(this.props.views,r=>r.id===e,r=>Ere(n,r))}),this.applyViewsUpdate()}updateView(e,n){this.store.transact(()=>{this.props.views=this.props.views.map(r=>r.id!==e?r:{...r,...n(r)})}),this.applyViewsUpdate()}}const AO=Zt({flavour:"affine:data-view",props:()=>({views:[],title:"",columns:[],cells:{}}),metadata:{role:"hub",version:1,parent:["affine:note"],children:["affine:paragraph","affine:list"]},toModel:()=>new ode}),ade=bt(AO),lde=[$o,Js,ol,Zs,Vo,es,Yo,hO,Uo,nA,Ji,rA,AO,rl,Cc,kc,Tc,QC,Qs,jo,Sc,KC,Go,eo,Pd];class cde{constructor({id:e,collection:n,doc:r,awarenessStore:i}){this._initSubDoc=()=>{let s=this.rootDoc.getMap("spaces").get(this.id);return s?(this._loaded=!1,this.rootDoc.on("subdocs",this._onSubdocEvent)):(s=new Ds({guid:this.id}),this.rootDoc.getMap("spaces").set(this.id,s),this._loaded=!0),s},this._onSubdocEvent=({loaded:s})=>{Array.from(s).find(a=>a.guid===this._ySpaceDoc.guid)&&(this.rootDoc.off("subdocs",this._onSubdocEvent),this._loaded=!0)},this._ready=!1,this.id=e,this.rootDoc=r,this.awarenessStore=i,this._ySpaceDoc=this._initSubDoc(),this._yBlocks=this._ySpaceDoc.getMap("blocks"),this._collection=n,this._storeContainer=new Q8(this)}get blobSync(){return this.workspace.blobSync}get workspace(){return this._collection}get isEmpty(){return this._yBlocks.size===0}get loaded(){return this._loaded}get meta(){return this.workspace.meta.getDocMeta(this.id)}get ready(){return this._ready}get spaceDoc(){return this._ySpaceDoc}get yBlocks(){return this._yBlocks}clear(){this._yBlocks.clear()}get removeStore(){return this._storeContainer.removeStore}_destroy(){this._ySpaceDoc.destroy(),this._loaded=!1}dispose(){this.ready&&this._yBlocks.clear()}getStore({readonly:e,query:n,provider:r,extensions:i,id:s}={}){const o=this.workspace.storeExtensions.concat(i??[]);let a;return s||e!==void 0||n?a=s:a=this.spaceDoc.guid,this._storeContainer.getStore({id:a,readonly:e,query:n,provider:r,extensions:o})}load(e){return this.ready?this:(this._ySpaceDoc.load(),e==null||e(),this._ready=!0,this)}remove(){this._destroy(),this.rootDoc.getMap("spaces").delete(this.id)}}class ude{constructor(e){this._handleDocCollectionMetaEvents=r=>{r.forEach(i=>{const s=o=>i.target===this._yMap&&i.changes.keys.has(o);(i.target===this.yDocs||i.target.parent===this.yDocs||s("pages"))&&this._handleDocMetaEvent()})},this._prevDocs=new Set,this.docMetaAdded=new Ie,this.docMetaRemoved=new Ie,this.docMetaUpdated=new Ie,this.id="meta",this.doc=e;const n=e.getMap(this.id);this._yMap=n,this._proxy=To(n),this._yMap.observeDeep(this._handleDocCollectionMetaEvents)}get docMetas(){return this._proxy.pages?this._proxy.pages:[]}get docs(){return this._proxy.pages}get properties(){const e=this._proxy.properties;return e||{tags:{options:[]}}}get yDocs(){return this._yMap.get("pages")}_handleDocMetaEvent(){const{docMetas:e,_prevDocs:n}=this,r=new Set;e.forEach(i=>{n.has(i.id)||this.docMetaAdded.next(i.id),r.add(i.id)}),n.forEach(i=>{r.has(i)===!1&&this.docMetaRemoved.next(i)}),this._prevDocs=r,this.docMetaUpdated.next()}addDocMeta(e,n){this.doc.transact(()=>{if(!this.docs)return;const r=this.docs;n===void 0?r.push(e):r.splice(n,0,e)},this.doc.clientID)}getDocMeta(e){return this.docMetas.find(n=>n.id===e)}initialize(){this._proxy.pages||(this._proxy.pages=[])}removeDocMeta(e){if(!this.docs)return;const r=this.docMetas.findIndex(i=>e===i.id);r!==-1&&this.doc.transact(()=>{this.docs&&this.docs.splice(r,1)},this.doc.clientID)}setDocMeta(e,n){var r;const s=((r=this.docs)!=null?r:[]).findIndex(o=>e===o.id);this.doc.transact(()=>{if(!this.docs||s===-1)return;const o=this.docs[s];Object.entries(n).forEach(([a,l])=>{o[a]=l})},this.doc.clientID)}setProperties(e){this._proxy.properties=e,this.docMetaUpdated.next()}}class dde{constructor(e,n){this.awareness=e,this.sources=n}connect(){this.sources.forEach(e=>e.connect(this.awareness))}disconnect(){this.sources.forEach(e=>e.disconnect())}}const kE=3e4;class hde extends rL{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=pf();this.getLocalState()!==null&&kE/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&kE<=n-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&fde(this,r,"timeout")},Cs(kE/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,s=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:pf()});const o=[],a=[],l=[],c=[];e===null?c.push(n):s==null?e!=null&&o.push(n):(a.push(n),sf(s,e)||l.push(n)),(o.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:o,updated:l,removed:c},"local"]),this.emit("update",[{added:o,updated:a,removed:c},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const fde=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const s=e[i];if(t.states.has(s)){if(t.states.delete(s),s===t.clientID){const o=t.meta.get(s);t.meta.set(s,{clock:o.clock+1,lastUpdated:pf()})}r.push(s)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))};class pde{constructor(e,n,r){this.main=e,this.shadows=n,this.logger=r,this._abort=null}get sources(){return[this.main,...this.shadows]}async delete(e){this.logger.error("You are trying to delete a blob. We do not support this feature yet. We need to wait until we implement the indexer, which will inform us which doc is using a particular blob so that we can safely delete it.")}async get(e){this.logger.debug("get blob",e);for(const n of this.sources){const r=await n.get(e);if(r)return r}return null}async list(){const e=new Set;for(const n of this.sources){const r=await n.list();for(const i of r)e.add(i)}return Array.from(e)}async set(e,n){if(this.main.readonly)throw new Error("main peer is readonly");const r=typeof e=="string"?e:await Tg(await e.arrayBuffer()),i=typeof e=="string"?n:e;if(!i)throw new Error("value is empty");return await this.main.set(r,i),Promise.allSettled(this.shadows.filter(s=>!s.readonly).map(s=>s.set(r,i).catch(o=>{this.logger.error("Error when uploading to peer",o)}))).then(s=>{s.some(({status:o})=>o==="rejected")?this.logger.error(`blob ${r} update finish, but some peers failed to update`):this.logger.debug(`blob ${r} update finish`)}).catch(()=>{}),r}blobState$(e){var n,r,i;return(i=(r=(n=this.main).blobState$)==null?void 0:r.call(n,e))!=null?i:null}upload(e){var n,r,i;return(i=(r=(n=this.main).upload)==null?void 0:r.call(n,e))!=null?i:null}start(){if(this._abort)return;this._abort=new AbortController;const e=this._abort.signal,n=()=>{e.aborted||this.sync().catch(r=>{this.logger.error("sync blob error",r)}).finally(()=>{setTimeout(n,6e4)})};n()}stop(){var e;(e=this._abort)==null||e.abort(),this._abort=null}async sync(){if(!this.main.readonly){this.logger.debug("start syncing blob...");for(const e of this.shadows){let n=[],r=[];if(!e.readonly){try{n=await this.main.list(),r=await e.list()}catch(o){this.logger.error("error when sync",o);continue}const s=n.filter(o=>!r.includes(o));for(const o of s)try{const a=await this.main.get(o);a?await e.set(o,a):this.logger.error("data not found when trying upload from main to shadow")}catch(a){this.logger.error(`error when sync ${o} from [${this.main.name}] to [${e.name}]`,a)}}const i=r.filter(s=>!n.includes(s));for(const s of i)try{const o=await e.get(s);o?await this.main.set(s,o):this.logger.error("data not found when trying download from shadow to main")}catch(o){this.logger.error(`error when sync ${s} from [${e.name}] to [${this.main.name}]`,o)}}this.logger.debug("finish syncing blob")}}}class mde{constructor(){this.map=new Map,this.name="memory",this.readonly=!1}delete(e){return this.map.delete(e),Promise.resolve()}get(e){var n;return Promise.resolve((n=this.map.get(e))!=null?n:null)}list(){return Promise.resolve(Array.from(this.map.keys()))}set(e,n){return this.map.set(e,n),Promise.resolve(e)}}var la=(t=>(t[t.Stopped=0]="Stopped",t[t.Synced=2]="Synced",t[t.Syncing=1]="Syncing",t))(la||{}),Tr=(t=>(t[t.Loaded=4.5]="Loaded",t[t.LoadingRootDoc=2]="LoadingRootDoc",t[t.LoadingSubDoc=3]="LoadingSubDoc",t[t.Retrying=1]="Retrying",t[t.Stopped=0]="Stopped",t[t.Synced=6]="Synced",t[t.Syncing=5]="Syncing",t))(Tr||{});class gde{constructor(e=[]){this._resolveUpdate=null,this._waitForUpdate=null,this._queue=e}get length(){return this._queue.length}clear(){this._queue=[]}find(e){return this._queue.find(e)}async next(e,n=r=>r.shift()){const r=n(this._queue);return r||(this._waitForUpdate||(this._waitForUpdate=new Promise(i=>{this._resolveUpdate=i})),await Promise.race([this._waitForUpdate,new Promise((i,s)=>{e!=null&&e.aborted&&s(e==null?void 0:e.reason),e==null||e.addEventListener("abort",()=>{s(e.reason)})})]),this.next(e,n))}push(...e){if(this._queue.push(...e),this._resolveUpdate){const n=this._resolveUpdate;this._resolveUpdate=null,this._waitForUpdate=null,n()}}remove(e){const n=this._queue.findIndex(e);n!==-1&&this._queue.splice(n,1)}}class TE extends gde{constructor(e=[],n=new SE){super(e),this.priorityTarget=n}next(e){return super.next(e,n=>{if(this.priorityTarget.priorityRule!==null){const r=n.findIndex(i=>{var s,o;return(o=(s=this.priorityTarget).priorityRule)==null?void 0:o.call(s,i.id)});if(r!==-1)return n.splice(r,1)[0]}return n.shift()})}}class SE{constructor(){this.priorityRule=null}}function ca(t){if(t!=null&&t.aborted)throw t.reason;return!0}const Bh="manually-stop";class IO{constructor(e,n,r=new SE,i){this.rootDoc=e,this.source=n,this.priorityTarget=r,this.logger=i,this._status={step:Tr.LoadingRootDoc,totalDocs:1,loadedDocs:0,pendingPullUpdates:0,pendingPushUpdates:0},this.abort=new AbortController,this.handleStorageUpdates=(s,o)=>{this.state.pullUpdatesQueue.push({id:s,data:o}),this.updateSyncStatus()},this.handleSubdocsUpdate=({added:s,removed:o})=>{for(const a of s)this.state.subdocsLoadQueue.push({id:a.guid,doc:a});for(const a of o)this.disconnectDoc(a),this.state.subdocsLoadQueue.remove(l=>l.doc===a);this.updateSyncStatus()},this.handleYDocUpdates=(s,o,a)=>{if(o===this.name)return;const l=this.state.pushUpdatesQueue.find(({id:c})=>c===a.guid);l?l.data.push(s):this.state.pushUpdatesQueue.push({id:a.guid,data:[s]}),this.updateSyncStatus()},this.onStatusChange=new Ie,this.state={connectedDocs:new Map,pushUpdatesQueue:new TE([],this.priorityTarget),pushingUpdate:!1,pullUpdatesQueue:new TE([],this.priorityTarget),subdocLoading:!1,subdocsLoadQueue:new TE([],this.priorityTarget)},this.logger.debug(`doc-peer:${this.name} start`),this.syncRetryLoop(this.abort.signal).catch(s=>{console.error(s)})}get name(){return this.source.name}set status(e){mp(e,this._status)||(this.logger.debug(`doc-peer:${this.name} status change`,e),this._status=e,this.onStatusChange.next(e))}get status(){return this._status}async connectDoc(e,n){var r;const{data:i,state:s}=(r=await this.source.pull(e.guid,OL(e)))!=null?r:{};ca(n),i&&i.length>0&&lw(e,i,"load"),this.state.pushUpdatesQueue.push({id:e.guid,data:[IL(e,s)]}),this.state.connectedDocs.set(e.guid,e),e.on("update",this.handleYDocUpdates),e.emit("sync",[!0,e]),this.updateSyncStatus()}disconnectDoc(e){e.off("update",this.handleYDocUpdates),this.state.connectedDocs.delete(e.guid),this.updateSyncStatus()}initState(){this.state.connectedDocs.clear(),this.state.pushUpdatesQueue.clear(),this.state.pullUpdatesQueue.clear(),this.state.subdocsLoadQueue.clear(),this.state.pushingUpdate=!1,this.state.subdocLoading=!1}stop(){this.logger.debug(`doc-peer:${this.name} stop`),this.abort.abort(Bh)}async sync(e){this.initState();const n=new AbortController;e.addEventListener("abort",i=>{n.abort(i)});let r=null;try{this.updateSyncStatus(),r=await this.source.subscribe(this.handleStorageUpdates,i=>{n.abort("subscribe disconnect:"+i)}),ca(n.signal),await this.connectDoc(this.rootDoc,n.signal),this.state.subdocsLoadQueue.push(...Array.from(this.rootDoc.getSubdocs()).map(i=>({id:i.guid,doc:i}))),this.updateSyncStatus(),this.rootDoc.on("subdocs",this.handleSubdocsUpdate),await Promise.all([(async()=>{for(;ca(n.signal);){const i=await this.state.subdocsLoadQueue.next(n.signal);this.state.subdocLoading=!0,this.updateSyncStatus(),await this.connectDoc(i.doc,n.signal),this.state.subdocLoading=!1,this.updateSyncStatus()}})(),(async()=>{for(;ca(n.signal);){const{id:i,data:s}=await this.state.pullUpdatesQueue.next(n.signal);if(!(s.byteLength===0||s.byteLength===2&&s[0]===0&&s[1]===0)){const o=this.state.connectedDocs.get(i);o&&lw(o,s,this.name)}this.updateSyncStatus()}})(),(async()=>{for(;ca(n.signal);){const{id:i,data:s}=await this.state.pushUpdatesQueue.next(n.signal);this.state.pushingUpdate=!0,this.updateSyncStatus();const o=kw(s);o.byteLength===0||o.byteLength===2&&o[0]===0&&o[1]===0||await this.source.push(i,o),this.state.pushingUpdate=!1,this.updateSyncStatus()}})()])}finally{r==null||r();for(const i of this.state.connectedDocs.values())this.disconnectDoc(i);this.rootDoc.off("subdocs",this.handleSubdocsUpdate)}}async syncRetryLoop(e){for(;e.aborted===!1;){try{await this.sync(e)}catch(n){if(n===Bh||e.aborted)return;this.logger.error(`doc-peer:${this.name} sync error`,n)}try{this.logger.error(`doc-peer:${this.name} retry after 5 seconds`),this.status={step:Tr.Retrying,totalDocs:1,loadedDocs:0,pendingPullUpdates:0,pendingPushUpdates:0},await Promise.race([new Promise(n=>{setTimeout(n,5*1e3)}),new Promise((n,r)=>{e.aborted&&r(e.reason),e.addEventListener("abort",()=>{r(e.reason)})})])}catch(n){if(n===Bh||e.aborted)return;throw n}}}updateSyncStatus(){let e;this.state.connectedDocs.size===0?e=Tr.LoadingRootDoc:this.state.subdocsLoadQueue.length||this.state.subdocLoading?e=Tr.LoadingSubDoc:this.state.pullUpdatesQueue.length||this.state.pushUpdatesQueue.length||this.state.pushingUpdate?e=Tr.Syncing:e=Tr.Synced,this.status={step:e,totalDocs:this.state.connectedDocs.size+this.state.subdocsLoadQueue.length,loadedDocs:this.state.connectedDocs.size,pendingPullUpdates:this.state.pullUpdatesQueue.length+(this.state.subdocLoading?1:0),pendingPushUpdates:this.state.pushUpdatesQueue.length+(this.state.pushingUpdate?1:0)}}async waitForLoaded(e){this.status.step>=Tr.LoadingSubDoc||(await Promise.race([new Promise(n=>{this.onStatusChange.subscribe(r=>{r.step>=Tr.LoadingSubDoc&&n()})}),new Promise((n,r)=>{e!=null&&e.aborted&&r(e.reason),e==null||e.addEventListener("abort",()=>{r(e.reason)})})]),ca(e))}async waitForSynced(e){this.status.step!==Tr.Synced&&(await Promise.race([new Promise(n=>{this.onStatusChange.subscribe(r=>{r.step===Tr.Synced&&n()})}),new Promise((n,r)=>{e!=null&&e.aborted&&r(e.reason),e==null||e.addEventListener("abort",()=>{r(e.reason)})})]),ca(e))}}class bde{constructor(e,n,r,i){this.rootDoc=e,this.main=n,this.shadows=r,this.logger=i,this._abort=new AbortController,this.onStatusChange=new Ie,this.priorityTarget=new SE,this._status={step:la.Stopped,main:null,shadows:r.map(()=>null),retrying:!1},this.logger.debug(`syne-engine:${this.rootDocId} status init`,this.status)}get rootDocId(){return this.rootDoc.guid}get status(){return this._status}setStatus(e){this.logger.debug(`syne-engine:${this.rootDocId} status change`,e),this._status=e,this.onStatusChange.next(e)}canGracefulStop(){return!!this.status.main&&this.status.main.pendingPushUpdates===0}forceStop(){this._abort.abort(Bh),this.setStatus({step:la.Stopped,main:null,shadows:this.shadows.map(()=>null),retrying:!1})}setPriorityRule(e){this.priorityTarget.priorityRule=e}start(){this.status.step!==la.Stopped&&this.forceStop(),this._abort=new AbortController,this.sync(this._abort.signal).catch(e=>{this.logger.error(`syne-engine:${this.rootDocId}`,e)})}async sync(e){var n;const r={mainPeer:null,shadowPeers:this.shadows.map(()=>null)},i=[];try{r.mainPeer=new IO(this.rootDoc,this.main,this.priorityTarget,this.logger);const s=r.mainPeer.onStatusChange.subscribe(()=>{e.aborted||this.updateSyncingState(r.mainPeer,r.shadowPeers)});i.push(()=>{s.unsubscribe()}),this.updateSyncingState(r.mainPeer,r.shadowPeers),await r.mainPeer.waitForLoaded(e),r.shadowPeers=this.shadows.map(o=>{const a=new IO(this.rootDoc,o,this.priorityTarget,this.logger),l=a.onStatusChange.subscribe(()=>{e.aborted||this.updateSyncingState(r.mainPeer,r.shadowPeers)});return i.push(()=>{l.unsubscribe()}),a}),this.updateSyncingState(r.mainPeer,r.shadowPeers),await new Promise((o,a)=>{e.aborted&&a(e.reason),e.addEventListener("abort",()=>{a(e.reason)})})}catch(s){if(s===Bh||e.aborted)return;throw s}finally{(n=r.mainPeer)==null||n.stop();for(const s of r.shadowPeers)s==null||s.stop();for(const s of i)s()}}updateSyncingState(e,n){var r;let i=la.Synced;const s=[e,...n];for(const o of s)if(!o||o.status.step!==Tr.Synced){i=la.Syncing;break}this.setStatus({step:i,main:(r=e==null?void 0:e.status)!=null?r:null,shadows:n.map(o=>{var a;return(a=o==null?void 0:o.status)!=null?a:null}),retrying:s.some(o=>(o==null?void 0:o.status.step)===Tr.Retrying)})}async waitForGracefulStop(e){await Promise.race([new Promise((n,r)=>{e!=null&&e.aborted&&r(e==null?void 0:e.reason),e==null||e.addEventListener("abort",()=>{r(e.reason)})}),new Promise(n=>{this.onStatusChange.subscribe(()=>{this.canGracefulStop()&&n()})})]),ca(e),this.forceStop()}async waitForLoadedRootDoc(e){function n(r){return![r.main,...r.shadows].some(i=>!i||i.step<=Tr.LoadingRootDoc)}if(!n(this.status))return Promise.race([new Promise(r=>{this.onStatusChange.subscribe(i=>{n(i)&&r()})}),new Promise((r,i)=>{e!=null&&e.aborted&&i(e==null?void 0:e.reason),e==null||e.addEventListener("abort",()=>{i(e.reason)})})])}async waitForSynced(e){if(this.status.step!==la.Synced)return Promise.race([new Promise(n=>{this.onStatusChange.subscribe(r=>{r.step===la.Synced&&n()})}),new Promise((n,r)=>{e!=null&&e.aborted&&r(e==null?void 0:e.reason),e==null||e.addEventListener("abort",()=>{r(e.reason)})})])}}class yde{constructor(){this.name="noop"}pull(e,n){return null}push(e,n){}subscribe(e,n){return()=>{}}}class _de{constructor({id:e,idGenerator:n,awarenessSources:r=[],docSources:i={main:new yde},blobSources:s={main:new mde}}={}){this.storeExtensions=[],this.blockCollections=new Map,this.slots={docListUpdated:new Ie};var o,a;this.id=e||"",this.doc=new Ds({guid:e}),this.awarenessStore=new e9(new hde(this.doc));const l=new nL;this.awarenessSync=new dde(this.awarenessStore.awareness,r),this.docSync=new bde(this.doc,i.main,(o=i.shadows)!=null?o:[],l),this.blobSync=new pde(s.main,(a=s.shadows)!=null?a:[],l),this.idGenerator=n??K,this.meta=new ude(this.doc),this._bindDocMetaEvents()}get docs(){return this.blockCollections}_bindDocMetaEvents(){this.meta.docMetaAdded.subscribe(e=>{const n=new cde({id:e,collection:this,doc:this.doc,awarenessStore:this.awarenessStore});this.blockCollections.set(n.id,n)}),this.meta.docMetaUpdated.subscribe(()=>this.slots.docListUpdated.next()),this.meta.docMetaRemoved.subscribe(e=>{const n=this.getBlockCollection(e);n&&(this.blockCollections.delete(e),n.remove())})}_hasDoc(e){return this.docs.has(e)}canGracefulStop(){this.docSync.canGracefulStop()}createDoc(e){const n=e??this.idGenerator();if(this._hasDoc(n))throw new V(re.DocCollectionError,"doc already exists");return this.meta.addDocMeta({id:n,title:"",createDate:Date.now(),tags:[]}),this.getDoc(n)}dispose(){this.awarenessStore.destroy()}forceStop(){this.docSync.forceStop(),this.blobSync.stop(),this.awarenessSync.disconnect()}getBlockCollection(e){const n=this.docs.get(e);return n??null}getDoc(e){return this.getBlockCollection(e)}removeDoc(e){if(!this.meta.getDocMeta(e))throw new V(re.DocCollectionError,`doc meta not found: ${e}`);const r=this.getBlockCollection(e);r&&(r.dispose(),this.meta.removeDocMeta(e),this.blockCollections.delete(e))}start(){this.docSync.start(),this.blobSync.start(),this.awarenessSync.connect()}waitForGracefulStop(e){return this.docSync.waitForGracefulStop(e)}waitForSynced(){return this.docSync.waitForSynced()}}var xde=Object.create,MO=Object.defineProperty,Ede=Object.getOwnPropertyDescriptor,DO=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Fh=t=>{throw TypeError(t)},vde=(t,e,n)=>e in t?MO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,wde=t=>{var e;return[,,,xde((e=t==null?void 0:t[DO("metadata")])!=null?e:null)]},NO=["class","method","getter","setter","accessor","field","value","get","set"],Uh=t=>t!==void 0&&typeof t!="function"?Fh("Function expected"):t,kde=(t,e,n,r,i)=>({kind:NO[t],name:e,metadata:r,addInitializer:s=>n._?Fh("Already initialized"):i.push(Uh(s||null))}),Tde=(t,e)=>vde(e,DO("metadata"),t[3]),OO=(t,e,n,r)=>{for(var i=0,s=t[e>>1],o=s&&s.length;i<o;i++)e&1?s[i].call(n):r=s[i].call(n,r);return r},Sde=(t,e,n,r,i,s)=>{for(var o,a,l,c,u,d=e&7,h=!1,f=!1,p=t.length+1,g=NO[d+5],b=t[p-1]=[],_=t[p]||(t[p]=[]),y=(i=i.prototype,Ede({get[n](){return Cde(this,s)},set[n](E){return Ide(this,s,E)}},n)),x=r.length-1;x>=0;x--)c=kde(d,n,l={},t[3],_),c.static=h,c.private=f,u=c.access={has:E=>n in E},u.get=E=>E[n],u.set=(E,I)=>E[n]=I,a=(0,r[x])({get:y.get,set:y.set},c),l._=1,a===void 0?Uh(a)&&(y[g]=a):typeof a!="object"||a===null?Fh("Object expected"):(Uh(o=a.get)&&(y.get=o),Uh(o=a.set)&&(y.set=o),Uh(o=a.init)&&b.unshift(o));return y&&MO(i,n,y),i},PO=(t,e,n)=>e.has(t)||Fh("Cannot "+n),Cde=(t,e,n)=>(PO(t,e,"read from private field"),e.get(t)),Ade=(t,e,n)=>e.has(t)?Fh("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Ide=(t,e,n,r)=>(PO(t,e,"write to private field"),e.set(t,n),n),LO,CE,$h,AE;class Hh extends(CE=Ub(jb(kd)),LO=[yc({attribute:!1})],CE){constructor(){super(...arguments),this._doc=un(),this._edgelessSpecs=un([]),this._mode=un("page"),this._pageSpecs=un([]),this._specs=Os(()=>this._mode.value==="page"?this._pageSpecs.value:this._edgelessSpecs.value),this._std=Os(()=>new dD({store:this.doc,extensions:this._specs.value})),this._editorTemplate=Os(()=>this._std.value.render()),Ade(this,AE,OO($h,8,this,!1)),OO($h,11,this)}get doc(){return this._doc.value}set doc(e){this._doc.value=e}set edgelessSpecs(e){this._edgelessSpecs.value=e}get edgelessSpecs(){return this._edgelessSpecs.value}get host(){try{return this.std.host}catch{return null}}get mode(){return this._mode.value}set mode(e){this._mode.value=e}set pageSpecs(e){this._pageSpecs.value=e}get pageSpecs(){return this._pageSpecs.value}get rootModel(){return this.doc.root}get std(){return this._std.value}connectedCallback(){super.connectedCallback(),this._disposables.add(this.doc.slots.rootAdded.subscribe(()=>this.requestUpdate()))}firstUpdated(){this.mode==="page"&&setTimeout(()=>{if(this.autofocus&&this.mode==="page"){const e=this.querySelector("rich-text"),n=e==null?void 0:e.inlineEditor;n==null||n.focusEnd()}})}render(){const e=this._mode.value,n=this.std.get(Em),r=n.app$.value,i=n.edgeless$.value;return kp`${hoe(this.rootModel.id+e,kp`
        <div
          data-theme=${e==="page"?r:i}
          class=${e==="page"?"affine-page-viewport":"affine-edgeless-viewport"}
        >
          ${p2(e==="page",()=>kp` <doc-title .doc=${this.doc}></doc-title> `)}
          <div
            class=${e==="page"?"page-editor playground-page-editor-container":"edgeless-editor-container"}
          >
            ${this._editorTemplate.value}
          </div>
        </div>
      `)}`}switchEditor(e){this._mode.value=e}}$h=wde(CE),AE=new WeakMap,Sde($h,4,"autofocus",LO,Hh,AE),Tde($h,Hh),Hh.styles=u2`
    .affine-page-viewport {
      position: relative;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      overflow-y: auto;
      container-name: viewport;
      container-type: inline-size;
      font-family: var(--affine-font-family);
    }
    .affine-page-viewport * {
      box-sizing: border-box;
    }

    @media print {
      .affine-page-viewport {
        height: auto;
      }
    }

    .playground-page-editor-container {
      flex-grow: 1;
      font-family: var(--affine-font-family);
      display: block;
    }

    .playground-page-editor-container * {
      box-sizing: border-box;
    }

    @media print {
      .playground-page-editor-container {
        height: auto;
      }
    }

    .edgeless-editor-container {
      font-family: var(--affine-font-family);
      background: var(--affine-background-primary-color);
      display: block;
      height: 100%;
      position: relative;
      overflow: clip;
    }

    .edgeless-editor-container * {
      box-sizing: border-box;
    }

    @media print {
      .edgeless-editor-container {
        height: auto;
      }
    }

    .affine-edgeless-viewport {
      display: block;
      height: 100%;
      position: relative;
      overflow: clip;
      container-name: viewport;
      container-type: inline-size;
    }
  `;const Mde=t=>{if(!ra(t))return!1;const e=nE(t);try{const n=Xs.parse(JSON.parse(e));return n.type==="attachment"&&!!n.blobId}catch{return!1}},Dde={flavour:rl.model.flavour,toMatch:t=>Mde(t.node),fromMatch:t=>t.node.flavour===rl.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!ra(t.node))return;const{walkerContext:n,configs:r}=e,i=t.node.identifier,s=`${ia}${i}`,o=r.get(s);if(o)try{const a=Xs.parse(JSON.parse(o)),{blobId:l,fileName:c}=a;if(!l||!c)return;n.openNode({type:"block",id:K(),flavour:rl.model.flavour,props:{name:c,sourceId:l,footnoteIdentifier:i,style:"citation"},children:[]},"children").closeNode(),n.skipAllChildren()}catch(a){console.warn("Failed to parse attachment footnote definition:",a);return}}},fromBlockSnapshot:{}},Nde=Rt(Dde),Ode={flavour:rl.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="figure"&&!!H.querySelector(t.node,".source"),fromMatch:()=>!1,toBlockSnapshot:{enter:async(t,e)=>{var n,r,i,s,o,a;if(!H.isElement(t.node))return;const{assets:l,walkerContext:c}=e;if(!l)return;const u=H.querySelector(t.node,".source");let d="";if(u){const h=H.querySelector(u,"a");d=typeof(h==null?void 0:h.properties.href)=="string"?h.properties.href:""}if(d){let h="",f="",p="",g=0;if(uE.fetchable(d)){const b=await fetch(d).catch(x=>(console.warn("Error fetching embed:",x),null));if(!b)return;const _=b.clone();f=(o=nN((n=b.headers.get("Content-Disposition"))!=null?n:""))!=null?o:((r=d.split("/").at(-1))!=null?r:"file")+"."+((s=(i=b.headers.get("Content-Type"))==null?void 0:i.split("/").at(-1))!=null?s:"blob");const y=new File([await b.blob()],f,{type:(a=b.headers.get("Content-Type"))!=null?a:""});g=y.size,p=y.type,h=await Tg(await _.arrayBuffer()),l==null||l.getAssets().set(h,y),await(l==null?void 0:l.writeToBlob(h))}else{const b=d.split("/");for(;b.length>0;){const y=l.getPathBlobIdMap().get(decodeURIComponent(b.join("/")));if(y){h=y;break}b.shift()}const _=l.getAssets().get(h);_&&(f=Sg(l.getAssets(),h),g=_.size,p=_.type)}c.openNode({type:"block",id:K(),flavour:rl.model.flavour,props:{name:f,size:g,type:p,sourceId:h},children:[]},"children").closeNode(),c.skipAllChildren()}}},fromBlockSnapshot:{}},Pde=[fr(Ode),Nde];class Lde extends it{constructor(){super(...arguments),this.name="affine-attachment-block"}setup(e){super.setup(e),e.register(iW),e.register(Pde)}}const Rde=Qc(Uo.model.flavour),Bde=In(Rde),Fde=t=>{if(!ra(t))return!1;const e=nE(t);try{const n=Xs.parse(JSON.parse(e));return n.type==="url"&&!!n.url}catch{return!1}},Ude=Zc(Uo.model.flavour,{toMatch:t=>Fde(t.node),toBlockSnapshot:{enter:(t,e)=>{if(!ra(t.node))return;const{walkerContext:n,configs:r}=e,i=t.node.identifier,s=`${ia}${i}`,o=r.get(s);if(!o)return;let a;try{a=Xs.parse(JSON.parse(o)),a.url&&(a.url=decodeURIComponent(a.url)),a.favicon&&(a.favicon=decodeURIComponent(a.favicon))}catch(h){console.warn("Failed to parse or decode footnote definition:",h);return}const{url:l,favicon:c,title:u,description:d}=a;n.openNode({type:"block",id:K(),flavour:Uo.model.flavour,props:{url:l,footnoteIdentifier:i,icon:c,title:u,description:d,style:"citation"},children:[]},"children").closeNode(),n.skipAllChildren()}}}),$de=Rt(Ude);function RO(t){try{return t===encodeURIComponent(decodeURIComponent(t))}catch{return!0}}function Hde(t,e){return`[^${t}]: ${JSON.stringify(e)}`}class zde{constructor(){this.pos=0,this.input="",this.tokens=[]}tokenize(e){for(this.input=e,this.pos=0,this.tokens=[];this.pos<this.input.length;){const n=this.input[this.pos];if(n===`
`){this.tokens.push({type:"NEWLINE",value:`
`}),this.pos++;continue}if(n==="["&&this.input[this.pos+1]==="^"){this.tokens.push({type:"FOOTNOTE_START",value:"[^"}),this.pos+=2;continue}if(this.tokens.length>0&&this.tokens[this.tokens.length-1].type==="FOOTNOTE_START"){let r="";for(;this.pos<this.input.length&&this.input[this.pos]!=="]";)r+=this.input[this.pos],this.pos++;r&&this.tokens.push({type:"REFERENCE",value:r}),this.pos++;continue}if(n===":"){let r=this.pos+1;for(;r<this.input.length&&this.input[r]===" ";)r++;this.tokens.push({type:"SEPARATOR",value:this.input.slice(this.pos,r)}),this.pos=r;continue}if(n==="{"){let r="",i=1,s=this.pos;this.pos++;let o=!1,a=!1;for(;this.pos<this.input.length&&i>0;){const l=this.input[this.pos];o||(l==="{"?i++:l==="}"&&i--),a?a=!1:l==="\\"?a=!0:l==='"'&&(o=!o),r+=l,this.pos++}i===0?this.tokens.push({type:"JSON_CONTENT",value:"{"+r}):(this.pos=s,this.pos++);continue}this.pos++}return this.tokens}parse(e){const n=[];let r={},i=!1;for(const s of e)switch(s.type){case"FOOTNOTE_START":i=!0,r={};break;case"REFERENCE":i&&(r.reference=s.value);break;case"JSON_CONTENT":if(i){try{r.content=Xs.parse(JSON.parse(s.value)),n.push(r)}catch{}i=!1,r={}}break;case"NEWLINE":i=!1,r={};break}return n}processUrls(e){const n=e.content;return n.url&&!RO(n.url)&&(n.url=encodeURIComponent(n.url)),n.favicon&&!RO(n.favicon)&&(n.favicon=encodeURIComponent(n.favicon)),e}process(e){const n=this.tokenize(e),i=this.parse(n).map(o=>this.processUrls(o)),s=new Map(i.map(o=>[o.reference,Hde(o.reference,o.content)]));return e.split(`
`).map(o=>{const a=o.match(/^\[\^([^\]]+)\]:/);return a&&s.has(a[1])?s.get(a[1]):o}).join(`
`)}}function Wde(t){return new zde().process(t)}const jde=[xm({name:"bookmark-block",levels:["block","slice","doc"],preprocess:Wde}),$de],Yde={flavour:Uo.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="figure"&&!!H.querySelector(t.node,".bookmark"),fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{var n,r;if(!H.isElement(t.node))return;const i=H.querySelector(t.node,".bookmark");if(!i)return;const{walkerContext:s}=e,o=(n=i.properties)==null?void 0:n.href,a=H.getTextContent(H.querySelector(i,".bookmark-title")),l=H.getTextContent(H.querySelector(i,".bookmark-description")),c=H.querySelector(i,".bookmark-icon"),u=typeof((r=c==null?void 0:c.properties)==null?void 0:r.src)=="string"?c.properties.src:"";s.openNode({type:"block",id:K(),flavour:Uo.model.flavour,props:{type:"card",url:o??"",title:a,description:l,icon:u},children:[]},"children").closeNode(),s.skipAllChildren()}},fromBlockSnapshot:{}},Gde=fr(Yde),Vde=Jc(Uo.model.flavour),qde=gn(Vde),Xde=[Bde,jde,Gde,qde].flat();class Kde extends it{constructor(){super(...arguments),this.name="affine-bookmark-block"}setup(e){super.setup(e),e.register(aW),e.register(Xde)}}const Qde=new Set(["paragraph","list","heading","blockquote"]),BO=":::",Zde={style:Dh.GFM};function FO(t){let e=Zde;try{const n=t.get(are);n&&(e=ure.parse(n))}catch{}return e}const Jde={flavour:Pd.model.flavour,toMatch:t=>Mh(t.node),fromMatch:t=>t.node.flavour===Pd.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!t.node.data||!Mh(t.node))return;t.node.children=t.node.children.filter(i=>Qde.has(i.type));const{walkerContext:n}=e,r=ore(t.node);n.openNode({type:"block",id:K(),flavour:Pd.model.flavour,props:{emoji:r},children:[]},"children")},leave:(t,e)=>{const{walkerContext:n}=e;Mh(t.node)&&n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=t.node.props.emoji,{walkerContext:i,configs:s}=e,o=FO(s),{style:a,admonitionType:l}=o;if(a===Dh.Admonitions){let c=l??lre,u="",d="";const h=t.node.children[0];if(!!h.props.text){const b=((n=h.props.text)!=null?n:{delta:[]}).delta.reduce((_,y)=>(y.insert&&(_+=y.insert),_),"");if(b){const _=b.includes(`
`)?b.split(`
`)[0]:b;d=b.split(`
`).slice(1).join(`
`);const y=_.split(" ")[0].toLowerCase();cre.has(y)&&(c=y,u=_.split(" ").slice(1).join(" ").trim(),t.node.children=t.node.children.slice(1))}}const p=`${BO} ${c} ${u}`.trim();i.openNode({type:"paragraph",children:[{type:"text",value:p}]}).closeNode(),d&&i.openNode({type:"paragraph",children:[{type:"text",value:`${d}`}]}).closeNode()}else i.openNode({type:"blockquote",children:[]},"children").openNode({type:"paragraph",children:[{type:"text",value:`[!${r}]`}]}).closeNode()},leave:(t,e)=>{const{walkerContext:n,configs:r}=e,i=FO(r),{style:s}=i;s===Dh.Admonitions?n.openNode({type:"paragraph",children:[{type:"text",value:BO}]}).closeNode():n.closeNode()}}},ehe=Rt(Jde);class the extends it{constructor(){super(...arguments),this.name="affine-callout-block"}setup(e){super.setup(e),e.register(uW),e.register(ehe)}}const nhe={flavour:$o.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="pre",fromMatch:t=>t.node.flavour==="affine:code",toBlockSnapshot:{enter:(t,e)=>{var n;if(!H.isElement(t.node))return;const r=H.querySelector(t.node,"code");if(!r)return;const i=r.children.length===1&&r.children[0].type==="text"?r.children[0]:{...r,tagName:"div"};let s=Array.isArray((n=r.properties)==null?void 0:n.className)?r.properties.className.find(u=>typeof u=="string"&&u.startsWith("code-")):void 0;s=typeof s=="string"?s.replace("code-",""):void 0;const{walkerContext:o,deltaConverter:a,configs:l}=e,c=l.get(sE)==="true";o.openNode({type:"block",id:K(),flavour:"affine:code",props:{language:s??"Plain Text",wrap:c,text:{"$blocksuite:internal:text$":!0,delta:a.astToDelta(i,{trim:!1,pre:!0})}},children:[]},"children").closeNode(),o.skipAllChildren()}},fromBlockSnapshot:{enter:async(t,e)=>{const{walkerContext:n}=e,r=t.node.props.language,s=t.node.props.text.delta.map(o=>o.insert).join("");n.openNode({type:"element",tagName:"pre",properties:{},children:[]},"children").openNode({type:"element",tagName:"code",properties:{className:[`code-${r??"text"}`]},children:[{type:"text",value:s}]},"children").closeNode().closeNode()}}},rhe=In(nhe),ihe=t=>t.type==="code",she=t=>t.type==="html",UO=t=>ihe(t)||she(t),ohe={flavour:$o.model.flavour,toMatch:t=>UO(t.node),fromMatch:t=>t.node.flavour==="affine:code",toBlockSnapshot:{enter:(t,e)=>{if(!UO(t.node))return;const{walkerContext:n,configs:r}=e,i=r.get(sE)==="true";let s="plain text";switch(t.node.type){case"code":{t.node.lang&&(s=t.node.lang);break}case"html":{if(!!n.getGlobalContext(rE))return;s="html";break}}n.openNode({type:"block",id:K(),flavour:"affine:code",props:{language:s,wrap:i,text:{"$blocksuite:internal:text$":!0,delta:[{insert:t.node.value}]}},children:[]},"children").closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{var n,r;const i=(n=t.node.props.text)!=null?n:{delta:[]},{walkerContext:s}=e;s.openNode({type:"code",lang:(r=t.node.props.language)!=null?r:null,meta:null,value:i.delta.map(o=>o.insert).join("")},"children").closeNode()}}},ahe=Rt(ohe),$O=xm({name:"code",levels:["slice"],preprocess:t=>{let e="";return t.split(`
`).map(r=>{if(r.trimStart().startsWith("-"))return r;let i=r.trimStart();if(!e&&i.startsWith("```")){if(e=i.substring(0,i.lastIndexOf("```")+3),e.split("").every(s=>s==="`"))return r;e=""}if(!e&&i.startsWith("~~~")){if(e=i.substring(0,i.lastIndexOf("~~~")+3),e.split("").every(s=>s==="~"))return r;e=""}return e&&i.startsWith(e)&&i.lastIndexOf(e)===0&&(e=""),e?r:(i=i.trimEnd(),!i.startsWith("<")&&!i.endsWith(">")&&!i.includes(" ")&&Cre(i)?`<${i}>`:r.replace(/^ /,"&#x20;"))}).join(`
`)}}),lhe=[$O,ahe],che={flavour:$o.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="pre",fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const n=H.querySelector(t.node,"code");if(!n)return;const{walkerContext:r,deltaConverter:i,configs:s}=e,o=s.get(sE)==="true",a=n.children.length===1&&n.children[0].type==="text"?n.children[0]:{...n,tag:"div"};r.openNode({type:"block",id:K(),flavour:$o.model.flavour,props:{language:"Plain Text",wrap:o,text:{"$blocksuite:internal:text$":!0,delta:i.astToDelta(a,{trim:!1,pre:!0})}},children:[]},"children").closeNode(),r.skipAllChildren()}},fromBlockSnapshot:{}},uhe=fr(che),dhe={flavour:$o.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===$o.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n;const i=((n=t.node.props.text)!=null?n:{delta:[]}).delta.map(s=>s.insert).join("");e.textBuffer.content+=i,e.textBuffer.content+=`
`}}},hhe=gn(dhe),fhe=[rhe,lhe,hhe,uhe].flat();class phe extends it{constructor(){super(...arguments),this.name="affine-code-block"}setup(e){super.setup(e),e.register(dW),e.register(fhe),e.register($O)}}class mhe extends it{constructor(){super(...arguments),this.name="affine-data-view-block"}setup(e){super.setup(e),e.register(ade)}}const ghe=[Moe,Poe,$oe,zoe];class bhe extends it{constructor(){super(...arguments),this.name="affine-database-block"}setup(e){super.setup(e),e.register(pW),e.register(sde),e.register(ghe)}}const yhe={flavour:es.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="hr",fromMatch:t=>t.node.flavour===es.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;n.openNode({type:"block",id:K(),flavour:"affine:divider",props:{},children:[]},"children").closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;n.openNode({type:"element",tagName:"hr",properties:{},children:[]},"children").closeNode()}}},_he=In(yhe),xhe=t=>t.type==="thematicBreak",Ehe={flavour:es.model.flavour,toMatch:t=>xhe(t.node),fromMatch:t=>t.node.flavour===es.model.flavour,toBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;n.openNode({type:"block",id:K(),flavour:"affine:divider",props:{},children:[]},"children").closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;n.openNode({type:"thematicBreak"},"children").closeNode()}}},vhe=Rt(Ehe),whe={flavour:es.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="hr",fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;n.openNode({type:"block",id:K(),flavour:es.model.flavour,props:{},children:[]},"children").closeNode()}},fromBlockSnapshot:{}},khe=fr(whe),The={flavour:es.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===es.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{e.textBuffer.content+=`---
`}}},She=gn(The),Che=[_he,vhe,khe,She];class Ahe extends it{constructor(){super(...arguments),this.name="affine-divider-block"}setup(e){super.setup(e),e.register(gW),e.register(Che)}}class Ihe extends it{constructor(){super(...arguments),this.name="affine-edgeless-text-block"}setup(e){super.setup(e),e.register(HW)}}const Mhe=[dce,fce,yce,gce],Dhe=[xce,vce,Cce,Tce],Nhe=[Tue,Cue,Nue,Mue],Ohe=[Pue,Rue,Hue,Uue];class Phe extends it{constructor(){super(...arguments),this.name="affine-embed-block"}setup(e){super.setup(e),e.register([JC,ZC,ej,rj,KW,GW,uj,bj]),e.register(Mhe),e.register(Dhe),e.register(Ohe),e.register(Nhe),e.register(Pce),e.register(wue),e.register(sN)}}const Lhe={flavour:Qs.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Qs.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n,r,i;const{configs:s,walkerContext:o}=e;if(!t.node.props.pageId)return;const a=(n=s.get("title:"+t.node.props.pageId))!=null?n:"untitled",l=Kn.generateDocUrl((r=s.get("docLinkBaseUrl"))!=null?r:"",String(t.node.props.pageId),(i=t.node.props.params)!=null?i:Object.create(null));o.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"a",properties:{href:l},children:[{type:"text",value:a}]},"children").closeNode().closeNode()}}},Rhe=In(Lhe),Bhe=t=>{if(!ra(t))return!1;const e=nE(t);try{const n=Xs.parse(JSON.parse(e));return n.type==="doc"&&!!n.docId}catch{return!1}},Fhe={flavour:Qs.model.flavour,toMatch:t=>Bhe(t.node),fromMatch:t=>t.node.flavour===Qs.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!ra(t.node))return;const{walkerContext:n,configs:r}=e,i=t.node.identifier,s=`${ia}${i}`,o=r.get(s);if(o)try{const a=Xs.parse(JSON.parse(o)),{docId:l}=a;if(!l)return;n.openNode({type:"block",id:K(),flavour:Qs.model.flavour,props:{pageId:l,footnoteIdentifier:i,style:"citation"},children:[]},"children").closeNode(),n.skipAllChildren()}catch(a){console.warn("Failed to parse linked doc footnote definition:",a);return}}},fromBlockSnapshot:{enter:(t,e)=>{var n,r,i;const{configs:s,walkerContext:o}=e;if(!t.node.props.pageId)return;const a=(n=s.get("title:"+t.node.props.pageId))!=null?n:"untitled",l=Kn.generateDocUrl((r=s.get("docLinkBaseUrl"))!=null?r:"",String(t.node.props.pageId),(i=t.node.props.params)!=null?i:Object.create(null));o.openNode({type:"paragraph",children:[]},"children").openNode({type:"link",url:l,title:t.node.props.caption,children:[{type:"text",value:a}]},"children").closeNode().closeNode()}}},Uhe=Rt(Fhe),$he={flavour:Qs.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Qs.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n,r,i;const{configs:s,textBuffer:o}=e;if(!t.node.props.pageId)return;const a=(n=s.get("title:"+t.node.props.pageId))!=null?n:"untitled",l=Kn.generateDocUrl((r=s.get("docLinkBaseUrl"))!=null?r:"",String(t.node.props.pageId),(i=t.node.props.params)!=null?i:Object.create(null));o.content+=`${a}: ${l}
`}}},Hhe=gn($he),zhe=[Rhe,Uhe,Hhe],Whe={flavour:jo.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===jo.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:async(t,e)=>{var n,r;const{configs:i,walker:s,walkerContext:o,job:a}=e,l=i.get("embedSyncedDocExportType");o.getGlobalContext("embed-synced-doc-counter")===void 0&&o.setGlobalContext("embed-synced-doc-counter",0);let c=o.getGlobalContext("embed-synced-doc-counter");if(o.setGlobalContext("embed-synced-doc-counter",++c),l==="content"){const u=t.node.props.pageId,d=a.docCRUD.get(u);if(o.setGlobalContext("hast:html-root-doc",!1),!d)return;if(c===1){const h=a.docToSnapshot(d);h&&await s.walkONode(h.blocks)}else o.openNode({type:"element",tagName:"div",properties:{className:["affine-paragraph-block-container"]},children:[]},"children").openNode({type:"element",tagName:"p",properties:{},children:[{type:"text",value:(r=(n=d.meta)==null?void 0:n.title)!=null?r:""}]},"children").closeNode().closeNode()}},leave:(t,e)=>{const{walkerContext:n}=e,i=n.getGlobalContext("embed-synced-doc-counter")-1;n.setGlobalContext("embed-synced-doc-counter",i),n.setGlobalContext("hast:html-root-doc",i===0)}}},jhe=In(Whe),Yhe={flavour:jo.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===jo.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:async(t,e)=>{var n,r;const{configs:i,walker:s,walkerContext:o,job:a}=e,l=i.get("embedSyncedDocExportType");o.getGlobalContext("embed-synced-doc-counter")===void 0&&o.setGlobalContext("embed-synced-doc-counter",0);let c=o.getGlobalContext("embed-synced-doc-counter");if(o.setGlobalContext("embed-synced-doc-counter",++c),l==="content"){const u=t.node.props.pageId,d=a.docCRUD.get(u);if(!d)return;if(c===1){const h=a.docToSnapshot(d);h&&await s.walkONode(h.blocks)}else o.openNode({type:"paragraph",children:[{type:"text",value:(r=(n=d.meta)==null?void 0:n.title)!=null?r:""}]}).closeNode()}},leave:(t,e)=>{const{walkerContext:n}=e,r=n.getGlobalContext("embed-synced-doc-counter");n.setGlobalContext("embed-synced-doc-counter",r-1)}}},Ghe=Rt(Yhe),Vhe={flavour:jo.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===jo.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:async(t,e)=>{var n,r;const{configs:i,walker:s,walkerContext:o,job:a,textBuffer:l}=e,c=i.get("embedSyncedDocExportType");o.getGlobalContext("embed-synced-doc-counter")===void 0&&o.setGlobalContext("embed-synced-doc-counter",0);let u=o.getGlobalContext("embed-synced-doc-counter");o.setGlobalContext("embed-synced-doc-counter",++u);let d="";if(c==="content"){const h=t.node.props.pageId,f=a.docCRUD.get(h);if(!f)return;if(u===1){const p=a.docToSnapshot(f);p&&await s.walkONode(p.blocks)}else d=(r=(n=f.meta)==null?void 0:n.title)!=null?r:"",d&&(d+=`
`)}l.content+=d},leave:(t,e)=>{const{walkerContext:n}=e,r=n.getGlobalContext("embed-synced-doc-counter");n.setGlobalContext("embed-synced-doc-counter",r-1)}}},qhe=gn(Vhe),Xhe=[jhe,Ghe,qhe];class Khe extends it{constructor(){super(...arguments),this.name="affine-embed-doc-block"}setup(e){super.setup(e),e.register([JC,ZC]),e.register(zhe),e.register(Xhe)}}class Qhe extends it{constructor(){super(...arguments),this.name="affine-frame-block"}setup(e){super.setup(e),e.register([yj])}}async function Cm(t,e,n,r){var i,s,o,a,l,c,u;let d="";if(uE.fetchable(t))try{const h=await uE.fetchImage(t,void 0,r.get("imageProxy"));if(!h)return;const f=h.clone(),p=(c=nN((s=h.headers.get("Content-Disposition"))!=null?s:""))!=null?c:((o=t.split("/").at(-1))!=null?o:"image")+"."+((l=(a=h.headers.get("Content-Type"))==null?void 0:a.split("/").at(-1))!=null?l:"png"),g=new File([await h.blob()],p,{type:(u=h.headers.get("Content-Type"))!=null?u:""});d=await Tg(await f.arrayBuffer()),n==null||n.getAssets().set(d,g),await(n==null?void 0:n.writeToBlob(d))}catch(h){console.error("Failed to process image:",h);return}else{const h=r.get(dre);if(h){const f=decodeURIComponent(t),p=Jre(h,f);d=(i=n.getPathBlobIdMap().get(p))!=null?i:""}else{const f=t.split("/");for(;f.length>0;){const p=n.getPathBlobIdMap().get(decodeURIComponent(f.join("/")));if(p){d=p;break}f.shift()}}}e.openNode({type:"block",id:K(),flavour:Yo.model.flavour,props:{sourceId:d},children:[]},"children").closeNode(),e.skipAllChildren()}const Zhe={flavour:Yo.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="img",fromMatch:t=>t.node.flavour===Yo.model.flavour,toBlockSnapshot:{enter:async(t,e)=>{if(!H.isElement(t.node))return;const{assets:n,walkerContext:r,configs:i}=e;if(!n)return;const s=t.node,o=typeof(s==null?void 0:s.properties.src)=="string"?s.properties.src:"";o&&await Cm(o,r,n,i)}},fromBlockSnapshot:{enter:async(t,e)=>{var n,r;const i=(n=t.node.props.sourceId)!=null?n:"",{assets:s,walkerContext:o,updateAssetIds:a}=e;if(!s)return;await s.readFromBlob(i);const l=s.getAssets().get(i);if(a==null||a(i),!l)return;const c=Sg(s.getAssets(),i),d=t.node.props.width&&t.node.props.height?{width:`${t.node.props.width}px`,height:`${t.node.props.height}px`}:{};o.openNode({type:"element",tagName:"figure",properties:{className:["affine-image-block-container"]},children:[]},"children").openNode({type:"element",tagName:"img",properties:{src:`assets/${c}`,alt:c,title:(r=t.node.props.caption)!=null?r:null,...d},children:[]},"children").closeNode().closeNode()}}},Jhe=In(Zhe),efe=t=>t.type==="image",tfe={flavour:Yo.model.flavour,toMatch:t=>efe(t.node),fromMatch:t=>t.node.flavour===Yo.model.flavour,toBlockSnapshot:{enter:async(t,e)=>{const{configs:n,walkerContext:r,assets:i}=e,s="url"in t.node?t.node.url:"";!i||!s||await Cm(s,r,i,n)}},fromBlockSnapshot:{enter:async(t,e)=>{var n,r,i;const{assets:s,walkerContext:o,updateAssetIds:a}=e,l=(n=t.node.props.sourceId)!=null?n:"";if(!s)return;await s.readFromBlob(l);const c=s.getAssets().get(l);if(!c)return;const u=Sg(s.getAssets(),l);a==null||a(l),o.openNode({type:"paragraph",children:[]},"children").openNode({type:"image",url:`assets/${u}`,title:(r=t.node.props.caption)!=null?r:null,alt:(i=c.name)!=null?i:null},"children").closeNode().closeNode()}}},nfe=Rt(tfe),rfe={flavour:Yo.model.flavour,toMatch:t=>H.isElement(t.node)&&(t.node.tagName==="img"||t.node.tagName==="figure"&&!!H.querySelector(t.node,".image")),fromMatch:()=>!1,toBlockSnapshot:{enter:async(t,e)=>{if(!H.isElement(t.node))return;const{assets:n,walkerContext:r,configs:i}=e;if(n&&!r.getGlobalContext("hast:disableimg"))switch(t.node.tagName){case"img":{const s=t.node,o=typeof(s==null?void 0:s.properties.src)=="string"?s.properties.src:"";o&&await Cm(o,r,n,i);break}case"figure":{const s=H.querySelector(t.node,".image");let o="";if(s){const a=H.querySelector(s,"img");o=typeof(a==null?void 0:a.properties.src)=="string"?a.properties.src:""}o&&await Cm(o,r,n,i);break}}}},fromBlockSnapshot:{}},ife=fr(rfe),sfe=[Jhe,nfe,ife];class ofe extends it{constructor(){super(...arguments),this.name="affine-image-block"}setup(e){super.setup(e),e.register([vj,gre]),e.register(sfe)}}const afe=t=>t.type==="math",lfe={flavour:Go.model.flavour,toMatch:t=>afe(t.node),fromMatch:t=>t.node.flavour===Go.model.flavour,toBlockSnapshot:{enter:(t,e)=>{const n="value"in t.node?t.node.value:"",{walkerContext:r}=e;r.openNode({type:"block",id:K(),flavour:"affine:latex",props:{latex:n},children:[]},"children").closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const n="latex"in t.node.props?t.node.props.latex:"",{walkerContext:r}=e;r.openNode({type:"math",value:n},"children").closeNode()}}},cfe=Rt(lfe);function ufe(t){const e=/(```[\S\s]*?```|`.*?`)|\\\[([\S\s]*?[^\\])\\]|\\\((.*?)\\\)/g;return t.replaceAll(e,(n,r,i,s)=>r||(i?`$$${i}$$`:s?`$${s}$`:n))}function dfe(t){return t.replaceAll("$\\ce{","$\\\\ce{").replaceAll("$\\pu{","$\\\\pu{")}function hfe(t){const e=[];let n=t;n=n.replace(/(```[\s\S]*?```|`[^`\n]+`)/g,(i,s)=>(e.push(s),`<<CODE_BLOCK_${e.length-1}>>`));const r=[];return n=n.replace(/(\$\$[\s\S]*?\$\$|\\\[[\s\S]*?\\\]|\\\(.*?\\\))/g,i=>(r.push(i),`<<LATEX_${r.length-1}>>`)),n=n.replace(/\$(?=\d)/g,"\\$"),n=n.replace(/<<LATEX_(\d+)>>/g,(i,s)=>r[parseInt(s)]),n=n.replace(/<<CODE_BLOCK_(\d+)>>/g,(i,s)=>e[parseInt(s)]),n=ufe(n),n=dfe(n),n}const HO=xm({name:"latex",levels:["block","slice","doc"],preprocess:t=>hfe(t)}),ffe=[HO,cfe],pfe={flavour:Go.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="figure"&&!!H.querySelector(t.node,".equation-container"),fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e,r=H.getTextContent(H.querySelector(t.node,"annotation"));n.openNode({type:"block",id:K(),flavour:Go.model.flavour,props:{latex:r},children:[]},"children").closeNode(),n.skipAllChildren()}},fromBlockSnapshot:{}},mfe=fr(pfe),gfe="LaTex, with value: ",bfe={flavour:Go.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===Go.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{const n="latex"in t.node.props?t.node.props.latex:"",{textBuffer:r}=e;n&&(r.content+=`${gfe}${n}`,r.content+=`
`)}}},yfe=gn(bfe),_fe=[ffe,mfe,yfe].flat();let xfe=class extends it{constructor(){super(...arguments),this.name="affine-latex-block"}setup(e){super.setup(e),e.register([kj]),e.register(_fe),e.register(HO)}};const Efe=[Vue,Que,nde,ede];class vfe extends it{constructor(){super(...arguments),this.name="affine-list-block"}setup(e){super.setup(e),e.register(Sj),e.register(Efe)}}const wfe=$e({mode:zf(["doc","edgeless"]).optional()});class kfe extends it{constructor(){super(...arguments),this.name="affine-note-block",this.schema=wfe}setup(e,n){super.setup(e),e.register(Aj),(n==null?void 0:n.mode)==="edgeless"?e.register(Gle):e.register(Yle)}}const Tfe=[Kle,ece,cce,ace];class Sfe extends it{constructor(){super(...arguments),this.name="affine-paragraph-block"}setup(e){super.setup(e),e.register(Ij),e.register(Tfe)}}const Cfe={flavour:ol.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="header",fromMatch:t=>t.node.flavour===ol.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;t.node.tagName==="header"&&n.skipAllChildren()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e,r=n.getGlobalContext("hast:html-root-doc");(r??!0)&&n.openNode({type:"element",tagName:"html",properties:{},children:[]},"children").openNode({type:"element",tagName:"head",properties:{},children:[]},"children").openNode({type:"element",tagName:"style",properties:{},children:[]},"children").openNode({type:"text",value:`
            input[type='checkbox'] {
              display: none;
            }
            label:before {
              background: rgb(30, 150, 235);
              border-radius: 3px;
              height: 16px;
              width: 16px;
              display: inline-block;
              cursor: pointer;
            }
            input[type='checkbox'] + label:before {
              content: '';
              background: rgb(30, 150, 235);
              color: #fff;
              font-size: 16px;
              line-height: 16px;
              text-align: center;
            }
            input[type='checkbox']:checked + label:before {
              content: '';
            }
            `.replace(/\s\s+/g,"")},"children").closeNode().closeNode().closeNode().openNode({type:"element",tagName:"body",properties:{},children:[]},"children").openNode({type:"element",tagName:"div",properties:{style:"width: 70vw; margin: 60px auto;"},children:[]},"children").openNode({type:"comment",value:"BlockSuiteDocTitlePlaceholder"}).closeNode()},leave:(t,e)=>{const{walkerContext:n}=e,r=n.getGlobalContext("hast:html-root-doc");(r??!0)&&n.closeNode().closeNode().closeNode()}}},Afe=In(Cfe),Ife={flavour:ol.model.flavour,toMatch:()=>!1,fromMatch:t=>t.node.flavour===ol.model.flavour,toBlockSnapshot:{},fromBlockSnapshot:{enter:(t,e)=>{var n;const r=(n=t.node.props.title)!=null?n:{delta:[]},{walkerContext:i,deltaConverter:s}=e;r.delta.length!==0&&i.openNode({type:"heading",depth:1,children:s.deltaToAST(r.delta,0)},"children").closeNode()}}},Mfe=Rt(Ife),Dfe={flavour:ol.model.flavour,toMatch:t=>H.isElement(t.node)&&t.node.tagName==="header",fromMatch:()=>!1,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;t.node.tagName==="header"&&n.skipAllChildren()}},fromBlockSnapshot:{}},Nfe=fr(Dfe),Ofe=[Afe,Mfe,Nfe];class Pfe extends it{constructor(){super(...arguments),this.name="affine-root-block"}setup(e){super.setup(e),e.register(Dj),e.register(Ofe)}}class Lfe extends it{constructor(){super(...arguments),this.name="affine-surface-block"}setup(e){super.setup(e),e.register(vle),e.register(xle)}}class Rfe extends it{constructor(){super(...arguments),this.name="affine-surface-ref-block"}setup(e){super.setup(e),e.register(Nj)}}const Bfe=120,Ffe=t=>({"$blocksuite:internal:text$":!0,delta:t});function Ufe(t){var e,n;return(n=(e=t[0])==null?void 0:e.map((r,i)=>Math.max(...t.map(s=>(s[i]||"").length))))!=null?n:[]}function $fe(t,e,n){const i=`| ${t.map((s,o)=>{var a;return s==null?void 0:s.padEnd((a=e[o])!=null?a:0," ")}).join(" | ")} |`;return n?`${i}
${Hfe(e)}`:i}function Hfe(t){return`| ${t.map(n=>"-".repeat(n)).join(" | ")} |`}function zfe(t){const e=Ufe(t);return t.map((r,i)=>$fe(r,e,i===0)).join(`
`)}const IE=(t,e,n)=>{const r=Object.values(t).sort((o,a)=>o.order.localeCompare(a.order)),i=Object.values(e).sort((o,a)=>o.order.localeCompare(a.order)),s={rows:[]};return i.forEach(o=>{const a={cells:[]};r.forEach(l=>{const c=n[`${o.rowId}:${l.columnId}`];if(!c){a.cells.push({value:{delta:[]}});return}a.cells.push({value:c.text})}),s.rows.push(a)}),s},gs=(t,e)=>t?H.isElement(t)?t.tagName===e?[t]:t.children.flatMap(n=>H.isElement(n)?gs(n,e):[]):[]:[],ME=t=>{var e;const n=l=>{var c,u;const d=Array.from({length:l});for(let h=0;h<l;h++){const f=K(),p=xre((u=(c=d[h-1])==null?void 0:c.order)!=null?u:null,null);d[h]={id:f,order:p}}return d},r=Math.max(...t.map(l=>l.length)),i=t.length,s=n(r).map(l=>({columnId:l.id,order:l.order})),o=n(i).map(l=>({rowId:l.id,order:l.order})),a={};for(let l=0;l<i;l++)for(let c=0;c<r;c++){const u=o[l],d=s[c];if(!u||!d)continue;const h=`${u.rowId}:${d.columnId}`,f=(e=t[l])==null?void 0:e[c];a[h]={text:Ffe(f??[])}}return{columns:Object.fromEntries(s.map(l=>[l.columnId,l])),rows:Object.fromEntries(o.map(l=>[l.rowId,l])),cells:a}},Wfe=(t,e)=>{const n=gs(t,"thead").flatMap(a=>gs(a,"tr").map(l=>gs(l,"th"))),r=gs(t,"tbody").flatMap(a=>gs(a,"tr").map(l=>gs(l,"td"))),i=gs(t,"tfoot").flatMap(a=>gs(a,"tr").map(l=>gs(l,"td"))),s=[...n,...r,...i],o=[];return s.forEach(a=>{const l=[];a.forEach(c=>{l.push(e(c))}),o.push(l)}),ME(o)},jfe=(t,e)=>{const n=[];return t.children.forEach(r=>{const i=[];r.children.forEach(s=>{i.push(e(s))}),n.push(i)}),ME(n)},Yfe=new Set(["table","thead","tbody","th","tr"]),Gfe={flavour:eo.model.flavour,toMatch:t=>H.isElement(t.node)&&Yfe.has(t.node.tagName),fromMatch:t=>t.node.flavour===eo.model.flavour,toBlockSnapshot:{enter:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;if(t.node.tagName==="table"){const r=e.deltaConverter.astToDelta.bind(e.deltaConverter),i=Wfe(t.node,r);n.openNode({type:"block",id:K(),flavour:$p,props:i,children:[]},"children"),n.skipAllChildren()}},leave:(t,e)=>{if(!H.isElement(t.node))return;const{walkerContext:n}=e;t.node.tagName==="table"&&n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e,{columns:r,rows:i,cells:s}=t.node.props,o=IE(r,i,s),a=d=>({type:"element",tagName:"td",properties:Object.create(null),children:[{type:"element",tagName:"div",properties:{style:`min-height: 22px;min-width:${Bfe}px;padding: 8px 12px;`},children:d}]}),l=d=>({type:"element",tagName:"tr",properties:Object.create(null),children:d}),{deltaConverter:c}=e,u={type:"element",tagName:"tbody",properties:Object.create(null),children:o.rows.map(d=>l(d.cells.map(h=>a(typeof h.value=="string"?[{type:"text",value:h.value}]:c.deltaToAST(h.value.delta)))))};n.openNode({type:"element",tagName:"table",properties:{border:!0,style:"border-collapse: collapse;border-spacing: 0;"},children:[u]}).closeNode(),n.skipAllChildren()}}},Vfe=In(Gfe),qfe=new Set(["table","tableRow"]),Xfe=t=>qfe.has(t.type),Kfe={flavour:eo.model.flavour,toMatch:t=>Xfe(t.node),fromMatch:t=>t.node.flavour===eo.model.flavour,toBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e;if(t.node.type==="table"){const r=e.deltaConverter.astToDelta.bind(e.deltaConverter);n.openNode({type:"block",id:K(),flavour:$p,props:jfe(t.node,r),children:[]},"children"),n.skipAllChildren()}},leave:(t,e)=>{const{walkerContext:n}=e;t.node.type==="table"&&n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,deltaConverter:r}=e,{columns:i,rows:s,cells:o}=t.node.props,a=IE(i,s,o),l=[];a.rows.forEach(c=>{l.push({type:"tableRow",children:c.cells.map(u=>({type:"tableCell",children:r.deltaToAST(u.value.delta)}))})}),n.openNode({type:"table",children:l}).closeNode(),n.skipAllChildren()}}},Qfe=Rt(Kfe),Zfe=new Set(["table","th","tr"]),Jfe={flavour:eo.model.flavour,toMatch:t=>H.isElement(t.node)&&Zfe.has(t.node.tagName),fromMatch:()=>!1,toBlockSnapshot:{},fromBlockSnapshot:{}},epe=fr(Jfe),tpe={flavour:eo.model.flavour,toMatch:()=>!0,fromMatch:t=>t.node.flavour===eo.model.flavour,toBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n}=e,i=t.node.content.split(`
`);if(i.length<=1)return;const s=[];let o=null;for(const l of i){const c=l.split("	").map(u=>[{insert:u}]);if(c.length<=1)return;if(o==null)o=c.length;else if(o!==c.length)return;s.push(c)}const a=ME(s);n.openNode({type:"block",id:K(),flavour:$p,props:a,children:[]}),n.skipAllChildren()},leave:(t,e)=>{const{walkerContext:n}=e;n.closeNode()}},fromBlockSnapshot:{enter:(t,e)=>{const{walkerContext:n,deltaConverter:r}=e,i=[],{columns:s,rows:o,cells:a}=t.node.props;IE(s,o,a).rows.forEach(u=>{i.push(u.cells.map(d=>r.deltaToAST(d.value.delta).join("")))});const c=zfe(i);e.textBuffer.content+=c,e.textBuffer.content+=`
`,n.skipAllChildren()}}},npe=gn(tpe),rpe=[Vfe,Qfe,epe,npe],ipe=$e({type:_r("area"),rowStartIndex:dn(),rowEndIndex:dn(),columnStartIndex:dn(),columnEndIndex:dn()}),spe=$e({type:_r("row"),rowId:pe()}),ope=$e({type:_r("column"),columnId:pe()}),ape=ko([ipe,spe,ope]),lpe=$e({blockId:pe(),data:ape}),Am=class nv extends Us{constructor({blockId:e,data:n}){super({blockId:e}),this.data=n}static fromJSON(e){return lpe.parse(e),new nv({blockId:e.blockId,data:e.data})}equals(e){return e instanceof nv?this.blockId===e.blockId:!1}toJSON(){return{type:"table",blockId:this.blockId,data:this.data}}};Am.group="note",Am.type="table",Am.recoverable=!0;const cpe=So(Am);class upe extends it{constructor(){super(...arguments),this.name="affine-table-block"}setup(e){super.setup(e),e.register(Lj),e.register(rpe),e.register(cpe)}}class dpe extends it{constructor(){super(...arguments),this.name="foundation"}setup(e){super.setup(e),e.register([_$,T$,w$,E$,pre,sre,Qre,SZ,Vre,jre,$re,lE,J4,dN])}}const hpe=Xc({name:"brush",match:t=>t.type==="brush",toAST:()=>({type:"paragraph",children:[{type:"text",value:"Brush Stroke"}]})}),fpe=Kc({name:"brush",match:t=>t.type==="brush",toAST:()=>({content:"Brush Stroke"})});class ppe extends it{constructor(){super(...arguments),this.name="affine-brush-gfx"}setup(e){super.setup(e),e.register(hpe),e.register(fpe)}}function zO(t){let e="";if(t.type!=="connector")return e;if("text"in t&&typeof t.text=="object"&&t.text){let n=[];"delta"in t.text&&(n=t.text.delta),e=n.map(r=>r.insert).join("")}return e}const mpe=Xc({name:"connector",match:t=>t.type==="connector",toAST:t=>{const e=zO(t);return e?{type:"paragraph",children:[{type:"text",value:`Connector, with text label "${e}"`}]}:null}}),gpe=Kc({name:"connector",match:t=>t.type==="connector",toAST:t=>({content:`Connector, with text label "${zO(t)}"`})});function bpe(t){return t instanceof Mt&&t.hasLabel()}function Im(t,e=!1){return{...X.deserialize(t.xywh),rotate:e?-t.rotate:t.rotate}}function Mm(t){const e=X.deserialize(t.xywh),n=10,r=[],i=t.rotate;return[[e.center[0],e.y-n],[e.center[0],e.maxY+n],[e.x-n,e.center[1]],[e.maxX+n,e.center[1]]].map(s=>ng({...e,rotate:i},s)).forEach(s=>{const o=t.getLineIntersections(e.center,s);if(!o)return;const a=ng({...e,rotate:-i},o[0]);r.push({point:o[0],coord:e.toRelative(a)})}),r}function ype(t,e){const n=t.getRelativePointLocation(e);return Al(R.sub(e,[0,.5]))?n.tangent=R.rot([0,-1],po(t.rotate)):Al(R.sub(e,[1,.5]))?n.tangent=R.rot([0,1],po(t.rotate)):Al(R.sub(e,[.5,0]))?n.tangent=R.rot([1,0],po(t.rotate)):Al(R.sub(e,[.5,1]))&&(n.tangent=R.rot([-1,0],po(t.rotate))),n}function zh(t,e){const n=Mm(t);return _pe(n.map(r=>r.point),e)}function _pe(t,e){if(t.length===0)return null;const n=t.map(r=>({p:r,d:R.dist(r,e)}));return n.sort((r,i)=>r.d-i.d),n[0].p}function xpe(t,e,n,r,i,s,o,a){var l,c;const u=Wh(t),d=Wh(e);let h=Wh(n),f=Wh(r);const p=wpe(u,d,h,f,i,s,o,a),g=p.points;return h=p.nextStartPoint,f=p.lastEndPoint,[WO(WO(g,(l=o==null?void 0:o.expand(-1))!=null?l:null),(c=a==null?void 0:a.expand(-1))!=null?c:null),u,d,h,f]}function Wh(t){var e;return[Number(t[0].toFixed(2)),Number(t[1].toFixed(2)),(e=t[2])!=null?e:0]}function WO(t,e){return t.filter(n=>e?!e.isPointInBound([n[0],n[1]]):!0)}function Ii(t,e,n=0){t.push(...e.map(r=>[...r,n]))}function ua(t,e,n,r=0){const i=Wr(e[0],e[1],n[0],n[1],!0);i&&Ii(t,[i],r)}function Epe(t,e,n,r){e&&n&&r&&(Ii(t,r.getVerticesAndMidpoints()),Ii(t,[r.center],2),[e.upperLine,e.horizontalLine,e.lowerLine,n.upperLine,n.horizontalLine,n.lowerLine].forEach(i=>{ua(t,i,r.leftLine,0),ua(t,i,r.rightLine,0)}),[e.leftLine,e.verticalLine,e.rightLine,n.leftLine,n.verticalLine,n.rightLine].forEach(i=>{ua(t,i,r.upperLine,0),ua(t,i,r.lowerLine,0)}))}function jO(t,e,n,r,i){if(e.maxX<n.x){const s=(e.maxX+n.x)/2;[r.horizontalLine,i.horizontalLine,r.upperLine,r.lowerLine,i.upperLine,i.lowerLine].forEach((o,a)=>{ua(t,o,[[s,0],[s,1]],a===0||a===1?6:3)})}if(e.maxY<n.y){const s=(e.maxY+n.y)/2;[r.verticalLine,i.verticalLine,r.leftLine,r.rightLine,i.leftLine,i.rightLine].forEach((o,a)=>{ua(t,o,[[0,s],[1,s]],a===0||a===1?6:3)})}}function YO(t,e,n,r,i,s){if(Je(e[1],n.y,.02)||Je(e[1],n.maxY,.02)){const o=[n.upperLine,n.lowerLine,r.upperLine,r.lowerLine].map(l=>Wr([e[0],e[1]],[e[0],e[1]+1],l[0],l[1],!0)).filter(l=>l!==null);o.sort((l,c)=>l[1]-c[1]);const a=R.lrp(o[1],o[2],.5);Ii(t,[a],6),[i.leftLine,i.rightLine,s.leftLine,s.rightLine].forEach(l=>{ua(t,[a,[a[0]+1,a[1]]],l,0)})}else{const o=[n.leftLine,n.rightLine,r.leftLine,r.rightLine].map(l=>Wr([e[0],e[1]],[e[0]+1,e[1]],l[0],l[1],!0)).filter(l=>l!==null);o.sort((l,c)=>l[0]-c[0]);const a=R.lrp(o[1],o[2],.5);Ii(t,[a],6),[i.upperLine,i.lowerLine,s.upperLine,s.lowerLine].forEach(l=>{ua(t,[a,[a[0],a[1]+1]],l,0)})}}function vpe(t){t=t.map(Wh),t.sort((e,n)=>e[0]-n[0]);for(let e=1;e<t.length-1;e++){const n=t[e],r=t[e-1];Je(n[0],r[0],.02)&&(n[0]=r[0])}t.sort((e,n)=>e[1]-n[1]);for(let e=1;e<t.length-1;e++){const n=t[e],r=t[e-1];Je(n[1],r[1],.02)&&(n[1]=r[1])}t.sort((e,n)=>e[0]<n[0]?-1:e[0]>n[0]?1:e[1]<n[1]?-1:e[1]>n[1]?1:0);for(let e=1;e<t.length;e++){const n=t[e],r=t[e-1];if(Je(n[0],r[0],.02)&&Je(n[1],r[1],.02)){n[2]<=r[2]?t.splice(e,1):t.splice(e-1,1),e--;continue}}return t}function wpe(t,e,n,r,i,s,o,a){const l=X.fromPoints([[t[0],t[1]],[e[0],e[1]]]),c=o&&a&&o.unite(a);let u=[n,r];Ii(u,l.getVerticesAndMidpoints()),(!i||!s)&&Ii(u,[l.center],3),c&&Epe(u,o,a,c),i&&s&&o&&a&&(YO(u,t,i,s,o,a),YO(u,e,s,i,a,o),jO(u,i,s,o,a),jO(u,s,i,a,o)),o&&(Ii(u,o.getVerticesAndMidpoints()),Ii(u,o.include([r[0],r[1]]).points)),a&&(Ii(u,a.getVerticesAndMidpoints()),Ii(u,a.include([n[0],n[1]]).points)),u=vpe(u);const d=u.map(f=>f[0]+","+f[1]).sort();d.forEach((f,p)=>{if(p!==0&&f===d[p-1])throw new Error("duplicate point")});const h=[n,r].map(f=>u.find(p=>Je(p[0],f[0],.02)&&Je(p[1],f[1],.02)));if(!h[0]||!h[1])throw new V(V.ErrorCode.ValueNotExists,"Failed to get start and end points when getting connectable points");return{points:u,nextStartPoint:h[0],lastEndPoint:h[1]}}function DE(t,e){if(Je(t[0],e[0],.02)||Je(t[1],e[1],.02))return[t,e];{const n=R.sub(e,t),r=[t[0],t[1]+n[1]];return[t,r,e]}}function kpe(t){if(t.length===0)return[];const e=[[t[0][0],t[0][1]]];for(let n=1;n<t.length-1;n++){const r=t[n],i=t[n-1],s=t[n+1];Je(i[0],r[0],.02)&&Je(r[0],s[0],.02)||Je(i[1],r[1],.02)&&Je(r[1],s[1],.02)||e.push([r[0],r[1]])}t.length!==0&&e.push([t[t.length-1][0],t[t.length-1][1]]);for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];Je(r[0],i[0],.02)||Je(r[1],i[1],.02)||(console.warn("Expected equal points"),console.warn(t),console.warn(e))}return e}function Tpe(t,e){const n=[20,20,20,20],r=[20,20,20,20];if(!(t&&e))return[n,r];let i=uu(t.upperLine,e.lowerLine,0,!1),s;return i&&t.upperLine[0][1]>e.lowerLine[0][1]&&(s=R.distanceToLineSegment(t.upperLine[0],t.upperLine[1],e.lowerLine[0],!1),n[1]=Math.max(Math.min(s/2,n[1]),0)),i=uu(t.rightLine,e.leftLine,1,!1),i&&t.rightLine[0][0]<e.leftLine[0][0]&&(s=R.distanceToLineSegment(t.rightLine[0],t.rightLine[1],e.leftLine[0],!1),n[2]=Math.max(Math.min(s/2,n[2]),0)),i=uu(t.lowerLine,e.upperLine,0,!1),i&&t.lowerLine[0][1]<e.upperLine[0][1]&&(s=R.distanceToLineSegment(t.lowerLine[0],t.lowerLine[1],e.upperLine[0],!1),n[3]=Math.max(Math.min(s/2,n[3]),0)),n[0]=r[2]=Math.min(n[0],r[2])===0?20:Math.min(n[0],r[2]),n[1]=r[3]=Math.min(n[1],r[3])===0?20:Math.min(n[1],r[3]),n[2]=r[0]=Math.min(n[2],r[0])===0?20:Math.min(n[2],r[0]),n[3]=r[1]=Math.min(n[3],r[1])===0?20:Math.min(n[3],r[1]),[n,r]}function GO(t,e,n=10,r=10,i=10,s=10){const o=[e[0],e[1]];if(Je(t.x,o[0]))o[0]-=n;else if(Je(t.y,o[1]))o[1]-=r;else if(Je(t.maxX,o[0]))o[0]+=i;else if(Je(t.maxY,o[1]))o[1]+=s;else{const a=R.normalize(R.sub(o,t.center)),l=a[0]>0?1:-1,c=a[1]>0?1:-1;if((Math.abs(e.tangent[0])<Math.abs(e.tangent[1])?0:1)===0)if(l>0){const d=Wr(t.rightLine[0],t.rightLine[1],o,[t.maxX+10,o[1]]);if(!d)throw new V(V.ErrorCode.ValueNotExists,"Failed to get line intersections for getNextPoint");o[0]=d[0]+n}else{const d=Wr(t.leftLine[0],t.leftLine[1],o,[t.x-10,o[1]]);if(!d)throw new V(V.ErrorCode.ValueNotExists,"Failed to get line intersections for getNextPoint");o[0]=d[0]-n}else if(c>0){const d=Wr(t.lowerLine[0],t.lowerLine[1],o,[o[0],t.maxY+10]);if(!d)throw new V(V.ErrorCode.ValueNotExists,"Failed to get line intersections for getNextPoint");o[1]=d[1]+r}else{const d=Wr(t.upperLine[0],t.upperLine[1],o,[o[0],t.y-10]);if(!d)throw new V(V.ErrorCode.ValueNotExists,"Failed to get line intersections for getNextPoint");o[1]=d[1]-r}}return o}function Spe(t,e,n,r,i,s){const o=n&&i?GO(n,t,i[0],i[1],i[2],i[3]):t,a=r&&s?GO(r,e,s[0],s[1],s[2],s[3]):e;return[o,a]}function Cpe(t,e,n=null,r=null){r||(Math.abs(e[0]-t[0])>Math.abs(e[1]-t[1])?e[0]+=nf(e[0]-t[0])*20:e[1]+=nf(e[1]-t[1])*20),n||(Math.abs(e[0]-t[0])>Math.abs(e[1]-t[1])?t[0]-=nf(e[0]-t[0])*20:t[1]-=nf(e[1]-t[1])*20)}function VO(t,e,n,r){const{x:i,y:s,w:o,h:a}=e;t.save(),t.beginPath(),t.strokeStyle=n,t.lineWidth=r,t.setLineDash([r*2,r*2]),t.strokeRect(i,s,o,a),t.closePath(),t.restore()}class Ape extends oO{constructor(e){super(e),this._themeDisposer=null,this.highlightPoint=null,this.points=[],this.sourceBounds=null,this.targetBounds=null,this._emphasisColor=this._getEmphasisColor(),this._setupThemeListener()}_findConnectablesInViews(){const e=this.gfx,n=e.viewport.viewportBounds;return e.getElementsByBound(n).filter(r=>r.connectable)}_getEmphasisColor(){return getComputedStyle(this.gfx.std.host).getPropertyValue("--affine-text-emphasis-color")}_setupThemeListener(){const e=this.gfx.std.get(Em);this._themeDisposer=Pu(()=>{e.theme$,this._emphasisColor=this._getEmphasisColor()})}_clearRect(){var e;this.points=[],this.highlightPoint=null,(e=this._renderer)==null||e.refresh()}clear(){this.sourceBounds=null,this.targetBounds=null,this._clearRect()}dispose(){var e;(e=this._themeDisposer)==null||e.call(this),this._renderer&&(this._renderer.removeOverlay(this),this._renderer=null)}render(e){const n=this.gfx.viewport.zoom,r=5/n,i=this._emphasisColor;e.globalAlpha=.6;let s=1/n;this.sourceBounds&&VO(e,this.sourceBounds,i,s),this.targetBounds&&VO(e,this.targetBounds,i,s),s=2/n,this.points.forEach(o=>{e.beginPath(),e.arc(o[0],o[1],r,0,ov),e.fillStyle="white",e.strokeStyle=i,e.lineWidth=s,e.fill(),e.stroke(),e.closePath()}),e.globalAlpha=1,this.highlightPoint&&(e.beginPath(),e.arc(this.highlightPoint[0],this.highlightPoint[1],r,0,ov),e.fillStyle=i,e.strokeStyle=i,e.lineWidth=s,e.fill(),e.stroke(),e.closePath())}renderConnector(e,n=[]){var r,i;const s=this._findConnectablesInViews(),o=this.gfx,a=[];this._clearRect();let l=null;for(let c=0;c<s.length;c++){const u=s[c];if(n.includes(u.id))continue;const d=X.deserialize(u.xywh);if(!X.from(mo(Im(u))).expand(10).isPointInBound(e))continue;const f=Mm(u),p=f.length,g=o.viewport.toViewCoord(e[0],e[1]);let b=Number.POSITIVE_INFINITY,_=0;for(this.points=f.map(x=>x.point);_<p;_++){const x=f[_],E=o.viewport.toViewCoord(x.point[0],x.point[1]),I=R.dist(E,g);I<b&&(b=I,a.push(u),this.highlightPoint=x.point,l={id:u.id,position:x.coord})}if(b<8&&l)break;const y=u.getNearestPoint(e);if(R.dist(y,e)<8){this.highlightPoint=y;const x=ng(Im(u,!0),y);(r=this._renderer)==null||r.refresh(),a.push(u),l={id:u.id,position:R.clampV(d.toRelative(x),0,1)}}l||u.includesPoint(e[0],e[1],{ignoreTransparent:!1},this.gfx.std.host)&&(a.push(u),l={id:u.id})}return Jt(a)instanceof Ic?this.targetBounds=X.deserialize(Jt(a).xywh):this.targetBounds=null,l||(l={position:e}),(i=this._renderer)==null||i.refresh(),l}}Ape.overlayName="connection";class Ipe{constructor(){this._aStarRunner=null}_prepareOrthogonalConnectorInfo(e){const{startBound:n,endBound:r,startPoint:i,endPoint:s}=e,[o,a]=Tpe(n,r),[l,c]=Spe(i,s,n,r,o,a),u=n?n.expand(o[0],o[1],o[2],o[3]):null,d=r?r.expand(a[0],a[1],a[2],a[3]):null;return[i,s,l,c,n,r,u,d]}generateOrthogonalConnectorPath(e){const n=this._prepareOrthogonalConnectorInfo(e),[r,i,s,o]=n,[,,,,a,l,c,u]=n,d=[],h=[];if(a&&d.push(a.clone()),l&&d.push(l.clone()),c&&h.push(c.clone()),u&&h.push(u.clone()),a&&l&&a.isPointInBound(i)&&l.isPointInBound(r)||a&&(c!=null&&c.isPointInBound(i,0))||l&&(u!=null&&u.isPointInBound(r,0)))return DE(r,i);const f=xpe(r,i,s,o,a,l,c,u),p=f[0],[,g,b,_,y]=f;Cpe(g,b,a,l),this._aStarRunner=new Mle(p,_,y,g,b,d,h),this._aStarRunner.run();const x=this._aStarRunner.path;return l||x.pop(),a||x.shift(),kpe(x)}}class NE extends Ipe{constructor(e){super(),this.options=e}static updatePath(e,n,r){var i;const s=new NE({getElementById:r??(()=>null)}),o=(i=n??s._generateConnectorPath(e))!=null?i:[],a=e.mode===en.Curve?W6(Nl(o)):du(o),l=o.map(c=>c.setVec(R.sub(c,[a.x,a.y])));if(e.updatingPath=!0,e.xywh=a.serialize(),e.path=l,bpe(e)){const c=e,[u,d]=c.getPointByOffsetDistance(c.labelOffset.distance),[,,h,f]=c.labelXYWH;c.labelXYWH=[u-h/2,d-f/2,h,f]}e.updatingPath=!1}_computeStartEndPoint(e){const{source:n,target:r}=e,i=this._getConnectorEndElement(e,"source"),s=this._getConnectorEndElement(e,"target");let o=null,a=null;if(n.id&&!n.position&&r.id&&!r.position&&i&&s){const l=Mm(i),c=Mm(s);let u=1/0,d=new wt,h=new wt;for(const f of l)for(const p of c){const g=R.dist(f.point,p.point);g+.1<u&&(u=g,d=f.point,h=p.point)}o=d,a=h}else o=this._getConnectionPoint(e,"source"),a=this._getConnectionPoint(e,"target");return!o||!a?[]:[o,a]}_generateConnectorPath(e){const{mode:n}=e;if(n===en.Straight)return this._generateStraightConnectorPath(e);if(n===en.Orthogonal){const r=this._getConnectorEndElement(e,"source"),i=this._getConnectorEndElement(e,"target"),[s,o]=this._computeStartEndPoint(e),a=r?X.from(mo(Im(r))):null,l=i?X.from(mo(Im(i))):null;return this.generateOrthogonalConnectorPath({startPoint:s,endPoint:o,startBound:a,endBound:l}).map(u=>new wt(u))}else if(n===en.Curve)return this._generateCurveConnectorPath(e);throw new Error("unknown connector mode")}_generateCurveConnectorPath(e){const{source:n,target:r}=e;let i=null,s=null;if(n.id||r.id){if(!n.position&&!r.position){const o=this._getConnectorEndElement(e,"source"),a=this._getConnectorEndElement(e,"target"),l=X.deserialize(o.xywh),c=X.deserialize(a.xywh);i=zh(o,c.center),s=zh(a,l.center)}else i=this._getConnectionPoint(e,"source"),s=this._getConnectionPoint(e,"target");if(!i||!s)return[];if(n.id){const o=R.rot(i.tangent,-Math.PI/2);i.out=Al(o)?R.mul(R.per(R.normalize(R.sub(i,s))),20):R.mul(o,Math.max(100,Math.abs(R.pry(R.sub(s,i),o))/3))}if(r.id){const o=R.rot(s.tangent,-Math.PI/2);s.in=Al(o)?R.mul(R.per(R.normalize(R.sub(s,i))),20):R.mul(o,Math.max(100,Math.abs(R.pry(R.sub(i,s),o))/3))}return[i,s]}else return i=this._getConnectionPoint(e,"source"),s=this._getConnectionPoint(e,"target"),!i||!s?[]:(Math.abs(s[0]-i[0])>Math.abs(s[1]-i[1])?(i.out=[R.mul(R.sub(s,i),2/3)[0],0],s.in=[R.mul(R.sub(i,s),2/3)[0],0]):(i.out=[0,R.mul(R.sub(s,i),2/3)[1]],s.in=[0,R.mul(R.sub(i,s),2/3)[1]]),[i,s])}_generateStraightConnectorPath(e){var n,r;const{source:i,target:s}=e;if(i.id&&!i.position&&s.id&&!s.position){const o=this._getConnectorEndElement(e,"source"),a=this._getConnectorEndElement(e,"target"),l=X.deserialize(o.xywh),c=X.deserialize(a.xywh),u=zh(o,c.center),d=zh(a,l.center);return(n=u&&d&&[u,d])!=null?n:[]}else{const o=this._getConnectionPoint(e,"target"),a=this._getConnectionPoint(e,"source");return(r=a&&o&&[a,o])!=null?r:[]}}_getConnectionPoint(e,n){const r=e[n];if(!r)return null;const i=this._getConnectorEndElement(e,n);if(!i&&r.position)return wt.fromVec(r.position);if(!i)return null;let s=null;if(r.position)s=ype(i,r.position);else{const o=n==="source"?"target":"source",a=this._getConnectionPoint(e,o);a&&(s=zh(i,a))}return s}_getConnectorEndElement(e,n){const r=e[n].id;return r?this.options.getElementById(r):null}hasRelatedElement(e){const{source:n,target:r}=e;return!(n.id&&!this.options.getElementById(n.id)||r.id&&!this.options.getElementById(r.id))}}const Mpe=dO("connector-watcher",t=>{const e=l=>t.hasElementById(l)||t.store.hasBlock(l),n=l=>{var c;return(c=t.getElementById(l))!=null?c:t.store.getModelById(l)},r=l=>{var c,u,d,h,f,p;((c=l.source)!=null&&c.id&&e(l.source.id)||!((u=l.source)!=null&&u.id)&&((d=l.source)!=null&&d.position))&&((h=l.target)!=null&&h.id&&e(l.target.id)||!((f=l.target)!=null&&f.id)&&((p=l.target)!=null&&p.position))&&NE.updatePath(l,null,n)},i=new Set;let s=!1;const o=l=>{i.add(l),s||(s=!0,queueMicrotask(()=>{i.forEach(r),i.clear(),s=!1}))},a=[t.elementAdded.subscribe(({id:l})=>{const c=n(l);c&&("type"in c&&c.type==="connector"?o(c):t.getConnectors(l).forEach(o))}),t.elementUpdated.subscribe(({id:l,props:c})=>{const u=n(l);(c.xywh||c.rotate)&&t.getConnectors(l).forEach(o),"type"in u&&u.type==="connector"&&(c.mode!==void 0||c.target||c.source)&&o(u)}),t.store.slots.blockUpdated.subscribe(l=>{(l.type==="add"||l.type==="update"&&l.props.key==="xywh")&&t.getConnectors(l.id).forEach(o)})];return t.getElementsByType("connector").forEach(l=>r(l)),()=>{a.forEach(l=>l.unsubscribe())}});class Dpe extends it{constructor(){super(...arguments),this.name="affine-connector-gfx"}setup(e){super.setup(e),e.register(gpe),e.register(mpe),e.register(Mpe)}}function qO(t){let e="";if(t.type!=="group")return e;if("title"in t&&typeof t.title=="object"&&t.title){let n=[];"delta"in t.title&&(n=t.title.delta),e=n.map(r=>r.insert).join("")}return e}const Npe=Xc({name:"group",match:t=>t.type==="group",toAST:t=>{const e=qO(t);return e?{type:"paragraph",children:[{type:"text",value:`Group, with title "${e}"`}]}:null}}),Ope=Kc({name:"group",match:t=>t.type==="group",toAST:t=>({content:`Group, with title "${qO(t)}"`})}),Ppe=dO("group-relation-watcher",t=>{const e=[t.elementUpdated.subscribe(({id:n,props:r,local:i})=>{if(!i)return;const s=t.getElementById(n);s instanceof dc&&r.childIds&&s.childIds.length===0&&t.deleteElement(n)})];return()=>{e.forEach(n=>n.unsubscribe())}});class Lpe extends it{constructor(){super(...arguments),this.name="affine-group-gfx"}setup(e){super.setup(e),e.register(Ope),e.register(Npe),e.register(Ppe)}}function XO(t){let e="";return t.type!=="shape"||"shapeType"in t&&typeof t.shapeType=="string"&&(e=t.shapeType),e}function Dm(t){let e="";if(t.type!=="shape")return e;if("text"in t&&typeof t.text=="object"&&t.text){let n=[];"delta"in t.text&&(n=t.text.delta),e=n.map(r=>r.insert).join("")}return e}const Rpe=Xc({name:"shape",match:t=>t.type==="shape",toAST:(t,e)=>{let n="";const{walkerContext:r}=e,i=r.getGlobalContext("surface:mindMap:nodeMapArray");if(i&&i.length>0&&i.some(c=>c.has(t.id)))return null;const s=Dm(t),o=XO(t);return!s&&!o?null:(n=`${o.charAt(0).toUpperCase()+o.slice(1)}, with text label "${s}"`,{type:"paragraph",children:[{type:"text",value:n}]})}}),Bpe=Kc({name:"shape",match:t=>t.type==="shape",toAST:(t,e)=>{let n="";const{walkerContext:r}=e,i=r.getGlobalContext("surface:mindMap:nodeMapArray");if(i&&i.length>0&&i.some(c=>c.has(t.id)))return{content:n};const s=Dm(t),o=XO(t);return n=`${o.charAt(0).toUpperCase()+o.slice(1)}, with text label "${s}"`,{content:n}}});function KO(t){let e="";if(t.type!=="text")return e;if("text"in t&&typeof t.text=="object"&&t.text){let n=[];"delta"in t.text&&(n=t.text.delta),e=n.map(r=>r.insert).join("")}return e}const Fpe=Xc({name:"text",match:t=>t.type==="text",toAST:t=>{const e=KO(t);return e?{type:"paragraph",children:[{type:"text",value:e}]}:null}}),Upe=Kc({name:"text",match:t=>t.type==="text",toAST:t=>({content:KO(t)})}),$pe=Xc({name:"mindmap",match:t=>t.type==="mindmap",toAST:(t,e)=>{if(t.type!=="mindmap")return null;const n=hI(t);if(!n)return null;const{walkerContext:r,elements:i}=e,s=o=>{const a=i[o.id],l=Dm(a);r.openNode({type:"listItem",spread:!1,children:[]},"children").openNode({type:"paragraph",children:[{type:"text",value:l}]},"children").closeNode(),o.children.forEach(c=>{s(c),r.closeNode()})};return r.openNode({type:"list",ordered:!1,spread:!1,children:[]},"children"),s(n),r.closeNode().closeNode(),null}});function Hpe(t,e,n={prefix:" ",repeat:2}){let r="";if(t.type!=="mindmap")return r;const i=hI(t);if(!i)return r;let s=0;const o=(a,l,c)=>{const u=e[a.id],d=Dm(u);u&&(r+=`${l.repeat(s*c)}- ${d}
`),a.children.forEach(h=>{s++,o(h,l,c),s--})};return o(i,n.prefix,n.repeat),r}const zpe=Kc({name:"mindmap",match:t=>t.type==="mindmap",toAST:(t,e)=>({content:Hpe(t,e.elements)})});class Wpe extends it{constructor(){super(...arguments),this.name="affine-mindmap-gfx"}setup(e){super.setup(e),e.register(zpe),e.register($pe)}}class jpe extends it{constructor(){super(...arguments),this.name="affine-shape-gfx"}setup(e){super.setup(e),e.register(Rpe),e.register(Bpe)}}class Ype extends it{constructor(){super(...arguments),this.name="affine-text-gfx"}setup(e){super.setup(e),e.register(Fpe),e.register(Upe)}}class Gpe extends it{constructor(){super(...arguments),this.name="affine-footnote-inline"}setup(e){super.setup(e),e.register(ile),e.register(rle),e.register(ale)}}class Vpe extends it{constructor(){super(...arguments),this.name="affine-latex-inline"}setup(e){super.setup(e),e.register(ule),e.register(lle),e.register(cle)}}class qpe extends it{constructor(){super(...arguments),this.name="affine-link-inline"}setup(e){super.setup(e),e.register(nle),e.register(Jae),e.register(tle),e.register(ele),e.register(Qae),e.register(Zae)}}class Xpe extends it{constructor(){super(...arguments),this.name="affine-inline-preset"}setup(e){super.setup(e),e.register(Kae)}}class Kpe extends it{constructor(){super(...arguments),this.name="affine-reference-inline"}setup(e){super.setup(e),e.register(Woe),e.register(joe),e.register(Yoe)}}function Qpe(){return[dpe,Lde,Kde,the,phe,mhe,bhe,Ahe,Ihe,Phe,Khe,Qhe,ofe,xfe,vfe,kfe,Sfe,Rfe,upe,Lfe,Pfe,Gpe,qpe,Kpe,Vpe,Xpe,ppe,jpe,Wpe,Dpe,Lpe,Ype]}const Zpe=new jue(Qpe());function Jpe(){return Zpe}function eme(){customElements.define("affine-editor-container",Hh)}eme();async function QO(t){const e=document.getElementById(t);if(!e){console.error(`Element with id ${t} not found`);return}new lT().register(lde);const r=new _de({id:"simple-playground"}),i=Jpe();r.storeExtensions=i.get("store"),r.start();const o=r.createDoc("doc:home").getStore({id:"doc:home"});o.load();const a=o.addBlock("affine:page",{});o.addBlock("affine:surface",{},a);const l=o.addBlock("affine:note",{},a);o.addBlock("affine:paragraph",{},l);const c=new Hh;return c.doc=o,c.mode="page",e.appendChild(c),c}window.initBlockSuite=QO;var Nm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var ZO;function tme(){return ZO||(ZO=1,Nm.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?i-1:0,h=n?-1:1,f=t[e+d];for(d+=h,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+d],d+=h,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-c}return(f?-1:1)*o*Math.pow(2,s-r)},Nm.write=function(t,e,n,r,i,s){var o,a,l,c=s*8-i-1,u=(1<<c)-1,d=u>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+d>=1?e+=h/l:e+=h*Math.pow(2,1-d),e*l>=2&&(o++,l/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*l-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[n+f]=o&255,f+=p,o/=256,c-=8);t[n+f-p]|=g*128}),Nm}tme();function Sr(t){return new DataView(t.buffer,t.byteOffset)}const nme={len:1,get(t,e){return Sr(t).getUint8(e)},put(t,e,n){return Sr(t).setUint8(e,n),e+1}},Ut={len:2,get(t,e){return Sr(t).getUint16(e,!0)},put(t,e,n){return Sr(t).setUint16(e,n,!0),e+2}},jh={len:2,get(t,e){return Sr(t).getUint16(e)},put(t,e,n){return Sr(t).setUint16(e,n),e+2}},Dn={len:4,get(t,e){return Sr(t).getUint32(e,!0)},put(t,e,n){return Sr(t).setUint32(e,n,!0),e+4}},rme={len:4,get(t,e){return Sr(t).getUint32(e)},put(t,e,n){return Sr(t).setUint32(e,n),e+4}},ime={len:4,get(t,e){return Sr(t).getInt32(e)},put(t,e,n){return Sr(t).setInt32(e,n),e+4}},sme={len:8,get(t,e){return Sr(t).getBigUint64(e,!0)},put(t,e,n){return Sr(t).setBigUint64(e,n,!0),e+8}};class ao{constructor(e,n){this.len=e,this.encoding=n,this.textDecoder=new TextDecoder(n)}get(e,n){return this.textDecoder.decode(e.subarray(n,n+this.len))}}const ome="End-Of-Stream";class si extends Error{constructor(){super(ome),this.name="EndOfStreamError"}}class ame extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class JO{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(e,n=!1){const r=await this.read(e,n);return this.peekQueue.push(e.subarray(0,r)),r}async read(e,n=!1){if(e.length===0)return 0;let r=this.readFromPeekBuffer(e);if(this.endOfStream||(r+=await this.readRemainderFromStream(e.subarray(r),n)),r===0&&!n)throw new si;return r}readFromPeekBuffer(e){let n=e.length,r=0;for(;this.peekQueue.length>0&&n>0;){const i=this.peekQueue.pop();if(!i)throw new Error("peekData should be defined");const s=Math.min(i.length,n);e.set(i.subarray(0,s),r),r+=s,n-=s,s<i.length&&this.peekQueue.push(i.subarray(s))}return r}async readRemainderFromStream(e,n){let r=0;for(;r<e.length&&!this.endOfStream;){if(this.interrupted)throw new ame;const i=await this.readFromStream(e.subarray(r),n);if(i===0)break;r+=i}if(!n&&r<e.length)throw new si;return r}}class lme extends JO{constructor(e){super(),this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class cme extends lme{async readFromStream(e,n){if(e.length===0)return 0;const r=await this.reader.read(new Uint8Array(e.length),{min:n?void 0:e.length});return r.done&&(this.endOfStream=r.done),r.value?(e.set(r.value),r.value.length):0}}class e6 extends JO{constructor(e){super(),this.reader=e,this.buffer=null}writeChunk(e,n){const r=Math.min(n.length,e.length);return e.set(n.subarray(0,r)),r<n.length?this.buffer=n.subarray(r):this.buffer=null,r}async readFromStream(e,n){if(e.length===0)return 0;let r=0;for(this.buffer&&(r+=this.writeChunk(e,this.buffer));r<e.length&&!this.endOfStream;){const i=await this.reader.read();if(i.done){this.endOfStream=!0;break}i.value&&(r+=this.writeChunk(e.subarray(r),i.value))}if(!n&&r===0&&this.endOfStream)throw new si;return r}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}function ume(t){try{const e=t.getReader({mode:"byob"});return e instanceof ReadableStreamDefaultReader?new e6(e):new cme(e)}catch(e){if(e instanceof TypeError)return new e6(t.getReader());throw e}}class t6{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e==null?void 0:e.onClose,e!=null&&e.abortSignal&&e.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(e,n=this.position){const r=new Uint8Array(e.len);if(await this.readBuffer(r,{position:n})<e.len)throw new si;return e.get(r,0)}async peekToken(e,n=this.position){const r=new Uint8Array(e.len);if(await this.peekBuffer(r,{position:n})<e.len)throw new si;return e.get(r,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new si;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new si;return e.get(this.numBuffer,0)}async ignore(e){if(this.fileInfo.size!==void 0){const n=this.fileInfo.size-this.position;if(e>n)return this.position+=n,n}return this.position+=e,e}async close(){var e;await this.abort(),await((e=this.onClose)==null?void 0:e.call(this))}normalizeOptions(e,n){if(!this.supportsRandomAccess()&&n&&n.position!==void 0&&n.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:e.length,position:this.position,...n}}abort(){return Promise.resolve()}}const dme=256e3;class hme extends t6{constructor(e,n){super(n),this.streamReader=e,this.fileInfo=(n==null?void 0:n.fileInfo)??{}}async readBuffer(e,n){const r=this.normalizeOptions(e,n),i=r.position-this.position;if(i>0)return await this.ignore(i),this.readBuffer(e,n);if(i<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(r.length===0)return 0;const s=await this.streamReader.read(e.subarray(0,r.length),r.mayBeLess);if(this.position+=s,(!n||!n.mayBeLess)&&s<r.length)throw new si;return s}async peekBuffer(e,n){const r=this.normalizeOptions(e,n);let i=0;if(r.position){const s=r.position-this.position;if(s>0){const o=new Uint8Array(r.length+s);return i=await this.peekBuffer(o,{mayBeLess:r.mayBeLess}),e.set(o.subarray(s)),i-s}if(s<0)throw new Error("Cannot peek from a negative offset in a stream")}if(r.length>0){try{i=await this.streamReader.peek(e.subarray(0,r.length),r.mayBeLess)}catch(s){if(n!=null&&n.mayBeLess&&s instanceof si)return 0;throw s}if(!r.mayBeLess&&i<r.length)throw new si}return i}async ignore(e){const n=Math.min(dme,e),r=new Uint8Array(n);let i=0;for(;i<e;){const s=e-i,o=await this.readBuffer(r,{length:Math.min(n,s)});if(o<0)return o;i+=o}return i}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class fme extends t6{constructor(e,n){super(n),this.uint8Array=e,this.fileInfo={...(n==null?void 0:n.fileInfo)??{},size:e.length}}async readBuffer(e,n){n!=null&&n.position&&(this.position=n.position);const r=await this.peekBuffer(e,n);return this.position+=r,r}async peekBuffer(e,n){const r=this.normalizeOptions(e,n),i=Math.min(this.uint8Array.length-r.position,r.length);if(!r.mayBeLess&&i<r.length)throw new si;return e.set(this.uint8Array.subarray(r.position,r.position+i)),i}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}function pme(t,e){const n=ume(t),r=e??{},i=r.onClose;return r.onClose=async()=>{if(await n.close(),i)return i()},new hme(n,r)}function mme(t,e){return new fme(t,e)}var Hr=Uint8Array,eu=Uint16Array,gme=Int32Array,n6=new Hr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r6=new Hr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bme=new Hr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i6=function(t,e){for(var n=new eu(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new gme(n[30]),r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return{b:n,r:i}},s6=i6(n6,2),o6=s6.b,yme=s6.r;o6[28]=258,yme[258]=28;for(var _me=i6(r6,0),xme=_me.b,OE=new eu(32768),Ct=0;Ct<32768;++Ct){var da=(Ct&43690)>>1|(Ct&21845)<<1;da=(da&52428)>>2|(da&13107)<<2,da=(da&61680)>>4|(da&3855)<<4,OE[Ct]=((da&65280)>>8|(da&255)<<8)>>1}for(var Yh=function(t,e,n){for(var r=t.length,i=0,s=new eu(e);i<r;++i)t[i]&&++s[t[i]-1];var o=new eu(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(n){a=new eu(1<<e);var l=15-e;for(i=0;i<r;++i)if(t[i])for(var c=i<<4|t[i],u=e-t[i],d=o[t[i]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[OE[d]>>l]=c}else for(a=new eu(r),i=0;i<r;++i)t[i]&&(a[i]=OE[o[t[i]-1]++]>>15-t[i]);return a},Gh=new Hr(288),Ct=0;Ct<144;++Ct)Gh[Ct]=8;for(var Ct=144;Ct<256;++Ct)Gh[Ct]=9;for(var Ct=256;Ct<280;++Ct)Gh[Ct]=7;for(var Ct=280;Ct<288;++Ct)Gh[Ct]=8;for(var a6=new Hr(32),Ct=0;Ct<32;++Ct)a6[Ct]=5;var Eme=Yh(Gh,9,1),vme=Yh(a6,5,1),PE=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Mi=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},LE=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},wme=function(t){return(t+7)/8|0},kme=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new Hr(t.subarray(e,n))},Tme=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],zr=function(t,e,n){var r=new Error(e||Tme[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,zr),!n)throw r;return r},RE=function(t,e,n,r){var i=t.length,s=0;if(!i||e.f&&!e.l)return n||new Hr(0);var o=!n,a=o||e.i!=2,l=e.i;o&&(n=new Hr(i*3));var c=function(Gt){var Hn=n.length;if(Gt>Hn){var Jn=new Hr(Math.max(Hn*2,Gt));Jn.set(n),n=Jn}},u=e.f||0,d=e.p||0,h=e.b||0,f=e.l,p=e.d,g=e.m,b=e.n,_=i*8;do{if(!f){u=Mi(t,d,1);var y=Mi(t,d+1,3);if(d+=3,y)if(y==1)f=Eme,p=vme,g=9,b=5;else if(y==2){var v=Mi(t,d,31)+257,N=Mi(t,d+10,15)+4,L=v+Mi(t,d+5,31)+1;d+=14;for(var z=new Hr(L),M=new Hr(19),B=0;B<N;++B)M[bme[B]]=Mi(t,d+B*3,7);d+=N*3;for(var $=PE(M),se=(1<<$)-1,be=Yh(M,$,1),B=0;B<L;){var _e=be[Mi(t,d,se)];d+=_e&15;var x=_e>>4;if(x<16)z[B++]=x;else{var we=0,de=0;for(x==16?(de=3+Mi(t,d,3),d+=2,we=z[B-1]):x==17?(de=3+Mi(t,d,7),d+=3):x==18&&(de=11+Mi(t,d,127),d+=7);de--;)z[B++]=we}}var Ue=z.subarray(0,v),Se=z.subarray(v);g=PE(Ue),b=PE(Se),f=Yh(Ue,g,1),p=Yh(Se,b,1)}else zr(1);else{var x=wme(d)+4,E=t[x-4]|t[x-3]<<8,I=x+E;if(I>i){l&&zr(0);break}a&&c(h+E),n.set(t.subarray(x,I),h),e.b=h+=E,e.p=d=I*8,e.f=u;continue}if(d>_){l&&zr(0);break}}a&&c(h+131072);for(var C=(1<<g)-1,he=(1<<b)-1,qe=d;;qe=d){var we=f[LE(t,d)&C],A=we>>4;if(d+=we&15,d>_){l&&zr(0);break}if(we||zr(2),A<256)n[h++]=A;else if(A==256){qe=d,f=null;break}else{var ot=A-254;if(A>264){var B=A-257,Ce=n6[B];ot=Mi(t,d,(1<<Ce)-1)+o6[B],d+=Ce}var Xe=p[LE(t,d)&he],Zn=Xe>>4;Xe||zr(3),d+=Xe&15;var Se=xme[Zn];if(Zn>3){var Ce=r6[Zn];Se+=LE(t,d)&(1<<Ce)-1,d+=Ce}if(d>_){l&&zr(0);break}a&&c(h+131072);var xn=h+ot;if(h<Se){var En=s-Se,$n=Math.min(Se,xn);for(En+h<0&&zr(3);h<$n;++h)n[h]=r[En+h]}for(;h<xn;++h)n[h]=n[h-Se]}}e.l=f,e.p=qe,e.b=h,e.f=u,f&&(u=1,e.m=g,e.d=p,e.n=b)}while(!u);return h!=n.length&&o?kme(n,0,h):n.subarray(0,h)},Sme=new Hr(0),Cme=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&zr(6,"invalid gzip data");var e=t[3],n=10;e&4&&(n+=(t[10]|t[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(e&2)},Ame=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Ime=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&zr(6,"invalid zlib data"),(t[1]>>5&1)==1&&zr(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Mme(t,e){return RE(t,{i:2},e,e)}function Dme(t,e){var n=Cme(t);return n+8>t.length&&zr(6,"invalid gzip data"),RE(t.subarray(n,-8),{i:2},new Hr(Ame(t)),e)}function Nme(t,e){return RE(t.subarray(Ime(t),-4),{i:2},e,e)}function Ome(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Dme(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Mme(t,e):Nme(t,e)}var Pme=typeof TextDecoder<"u"&&new TextDecoder,Lme=0;try{Pme.decode(Sme,{stream:!0}),Lme=1}catch{}var Om={exports:{}},BE,l6;function Rme(){if(l6)return BE;l6=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;BE=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=e?Math.round(u/e)+"m":d>=t?Math.round(u/t)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=n?c(u,d,n,"hour"):d>=e?c(u,d,e,"minute"):d>=t?c(u,d,t,"second"):u+" ms"}function c(u,d,h,f){var p=d>=h*1.5;return Math.round(u/h)+" "+f+(p?"s":"")}return BE}var FE,c6;function Bme(){if(c6)return FE;c6=1;function t(e){r.debug=r,r.default=r,r.coerce=c,r.disable=a,r.enable=s,r.enabled=l,r.humanize=Rme(),r.destroy=u,Object.keys(e).forEach(d=>{r[d]=e[d]}),r.names=[],r.skips=[],r.formatters={};function n(d){let h=0;for(let f=0;f<d.length;f++)h=(h<<5)-h+d.charCodeAt(f),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=n;function r(d){let h,f=null,p,g;function b(..._){if(!b.enabled)return;const y=b,x=Number(new Date),E=x-(h||x);y.diff=E,y.prev=h,y.curr=x,h=x,_[0]=r.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let I=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(N,L)=>{if(N==="%%")return"%";I++;const z=r.formatters[L];if(typeof z=="function"){const M=_[I];N=z.call(y,M),_.splice(I,1),I--}return N}),r.formatArgs.call(y,_),(y.log||r.log).apply(y,_)}return b.namespace=d,b.useColors=r.useColors(),b.color=r.selectColor(d),b.extend=i,b.destroy=r.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(p!==r.namespaces&&(p=r.namespaces,g=r.enabled(d)),g),set:_=>{f=_}}),typeof r.init=="function"&&r.init(b),b}function i(d,h){const f=r(this.namespace+(typeof h>"u"?":":h)+d);return f.log=this.log,f}function s(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];const h=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const f of h)f[0]==="-"?r.skips.push(f.slice(1)):r.names.push(f)}function o(d,h){let f=0,p=0,g=-1,b=0;for(;f<d.length;)if(p<h.length&&(h[p]===d[f]||h[p]==="*"))h[p]==="*"?(g=p,b=f,p++):(f++,p++);else if(g!==-1)p=g+1,b++,f=b;else return!1;for(;p<h.length&&h[p]==="*";)p++;return p===h.length}function a(){const d=[...r.names,...r.skips.map(h=>"-"+h)].join(",");return r.enable(""),d}function l(d){for(const h of r.skips)if(o(d,h))return!1;for(const h of r.names)if(o(d,h))return!0;return!1}function c(d){return d instanceof Error?d.stack||d.message:d}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return FE=t,FE}var u6;function Fme(){return u6||(u6=1,function(t,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=n,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(u++,h==="%c"&&(d=u))}),l.splice(d,0,c)}e.log=console.debug||console.log||(()=>{});function i(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function s(){let l;try{l=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function o(){try{return localStorage}catch{}}t.exports=Bme()(e);const{formatters:a}=t.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}(Om,Om.exports)),Om.exports}var Ume=Fme();const $me=ep(Ume),tu={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256},d6={get(t){return Ut.get(t,6),{signature:Dn.get(t,0),compressedSize:Dn.get(t,8),uncompressedSize:Dn.get(t,12)}},len:16},Hme={get(t){const e=Ut.get(t,6);return{signature:Dn.get(t,0),minVersion:Ut.get(t,4),dataDescriptor:!!(e&8),compressedMethod:Ut.get(t,8),compressedSize:Dn.get(t,18),uncompressedSize:Dn.get(t,22),filenameLength:Ut.get(t,26),extraFieldLength:Ut.get(t,28),filename:null}},len:30},zme={get(t){return{signature:Dn.get(t,0),nrOfThisDisk:Ut.get(t,4),nrOfThisDiskWithTheStart:Ut.get(t,6),nrOfEntriesOnThisDisk:Ut.get(t,8),nrOfEntriesOfSize:Ut.get(t,10),sizeOfCd:Dn.get(t,12),offsetOfStartOfCd:Dn.get(t,16),zipFileCommentLength:Ut.get(t,20)}},len:22},Wme={get(t){const e=Ut.get(t,8);return{signature:Dn.get(t,0),minVersion:Ut.get(t,6),dataDescriptor:!!(e&8),compressedMethod:Ut.get(t,10),compressedSize:Dn.get(t,20),uncompressedSize:Dn.get(t,24),filenameLength:Ut.get(t,28),extraFieldLength:Ut.get(t,30),fileCommentLength:Ut.get(t,32),relativeOffsetOfLocalHeader:Dn.get(t,42),filename:null}},len:46};function h6(t){const e=new Uint8Array(Dn.len);return Dn.put(e,0,t),e}const bs=$me("tokenizer:inflate"),UE=256*1024,jme=h6(tu.DataDescriptor),Pm=h6(tu.EndOfCentralDirectory);class Yme{constructor(e){this.tokenizer=e,this.syncBuffer=new Uint8Array(UE)}async isZip(){return await this.peekSignature()===tu.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(Dn)}async findEndOfCentralDirectoryLocator(){const e=this.tokenizer,n=Math.min(16*1024,e.fileInfo.size),r=this.syncBuffer.subarray(0,n);await this.tokenizer.readBuffer(r,{position:e.fileInfo.size-n});for(let i=r.length-4;i>=0;i--)if(r[i]===Pm[0]&&r[i+1]===Pm[1]&&r[i+2]===Pm[2]&&r[i+3]===Pm[3])return e.fileInfo.size-n+i;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){bs("Cannot reading central-directory without random-read support");return}bs("Reading central-directory...");const e=this.tokenizer.position,n=await this.findEndOfCentralDirectoryLocator();if(n>0){bs("Central-directory 32-bit signature found");const r=await this.tokenizer.readToken(zme,n),i=[];this.tokenizer.setPosition(r.offsetOfStartOfCd);for(let s=0;s<r.nrOfEntriesOfSize;++s){const o=await this.tokenizer.readToken(Wme);if(o.signature!==tu.CentralFileHeader)throw new Error("Expected Central-File-Header signature");o.filename=await this.tokenizer.readToken(new ao(o.filenameLength,"utf-8")),await this.tokenizer.ignore(o.extraFieldLength),await this.tokenizer.ignore(o.fileCommentLength),i.push(o),bs(`Add central-directory file-entry: n=${s+1}/${i.length}: filename=${i[s].filename}`)}return this.tokenizer.setPosition(e),i}this.tokenizer.setPosition(e)}async unzip(e){const n=await this.readCentralDirectory();if(n)return this.iterateOverCentralDirectory(n,e);let r=!1;do{const i=await this.readLocalFileHeader();if(!i)break;const s=e(i);r=!!s.stop;let o;if(await this.tokenizer.ignore(i.extraFieldLength),i.dataDescriptor&&i.compressedSize===0){const a=[];let l=UE;bs("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let c=-1;for(;c<0&&l===UE;){l=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),c=Gme(this.syncBuffer.subarray(0,l),jme);const u=c>=0?c:l;if(s.handler){const d=new Uint8Array(u);await this.tokenizer.readBuffer(d),a.push(d)}else await this.tokenizer.ignore(u)}bs(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),s.handler&&await this.inflate(i,Vme(a),s.handler)}else s.handler?(bs(`Reading compressed-file-data: ${i.compressedSize} bytes`),o=new Uint8Array(i.compressedSize),await this.tokenizer.readBuffer(o),await this.inflate(i,o,s.handler)):(bs(`Ignoring compressed-file-data: ${i.compressedSize} bytes`),await this.tokenizer.ignore(i.compressedSize));if(bs(`Reading data-descriptor at pos=${this.tokenizer.position}`),i.dataDescriptor&&(await this.tokenizer.readToken(d6)).signature!==134695760)throw new Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-d6.len}`)}while(!r)}async iterateOverCentralDirectory(e,n){for(const r of e){const i=n(r);if(i.handler){this.tokenizer.setPosition(r.relativeOffsetOfLocalHeader);const s=await this.readLocalFileHeader();if(s){await this.tokenizer.ignore(s.extraFieldLength);const o=new Uint8Array(r.compressedSize);await this.tokenizer.readBuffer(o),await this.inflate(s,o,i.handler)}}if(i.stop)break}}inflate(e,n,r){if(e.compressedMethod===0)return r(n);bs(`Decompress filename=${e.filename}, compressed-size=${n.length}`);const i=Ome(n);return r(i)}async readLocalFileHeader(){const e=await this.tokenizer.peekToken(Dn);if(e===tu.LocalFileHeader){const n=await this.tokenizer.readToken(Hme);return n.filename=await this.tokenizer.readToken(new ao(n.filenameLength,"utf-8")),n}if(e===tu.CentralFileHeader)return!1;throw e===3759263696?new Error("Encrypted ZIP"):new Error("Unexpected signature")}}function Gme(t,e){const n=t.length,r=e.length;if(r>n)return-1;for(let i=0;i<=n-r;i++){let s=!0;for(let o=0;o<r;o++)if(t[i+o]!==e[o]){s=!1;break}if(s)return i}return-1}function Vme(t){const e=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}new globalThis.TextDecoder("utf8"),new globalThis.TextEncoder,Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function f6(t){const{byteLength:e}=t;if(e===6)return t.getUint16(0)*2**32+t.getUint32(2);if(e===5)return t.getUint8(0)*2**32+t.getUint32(1);if(e===4)return t.getUint32(0);if(e===3)return t.getUint8(0)*2**16+t.getUint16(1);if(e===2)return t.getUint16(0);if(e===1)return t.getUint8(0)}function qme(t){return[...t].map(e=>e.charCodeAt(0))}function Xme(t,e=0){const n=Number.parseInt(new ao(6).get(t,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(n))return!1;let r=8*32;for(let i=e;i<e+148;i++)r+=t[i];for(let i=e+156;i<e+512;i++)r+=t[i];return n===r}const Kme={get:(t,e)=>t[e+3]&127|t[e+2]<<7|t[e+1]<<14|t[e]<<21,len:4},Qme=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx"],Zme=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia"],Lm=4100;async function Jme(t,e){return new p6(e).fromBuffer(t)}function $E(t){switch(t=t.toLowerCase(),t){case"application/epub+zip":return{ext:"epub",mime:t};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:t};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:t};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:t};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:t};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:t};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:t};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:t};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:t};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:t};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:t};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:t};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:t};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:t};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:t};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:t};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"}}}function ys(t,e,n){n={offset:0,...n};for(const[r,i]of e.entries())if(n.mask){if(i!==(n.mask[r]&t[r+n.offset]))return!1}else if(i!==t[r+n.offset])return!1;return!0}class p6{constructor(e){J(this,"detectConfident",async e=>{if(this.buffer=new Uint8Array(Lm),e.fileInfo.size===void 0&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const n=await e.readToken(Kme);return e.position+n>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(n),this.fromTokenizer(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let n;return await new Yme(e).unzip(r=>{switch(r.filename){case"META-INF/mozilla.rsa":return n={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return n={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(i){const s=new TextDecoder("utf-8").decode(i).trim();n=$E(s)},stop:!0};case"[Content_Types].xml":return{async handler(i){let s=new TextDecoder("utf-8").decode(i);const o=s.indexOf('.main+xml"');if(o===-1){const a="application/vnd.ms-package.3dmanufacturing-3dmodel+xml";s.includes(`ContentType="${a}"`)&&(n=$E(a))}else{s=s.slice(0,Math.max(0,o));const a=s.lastIndexOf('"'),l=s.slice(Math.max(0,a+1));n=$E(l)}},stop:!0};default:return/classes\d*\.dex/.test(r.filename)?(n={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0}):{}}}),n??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const n=new Uint8Array(8);return await e.readBuffer(n),ys(n,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:ys(n,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:ys(n,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:ys(n,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:ys(n,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:ys(n,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const n=await this.readTiffHeader(!1);if(n)return n}if(this.check([77,77])){const n=await this.readTiffHeader(!0);if(n)return n}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function n(){const a=await e.peekNumber(nme);let l=128,c=0;for(;(a&l)===0&&l!==0;)++c,l>>=1;const u=new Uint8Array(c+1);return await e.readBuffer(u),u}async function r(){const a=await n(),l=await n();l[0]^=128>>l.length-1;const c=Math.min(6,l.length),u=new DataView(a.buffer),d=new DataView(l.buffer,l.length-c,c);return{id:f6(u),len:f6(d)}}async function i(a){for(;a>0;){const l=await r();if(l.id===17026)return(await e.readToken(new ao(l.len))).replaceAll(/\00.*$/g,"");await e.ignore(l.len),--a}}const s=await r();switch(await i(s.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const n=new ao(4,"latin1").get(this.buffer,2);if(n.match("^d*")&&n>=1e3&&n<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await e.ignore(8),await e.readToken(new ao(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("WEBVTT")&&[`
`,"\r","	"," ","\0"].some(n=>this.checkString(n,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await e.ignore(8);async function n(){return{length:await e.readToken(ime),type:await e.readToken(new ao(4,"latin1"))}}do{const r=await n();if(r.length<0)return;switch(r.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(r.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){const n=new ao(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(n){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return n.startsWith("3g")?n.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function n(){const r=new Uint8Array(16);return await e.readBuffer(r),{id:r,size:Number(await e.readToken(sme))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const r=await n();let i=r.size-24;if(ys(r.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const s=new Uint8Array(16);if(i-=await e.readBuffer(s),ys(s,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(ys(s,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(i)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new ao(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const n=new DataView(this.buffer.buffer).getUint32(12,!0);if(n>12&&this.buffer.length>=n+16)try{const r=new TextDecoder().decode(this.buffer.subarray(16,n+16));if(JSON.parse(r).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\0",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&Xme(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"}});J(this,"detectImprecise",async e=>{if(this.buffer=new Uint8Array(Lm),await e.peekBuffer(this.buffer,{length:Math.min(8,e.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await e.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,e.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let n=0;n<=this.options.mpegOffsetTolerance;++n){const r=this.scanMpeg(n);if(r)return r}});this.options={mpegOffsetTolerance:0,...e},this.detectors=[...(e==null?void 0:e.customDetectors)??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:e==null?void 0:e.signal}}async fromTokenizer(e){const n=e.position;for(const r of this.detectors){const i=await r.detect(e);if(i)return i;if(n!==e.position)return}}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const n=e instanceof Uint8Array?e:new Uint8Array(e);if((n==null?void 0:n.length)>1)return this.fromTokenizer(mme(n,this.tokenizerOptions))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const n=await pme(e,this.tokenizerOptions);try{return await this.fromTokenizer(n)}finally{await n.close()}}async toDetectionStream(e,n){const{sampleSize:r=Lm}=n;let i,s;const o=e.getReader({mode:"byob"});try{const{value:c,done:u}=await o.read(new Uint8Array(r));if(s=c,!u&&c)try{i=await this.fromBuffer(c.subarray(0,r))}catch(d){if(!(d instanceof si))throw d;i=void 0}s=c}finally{o.releaseLock()}const a=new TransformStream({async start(c){c.enqueue(s)},transform(c,u){u.enqueue(c)}}),l=e.pipeThrough(a);return l.fileType=i,l}check(e,n){return ys(this.buffer,e,n)}checkString(e,n){return this.check(qme(e),n)}async readTiffTag(e){const n=await this.tokenizer.readToken(e?jh:Ut);switch(this.tokenizer.ignore(10),n){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const n=await this.tokenizer.readToken(e?jh:Ut);for(let r=0;r<n;++r){const i=await this.readTiffTag(e);if(i)return i}}async readTiffHeader(e){const n=(e?jh:Ut).get(this.buffer,2),r=(e?rme:Dn).get(this.buffer,4);if(n===42){if(r>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r>=8){const s=(e?jh:Ut).get(this.buffer,8),o=(e?jh:Ut).get(this.buffer,10);if(s===28&&o===254||s===31&&o===11)return{ext:"nef",mime:"image/x-nikon-nef"}}}return await this.tokenizer.ignore(r),await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(n===43)return{ext:"tif",mime:"image/tiff"}}scanMpeg(e){if(this.check([255,224],{offset:e,mask:[255,224]})){if(this.check([16],{offset:e+1,mask:[22]}))return this.check([8],{offset:e+1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:e+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:e+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:e+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}new Set(Qme),new Set(Zme);const ege=Object.freeze(Object.defineProperty({__proto__:null,FileTypeParser:p6,fileTypeFromBuffer:Jme,reasonableDetectionSizeInBytes:Lm},Symbol.toStringTag,{value:"Module"}));He.initEditor=QO,Object.defineProperty(He,Symbol.toStringTag,{value:"Module"})});
